<!-- Page 1160 of ts_138331v170000p -->

3GPP TS 38.331 version 17.0.0 Release 17
1159
ETSI TS 138331 V17.0.0 (2022-05)

The non-critical extension mechanism is the primary mechanism for introducing protocol extensions i.e the critical extension mechanism is used merely when there is a need to introduce a 'clean' message version. Such a need appears when the last message version includes a large number of non-critical extensions, which results in issues like readability, overhead associated with the extension markers. The critical extension mechanism may also be considered when it is complicated to accommodate the extensions by means of non-critical extension mechanisms.
A.4.2 Critical extension of messages and fields

The mechanisms to critically extend a message are defined in A.3.3. There are both "outer branch" and "inner branch" mechanisms available. The "outer branch" consists of a CHOICE having the name criticalExtensions, with two values, \( c I \) and criticalExtensionsFuture. The criticalExtensionsFuture branch consists of an empty SEQUENCE, while the cl branch contains the "inner branch" mechanism.

The "inner branch" structure is a CHOICE with values of the form "MessageName-rX-IEs" (e.g., "RRCConnectionReconfiguration-r8-IEs") or "spareX", with the spare values having type NULL. The "-rX-IEs" structures contain the complete structure of the message [Es for the appropriate release; i.e., the critical extension branch for the Rel-10 version of a message includes all Rel-8 and Rel-9 fields (that are not obviated in the later version), rather than containing only the additional Rel-10 fields.

The following guidelines may be used when deciding which mechanism to introduce for a particular message, i.e. only an 'outer branch', or an 'outer branch' in combination with an 'inner branch' including a certain number of spares:
- For certain messages, e.g. initial uplink messages, messages transmitted on a broadcast channel, critical extension may not be applicable.
- An outer branch may be sufficient for messages not including any fields.
- The number of spares within inner branch should reflect the likelihood that the message will be critically extended in future releases (since each release with a critical extension for the message consumes one of the spare values). The estimation of the critical extension likelihood may be based on the number, size and changeability of the fields included in the message.
- In messages where an inner branch extension mechanism is available, all spare values of the inner branch should be used before any critical extensions are added using the outer branch.

The following example illustrates the use of the critical extension mechanism by showing the ASN. 1 of the original and of a later release
```
-- /example/ ASN1START -- Original release
RRCMessage ::=
    rrc-TransactionIdentifier
    criticalExtensions
        cl
            rrcMessage-r8 RRCMessage-r8-IEs,
            spare3 NULL, spare2 NULL, sparel NULL
        },
        criticalExtensionsFuture SEQUENCE {}
    }
}
-- ASNISTOP
```


ETSI