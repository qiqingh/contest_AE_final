<!-- Page 258 of ts_138331v170000p -->

3GPP TS 38.331 version 17.0.0 Release 17
257
ETSI TS 138331 V17.0.0 (2022-05)

\( 2> \) discard the connEstFailReport from VarConnEstFailReport and VarConnEstFailReportList upon successful delivery of the UEInformationResponse message confirmed by lower layers;
\( 1> \) if the mobilityHistoryReportReq is set to true:
\( 2> \) include the mobilityHistoryReport and set it to include visitedCellInfoList from VarMobilityHistoryReport;
\( 2> \) include in the mobilityHistoryReport an entry for the current PCell, possibly after removing the oldest entry if required, and set its fields as follows:

3> set visitedCellld to the global cell identity or the physical cell identity and carrier frequency of the current PCell:
\( 3> \) set field timeSpent to the time spent in the current PCell;
3> if visitedPSCellInfoList is present in VarMobilityHistoryReport:
4> for the newest entry of the PCell in the mobiliyHistoryReport, include visitedPSCellInfoList from VarMobilityHistoryReport;

4> if the UE is configured with a PSCell:
\( 5> \) for the newest entry of the PCell in the mobiliyHistoryReport, include the current PSCell information in the visitedPSCellInfoList, possibly after removing the oldest entry, if required, and set its fields as follows:

6> set visitedCellld to the global cell identity or the physical cell identity and carrier frequency of the current PSCell:

6> set field timeSpent to the time spent in the current PSCell while being connected to the current PCell;

4> else:
5> for the newest entry of the PCell in the mobiliyHistoryReport, include a new entry in the visitedPSCellInfoList, possibly after removing the oldest entry, if required, and set its fields as follows:

6> set field timeSpent to the time spent without PSCell in the current PCell since last PSCell release or secondary cell radio link failure since connected to the current PCell in RRC_CONNECTED;

3> else:
4> if the UE is configured with a PSCell:
\( 5> \) for the newest entry of the PCell in the mobiliyHistoryReport, include the current PSCell information in the visitedPSCellInfoList, possibly after removing the oldest entry, if required, and set its fields as follows:

6> set visitedCellld to the global cell identity or the physical cell identity and carrier frequency of the current PSCell:

6> set field timeSpent to the time spent in the current PSCell while being connected to the current PCell;
\( 4> \) else:
5> for the newest entry of the PCell in the mobiliyHistoryReport, include a new entry in the visitedPSCellInfoList, possibly after removing the oldest entry, if required, and set its fields as follows:

6> set field timeSpent to the time spent without PSCell in the current PCell since connected to the current PCell in RRC_CONNECTED;

1> if the successHO-ReportReq is set to true and if the RPLMN is included in the plmn-IdentityList stored in VarSuccessHO-Report:

ETSI