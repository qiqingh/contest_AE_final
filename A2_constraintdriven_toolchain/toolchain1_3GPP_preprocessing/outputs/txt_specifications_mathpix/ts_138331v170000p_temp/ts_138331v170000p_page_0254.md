<!-- Page 254 of ts_138331v170000p -->

3GPP TS 38.331 version 17.0.0 Release 17
253
ETSI TS 138331 V17.0.0 (2022-05)

3> set the field timeSpent of the entry according to following:
4> if this is the first PSCell entry for the current PCell since entering the current PCell in RRC_CONNECTED:
\( 5> \) include the entry as the time spent with no PSCell since entering the current PCell in RRC_CONNECTED;

4> else:
\( 5> \) include the time spent with no PSCell since last PSCell release or SCG failure since entering the current PCell in RRC_CONNECTED;

1> Upon change, or release of a PSCell or upon declaring failure in a PSCell (SCG RLF or SCG HOF) while being connected to the current PCell:
\( 2> \) include an entry in visitedPSCellInfoList of the variable VarMobilityHistoryReport possibly after removing the oldest entry, if necessary, according to following:

3> if the global cell identity of the previous PSCell is available:
\( 4> \) include the global cell identity of that cell in the field visitedCellld of the entry;
3> else:
\( 4> \) include the physical cell identity and carrier frequency of that cell in the field visitedCellld of the entry;
\( 3> \) set the field timeSpent of the entry as the time spent in the previous PSCell while being connected to the current PCell;

1> Upon change of suitable cell, consisting of PCell in RRC_CONNECTED (for NR or E-UTRA cell) or serving cell in RRC_INACTIVE (for NR cell) or in RRC_IDLE (for NR or E-UTRA cell), to another NR or E-UTRA cell, or when entering any cell selection' state from 'camped normally' state in NR or LTE or when entering 'any cell selection' state from a suitable cell in RRC_CONNECTED state in NR or LTE:
\( 2> \) include an entry in visitedCellInfoList of the variable VarMobilityHistoryReport possibly after removing the oldest entry, if necessary, according to following:

3> if the global cell identity of the previous PCell/serving cell is available:
4> include the global cell identity of that cell in the field visitedCellld of the entry;
3> else:
\( 4> \) include the physical cell identity and carrier frequency of that cell in the field visitedCellld of the entry;

3> set the field timeSpent of the entry as the time spent in the previous PCell/serving cell;
3> if the UE continues to be connected to the same PSCell during the change of the PCell in
RRC_CONNECTED:
\( 4> \) include an entry in visitedPSCellInfoList of the variable VarMobilityHistoryReport possibly after removing the oldest entry, if necessary, according to following:
\( 5> \) if the global cell identity of the PSCell is available:
\( 6> \) include the global cell identity of that cell in the field visitedCellld of the entry;
\( 5> \) else:
6> include the physical cell identity and carrier frequency of that cell in the field visitedCellld of the entry;
\( 5> \) set the field timeSpent of the entry as the time spent in the PSCell, while being connected to previous PCell;

ETSI