<!-- Page 216 of ts_138331v170000p -->

3GPP TS 38.331 version 17.0.0 Release 17
215
ETSI TS 138331 V17.0.0 (2022-05)

\( 2> \) if this fallback band combination is generated by releasing at least one SCell or uplink configuration of SCell or SUL according to TS 38.306 [26]:
\( 3> \) remove the band combination from the list of "candidate band combinations";
NOTE 5: Even if the network requests (only) capabilities for \( n r \), it may include E-UTRA band numbers in the frequencyBandListFilter to ensure that the UE includes all necessary feature sets needed for subsequently requested eutra-nr capabilities. At this point of the procedure the list of "candidate band combinations" contains all NR- and/or E-UTRA-NR band combinations that match the filter (frequencyBandListFilter) provided by the NW and that match the eutra-nr-only flag (if RAT-Type n \( r \) is requested by E-UTRA). In the following, this candidate list is used to derive the band combinations, feature set combinations and feature sets to be reported in the requested capability container.
\( 1> \) if the requested rat-Type is \( n r \) :
\( 2> \) include into supportedBandCombinationList as many NR-only band combinations as possible from the list of "candidate band combinations", starting from the first entry;

3> if srs-SwitchingTimeRequest is received:
4> if SRS carrier switching is supported;
\( 5> \) include srs-SwitchingTimesListNR for each band combination;
4> set srs-SwitchingTimeRequested to true;
\( 2> \) include, into featureSetCombinations, the feature set combinations referenced from the supported band combinations as included in supportedBandCombinationList according to the previous;
\( 2> \) compile a list of "candidate feature set combinations" referenced from the list of "candidate band combinations" excluding entries (rows in feature set combinations) with same or lower capabilities;
\( 2> \) if uplinkTxSwitchRequest is received:
3> include into supportedBandCombinationList-UplinkTxSwitch as many NR-only band combinations that supported UL TX switching as possible from the list of "candidate band combinations", starting from the first entry;

4> if srs-SwitchingTimeRequest is received:
\( 5> \) if SRS carrier switching is supported;
\( 6> \) include srs-SwitchingTimesListNR for each band combination;
\( 5> \) set srs-SwitchingTimeRequested to true;
3> include, into featureSetCombinations, the feature set combinations referenced from the supported band combinations as included in supportedBandCombinationList-UplinkTxSwitch according to the previous;

NOTE 6: This list of "candidate feature set combinations" contains the feature set combinations used for NR-only as well as E-UTRA-NR band combinations. It is used to derive a list of NR feature sets referred to from the feature set combinations in the UE-NR-Capability and from the feature set combinations in a UE-MRDC-Capability container.
\( 2> \) include into featureSets the feature sets referenced from the "candidate feature set combinations" and may exclude the feature sets with the parameters that exceed any of maxBandwidthRequestedDL, maxBandwidthRequestedUL, maxCarriersRequestedDL or maxCarriersRequestedUL, whichever are received;
\( 1> \) else, if the requested rat-Type is eutra-nr:
\( 2> \) include into supportedBandCombinationList and/or supportedBandCombinationListNEDC-Only as many E-UTRA-NR band combinations as possible from the list of "candidate band combinations", starting from the first entry;

3> if srs-SwitchingTimeRequest is received:

ETSI