<!-- Page 311 of ts_138331v170000p -->

3GPP TS 38.331 version 17.0.0 Release 17
310
ETSI TS 138331 V17.0.0 (2022-05)

\( 2> \) set \( s / \)-ResultDMRS within sl-MeasResult to include the NR sidelink DMRS based quantity indicated in the slReportQuantity within the concerned sl-ReportConfig;
\( 1> \) increment the \( s \)-NumberOfReportsSent as defined within the VarMeasReportListSSL for this sl-Measld by 1 ;
\( 1> \) stop the periodical reporting timer, if running;
\( 1> \) if the \( s / \)-NumberOfReportsSent as defined within the VarMeasReportListSL for this \( s / \)-Measld is less than the \( s / \) ReportAmount as defined within the corresponding sl-ReportConfig for this s/-Measld:
\( 2> \) start the periodical reporting timer with the value of \( s l \)-ReportInterval as defined within the corresponding \( s l \) ReportConfig for this sl-Measld;

1> else:
\( 2> \) if the sl-ReportType is set to sl-Periodical:
\( 3> \) remove the entry within the VarMeasReportListSL for this sl-Measld;
\( 3> \) remove this sl-Measld from the sl-MeasldList within VarMeasConfigSL;
\( 1> \) submit the MeasurementReportSidelink message to lower layers for transmission, upon which the procedure ends.
5.8.11 Zone identity calculation

The UE shall determine an identity of the zone (i.e Zone_id) in which it is located using the following formulae, if \( s / \) ZoneConfig is configured:
\[
\begin{array}{l}
x_{1}=\text { Floor }(x / L) \text { Mod } 64 \\
y_{1}=\text { Floor }(y / L) \text { Mod } 64 \\
\text { Zone_id }=y_{1} * 64+x_{1}
\end{array}
\]

The parameters in the formulae are defined as follows:
\( \mathbf{L} \) is the value of sl-ZoneLength included in sl-ZoneConfig;
\( \mathbf{x} \) is the geodesic distance in longitude between UE's current location and geographical coordinates ( 0,0 ) according to WGS84 model [58] and it is expressed in meters;
\( y \) is the geodesic distance in latitude between UE's current location and geographical coordinates ( 0,0 ) according to WGS84 model [58] and it is expressed in meters.

NOTE: How the calculated zone_id is used is specified in TS 38.321 [3].
5.8.12 DFN derivation from GNSS

When the UE selects GNSS as the synchronization reference source, the DFN, the subframe number within a frame and slot number within a frame used for NR sidelink communication/discovery are derived from the current UTC time, by the following formulae:
\[
\begin{array}{c}
D F N=\text { Floor }(0.1 *(\text { Tcurrent }- \text { Tref-OffsetDFN })) \bmod 1024 \\
\text { SubframeNumber }=\text { Floor }(\text { Tcurrent }- \text { Tref-OffsetDFN }) \bmod 10 \\
\text { SlotNumber }=\text { Floor }\left((\text { Tcurrent }- \text { Tref-OffsetDFN })^{*} 2^{\mu}\right) \bmod \left(10^{*} 2^{\mu}\right)
\end{array}
\]

Where:
Tcurrent is the current UTC time obtained from GNSS. This value is expressed in milliseconds;
Tref is the reference UTC time 00:00:00 on Gregorian calendar date 1 January, 1900 (midnight between Thursday, December 31, 1899 and Friday, January 1, 1900). This value is expressed in milliseconds;

ETSI