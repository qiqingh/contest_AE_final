<!-- Page 127 of ts_138331v170000p -->

3GPP TS 38.331 version 17.0.0 Release 17
126
ETSI TS 138331 V17.0.0 (2022-05)
5.3.7.5 Reception of the RRCReestablishment by the UE

The UE shall:
\( 1> \) stop timer T301;
1> if the RRCReestablishment message includes the sl-L2RemoteUEConfig (i.e. the UE is a L2 U2N Remote UE):
\( 2> \) perform the L2 U2N Remote UE configuration procedure as specified in 5.3.5.16;
1> else:
\( 2> \) consider the current cell to be the PCell;
\( 1> \) update the \( \mathrm{K}_{\mathrm{gNB}} \) key based on the current \( \mathrm{K}_{\mathrm{gNB}} \) key or the NH , using the received nextHopChainingCount value, as specified in TS 33.501[11];
\( 1> \) store the nextHopChainingCount value indicated in the RRCReestablishment message;
\( 1> \) derive the \( K_{R R C e n c} \) and \( K_{U P e n c} \) keys associated with the previously configured cipheringAlgorithm, as specified in TS 33.501 [11];
\( 1> \) derive the \( K_{R R C_{1 n t}} \) and \( K_{U P m t} \) keys associated with the previously configured integrityProtAlgorithm, as specified in TS 33.501 [11].
\( 1> \) request lower layers to verify the integrity protection of the RRCReestablishment message, using the previously configured algorithm and the \( \mathrm{K}_{\mathrm{RRCint}} \) key;
\( 1> \) if the integrity protection check of the RRCReestablishment message fails:
\( 2> \) perform the actions upon going to RRC_IDLE as specified in 5.3.11, with release cause 'RRC connection failure', upon which the procedure ends;
\( 1> \) configure lower layers to resume integrity protection for SRB1 using the previously configured algorithm and the \( K_{R R C \text { mt }} \) key immediately, i.e., integrity protection shall be applied to all subsequent messages received and sent by the UE, including the message used to indicate the successful completion of the procedure;
\( 1> \) configure lower layers to resume ciphering for SRB1 using the previously configured algorithm and, the \( \mathrm{K}_{\mathrm{RRCenc}} \) key immediately, i.e, ciphering shall be applied to all subsequent messages received and sent by the UE, including the message used to indicate the successful completion of the procedure;
\( 1> \) release the measurement gap configuration indicated by the measGapConfig, if configured;
\( 1> \) release the measurement gap configuration indicated by the musim-GapConfig, if configured;
\( 1> \) set the content of RRCReestablishmentComplete message as follows:
\( 2> \) if the UE has logged measurements available for NR and if the RPLMN is included in plmn-IdentityList stored in VarLogMeasReport:
\( 3> \) if the sigLoggedMeasType in VarLogMeasReport is included:
4> include the sigLogMeasConfigAvailable in the RRCReestablishmentComplete message and set it according to the following:
\( 5> \) if T330 timer is running:
\( 6> \) set sigLogMeasConfigAvailable to true in the RRCReestablishmentComplete message;
\( 5> \) else:
6> set sigLogMeasConfigAvailable to false in the RRCReestablishmentComplete message;
\( 3> \) include the \( l o g \) MeasAvailable in the RRCReestablishmentComplete message;
\( 3> \) if Bluetooth measurement results are included in the logged measurements the UE has available for NR:
\( 4> \) include the \( \log \) MeasAvailableBT in the RRCReestablishmentComplete message;

ETSI