<!-- Page 60 of ts_138331v170000p -->

3GPP TS 38.331 version 17.0.0 Release 17
59
ETSI TS 138331 V17.0.0 (2022-05)

In response to a request to resume the \( R R C \) connection, the network may resume the suspended \( R R C \) connection and send UE to RRC_CONNECTED, or reject the request to resume and send UE to RRC_INACTIVE (with a wait timer), or directly re-suspend the RRC connection and send UE to RRC_INACTIVE, or directly release the RRC connection and send UE to RRC_IDLE, or instruct the UE to initiate NAS level recovery (in this case the network sends an RRC setup message).

In response to a resume procedure initiated for SDT, the network may resume the suspended RRC connection and send UE to RRC_CONNECTED, or reject the request to resume and send UE to RRC_INACTIVE (with a wait timer), or directly re-suspend the RRC connection and send UE to RRC_INACTIVE, or directly release the RRC connection and send UE to RRC_IDLE, or instruct the UE to initiate NAS level recovery (in this case the network sends an RRC setup message).

NOTE: In case the UE receives the configurations for NR sidelink communication via the E-UTRA, the configurations for NR sidelink communication in SIB12 and s/-ConfigDedicatedNR within RRCReconfiguration used in clause 5.3 are provided by the configurations in SystemInformationBlockType28 and sl-ConfigDedicatedForNR within RRCConnectionReconfiguration as specified in TS 36.331 [10], respectively.
5.3.1.2 AS Security

AS security comprises of the integrity protection and ciphering of RRC signalling (SRBs) and user data (DRBs).
RRC handles the configuration of the AS security parameters which are part of the AS configuration: the integrity protection algorithm, the ciphering algorithm, if integrity protection and/or ciphering is enabled for a \( D R B \) and two parameters, namely the keySetChangelndicator and the nextHopChainingCount, which are used by the UE to determine the AS security keys upon reconfiguration with sync (with key change), connection re-establishment and/or connection resume.

The integrity protection algorithm is common for SRB1, SRB2, SRB3 (if configured), SRB4 (if configured) and DRBs configured with integrity protection, with the same keyToUse value. The ciphering algorithm is common for SRB1, SRB2, SRB3 (if configured), SRB4 (if configured) and DRBs configured with the same keyTo Use value. Neither integrity protection nor ciphering applies for SRB0.

NOTE 0: All DRBs related to the same PDU session have the same enable/disable setting for ciphering and the same enable/disable setting for integrity protection, as specified in TS 33.501 [11].

RRC integrity protection and ciphering are always activated together, i.e in one message/procedure. RRC integrity protection and ciphering for SRBs are never de-activated. However, it is possible to switch to a 'NULL' ciphering algorithm (nea0).

The 'NULL' integrity protection algorithm (nia0) is used only for SRBs and for the UE in limited service mode, see TS \( 33.501[11] \) and when used for SRBs, integrity protection is disabled for DRBs. In case the 'NULL' integrity protection algorithm is used, 'NULL' ciphering algorithm is also used.

NOTE 1: Lower layers discard RRC messages for which the integrity protection check has failed and indicate the integrity protection verification check failure to RRC.

The AS applies four different security keys: one for the integrity protection of RRC signalling ( \( K_{R R C \text { mt }} \) ), one for the ciphering of \( R R C \) signalling ( \( K_{R R C e n c} \) ), one for integrity protection of user data ( \( K_{\text {UPInt }} \) ) and one for the ciphering of user data ( \( K_{\text {UPenc }} \) ). All four AS keys are derived from the \( K_{g N B} \) key. The \( K_{g N B} \) key is based on the \( K_{\text {amf }} \) key (as specified in TS 33.501 [11]), which is handled by upper layers.

The integrity protection and ciphering algorithms can only be changed with reconfiguration with sync. The AS keys ( \( \mathrm{K}_{\mathrm{gNB}}, \mathrm{K}_{\mathrm{RRC} \text { int }}, \mathrm{K}_{\mathrm{RRCenc}}, \mathrm{K}_{\text {upint }} \) and \( \mathrm{K}_{\text {UPenc }} \) ) change upon reconfiguration with sync (if masterKeyUpdate is included), and upon connection re-establishment and connection resume.

For each radio bearer an independent counter (COUNT, as specified in TS 38.323 [5]) is maintained for each direction. For each radio bearer, the COUNT is used as input for ciphering and integrity protection.

It is not allowed to use the same COUNT value more than once for a given security key. As specified in TS 33.501 clause 6.9.4.1 [11], the network is responsible for avoiding reuse of the COUNT with the same RB identity and with the same key, e.g. due to the transfer of large volumes of data, release and establishment of new RBs, and multiple termination point changes for RLC-UM bearers and multiple termination point changes for RLC-AM bearer with SN terminated PDCP re-establishment (COUNT reset) due to SN only full configuration whilst the key stream inputs (i.e.

ETSI