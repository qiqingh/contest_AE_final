<!-- Page 45 of ts_138321v180200p -->

3GPP TS 38.321 version 18.2.0 Release 18
44
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 1: If within a Random Access procedure, an uplink grant provided in the Random Access Response for the same group of contention-based Random Access Preambles has a different size than the first uplink grant allocated during that Random Access procedure, the UE behavior is not defined.

1> if ra-ResponseWindow configured in BeamFailureRecoveryConfig expires and if a PDCCH transmission on the search space indicated by recoverySearchSpaceld addressed to the C-RNTI has not been received on the Serving Cell where the preamble was transmitted; or

1> if ra-ResponseWindow configured in RACH-ConfigCommon expires, and if the Random Access Response containing Random Access Preamble identifiers that matches the transmitted PREAMBLE_INDEX has not been received:
\( 2> \) consider the Random Access Response reception not successful;
\( 2> \) increment PREAMBLE TRANSMISSION_COUNTER by 1;
\( 2> \) if PREAMBLE_TRANSMISSION_COUNTER \( = \) preambleTransMax +1 :
3> if the Random Access Preamble is transmitted on the SpCell:
4> indicate a Random Access problem to upper layers;
4> if this Random Access procedure was triggered for SI request:
\( 5> \) consider the Random Access procedure unsuccessfully completed.
3> else if the Random Access Preamble is transmitted on an SCell:
4> consider the Random Access procedure unsuccessfully completed.
\( 2> \) if the Random Access procedure is not completed:
3> if the Random Access Preamble is transmitted with repetitions and neither contention-free Random Access Resources nor Random Access resources for SI request have been provided for this Random Access procedure:

4> if PREAMBLE_TRANSMISSION_COUNTER \( = \) [preambleTransMax-Msgl-Repetition] +1 ; or
\( 4> \) if PREAMBLE_TRANSMISSION_COUNTER \( =2 \times \) [preambleTransMax-Msgl-Repetition] +1 :
\( 5> \) if set of Random Access resources configured with the same prach-ConfigurationIndex and associated with a higher Msgl repetition number with the same feature or feature combination as the current set of Random Access resources is available:

6> select the set of Random Access resources associated with the next higher Msg1 repetition number with the same feature or feature combination for this Random Access procedure;

6> initialize startPreambleForThisPartition, numberOfPreamblesPerSSB-ForThisPartition, ssb-SharedRO-MaskIndex and numberOfRA-PreamblesGroupA parameters for the Random Access procedure according to the values configured by RRC for the selected set of Random Access resources.

3> select a random backoff time according to a uniform distribution between 0 and the
PREAMBLE_BACKOFF;
\( 3> \) if the criteria (as defined in clause 5.1.2) to select contention-free Random Access Resources is met during the backoff time:
\( 4> \) perform the Random Access Resource selection procedure (see clause 5.1.2).
3> else if the Random Access procedure for an SCell is performed on uplink carrier where pusch-Config is not configured:
\( 4> \) delay the subsequent Random Access transmission until the Random Access Procedure is triggered by a PDCCH order with the same ra-PreambleIndex, ra-ssb-OccasionMaskIndex, and UL/SUL indicator TS 38.212 [9].

ETSI