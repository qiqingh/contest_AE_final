<!-- Page 58 of ts_138321v180200p -->

3GPP TS 38.321 version 18.2.0 Release 18
57
ETSI TS 138321 V18.2.0 (2024-08)

1> else if a downlink assignment for this PDCCH occasion has been received for this Serving Cell on the PDCCH for the MAC entity's CS-RNTI or G-CS-RNTI:
\( 2> \) if the NDI in the received HARQ information is 1 :
\( 3> \) consider the NDI for the corresponding HARQ process not to have been toggled;
\( 3> \) indicate the presence of a downlink assignment for this Serving Cell and deliver the associated HARQ information to the HARQ entity.

2 if the NDI in the received HARQ information is 0 :
\( 3> \) if PDCCH contents indicate SPS deactivation:
\( 4> \) clear the configured downlink assignment for this Serving Cell (if any);
4> if the timeAlignmentTimer, associated with the TAG containing the Serving Cell on which the HARQ feedback is to be transmitted, is running, and the Serving Cell is not configured with two TAGs; or

4> if the Serving Cell on which the HARQ feedback is to be transmitted is configured with two TAGs and if the timeAlignmentTimer of the TAG, associated with the TCI state(s) used for transmitting the HARQ feedback, is running:
\( 5> \) indicate a positive acknowledgement for the SPS deactivation to the physical layer.
3> else if PDCCH content indicates SPS activation:
4> store the downlink assignment for this Serving Cell and the associated HARQ information as configured downlink assignment;

4> initialise or re-initialise the configured downlink assignment for this Serving Cell to start in the associated PDSCH duration and to recur according to rules in clause 5.8.1 or in clause 5.8.1a;

For each Serving Cell and each configured downlink assignment, if configured and activated, the MAC entity shall:
1> if the PDSCH duration of the configured downlink assignment does not overlap with the PDSCH duration of a downlink assignment received on the PDCCH for this Serving Cell:
\( 2> \) instruct the physical layer to receive, in this PDSCH duration, transport block on the DL-SCH according to the configured downlink assignment and to deliver it to the HARQ entity;
\( 2> \) set the HARQ Process ID to the HARQ Process ID associated with this PDSCH duration;
\( 2> \) consider the NDI bit for the corresponding HARQ process to have been toggled;
\( 2> \) indicate the presence of a configured downlink assignment and deliver the stored HARQ information to the HARQ entity.

For configured downlink assignments without harq-ProcID-Offset, the HARQ Process ID associated with the slot where the DL transmission starts is derived from the following equation:

HARQ Process ID \( =[ \) floor \( ( \) CURRENT_slot × \( 10 / \) (numberOfSlotsPerFrame × periodicity) \( )] \) modulo nrofHARQ-Processes
where CURRENT_slot \( =[( \) SFN × numberOfSlotsPerFrame \( )+ \) slot number in the frame \( ] \) and numberOfSlotsPerFrame refers to the number of consecutive slots per frame as specified in TS 38.211 [8].

For configured downlink assignments with harq-ProcID-Offset, the HARQ Process ID associated with the slot where the DL transmission starts is derived from the following equation:

HARQ Process ID \( =[ \) floor \( ( \) CURRENT_slot × \( 10 /( \) numberOfSiotsPerFrame × periodicity \( ))] \) modulo nrofHARQ-Processes + harq-ProcID-Offset
where CURRENT_slot \( =[( \) SFN × numberOfSIotsPerFrame \( )+ \) slot number in the frame \( ] \) and numberOfSlotsPerFrame refers to the number of consecutive slots per frame as specified in TS 38.211 [8].

ETSI