<!-- Page 51 of ts_138321v180200p -->

3GPP TS 38.321 version 18.2.0 Release 18
50
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if the Random Access procedure is not completed:
3> if the RA_TYPE is set to 4-stepRA:
4> if the Random Access Preamble is transmitted with repetitions and contention-free Random Access Resources have not been provided for this Random Access procedure:
\( 5> \) if PREAMBLE_TRANSMISSION_COUNTER \( =[ \) preambleTransMax-Msgl-Repetition \( ]+1 \); or
\( 5> \) if PREAMBLE_TRANSMISSION_COUNTER \( =2 \times[ \) preambleTransMax-Msg 1 -Repetition \( ]+1 \) :
\( 6> \) if set of Random Access resources configured with the same prach-ConfigurationIndex and associated with a higher Msgl repetition number with the same feature or feature combination as the current set of Random Access resources is available:
\( 7> \) select the set of Random Access resources associated with the next higher Msg1 repetition number with the same feature or feature combination for this Random Access procedure;

7> initialize startPreambleForThisPartition, numberOfPreamblesPerSSB-ForThisPartition, ssb-SharedRO-MaskIndex and numberOfRA-PreamblesGroupA parameters for the Random Access procedure according to the values configured by RRC for the selected set of Random Access resources.

4> select a random backoff time according to a uniform distribution between 0 and the
PREAMBLE_BACKOFF;
\( 4> \) if the criteria (as defined in clause 5.1.2) to select contention-free Random Access Resources is met
during the backoff time:
\( 5> \) perform the Random Access Resource selection procedure (see clause 5.1.2);
4> else:
5> perform the Random Access Resource selection procedure (see clause 5.1.2) after the backoff time.

3> else (i.e. the RA_TYPE is set to 2-stepRA):
4> if msgA-TransMax is applied (see clause 5.1.1a) and PREAMBLE_TRANSMISSION_COUNTER= msgA-TransMax +1 :
\( 5> \) set the RA_TYPE to 4-stepRA;
\( 5> \) perform initialization of variables specific to Random Access type as specified in clause 5.1.1a;
\( 5> \) flush HARQ buffer used for the transmission of MAC PDU in the MSGA buffer;
\( 5> \) discard explicitly signalled contention-free 2 -step RA type Random Access Resources, if any;
\( 5> \) perform the Random Access Resource selection as specified in clause 5.1.2.
4> else:
\( 5> \) select a random backoff time according to a uniform distribution between 0 and the PREAMBLE_BACKOFF;
\( 5> \) if the criteria (as defined in clause 5.1.2a) to select contention-free Random Access Resources is met during the backoff time:
\( 6> \) perform the Random Access Resource selection procedure for 2 -step RA type as specified in clause 5.1.2a

5> else:
\( 6> \) perform the Random Access Resource selection for 2-step RA type procedure (see clause 5.1.2a) after the backoff time.

ETSI