<!-- Page 26 of ts_138321v180200p -->

3GPP TS 38.321 version 18.2.0 Release 18
25
ETSI TS 138321 V18.2.0 (2024-08)

1> if the Random Access procedure was initiated for LTM cell switch and if the contention-free Random Access Resources have been explicitly provided in LTM Cell Switch Command MAC CE:
\( 2> \) set the RA_TYPE to 4-stepRA.
1> else if the BWP selected for Random Access procedure is configured with both 2-step and 4-step RA type Random Access Resources within the selected set of Random Access resources (as specified in clause 5.1.1b) and the RSRP of the downlink pathloss reference is above msgA-RSRP-Threshold; or
\( 1> \) if the BWP selected for Random Access procedure is only configured with 2 -step RA type Random Access resources within the selected set of Random Access resources according to clause 5.1.1b; or
\( 1> \) if the Random Access procedure was initiated for reconfiguration with sync and if the contention-free Random Access Resources for 2-step RA type have been explicitly provided in rach-ConfigDedicated for the BWP selected for Random Access procedure:
\( 2> \) set the RA_TYPE to 2-stepRA.
1> else:
\( 2> \) set the RA_TYPE to 4-stepRA.
\( 1> \) perform initialization of variables specific to Random Access type as specified in clause 5.1.1a;
\( 1> \) if RA_TYPE is set to 2-stepRA:
\( 2> \) perform the Random Access Resource selection procedure for 2-step RA type (see clause 5.1.2a).
1> else:
\( 2> \) perform the Random Access Resource selection procedure (see clause 5.1.2).
5.1.1a Initialization of variables specific to Random Access type

The MAC entity shall:
\( 1> \) if RA_TYPE is set to 2-stepRA:
\( 2> \) set PREAMBLE_POWER_RAMPING_STEP to msgA-PreamblePowerRampingStep;
\( 2>\operatorname{set} \) SCALING_FACTOR_BI to 1;
2> apply preambleTransMax included in the RACH-ConfigGenericTwoStepRA;
\( 2> \) if the Random Access procedure was initiated for reconfiguration with sync or for SCG activation; and
\( 2> \) if cfra-TwoStep is configured for the selected carrier:
\( 3> \) if msgA-TransMax is configured in the cfra-TwoStep:
4> apply msgA-TransMax configured in the cfra-TwoStep.
\( 2> \) else if msgA-TransMax is included in the RACH-ConfigCommonTwoStepRA:
3> apply msgA-TransMax included in the RACH-ConfigCommonTwoStepRA.
\( 2> \) if the Random Access procedure was initiated for SpCell beam failure recovery (as specified in clause 5.17); and
\( 2> \) if beamFailureRecoveryConfig is configured for the active UL BWP of the selected carrier; and
\( 2> \) if ra-PrioritizationTwoStep is configured in the beamFailureRecoveryConfig:
3> set PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority included in the raPrioritizationTwoStep in beamFailureRecoveryConfig;

3> if scalingFactorBI is configured in the ra-PrioritizationTwoStep in beamFailureRecoveryConfig:

ETSI