<!-- Page 180 of ts_138321v180200p -->

3GPP TS 38.321 version 18.2.0 Release 18
179
ETSI TS 138321 V18.2.0 (2024-08)

The MAC entity shall for each SCI corresponding to a new transmission for SL-SCH:
1> allocate resources to the logical channels as follows:
\( 2> \) logical channels selected in clause 5.22.1.4.1.2 for the SL grant with SBJ \( >0 \) are allocated resources in a decreasing priority order. If the sPBR of a logical channel is set to minity, the MAC entity shall allocate resources for all the data that is available for transmission on the logical channel before meeting the sPBR of the lower priority logical channel(s);
\( 2> \) decrement SBj by the total size of MAC SDUs served to logical channel \( j \) above;
\( 2> \) if any resources remain, all the logical channels selected in clause 5.22.1.4.1.2 are served in a strict decreasing priority order (regardless of the value of SBJ) until either the data for that logical channel or the SL grant is exhausted, whichever comes first. Logical channels configured with equal priority should be served equally.

NOTE 1: The value of SBJ can be negative.
The UE shall also follow the rules below during the SL scheduling procedures above:
- the UE should not segment an RLC SDU (or partially transmitted SDU or retransmitted RLC PDU) if the whole SDU (or partially transmitted SDU or retransmitted RLC PDU) fits into the remaining resources of the associated MAC entity;
- if the UE segments an RLC SDU from the logical channel, it shall maximize the size of the segment to fill the grant of the associated MAC entity as much as possible;
- the UE should maximise the transmission of data;
- if the MAC entity is given a sidelink grant size that is equal to or larger than 12 bytes while having data available and allowed (according to clause 5.22.1.4.1) for transmission, the MAC entity shall not transmit only padding;
- A logical channel configured with sl-HARQ-FeedbackEnabled set to enabled and a logical channel configured with sl-HARQ-FeedbackEnabled set to disabled cannot be multiplexed into the same MAC PDU.

The MAC entity shall not generate a MAC PDU for the HARQ entity if the following conditions are satisfied:
- there is no Sidelink CSI Reporting MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.7; and
- there is no Sidelink DRX Command MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.8; and
- there is no Sidelink Inter-UE Coordination Request MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.9; and
- there is no Sidelink Inter-UE Coordination Information MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.10; and
- the MAC PDU includes zero MAC SDUs and the MAC PDU is not associated with SL-PRS transmission on Shared SL-PRS resource pool.

Logical channels shall be prioritised in accordance with the following order (highest priority listed first):
- data from SCCH;
- Sidelink CSI Reporting MAC CE;
- Sidelink Inter-UE Coordination Request MAC CE and Sidelink Inter-UE Coordination Information MAC CE;
- Sidelink DRX Command MAC CE;
- data from any STCH or SL-PRS.

NOTE 2: The priority order between Sidelink Inter-UE Coordination Request MAC CE and Sidelink Inter-UE Coordination Information MAC CE is up to UE implementation.

ETSI