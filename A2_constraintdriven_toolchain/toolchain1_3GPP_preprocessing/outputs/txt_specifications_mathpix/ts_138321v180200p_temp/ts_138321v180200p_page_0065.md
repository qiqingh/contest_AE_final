<!-- Page 65 of ts_138321v180200p -->

3GPP TS 38.321 version 18.2.0 Release 18
64
ETSI TS 138321 V18.2.0 (2024-08)

For configured uplink grants that are not part of a multi-PUSCH configured grant and configured with harq-ProcIDOffset2, the HARQ Process ID associated with the first symbol of a UL transmission is derived from the following equation:

HARQ Process ID \( =[ \) floor(CURRENT_symbol / periodicity) \( ] \) modulo nrofHARQ-Processes + harq-ProcID-Offset 2
For a multi-PUSCH configured grant (as specified in clause 5.8.2) configured with neither harq-ProcID-Offset2 nor cgRetransmissionTimer, the HARQ Process ID associated with the first symbol of a UL transmission is derived from the following equation:

HARQ Process \( \mathrm{ID}=[ \) nrofSilotsInCG-Period × floor \( ( \) CURRENT_symbol \( / \) periodicity \( )+ \) ID_OFFSET \( ] \) modulo nrofHARQ-Processes

For a multi-PUSCH configured grant configured with harq-ProcID-Offset2, the HARQ Process ID associated with the first symbol of a UL transmission is derived from the following equation:

HARQ Process \( [\mathrm{D}=[ \) nrofSlotsInCG-Period × floor \( ( \) CURRENT_symbol \( / \) periodicity \( )+ \) [D_OFFSET] modulo nrofHARQ-Processes + harq-ProcID-Offset 2
where, if cg-SDT-PeriodicityExt (as defined in TS 38.331 [5]) is not configured, CURRENT_symbol \( = \) (SFN × numberOfSlotsPerFrame × numberOfSymbolsPerSlot + slot number in the frame × numberOfSymbolsPerSlot + symbol number in the slot), and numberOfSlotsPerFrame and numberOfSymbolsPerSlot refer to the number of consecutive slots per frame and the number of consecutive symbols per slot, respectively as specified in TS 38.211 [8]; alternatively, if cg-SDT-PeriodicityExt (as defined in TS 38.331 [5]) is configured, CURRENT_symbol \( = \) ((H-SFN × numberOfSFNperH-SFN + SFN ) × numberOfSlotsPerFrame × numberOfSymbolsPerSlot + slot number in the frame × numberOfSymbolsPerSlot + symbol number in the slot), and numberOfSFNperH-SFN, numberOfSlotsPerFrame and numberOfSymbolsPerSlot refer to the number of consecutive frames per H-SFN, the number of consecutive slots per frame and the number of consecutive symbols per slot, respectively as specified in TS 38.211 [8]. For a multi-PUSCH configured grant, ID_OFFSET equals 0 for the first configured uplink grant within a periodicity of the configuration and K for the \( \mathrm{K}^{\text {th }}(1 \leq \mathrm{K}< \) nrofSiotsInCG-Period \( ) \) valid configured uplink grant after the first configured uplink grant within the same periodicity. A configured uplink grant in a multi-PUSCH configured grant is considered valid if it satisfies the conditions specified in clause 6.1 in TS 38.214 [7].

For configured uplink grants configured with cg-RetransmissionTimer, the UE implementation selects an HARQ Process ID among the HARQ process IDs available for the configured grant configuration. If the MAC entity is configured with intraCG-Prioritization, for HARQ Process ID selection, the UE shall prioritize the HARQ Process ID with the highest priority, where the priority of HARQ process is determined by the highest priority among priorities of the logical channels that are multiplexed (i.e. the MAC PDU to transmit is already stored in the HARQ buffer) or have data available that can be multiplexed (i.e. the MAC PDU to transmit is not stored in the HARQ buffer) in the MAC PDU, according to the mapping restrictions as described in clause 5.4.3.1.2. If the MAC entity is configured with intraCG-Prioritization, for HARQ Process ID selection among initial transmission and retransmission with equal priority, the UE shall prioritize retransmissions before initial transmissions. The priority of a HARQ Process for which no data for logical channels is multiplexed or can be multiplexed in the MAC PDU is lower than the priority of a HARQ Process for which data for any logical channels is multiplexed or can be multiplexed in the MAC PDU. If the MAC entity is not configured with intraCG-Prioritization, for HARQ Process [D selection, the UE shall prioritize retransmissions before initial transmissions. The UE shall toggle the NDI in the CG-UCI for new transmissions and not toggle the NDI in the CG-UCI in retransmissions.

NOTE 1: If a configured uplink grant is associated with a multi-PUSCH configured grant, CURRENT_symbol refers to the symbol index of the first transmission occasion in the first configured uplink grant within the same periodicity. Otherwise, CURRENT_symbol refers to the symbol index of the first transmission occasion of a bundle of configured uplink grant.

NOTE 2: A HARQ process is configured for a configured uplink grant where neither harq-ProcID-Offset nor harq-ProcID-Offset 2 is configured, if the configured uplink grant is activated and the associated HARQ process ID is less than nrofHARQ-Processes. A HARQ process is configured for a configured uplink grant where harq-ProcID-Offset 2 is configured, if the configured uplink grant is activated and the associated HARQ process ID is greater than or equal to harq-ProcID-Offset2 and less than sum of harq-ProcID-Offset 2 and nrofHARQ-Processes for the configured grant configuration.

ETSI