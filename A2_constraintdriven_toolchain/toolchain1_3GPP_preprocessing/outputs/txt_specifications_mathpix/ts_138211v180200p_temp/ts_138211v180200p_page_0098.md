<!-- Page 98 of ts_138211v180200p -->

3GPP TS 38.211 version 18.2.0 Release 18
97
ETSI TS 138211 V18.2.0 (2024-05)
- \( n_{\mathrm{ID}}^{\mathrm{RS}}=N_{\mathrm{ID}}^{n_{\mathrm{SCID}}} \) if the higher-layer parameter dmrs-UplinkTransformPrecoding is configured, \( \pi / 2 \)-BPSK modulation is used for PUSCH, the PUSCH transmission is not a msg3 transmission, and the transmission is not scheduled using DCI format \( 0 \_0 \) in a common search space;
- \( n_{\mathrm{ID}}^{\mathrm{RS}}=N_{\mathrm{ID}}^{\text {cell }} \) otherwise
where \( f_{g h} \) and the sequence number \( v \) are given by:
- if neither group, nor sequence hopping is enabled
\[
\begin{array}{r}
f_{\mathrm{gh}}=0 \\
v=0
\end{array}
\]
- if group hopping is enabled and sequence hopping is disabled
\[
\begin{aligned}
f_{\mathrm{gh}} & =\left(\sum_{m=0}^{7} 2^{m} c\left(8\left(N_{\mathrm{symb}}^{\text {slot }} n_{\mathrm{s}, \mathrm{f}}^{\mu}+l\right)+m\right)\right) \bmod 30 \\
v & =0
\end{aligned}
\]
where the pseudo-random sequence \( c(i) \) is defined by clause 5.2 .1 and shall be initialized with \( c_{\text {init }}=\left\lfloor n_{\text {ID }}^{\mathrm{RS}} / 30\right\rfloor \) at the beginning of each radio frame
- if sequence hopping is enabled and group hopping is disabled
\[
\begin{aligned}
f_{\mathrm{gh}} & =0 \\
v & =\left\{\begin{array}{ll}
c\left(N_{\mathrm{symb}}^{\mathrm{slol}} n_{\mathrm{s}, \mathrm{~F}}^{\mu}+t\right) & \text { if } M_{\mathrm{zC}} \geq 6 N_{\mathrm{sc}}^{\mathrm{RB}} \\
0 & \text { otherwise }
\end{array}\right.
\end{aligned}
\]
where the pseudo-random sequence \( c(i) \) is defined by clause 5.2 .1 and shall be initialized with \( c_{\text {init }}=n_{\text {ID }}^{\mathrm{RS}} \) at the beginning of each radio frame.

The hopping mode is controlled by higher-layer parameters:
- for PUSCH transmission scheduled by RAR UL grant or by DCI format \( 0 \_0 \) with CRC scrambled by TC-RNTI, sequence hopping is disabled and group hopping is enabled or disabled by the higher-layer parameter groupHoppingEnabledTransformPrecoding;
- for all other transmissions, sequence hopping and group hopping are enabled or disabled by the respective higher-layer parameters sequenceHopping and sequenceGroupHopping if these parameters are provided, otherwise, the same hopping mode as for Msg3 shall be used.

The UE is not expected to handle the case of combined sequence hopping and group hopping.
The quantity \( l \) above is the OFDM symbol number in the slot except for the case of double-symbol DMRS in which case \( l \) is the OFDM symbol number in the slot of the first symbol of the double-symbol DMRS.
6.4.1.1.2 (void)
6.4.1.1.3 Precoding and mapping to physical resources

The sequence \( r(m) \) shall be mapped to the intermediate quantity \( \tilde{a}_{k, l}^{\left(\tilde{p}_{j,} \mu\right)} \) according to
- if transform precoding is not enabled,
- if the higher-layer parameter dmrs-TypeEnh is configured
\[
\begin{aligned}
\tilde{a}_{k, l}^{\left(p_{j,} \mu\right)} & =w_{\mathrm{f}}\left(k^{\prime}\right) w_{\mathrm{t}}\left(l^{\prime}\right) r\left(4 n+k^{\prime}\right) \\
k & =\left\{\begin{array}{ll}
8 n+2 k^{\prime}+\Delta & \text { configuration type } 1 \\
12 n+k^{\prime}+\Delta & \text { configuration type } 2, k^{\prime}=0,1 \\
12 n+k^{\prime}+\Delta+4 & \text { configuration type } 2, k^{\prime}=2,3
\end{array}\right.
\end{aligned}
\]

ETSI