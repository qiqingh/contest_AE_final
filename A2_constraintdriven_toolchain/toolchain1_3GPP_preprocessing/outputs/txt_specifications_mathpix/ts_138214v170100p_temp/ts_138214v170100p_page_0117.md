<!-- Page 117 of ts_138214v170100p -->

3GPP TS 38.214 version 17.1.0 Release 17
116
ETSI TS 138214 V17.1.0 (2022-05)
- The parameter \( R \in\{1,2\} \) is configured with the higher-layer parameter numberOfPMI-SubbandsPerCQI-Subband-r 17, when \( M=2 \), and \( R=1 \) when \( M=1 \), where \( R \) is defined as in clause 5.2.2.2.5.
- The UE shall report the RI value \( v \) according to the configured higher layer parameter typell-PortSelectionRI-Restriction-r 17. The UE shall not report \( v>4 \). The bitmap parameter typell-PortSelectionRI-Restriction-r 17 forms the bit sequence \( r_{3}, r_{2}, r_{1}, r_{0} \), where \( r_{0} \) is the LSB and \( r_{3} \) is the MSB. When \( r_{i} \) is zero, \( i \in\{0,1, \ldots, 3\} \), PMI and RI reporting are not allowed to correspond to any precoder associated with \( v=i+1 \) layers.

The PMI value corresponds to the codebook indices \( i_{1} \) and \( i_{2} \) where
\[
\begin{aligned}
i_{1} & =\left\{\begin{array}{lllllll}
{\left[\begin{array}{lllllll}
i_{1,2} & i_{1,6} & i_{1,7,1} & i_{1,8,1}
\end{array}\right]} & v=1 \\
{\left[\begin{array}{llllllll}
i_{1,2} & i_{1,6} & i_{1,7,1} & i_{1,8,1} & i_{1,7,2} & i_{1,8,2}
\end{array}\right]} & v=2 \\
{\left[\begin{array}{lllllllll}
i_{1,2} & i_{1,6} & i_{1,7,1} & i_{1,8,1} & i_{1,7,2} & i_{1,8,2} & i_{1,7,3} & i_{1,8,3}
\end{array}\right]} & v=3 \\
{\left[i_{1,2}\right.} & i_{1,6} & i_{1,7,1} & i_{1,8,1} & i_{1,7,2} & i_{1,8,2} & i_{1,7,3} \\
i_{1,8,3} & i_{1,7,4} & i_{1,8,4}
\end{array}\right] \\
i_{2} & =\left\{\begin{array}{llllllll}
{\left[\begin{array}{lllllll}
i_{2,3,1} & i_{2,4,1} & i_{2,5,1}
\end{array}\right]} & v=4 \\
{\left[\begin{array}{llllllll}
i_{2,3,1} & i_{2,4,1} & i_{2,5,1} & i_{2,3,2} & i_{2,4,2} & i_{2,5,2}
\end{array}\right]} & v=1 \\
{\left[\begin{array}{llllllll}
i_{2,3,1} & i_{2,4,1} & i_{2,5,1} & i_{2,3,2} & i_{2,4,2} & i_{2,5,2} & i_{2,3,3} & i_{2,4,3}
\end{array} i_{2,5,3}\right]} & v=3 \\
{\left[i_{2,3,1}\right.} & i_{2,4,1} & i_{2,5,1} & i_{2,3,2} & i_{2,4,2} & i_{2,5,2} & i_{2,3,3} & i_{2,4,3} \\
i_{2,5,3} & i_{2,3,4} & i_{2,4,4} & i_{2,5,4}
\end{array}\right]
\end{aligned}
\]

The precoding matrices indicated by the PMI are determined from \( L+M \) vectors, where \( L=K_{1} / 2 \) and \( K_{1}=\alpha P_{\text {CSI-RS }} \). \( K_{1} \) ports are selected from \( P_{C S I-R S} \) ports based on \( L \) vectors, \( v_{m}(i), i=0,1, \ldots, L-1 \), which are identified by
\[
\begin{array}{c}
m=\left[m^{(0)} \ldots m^{(L-1)}\right] \\
m^{(i)} \in\left\{0,1, \ldots, \frac{P_{C S I-R S}}{2}-1\right\}
\end{array}
\]
which are indicated by the index \( i_{1,2} \), where
\[
i_{1,2} \in\left\{0,1, \ldots,\left(\frac{P_{C S I-R S} / 2}{L}\right)-1\right\} .
\]

The elements of \( m \) are found from \( i_{1,2} \) using \( C(x, y) \) as defined in Tables 5.2.2.2.5-4 and 5.2.2.2.7-2 and the algorithm:
\[
\begin{array}{l}
s_{-1}=0 \\
\text { for } i=0, \ldots, L-1
\end{array}
\]

Find the largest \( x^{8} \in\left\{L-1-i, \ldots, \frac{P C S I-R S}{2}-1-i\right\} \) in Table 5.2.2.2.5-4, if \( L-i \leq 9 \), or in Table 5.2.2.2.7-2, if \( L-i>9 \), such that \( i_{1,2}-s_{i-1} \geq C\left(x^{*}, L-i\right) \)
\[
\begin{array}{l}
e_{i}=C\left(x^{*}, L-i\right) \\
s_{i}=s_{i-1}+e_{i} \\
m^{(i)}=\frac{P C S I-R S}{2}-1-x^{*}
\end{array}
\]

When \( m^{(i)} \) are known, \( i_{1,2} \) is found using \( i_{1,2}=\sum_{i=0}^{L-1} C\left(\frac{P C S I-R S}{2}-1-m^{(i)}, L-i\right) \), where \( C(x, y) \) is given in Tables 5.2.2.2.5-4 and 5.2.2.2.7-2, and where the indices \( i=0, \ldots, L-1 \) are assigned such that \( m^{(i)} \) increases as \( i \) increases.
- If \( \alpha=1, m^{(i)}=i, i=0,1, \ldots, \frac{P C S I-R S}{2}-1 \), and \( i_{1,2} \) is not reported.

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 5.2.2.2.7-2: Combinatorial coefficients \( C(x, y) \)}
\begin{tabular}{|l|l|l|l|}
\hline\( x \) & 10 & 11 & 12 \\
\hline
\end{tabular}
\end{table}

ETSI