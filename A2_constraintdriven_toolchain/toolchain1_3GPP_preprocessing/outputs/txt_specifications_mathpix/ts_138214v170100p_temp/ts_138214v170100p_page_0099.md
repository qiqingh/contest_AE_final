<!-- Page 99 of ts_138214v170100p -->

3GPP TS 38.214 version 17.1.0 Release 17
98
ETSI TS 138214 V17.1.0 (2022-05)
- The value of \( N_{\text {PSK }} \) is configured with the higher layer parameter phaseAlphabetSize, where \( N_{\text {PSK }} \in\{4,8\} \).
- The UE is configured with the higher layer parameter subbandAmplitude set to 'true' or 'false'.
- The UE shall not report \( \mathrm{RI}>2 \).

When \( v \leq 2 \), where \( v \) is the associated RI value, each PMI value corresponds to the codebook indices \( i_{1} \) and \( i_{2} \) where
\[
\begin{array}{l}
i_{1}=\left\{\begin{array}{llll}
{\left[i_{1,1}\right.} & i_{1,2} & i_{1,3,1} & i_{1,4,1}
\end{array}\right] \quad \begin{array}{l}
v=1 \\
{\left[\begin{array}{lllll}
i_{1,1} & i_{1,2} & i_{1,3,1} & i_{1,4,1} & i_{1,3,2}
\end{array} \quad i_{1,4,2}\right]}
\end{array} \quad v=2 \\
i_{2}=\left\{\begin{array}{ll}
{\left[i_{2,1,1}\right]} & \text { subbandAmplitude }=\text { 'false', } v=1 \\
{\left[\begin{array}{ll}
i_{2,1,1} & i_{2,1,2}
\end{array}\right]} & \text { subbandAmplitude }=\text { 'false', } v=2 \\
{\left[\begin{array}{lll}
i_{2,1,1} & i_{2,2,1}
\end{array}\right]} & \text { subbandAmplitude }=\text { 'true', } v=1 \\
{\left[\begin{array}{lll}
i_{2,1,1} & i_{2,2,1} & i_{2,1,2} \\
i_{2,2,2}
\end{array}\right]} & \text { subbandAmplitude }=\text { 'true', } v=2
\end{array} .\right.
\end{array}
\]

The \( L \) vectors combined by the codebook are identified by the indices \( i_{1,1} \) and \( i_{1,2} \), where
\[
\begin{aligned}
i_{1,1} & =\left[\begin{array}{ll}
q_{1} & q_{2}
\end{array}\right] \\
q_{1} & \in\left\{0,1, \ldots, O_{1}-1\right\} \\
q_{2} & \in\left\{0,1, \ldots, O_{2}-1\right\} \\
i_{1,2} & \in\left\{0,1, \ldots,\binom{N_{1} N_{2}}{L}-1\right\} .
\end{aligned}
\]

Let
\[
\begin{aligned}
n_{1} & =\left[n_{1}^{(0)}, \ldots, n_{1}^{(L-1)}\right] \\
n_{2} & =\left[n_{2}^{(0)}, \ldots, n_{2}^{(L-1)}\right] \\
n_{1}^{(i)} & \in\left\{0,1, \ldots, N_{1}-1\right\} \\
n_{2}^{(i)} & \in\left\{0,1, \ldots, N_{2}-1\right\}
\end{aligned}
\]
and
\[
C(x, y)=\left\{\begin{array}{cc}
\binom{x}{y} & x \geq y \\
0 & x<y
\end{array}\right.
\]
where the values of \( C(x, y) \) are given in Table 5.2.2.2.3-1.
Then the elements of \( n_{1} \) and \( n_{2} \) are found from \( i_{1,2} \) using the algorithm:
\[
s_{-1}=0
\]
for \( i=0, \ldots, L-1 \)
Find the largest \( x^{*} \in\left\{L-1-i, \ldots, N_{1} N_{2}-1-i\right\} \) in Table 5.2.2.2.3-1 such that \( i_{1,2}-s_{i-1} \geq C\left(x^{*}, L-i\right) \)
\[
\begin{array}{l}
e_{i}=C\left(x^{*}, L-i\right) \\
s_{i}=s_{i-1}+e_{i} \\
n^{(i)}=N_{1} N_{2}-1-x^{*} \\
n_{\mathrm{j}}^{(i)}=n^{(i)} \bmod N_{\mathrm{1}}
\end{array}
\]

ETSI