<!-- Page 140 of ts_138214v170100p -->

3GPP TS 38.214 version 17.1.0 Release 17
139
ETSI TS 138214 V17.1.0 (2022-05)

For non-codebook based transmission, the UE can calculate the precoder used for the transmission of SRS based on measurement of an associated NZP CSI-RS resource. A UE can be configured with only one NZP CSI-RS resource for the SRS resource set with higher layer parameter usage in SRS-ResourceSet set to 'nonCodebook' if configured.
- If aperiodic SRS resource set is configured, the associated NZP-CSI-RS is indicated via SRS request field in DCI format \( 0 \_1 \) and \( 1 \_1 \), as well as DCI format \( 0 \_2 \) (if SRS request field is present) and DCI format \( 1 \_2 \) (if SRS request field is present), where AperiodicSRS-ResourceTrigger and AperiodicSRS-ResourceTriggerList (indicating the association between aperiodic SRS triggering state(s) and SRS resource sets), triggered SRS resource(s) srs-ResourceSetId, csi-RS (indicating the associated NZP-CSI-RS-ResourceId) are higher layer configured in SRS-ResourceSet. The SRS-ResourceSet(s) associated with the SRS request by DCI format \( 0 \_1 \) and 1_1 are defined by the entries of the higher layer parameter srs-ResourceSetToAddModList and the SRSResourceSet(s) associated with the SRS request by DCI format \( 0 \_2 \) and \( 1 \_2 \) are defined by the entries of the higher layer parameter srs-ResourceSetToAddModListDCI-0-2. A UE is not expected to update the SRS precoding information if the gap from the last symbol of the reception of the aperiodic NZP-CSI-RS resource and the first symbol of the aperiodic SRS transmission is less than \( 42 \cdot 2^{\max (0, \mu-3)} \) OFDM symbols, where the SCS configuration \( \mu \) is the smallest SCS configuration between the NZP-CSI-RS resource and the SRS transmission.
- If the UE configured with aperiodic SRS associated with aperiodic NZP CSI-RS resource, the presence of the associated CSI-RS is indicated by the SRS request field if the value of the SRS request field is not ' 00 ' as in Table 7.3.1.1.2-24 of [5, TS 38.212] and if the scheduling DCI is not used for cross carrier or cross bandwidth part scheduling. If UE is configured with minimumSchedulingOffsetKO in the active DL BWP and the currently applicable minimum scheduling offset restriction \( K_{0, m i n} \) is larger than 0 , the UE does not expected to receive the scheduling DCI with the SRS request field value other than ' 00 '. The CSI-RS is located in the same slot as the SRS request field. If the UE configured with aperiodic SRS associated with aperiodic NZP CSI-RS resource, any of the TCI states configured in the scheduled CC shall not be configured with qcl-Type set to 'typeD'.
- If periodic or semi-persistent SRS resource set is configured, the NZP-CSI-RS-Resourceld for measurement is indicated via higher layer parameter associatedCSI-RS in SRS-ResourceSet.

The UE shall perform one-to-one mapping from the indicated SRI(s) to the indicated DM-RS ports(s) and their corresponding PUSCH layers \( \{0 \ldots \mathrm{v}-1\} \) given by DCI format \( 0 \_1 \) or \( 0 \_2 \) or by configuredGrantConfig according to clause 6.1.2.3 in increasing order.

The UE shall transmit PUSCH using the same antenna ports as the SRS port(s) in the SRS resource(s) indicated by SRI(s) given by DCI format \( 0 \_1 \) or \( 0 \_2 \) or by configuredGrantConfig according to clause 6.1.2.3, where the SRS port in \( (i+1) \)-th SRS resource in the SRS resource set is indexed as \( p_{i}=1000+i \).

The DM-RS antenna ports \( \left\{\tilde{p}_{0, \ldots, \tilde{p}_{v-1}}\right\} \) in Clause 6.4.1.1.3 of [4, TS 38.211] are determined according to the ordering of DM-RS port(s) given by Tables 7.3.1.1.2-6 to 7.3.1.1.2-23 in Clause 7.3.1.1.2 of [5, TS 38.212].

For non-codebook based transmission, the UE does not expect to be configured with both spatialRelationInfo for SRS resource and associatedCSI-RS in SRS-ResourceSet for SRS resource set.

For non-codebook based transmission, the UE can be scheduled with DCI format \( 0 \_1 \) or \( 0 \_2 \) when at least one SRS resource is configured in SRS-ResourceSet with usage set to 'nonCodebook'.
6.1.2 Resource allocation
6.1.2.1 Resource allocation in time domain

When the UE is scheduled to transmit a transport block and no CSI report by a DCI or by a RAR UL grant or fallbackRAR UL grant, or the UE is scheduled to transmit a transport block and a CSI report(s) on PUSCH by a DCI, the 'Time domain resource assignment' field value \( m \) of the DCI or the PUSCH time resource allocation field value \( m \) of the RAR UL grant or of the fallbackRAR UL grant provides a row index \( m+1 \) to an allocated table. The determination of the used resource allocation table is defined in Clause 6.1.2.1.1. The indexed row defines the slot offset \( K_{2} \), the start and length indicator SLIV, or directly the start symbol \( S \) and the allocation length \( L \), the PUSCH mapping type, the number of slots used for TBS determination (if numberOfSlotsTBoMS is present in the resource allocation table), and the number of repetitions (if numberOfRepetitions is present in the resource allocation table) to be applied in the PUSCH transmission.

ETSI