<!-- Page 155 of ts_138214v170100p -->

3GPP TS 38.214 version 17.1.0 Release 17
154
ETSI TS 138214 V17.1.0 (2022-05)
- the size of all other RBG is \( P \).

The bitmap is of size \( N_{\text {RBG }} \) bits with one bitmap bit per RBG such that each RBG is addressable. The RBGs shall be indexed in the order of increasing frequency of the bandwidth part and starting at the lowest frequency. The order of RBG bitmap is such that RBG 0 to RBG \( N_{\text {RBG }}-1 \) are mapped from MSB to LSB of the bitmap. The RBG is allocated to the UE if the corresponding bit value in the bitmap is 1 , the RBG is not allocated to the UE otherwise.

In frequency range 1, only 'almost contiguous allocation' defined in [8, TS 38.101-1] is allowed as non-contiguous allocation per component carrier for UL RB allocation for CP-OFDM.

In frequency range 2, non-contiguous allocation per component carrier for UL RB allocation for CP-OFDM is not supported.
6.1.2.2.2 Uplink resource allocation type 1

In uplink resource allocation of type 1, the resource block assignment information indicates to a scheduled UE a set of contiguously allocated non-interleaved virtual resource blocks within the active bandwidth part of size \( N_{\text {BWP }}^{\text {size }} \) PRBs except for the case when DCI format \( 0 \_0 \) is decoded in any common search space in which case the size of the initial UL bandwidth part \( N_{\mathrm{BWP}, 0}^{\mathrm{azz}} \) shall be used.

An uplink type 1 resource allocation field consists of a resource indication value ( \( R I V \) ) corresponding to a starting virtual resource block ( \( R B_{\text {siar }} \) ) and a length in terms of contiguously allocated resource blocks \( L_{R B s} \). The resource indication value is defined by
if \( \left(L_{R B s}-1\right) \leq\left\lfloor N_{B W P}^{s i z e} / 2\right\rfloor \) then
\[
R I V=N_{B W P}^{\text {size }}\left(L_{R B s}-1\right)+R B_{\text {sars }}
\]
else
\[
R I V=N_{B W P}^{\text {size }}\left(N_{B W P}^{\text {size }}-L_{R B s}+1\right)+\left(N_{B W P}^{\text {size }}-1-R B_{\text {sars }}\right)
\]
where \( L_{R B s} \geq 1 \) and shall not exceed \( N_{B W P}^{\text {size }}-R B_{\text {start }} \)
When the DCI size for DCI format \( 0 \_0 \) in USS is derived from the initial UL BWP with size \( N_{B W P}^{\text {initial }} \) but applied to another active BWP with size of \( N_{B W P}^{a c t i v e} \), an uplink type 1 resource block assignment field consists of a resource indication value ( \( R I V \) ) corresponding to a starting resource block \( R B_{\text {start }}=0, K, 2 \cdot K, \ldots,\left(N_{B W P}^{\text {initial }}-1\right) \cdot K \) and a length in terms of virtually contiguously allocated resource blocks \( L_{\text {nss }}=K, 2 \cdot K, \ldots, N_{\text {BWP }}^{\text {intial }} \cdot K \).

The resource indication value is defined by
if \( \left(L_{\text {RBS }}^{\prime}-1\right) \leq\left\lfloor N_{\text {BWP }}^{\text {inididar }} / 2\right\rfloor \) then
\[
R I V=N_{B W P}^{\text {intifial }}\left(L_{\text {nss }}^{\mathrm{t}}-1\right)+R B_{\text {start }}^{\mathrm{t}}
\]
else
\[
R I V=N_{s W P}^{\text {initial }}\left(N_{s W P}^{\text {initial }}-L_{R B s}^{\prime}+1\right)+\left(N_{s W P}^{\text {initial }}-1-R B_{s t a r t}^{\prime}\right)
\]
where \( L_{R B s}^{\prime}=L_{R B s} / K, R B_{\text {siars }}^{\prime}=R B_{\text {siars }} / K \) and where \( L_{R B s}^{\prime} \) shall not exceed \( N_{\text {sWP }}^{\text {initial }}-R B_{\text {start }}^{\prime} \) -

If \( N_{B W P}^{\text {active }}>N_{B W P}^{\text {initial }}, K \) is the maximum value from set \( \{1,2,4,8\} \) which satisfies \( K \leq\left\lfloor N_{B W P}^{\text {active }} / N_{B W P}^{\text {initial }}\right\rfloor \); otherwise \( K=1 \).
When the scheduling grant is received with DCI format \( 0 \_2 \), an uplink type 1 resource allocation field consists of a resource indication value ( \( R I V \) ) corresponding to a starting resource block group \( R B G_{\text {starf }}=0,1, \ldots, N_{R B G}-1 \) and a length in terms of virtually contiguously allocated resource block groups \( L_{R B G s}=1, \ldots, N_{R B G} \), where the resource block groups are defined as in 6.1.2.2.1 with \( P \) defined by resourceAllocationTypelGranularityDCI-0-2 if the UE is configured with

ETSI