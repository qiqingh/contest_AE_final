<!-- Page 196 of ts_138214v170100p -->

3GPP TS 38.214 version 17.1.0 Release 17
195
ETSI TS 138214 V17.1.0 (2022-05)
- Inter-slot frequency hopping, applicable to multi-slot PUSCH transmission.

For operation with shared spectrum channel access, the UE does not expect that two hops of a PUSCH transmission are in different RB sets.

In case of resource allocation type 2, the UE transmits PUSCH without frequency hopping.
In case of resource allocation type 1, whether or not transform precoding is enabled for PUSCH transmission, the UE may perform PUSCH frequency hopping, if the frequency hopping field in a corresponding detected DCI format or in a random access response UL grant is set to 1 , or if for a Type 1 PUSCH transmission with a configured grant the higher layer parameter frequencyHoppingOffset is provided, otherwise no PUSCH frequency hopping is performed. When frequency hopping is enabled for PUSCH, the RE mapping is defined in clause 6.3.1.6 of [4, TS 38.211].

For a PUSCH scheduled by RAR UL grant, fallbackRAR UL grant, or by DCI format \( 0 \_0 \) with CRC scrambled by TCRNTI, frequency offsets are obtained as described in clause 8.3 of [6, TS 38.213]. Otherwise, for a PUSCH scheduled by DCI format \( 0 \_0 / 0 \_1 \) or a PUSCH based on a Type2 configured UL grant activated by DCI format \( 0 \_0 / 0 \_1 \) and for resource allocation type 1, frequency offsets are configured by higher layer parameter frequencyHoppingOffsetLists in pusch-Config. For a PUSCH scheduled by DCI format \( 0 \_2 \) or a PUSCH based on a Type2 configured UL grant activated by DCI format \( 0 \_2 \) and for resource allocation type 1 , frequency offsets are configured by higher layer parameter frequencyHoppingOffsetListsDCI-0-2 in pusch-Config.
- When the size of the active BWP is less than 50 PRBs, one of two higher layer configured offsets is indicated in the UL grant.
- When the size of the active BWP is equal to or greater than 50 PRBs, one of four higher layer configured offsets is indicated in the UL grant.

For PUSCH based on a Typel configured UL grant the frequency offset is provided by the higher layer parameter frequencyHoppingOffset in rrc-ConfiguredUplinkGrant.

For a MsgA PUSCH the frequency offset is provided by the higher layer parameter as described in [6, TS 38.213].
In case of intra-slot frequency hopping, the starting RB in each hop is given by:
\[
\mathrm{RB}_{\text {statt }}=\left\{\begin{array}{cc}
\mathrm{RB}_{\text {statt }} & i=0 \\
\left(\mathrm{RB}_{\text {start }}+\mathrm{RB}_{\text {olset }}\right) \bmod N_{B W P}^{\text {size }} & i=1
\end{array},\right.
\]
where \( i=0 \) and \( i=1 \) are the first hop and the second hop respectively, and \( \mathrm{RB}_{\text {start }} \) is the starting RB within the ULBWP, as calculated from the resource block assignment information of resource allocation type 1 (described in Clause 6.1.2.2.2) or as calculated from the resource assignment for MsgA PUSCH (described in [6, TS 38.213]) and RB \( { }_{\text {afset }} \) is the frequency offset in RBs between the two frequency hops. The number of symbols in the first hop is given by \( \left\lfloor N_{\text {symb }}^{\text {PUSCHs }} / 2\right\rfloor \), the number of symbols in the second hop is given by \( N_{\text {symb }}^{\text {PUSCHs }}-\left\lfloor N_{\text {symb }}^{\text {PUSCHs }} / 2\right\rfloor \), where \( N_{\text {symb }}^{\text {PUSCH }, s} \) is the length of the PUSCH transmission in OFDM symbols in one slot.

In case of inter-slot frequency hopping and when PUSCH-DMRS-Bundling is not enabled, the starting RB during slot \( n_{s}^{p} \) is given by:
\[
\mathrm{RB}_{\text {start }}\left(n_{s}^{\mu}\right)=\left\{\begin{array}{cl}
\mathrm{RB}_{\text {start }} & n_{s}^{\mu} \bmod 2=0 \\
\left(\mathrm{RB}_{\text {start }}+\mathrm{RB}_{\text {offset }}\right) \bmod N_{B W P}^{s i z e} & n_{s}^{\mu} \bmod 2=1
\end{array},\right.
\]
where \( n_{s}^{\mu} \) is the current slot number within a system radio frame, where a multi-slot PUSCH transmission can take place, \( \mathrm{RB}_{\text {start }} \) is the starting RB within the UL BWP, as calculated from the resource block assignment information of resource allocation type 1 (described in Clause 6.1.2.2.2) and \( \mathrm{RB}_{\text {offset }} \) is the frequency offset in RBs between the two frequency hops.

In case of inter-slot frequency hopping and when PUSCH-DMRS-Bundling is enabled, the starting RB during slot \( n_{s}^{\mu} \) is given by:

ETSI