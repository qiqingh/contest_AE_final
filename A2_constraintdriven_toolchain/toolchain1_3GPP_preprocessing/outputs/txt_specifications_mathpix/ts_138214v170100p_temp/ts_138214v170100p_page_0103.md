<!-- Page 103 of ts_138214v170100p -->

3GPP TS 38.214 version 17.1.0 Release 17
102
ETSI TS 138214 V17.1.0 (2022-05)
\[
\begin{array}{l}
\varphi_{l, i}=\left\{\begin{array}{ll}
e^{j 2 \pi c_{l} / N_{\mathrm{PSK}}} & \text { subbandAmplitude }=\text { 'false' } \\
e^{j 2 \pi c_{l} / N_{\mathrm{PSK}}} & \text { subbandAmplitude } \left.=\text { 'true', } \min \left(M_{l}, K^{(2)}\right) \text { strongest coefficients (including } i_{l, 3, l}\right) \text { with } k_{l, i}^{(1)}>0 \\
e^{j 2 \pi c_{l} / 4} & \text { subbandAmplitude }=\text { 'true', } M_{l}-\min \left(M_{l}, K^{(2)}\right) \text { weakest coefficients with } k_{l, i}^{(1)}>0 \\
1 & \text { subbandAmplitude }=\text { 'true', } 2 L-M_{l} \text { coefficients with } k_{l, i}^{(1)}=0
\end{array}\right. \\
u_{m}=\left\{\begin{array}{lll}
{\left[\begin{array}{llll}
1 & e^{j \frac{2 \pi m}{O_{2} N_{2}}} & \cdots & e^{j \frac{2 \pi m\left(N_{2}-1\right)}{O_{2} N_{2}}}
\end{array}\right]} & N_{2}>1 \\
1 & N_{2}=1
\end{array}\right. \\
v_{l, m}=\left[\begin{array}{llll}
u_{m} & e^{j \frac{2 \pi l}{O_{1} N_{1}}} u_{m} & \cdots & e^{j \frac{2 \pi l\left(N_{1}-1\right)}{O_{1} N_{1}}} u_{m}
\end{array}\right]^{T}
\end{array}
\]

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 5.2.2.2.3-5: Codebook for 1-layer and 2-layer CSI reporting using antenna ports 3000 to \( 2999+P_{\text {csI-Rs }} \)}
\begin{tabular}{|l|l|}
\hline Layers & \\
\hline \( v=1 \) & \( W_{q_{1}, q_{2}, n_{1}, n_{2}, p_{1}^{(1)}, p_{1}^{(2)}, i_{2,1}}=W_{q_{1}, q_{2}, n_{1}, n_{2}, p_{1}^{(1)}, p_{1}^{(2)}, i_{2,1.1}}^{1} \) \\
\hline \( v=2 \) & \( W_{q_{1}, q_{2}, n_{1}, n_{2}, p_{1}^{(1)}, q_{1}^{(2)}, i_{2,1,1}, q_{2}^{(1)}, q_{2}^{(2)}, i_{2,1,2}}=\frac{1}{\sqrt{2}}\left[W_{q_{1}, q_{2}, n_{1}, n_{2}, p_{1}^{(1)}, p_{1}^{(2)}, i_{2,1}, 1}^{1} W_{q_{1}, q_{2}, n_{1}, n_{2}, p_{2}^{(1)}, p_{2}^{(2)}, i_{2,1,2}}^{2}\right] \) \\
\hline \multicolumn{2}{|c|}{\begin{tabular}{l}
\[
\text { where } W_{q_{1}, q_{2}, n_{1}, n_{2}, p_{l}^{(1)}, p_{l}^{(2)}, c_{l}}^{l}=\frac{1}{\sqrt{N_{1} N_{2} \sum_{i=0}^{2 L-1}\left(p_{l, i}^{(1)} p_{l, i}^{(2)}\right)^{2}}}\left[\begin{array}{c}
\sum_{i=0}^{L-1} v_{m_{1}^{(i)}, m_{2}^{(i)}} p_{l, i}^{(1)} p_{l, i}^{(2)} \varphi_{l, i} \\
\sum_{i=0}^{L-1} v_{m_{1}^{(i)}, m_{i}^{(i)}} p_{l, i+L}^{(1)} p_{l, i+L}^{(2)} \varphi_{l, i+L}
\end{array}\right], l=1,2
\] \\
and the mappings from \( i_{1} \) to \( q_{1}, q_{2}, n_{1}, n_{2}, p_{1}^{(1)} \), and \( p_{2}^{(1)} \), and from \( i_{2} \) to \( i_{2,1,1}, i_{2,1,2}, p_{1}^{(2)} \) and \( p_{2}^{(2)} \) are as described above, including the ranges of the constituent indices of \( i_{1} \) and \( i_{2} \).
\end{tabular}} \\
\hline
\end{tabular}
\end{table}

When the UE is configured with higher layer parameter codebookType set to 'typell', thebitmap parameter typell-RI-Restriction forms the bit sequence \( r_{1}, r_{0} \) where \( r_{0} \) is the LSB and \( r_{1} \) is the MSB. When \( r_{i} \) is zero, \( i \in\{0,1\} \), PMI and RI reporting are not allowed to correspond to any precoder associated with \( v=i+1 \) layers. The bitmap parameter \( n l \) \( n 2 \)-codebookSubsetRestriction forms the bit sequence \( B=B_{1} B_{2} \) where bit sequences \( B_{1} \), and \( B_{2} \) are concatenated to form \( B \). To define \( B_{1} \) and \( B_{2} \), first define the \( O_{1} O_{2} \) vector groups \( G\left(r_{1}, r_{2}\right) \) as
\[
G\left(r_{1}, r_{2}\right)=\left\{v_{N_{1} r_{1}+x_{1}, N_{2} r_{2}+x_{2}}: x_{1}=0,1, \ldots, N_{1}-1 ; x_{2}=0,1, \ldots, N_{2}-1\right\}
\]
for
\[
\begin{array}{l}
r_{1} \in\left\{0,1, \ldots, O_{1}-1\right\} \\
r_{2} \in\left\{0,1, \ldots, O_{2}-1\right\}
\end{array}
\]

The UE shall be configured with restrictions for 4 vector groups indicated by \( \left(r_{1}^{(k)}, r_{2}^{(k)}\right) \) for \( k=0,1,2,3 \) and identified by the group indices
\[
g^{(k)}=O_{1} r_{2}^{(k)}+r_{1}^{(k)}
\]

ETSI