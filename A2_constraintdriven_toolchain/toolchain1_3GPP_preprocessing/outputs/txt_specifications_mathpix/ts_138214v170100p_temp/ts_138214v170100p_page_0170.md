<!-- Page 170 of ts_138214v170100p -->

3GPP TS 38.214 version 17.1.0 Release 17
169
ETSI TS 138214 V17.1.0 (2022-05)

always set to 0 . In case of PUSCH repetition Type \( \mathrm{B}, N_{\text {DMRS }}^{\text {PRS }} \) is determined assuming a nominal repetition with the duration of \( L \) symbols without segmentation.
- A UE determines the total number of REs allocated for PUSCH \( \left(N_{R E}\right) \) as follows
- For TB processing over multiple slots, \( N_{R E}=N * \min \left(156, N_{R E}^{\prime}\right) \cdot n_{P R B} \) where \( n_{P R B} \) is the total number of allocated PRBs for the UE and \( N \) is the number of slots used for TBS determination indicated by numberOfSlotsTBoMS.
- Otherwise, \( N_{R E}=\min \left(156, N_{R E}^{\prime}\right) \cdot n_{P R B} \) -
- Next, proceed with steps 2-4 as defined in Clause 5.1 3.2
- For a PUSCH scheduled by fallbackRAR UL grant, UE assumes the TB size determined by the UL grant in the fallbackRAR shall be the same as the TB size used in the corresponding MsgA PUSCH transmission.
else if
- \( 28 \leq I_{M C S} \leq 31 \) and transform precoding is disabled and Table 5.1.3.1-2 is used, or
- \( 28 \leq I_{M C S} \leq 31 \) and transform precoding is enabled,
- the TBS is assumed to be as determined from the DCI transported in the latest PDCCH for the same transport block using \( 0 \leq I_{M C S} \leq 27 \). If there is no PDCCH for the same transport block using \( 0 \leq I_{M C S} \leq 27 \), and if the initial PUSCH for the same transport block is transmitted with configured grant,
- the TBS shall be determined from configuredGrantConfig for a configured grant Type 1 PUSCH.
- the TBS shall be determined from the most recent PDCCH scheduling a configured grant Type 2 PUSCH.
else
- the TBS is assumed to be as determined from the DCI transported in the latest PDCCH for the same transport block using \( 0 \leq I_{M C S} \leq 28 \). If there is no PDCCH for the same transport block using \( 0 \leq I_{M C S} \leq 28 \), and if the initial PUSCH for the same transport block is transmitted with configured grant,
- the TBS shall be determined from configuredGrantConfig for a configured grant Type 1 PUSCH.
- the TBS shall be determined from the most recent PDCCH scheduling a configured grant Type 2 PUSCH.
6.1.5 Code block group based PUSCH transmission
6.1.5.1 UE procedure for grouping of code blocks to code block groups

If a UE is configured to transmit code block group (CBG) based transmissions by receiving the higher layer parameter codeBlockGroupTransmission in PUSCH-ServingCellConfig, the UE shall determine the number of CBGs for a PUSCH transmission as
\[
M=\min (N, C)
\]
where \( N \) is the maximum number of CBGs per transport block as configured by maxCodeBlockGroupsPerTransportBlock in PUSCH-ServingCellConfig, and \( C \) is the number of code blocks in the PUSCH according to the procedure defined in Clause 6.2 .3 of [5, TS 38.212].

Define \( M_{1}=\bmod (C, M), K_{1}=\left[\begin{array}{c}C \\ M\end{array}\right] \), and \( K_{2}=\left\lfloor\begin{array}{c}C \\ M\end{array}\right\rfloor \).
If \( M_{1}>0 \), CBG \( m, m=0,1, \ldots, M_{1}-1 \), consists of code blocks with indices \( m \cdot K_{1}+k, k=0,1, \ldots, K_{1}-1 \). CBG \( m \), \( m=M_{1}, M_{1}+1, \ldots, M-1 \), consists of code blocks with indices \( M_{1} \cdot K_{1}+\left(m-M_{1}\right) \cdot K_{2}+k, k=0,1, \ldots, K_{2}-1 \).

ETSI