# ts_138321v180200p

Processed with Mathpix OCR API + pdfplumber fallback
Total pages: 334
Generated: 2025-12-06T15:44:41.684014

================================================================================


--- Page 1  ---


ETSI TS 138321 v18.2.0 (2024-08)

TECHNICAL SPECIFICATION

5G;
NR;
Medium Access Control (MAC) protocol specification (3GPP TS 38.321 version 18.2.0 Release 18)
3 GP

A GLOBAL INITIATIVE


--- Page 2  ---


3GPP TS 38.321 version 18.2.0 Release 18
1
ETSI TS 138321 V18.2.0 (2024-08)

Reference
RTS/TSGR-0238321vi20
Keywords
5G

ETSI
650 Route des Lucioles
F-06921 Sophia Antipolis Cedex - FRANCE
Tel.: +33492944200 Fax: +33493654716
Siret N \( { }^{\circ} 34862356200017 \) - APE 7112B
Association à but non lucratif enregistrée à la
Sous-Préfecture de Grasse (06) No w061004871

Important notice
The present document can be downloaded from the ETSI Search \& Browse Standards application.

The present document may be made available in electronic versions and/or in print. The content of any electronic and/or print versions of the present document shall not be modified without the prior written authorization of ETSI. In case of any existing or perceived difference in contents between such versions and/or in print, the prevailing version of an ETSI deliverable is the one made publicly available in PDF format on ETSI deliver.

Users should be aware that the present document may be revised or have its status changed, this information is available in the Milestones listing.

If you find errors in the present document, please send your comments to the relevant service listed under Committee Support Staff.

If you find a security vulnerability in the present document, please report it through our Coordinated Vulnerability Disclosure (CVD) program.

Notice of disclaimer \& limitation of liability
The information provided in the present deliverable is directed solely to professionals who have the appropriate degree of experience to understand and interpret its content in accordance with generally accepted engineering or other professional standard and applicable regulations.
No recommendation as to products and services or vendors is made or should be implied.
No representation or warranty is made that this deliverable is technically accurate or sufficient or conforms to any law and/or governmental rule and/or regulation and further, no representation or warranty is made of merchantability or fitness for any particular purpose or against infringement of intellectual property rights.
In no event shall ETSI be held liable for loss of profits or any other incidental or consequential damages.
Any software contained in this deliverable is provided "AS IS" with no warranties, express or implied, including but not limited to, the warranties of merchantability, fitness for a particular purpose and non-infringement of intellectual property rights and ETSI shall not be held liable in any event for any damages whatsoever (including, without limitation, damages for loss of profits, business interruption, loss of information, or any other pecuniary loss) arising out of or related to the use of or inability to use the software.

Copyright Notification
No part may be reproduced or utilized in any form or by any means, electronic or mechanical, including photocopying and microfilm except as authorized by written permission of ETSI.
The content of the PDF version shall not be modified without the written authorization of ETSI.
The copyright and the foregoing restriction extend to reproduction in all media.
(c) ETSI 2024.

All rights reserved.

ETSI


--- Page 3  ---


3GPP TS 38.321 version 18.2.0 Release 18
2
ETSI TS 138321 V18.2.0 (2024-08)

Intellectual Property Rights

Essential patents
IPRs essential or potentially essential to normative deliverables may have been declared to ETSL. The declarations pertaining to these essential IPRs, if any, are publicly available for ETSI members and non-members, and can be found in ETSI SR 000 314: "Intellectual Property Rights (IPRs); Essential, or potentially Essential, IPRs notified to ETSI in respect of ETSI standards", which is available from the ETSI Secretariat. Latest updates are available on the ETSI Web server (https://ipr.etsi.org).

Pursuant to the ETSI Directives including the ETSI IPR Policy, no investigation regarding the essentiality of [PRs, including IPR searches, has been carried out by ETSI. No guarantee can be given as to the existence of other IPRs not referenced in ETSI SR 000314 (or the updates on the ETSI Web server) which are, or may be, or may become, essential to the present document.

Trademarks
The present document may include trademarks and/or tradenames which are asserted and/or registered by their owners. ETSI claims no ownership of these except for any which are indicated as being the property of ETSI, and conveys no right to use or reproduce any trademark and/or tradename. Mention of those trademarks in the present document does not constitute an endorsement by ETSI of products, services or organizations associated with those trademarks.

DECT \( { }^{\text {TM }} \), PLUGTESTS \( { }^{\text {TM }} \), UMTS \( { }^{\text {TM }} \) and the ETSI logo are trademarks of ETSI registered for the benefit of its Members. 3GPPTM and LTETM are trademarks of ETSI registered for the benefit of its Members and of the 3GPP Organizational Partners. oneM2M \( { }^{\text {TM }} \) logo is a trademark of ETSI registered for the benefit of its Members and of the oneM2M Partners. GSM \( { }^{\text {® }} \) and the GSM logo are trademarks registered and owned by the GSM Association.

Legal Notice
This Technical Specification (TS) has been produced by ETSI 3rd Generation Partnership Project (3GPP).
The present document may refer to technical specifications or reports using their 3GPP identities. These shall be interpreted as being references to the corresponding ETSI deliverables.

The cross reference between 3GPP and ETSI identities can be found under https://webapp.etsi_org/key/queryform asp.
Modal verbs terminology
In the present document "shall", "shall not", "should", "should not", "may", "need not", "will", "will not", "can" and "cannot" are to be interpreted as described in clause 3.2 of the ETSI Drafting Rules (Verbal forms for the expression of provisions).
"must" and "must not" are NOT allowed in ETSI deliverables except when used in direct citation.

ETSI


--- Page 4  ---


3GPP TS 38.321 version 18.2.0 Release 18
3
ETSI TS 138321 V18.2.0 (2024-08)

Contents
Intellectual Property Rights ..... 2
Legal Notice ..... 2
Modal verbs terminology ..... 2
Foreword ..... 9
1 Scope ..... 10
2 References ..... 10
3 Definitions, symbols and abbreviations ..... 11
3.1 Definitions ..... 11
3.2 Abbreviations ..... 13
4 General ..... 15
4.1 Introduction ..... 15
4.2 MAC architecture ..... 15
4.2.1 General ..... 15
4.2.2 MAC Entities ..... 15
4.3 Services ..... 17
4.3.1 Services provided to upper layers ..... 17
4.3.2 Services expected from physical layer ..... 17
4.4 Functions ..... 18
4.5 Channel structure ..... 18
4.5.1 General ..... 18
4.5.2 Transport Channels ..... 18
4.5.3 Logical Channels ..... 19
4.5.4 Mapping of Transport Channels to Logical Channels ..... 19
4.5.4.1 General ..... 19
4.5.4.2 Uplink mapping ..... 19
4.5.4.3 Downlink mapping ..... 19
4.5.4.4 Sidelink mapping ..... 20
5 MAC procedures ..... 20
5.1 Random Access procedure ..... 20
5.1.1 Random Access procedure initialization ..... 20
5.1.1a Initialization of variables specific to Random Access type ..... 25
5.1.1b Selection of the set of Random Access resources for the Random Access procedure ..... 28
5.1.1c Availability of the set of Random Access resources ..... 32
5.1.1d Selection of the set of Random Access resources based on feature prioritization ..... 32
5.1.1e Selection of Msg1 repetition for SI request ..... 33
5.1.2 Random Access Resource selection ..... 33
5.1.2a Random Access Resource selection for 2-step RA type ..... 37
5.1.3 Random Access Preamble transmission ..... 38
5.1.3a MSGA transmission ..... 40
5.1.4 Random Access Response reception ..... 41
5.1.4a MSGB reception and contention resolution for 2-step RA type ..... 45
5.1.5 Contention Resolution ..... 48
5.1.6 Completion of the Random Access procedure ..... 51
5.2 Maintenance of Uplink Time Alignment ..... 51
5.2a Maintenance of UL Synchronization ..... 55
5.3 DL-SCH data transfer ..... 56
5.3.1 DL Assignment reception ..... 56
5.3.2 HARQ operation ..... 58
5.3.2.1 HARQ Entity ..... 58
5.3.2.2 HARQ process ..... 59
5.3.3 Disassembly and demultiplexing ..... 60
5.4 UL-SCH data transfer ..... 61
5.4.1 UL Grant reception ..... 61

ETSI


--- Page 5  ---


3GPP TS 38.321 version 18.2.0 Release 18
4
ETSI TS 138321 V18.2.0 (2024-08)
5.43.2 Multiplexing of MAC Control Elements and MAC SDUs
5.4.4 Scheduling Request
5.4.8 Timing Advance Reporting ................................................................................................................... 90
5.4.9 Delay status reporting
5.7 Discontinuous Reception (DRX)
5.7b Discontinuous Reception (DRX) for MBS Multicast
5.8 Transmission and reception without dynamic scheduling
5.8.3 Sidelink
5.12 MAC Reset
5.12a Void 117
5.15.1 Downlink and Uplink ------------------------------------------------------------------------------------------------------------ 118
5.18 .1 General
5.18.6 Activation/Deactivation of Semi-persistent CSI reporting on PUCCH
5.18.7 Activation/Deactivation of Semi-persistent SRS and Indication of spatial relation of SP/AP SRS ......... 131
5.18.8 Activation/Deactivation of spatial relation of PUCCH resource .............................................................131
5.18.9 Activation/Deactivation of semi-persistent ZP CSI-RS resource set
5.18.14 Update of Pathloss Reference RS of SRS
5.18.15 Update of Pathloss Reference RS of PUSCH
5.18.16 Indication of spatial relation of SRS resource for a Serving Cell set
5.18.17 Activation/Deactivation of Semi-Persistent Positioning SRS
5.18.22 Update of PUCCH Power Control Set for multiple TRP PUCCH repetition ...........................................136
5.18.23 Unified TCI States Activation/Deactivation MAC CE

ETSI


--- Page 6  ---


3GPP TS 38.321 version 18.2.0 Release 18
5
ETSI TS 138321 V18.2.0 (2024-08)
5.18.25 BFD-RS Indication MAC CE ..... 136
5.18.26 Restricted and recommended beam indication for IAB ..... 136
5.18.27 DL TX power adjustment for IAB ..... 137
5.18.28 UL PSD range adjustment for IAB ..... 137
5.18.29 Timing case indication for [AB ..... 138
5.18.30 Case-6 Timing Request ..... 138
5.18.31 Backhaul Link Beam Indication for NCR ..... 138
5.18.32 Access Link Beam Indication for NCR ..... 139
5.18.33 Enhanced Unified TCI States Activation/Deactivation MAC CE ..... 139
5.18.34 Activation/deactivation of PSI-based SDU discard ..... 139
5.18.35 LTM Cell Switch Command ..... 139
5.18.36 Candidate Cell TCI States Activation/Deactivation ..... 140
5.18.37 Activation/Deactivation of Aggregated Semi-Persistent Positioning SRS ..... 140
5.19 Data inactivity monitoring ..... 140
5.20 Void ..... 141
5.21 LBT operation ..... 141
5.21.1 General ..... 141
5.21.2 LBT failure detection and recovery procedure ..... 141
5.22 SL-SCH Data transfer and SL-PRS transmission ..... 142
5.22.1 SL-SCH Data and SL-PRS transmission ..... 142
5.22.1.1 SL Grant reception and SCI transmission ..... 142
5.22.1.2 TX resource (re-)selection check ..... 163
5.22.1.2a Re-evaluation and Pre-emption ..... 164
5.22.1.2b Re-selection for using a received resource conflict indication ..... 166
5.22.1.2c Resource re-selection from SL LBT Failure indication ..... 166
5.22.1.3 Sidelink HARQ operation and SL-PRS transmission ..... 167
5.22.1.3.1 Sidelink HARQ Entity ..... 167
5.22.1.3.1a Sidelink process not associated with Dedicated SL-PRS resource pool ..... 170
5.22.1.3.2 PSFCH reception ..... 171
5.22.1.3.3 HARQ-based Sidelink RLF detection ..... 173
5.22.1.3.4 Processing of sidelink grant on Dedicated SL-PRS resource pool ..... 173
5.22.1.3.5 Sidelink process associated with Dedicated SL-PRS resource pool ..... 174
5.22.1.4 Multiplexing and assembly ..... 175
5.22.1.4.0 General ..... 175
5.22.1.4.1 Logical channel prioritization ..... 175
5.22.1.4.1.1 General ..... 175
5.22.1.4.1.2 Selection of logical channels and SL-PRS ..... 175
5.22.1.4.1.3 Allocation of sidelink resources ..... 178
5.22.1.4.2 Multiplexing of MAC Control Elements and MAC SDUs ..... 180
5.22.1.5 Scheduling Request ..... 180
5.22.1.6 Buffer Status Reporting ..... 181
5.22.1.7 CSI Reporting ..... 183
5.22.1.8 Void ..... 184
5.22.1.9 IUC-Request transmission ..... 184
5.22.1.10 IUC-Information Reporting ..... 184
5.22.1.10.1 General ..... 184
5.22.1.10.2 Reception of IUC-Information Reporting ..... 185
5.22.1.11 TX carrier (re-)selection. ..... 185
5.22.1.12 SL-PRS Resource Request ..... 186
5.22.2 SL-SCH Data and SL-PRS reception ..... 187
5.22.2.1 SCI reception ..... 187
5.22.2.2 Sidelink HARQ operation and SL-PRS reception on Shared SL-PRS resource pool ..... 188
5.22.2.2.1 Sidelink HARQ Entity ..... 188
5.22.2.2.2 Sidelink process ..... 189
5.22.2.3 Disassembly and demultiplexing ..... 190
5.22.2.4 SL-PRS reception on Dedicated SL-PRS resource pool ..... 190
5.23 SL-BCH data transfer ..... 191
5.23.1 SL-BCH data transmission ..... 191
5.23.2 SL-BCH data reception ..... 191
5.24 Handling of PRS Processing Window ..... 191
5.25 Positioning Measurement Gap Activation/Deactivation Request ..... 191
5.26 Positioning SRS transmission in RRC_INACTIVE ..... 192

ETSI


--- Page 7  ---


3GPP TS 38.321 version 18.2.0 Release 18
6
ETSI TS 138321 V18.2.0 (2024-08)
5.26.2 TA validation for SRS transmission in RRC_INACTIVE_a一 192
5.27 Small Data Transmission
5.27 .1 General
5.28 .1 General
5.28.3 Behaviour of UE transmitting SL-SCH Data
5. 29 Activation/Deactivation of SCG
5.32 SRS for positioning Tx frequency hopping

6 Protocol Data Units, formats and parameters......................................................................... 206
6.1.1 General_
6.1.2 MAC PDU (DL-SCH and UL-SCH except transparent MAC and Random Access Response) .................. 207
6.1.3.3 UE Contention Resolution Identity MAC CE
6.13.4a Absolute Timing Advance Command MAC CE
6.1.3.8 Single Entry PHR MAC CE
6.1.3.13 Aperiodic CSI Trigger State Subselection MAC CE
6.1.3.15 TCI State Indication for UE-specific PDCCH MAC CE ⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯⋯ 228
6.1.3.16 SP CSI reporting on PUCCH Activation/Deactivation MAC CE
6.1.3.18 PUCCH spatial relation Activation/Deactivation MAC CE
6.1.3.26 Enhanced SP/AP SRS Spatial Relation Indication MAC CE
6.1.3.27 SRS Pathloss Reference RS Update MAC CE

ETSI


--- Page 8  ---


3GPP TS 38.321 version 18.2.0 Release 18
7
ETSI TS 138321 V18.2.0 (2024-08)
6.13.38 Case-7 Timing advance offset MAC CE
6.1.3.42 PPW Activation/Deactivation Command MAC CE
6.13.43 Enhanced BFR MAC CEs
6.1.3.45 PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE ... 254
6.13.54 Inter-UE Coordination Request MAC CE
6.1.3.57 Differential Koffset MAC CE
6.13.58 BFD-RS Indication MAC CE
6.1.3.66 NCR Downlink Backhaul Link Beam Indication MAC CE
6.1.3.70 Enhanced Unified TCI States Activation/Deactivation MAC CE for Joint TCI States ........................ 287
6.1.3.71 Enhanced Unified TCI States Activation/Deactivation MAC CE for Separate TCI States ................ 288
6.1.3.74 SL-PRS Resource Request MAC CE
6.1.3.78 Single Entry PHR with assumed PUSCH MAC CE
6.1.3.80 Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE
6.1.3.81 Enhanced Single Entry PHR for multiple TRP STx2P MAC CE
6.1.3.82 Enhanced Multiple Entry PHR for multiple TRP STx2P MAC CE
6.1.4 MAC PDU (transparent MAC)
6.1.5 MAC PDU (Random Access Response)
6.2 Formats and parameters
6.2.1 MAC subheader for DL-SCH and UL-SCH
6.2.2 MAC subheader for Random Access Response
6.2.2a MAC subheader for MSGB
6.2.3a MAC payload for MSGB
6.2.4 MAC subheader for SL-SCH

ETSI


--- Page 9  ---


3GPP TS 38.321 version 18.2.0 Release 18
8
ETSI TS 138321 V18.2.0 (2024-08)
7.2 Backoff Parameter values ..... 323
7.3 DELTA_PREAMBLE values ..... 323
7.4 PRACH Mask Index values ..... 324
Annex A (informative): Change history ..... 325
History ..... 333

ETSI


--- Page 10  ---


3GPP TS 38.321 version 18.2.0 Release 18
9
ETSI TS 138321 V18.2.0 (2024-08)

Foreword
This Technical Specification has been produced by the 3rd Generation Partnership Project (3GPP).
The contents of the present document are subject to continuing work within the TSG and may change following formal TSG approval. Should the TSG modify the contents of the present document, it will be re-released by the TSG with an identifying change of release date and an increase in version number as follows:

Version x.y.z
where:
x the first digit:
1 presented to TSG for information;
2 presented to TSG for approval;
3 or greater indicates TSG approved document under change control.
y the second digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc.
\( z \) the third digit is incremented when editorial only changes have been incorporated in the document.

ETSI


--- Page 11  ---


3GPP TS 38.321 version 18.2.0 Release 18
10
ETSI TS 138321 V18.2.0 (2024-08)

1 Scope
The present document specifies the NR MAC protocol.
2 References
The following documents contain provisions which, through reference in this text, constitute provisions of the present document.
- References are either specific (identified by date of publication, edition number, version number, etc.) or non-specific.
- For a specific reference, subsequent revisions do not apply.
- For a non-specific reference, the latest version applies. In the case of a reference to a 3GPP document (including a GSM document), a non-specific reference implicitly refers to the latest version of that document in the same Release as the present document.
[1] 3GPP TR 21.905: "Vocabulary for 3GPP Specifications".
[2] 3GPP TS 38.300: "NR; Overall description; Stage 2".
[3] 3GPP TS 38.322: "NR; Radio Link Control (RLC) protocol specification".
[4] 3GPP TS 38.323: "NR; Packet Data Convergence Protocol (PDCP) protocol specification".
[5] 3GPP TS 38.331: "NR; Radio Resource Control (RRC); Protocol specification".
[6] 3GPP TS 38.213: "NR; Physical Layer Procedures for control".
[7] 3GPP TS 38.214: "NR; Physical Layer Procedures for data".
[8] 3GPP TS 38.211: "NR; Physical channels and modulation".
[9] 3GPP TS 38.212: "NR; Multiplexing and channel coding".
[10] Void.
[11] 3GPP TS 38.133: "NR; Requirements for support of radio resource management".
[12] 3GPP TS 36.133: "Evolved Universal Terrestrial Radio Access (E-UTRA); Requirements for support of radio resource management".
[13] 3GPP TS 26.114: "Technical Specification Group Services and System Aspects; IP Multimedia Subsystem (IMS); Multimedia Telephony; Media handling and interaction".
[14] 3GPP TS 38.101-1: "NR; User Equipment (UE) radio transmission and reception; Part 1: Range 1 Standalone".
[15] 3GPP TS 38.101-2: "NR; User Equipment (UE) radio transmission and reception; Part 2: Range 2 Standalone".
[16] 3GPP TS 38.101-3: "NR; User Equipment (UE) radio transmission and reception; Part 3: Range 1 and Range 2 Interworking operation with other radios".
[17] 3GPP TS 36.213: "Evolved Universal Terrestrial Radio Access (E-UTRA); Physical Layer Procedures".
[18] 3GPP TS 37.213: "Physical layer procedures for shared spectrum channel access".
[19] 3GPP TS 23.287: "Architecture enhancements for 5G System (5GS) to support Vehicle-toEverything (V2X) services".
[20] 3GPP TS 23.285: "Architecture enhancements for V2X services".

ETSI


--- Page 12  ---


3GPP TS 38.321 version 18.2.0 Release 18
11
ETSI TS 138321 V18.2.0 (2024-08)

[21] 3GPP TS 36.331: "Evolved Universal Terrestrial Radio Access (E-UTRA); Radio Resource Control (RRC); Protocol specification".
[22] 3GPP TS 36.321: "Evolved Universal Terrestrial Radio Access (E-UTRA); Medium Access Control (MAC); Protocol specification".
[23] 3GPP TS 37.355: "Evolved Universal Terrestrial Radio Access (E-UTRA); LTE Positioning Protocol (LPP)".
[24] 3GPP TS 38.215: "NR; Physical layer measurements".
[25] 3GPP TS 38.306: "NR; User Equipment (UE) radio access capabilities".
[26] 3GPP TS 23.304: "Proximity based Services (ProSe) in the 5G System (5GS)".
[27] 3GPP TS 38.473: "NG-RAN; F1 Application Protocol (F1AP)".
[28] 3GPP TS 24.587: "Technical Specification Group Core Network and Terminals; Vehicle-toEverything (V2X) services in 5G System (5GS)".
[29] 3GPP TS 24.554: "Technical Specification Group Core Network and Terminals; Proximityservices (ProSe) in 5G System (5GS) protocol".
[30] 3GPP TS 23.586: "Technical Specification Group Services and System Aspects; Architectural Enhancements to support Ranging based services and Sidelink Positioning".
[31] 3GPP TS 23.256: "Support of Uncrewed Aerial Systems (UAS) connectivity, identification and tracking; Stage 2".

3 Definitions, symbols and abbreviations
3.1 Definitions

For the purposes of the present document, the terms and definitions given in TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in TR 21.905 [1].

A2X communication: A communication to support A2X services leveraging PC5 reference points, as defined in TS 23.256 [31]. A2X services are realized by various types of A2X applications, e.g., BRID or DAA.

Air to Ground network: An NG-RAN consisting of ground-based gNBs, which provide cell towers that send signals up to an aircraft's antenna(s) of onboard ATG terminal, with typical vertical altitude of around \( 10,000 \mathrm{~m} \) and takeoff/landing altitudes down to 3000 m .

BWP for SRS for positioning Tx frequency hopping: For SRS for positioning Tx frequency hopping, separate BWP configuration outside BWP configuration for data transmission.

Dedicated SL-PRS resource pool: A sidelink resource pool which can be used for the transmission of SL-PRS and cannot be used for the transmission of PSSCH.

Dormant BWP: The dormant BWP is one of downlink BWPs configured by the network via dedicated RRC signaling. In the dormant BWP, the UE stop monitoring PDCCH on/for the SCell, but continues performing CSI measurements, Automatic Gain Control (AGC) and beam management, if configured.

DRX group: A group of Serving Cells that is configured by RRC and that have the same DRX Active Time.
eRedCap UE: A UE with enhanced reduced capabilities as specified in clause 4.2.22.1 of TS 38.306 [25].
HARQ information: HARQ information for DL-SCH, for UL-SCH, or for SL-SCH transmissions consists of New Data Indicator (NDI), Transport Block Size (TBS), Redundancy Version (RV), and HARQ process ID.

IAB-donor: gNB that provides network access to UEs via a network of backhaul and access links.
IAB-node: RAN node that supports NR access links to UEs and NR backhaul links to parent nodes and child nodes.

ETSI


--- Page 13  ---


3GPP TS 38.321 version 18.2.0 Release 18
12
ETSI TS 138321 V18.2.0 (2024-08)

Listen Before Talk: A procedure according to which transmissions are not performed if the channel is identified as being occupied, see TS 37.213 [18].

LTM candidate cell: A candidate cell configured for LTM as defined in TS 38.331 [5].
Msg3: Message transmitted on UL-SCH containing a C-RNTI MAC CE or CCCH SDU, submitted from upper layer and associated with the UE Contention Resolution Identity, as part of a Random Access procedure.

Multi-path: Mode of operation of a UE in RRC_CONNECTED configured with one direct path on which the UE connects to gNB using NR Uu, and one indirect path on which the UE connects to the same gNB via another UE using PC5 unicast link or non-3GPP connection (N3C).

Multi-PUSCH configured grant: A configured grant configuration that includes multiple consecutive configured uplink grants within a single periodicity.

N3C indirect path: In Multi-path, the indirect path using Non-3GPP Connection between remote UE and relay UE.
NCR-Fwd: NCR-node function, which performs amplifying-and-forwarding of UL/DL RF signals between gNB and UE. The behavior of the NCR-Fwd is controlled according to the side control information received by the NCR-MT from a gNB .

NCR-MT: NCR-node entity which communicates with a gNB via a control link to receive side control information. The control link is based on NR Uu interface.

NCR-node: RAN node comprising NCR-MT and NCR-Fwd.
Non-terrestrial network: An NG-RAN consisting of gNBs, which provide non-terrestrial NR access to UEs by means of an NTN payload embarked on an airborne or space-borne NTN vehicle and an NTN Gateway.

NR backhaul link: NR link used for backhauling between an [AB-node and an [AB-donor, and between [AB-nodes in case of a multi-hop backhauling.

NR sidelink communication: AS functionality enabling at least V2X Communication as defined in TS 23.287 [19] and ProSe communication (including ProSe non-Relay, UE-to-Network Relay and UE-to-UE Relay communication (including ProSe UE-to-UE Relay communication with integrated discovery)) as defined in TS 23.304 [26], between two or more nearby UEs, using NR technology but not traversing any network node.

NR sidelink discovery: AS functionality enabling ProSe non-Relay discovery, ProSe UE-to-Network Relay discovery and ProSe UE-to-UE Relay discovery for Proximity based Services as defined in TS 23.304 [26], between two or more nearby UEs, using NR technology but not traversing any network node.

NR sidelink transmission: Any NR Sidelink-based transmission, including transmission for NR sidelink discovery, transmission for NR sidelink communication, transmission for Ranging/Sidelink Positioning, and transmission for A2X communication.

PDCCH occasion: A time duration (i.e. one or a consecutive number of symbols) during which the MAC entity is configured to monitor the PDCCH.

Positioning SRS Bandwidth Aggregation: Transmission of positioning SRS on multiple carriers in RRC_CONNECTED and RRC_INACTIVE where the positioning SRS resources are linked in RRC configuration as defined in TS 38.331 [5].

PRS Processing Window: A time window during which UE may perform PRS measurement inside the active DL BWP with the same numerology as the active DL BWP without measurement gap.

Ranging/Sidelink Positioning: AS functionality enabling ranging-based services and sidelink positioning as specified in TS 23.586 [30].

RB set: A RB set refers to a contiguous set of resource blocks (RBs) on which a channel access procedure is performed in shared spectrum as defined in TS 37.213 [18].

RedCap UE: A UE with reduced capabilities as specified in clause 4.2.21.1 in TS 38.306 [25].
Serving Cell: A PCell, a PSCell, or an SCell in TS 38.331 [5].

ETSI


--- Page 14  ---


3GPP TS 38.321 version 18.2.0 Release 18
13
ETSI TS 138321 V18.2.0 (2024-08)

Shared SL-PRS resource pool: A sidelink resource pool which can be used for the transmission of both SL-PRS and PSSCH.

Sidelink transmission information: Sidelink transmission information included in an SCI for an SL-SCH transmission or SL-PRS transmission with or without SL-SCH transmission on Shared SL-PRS resource pool as specified in clause 8.3 and 8.4 of TS 38.212 [9] consists of Sidelink HARQ information including NDI, RV, Sidelink process [D, HARQ feedback enabled/disabled indicator, Sidelink identification information including cast type indicator, Source Layer-1 ID and Destination Layer-1 ID, and Sidelink other information including CSI request, SL-PRS request, SL-PRS resource ID, a priority, a communication range requirement and Zone ID and COT sharing information.

SL-PRS delay budget: Delay budget before which the SL-PRS is expected to be transmitted by the Tx UE.
SL-PRS transmission information on Dedicated SL-PRS resource pool: SL-PRS transmission information on Dedicated SL-PRS resource pool is included in an SCI for an SL-PRS transmission on Dedicated SL-PRS resource pool, as specified in TS 38.212 [9], consisting of
- SL-PRS identification information, including cast type indicator, source ID and destination ID;
- SL-PRS transmission other information, including SL-PRS priority, SL-PRS request, SL-PRS resource ID and resource reservation period.

SRS for positioning Tx frequency hopping: Transmit frequency hopping of positioning SRS in RRC_INACTIVE and RRC_CONNECTED.

SRS positioning validity area: An area consisting of a list of cells within which the corresponding positioning SRS configuration is considered as valid.

Special Cell: For Dual Connectivity operation the term Special Cell refers to the PCell of the MCG or the PSCell of the SCG depending on if the MAC entity is associated to the MCG or the SCG, respectively. Otherwise the term Special Cell refers to the PCell. A Special Cell supports PUCCH transmission and contention-based Random Access, and is always activated.

Timing Advance Group: A group of Serving Cells that is configured by RRC and that, for the cells with a UL configured, using the same timing reference cell and the same Timing Advance value. A Timing Advance Group containing the SpCell of a MAC entity is referred to as Primary Timing Advance Group (PTAG), whereas the term Secondary Timing Advance Group (STAG) refers to other TAGs.

UE-gNB RTT: For non-terrestrial networks, the sum of the UE's Timing Advance value (see TS 38.211 [8] clause 4.3.1) and kmac.

V2X sidelink communication: AS functionality enabling V2X Communication as defined in TS 23.285 [20], between nearby UEs, using E-UTRA technology but not traversing any network node.

NOTE 1: A timer is running once it is started, until it is stopped or until it expires; otherwise it is not running. A timer can be started if it is not running or restarted if it is running. A Timer is always started or restarted from its initial value. The duration of a timer is not updated until it is stopped or expires (e.g. due to BWP switching). When the MAC entity applies zero value for a timer, the timer shall be started and immediately expire unless explicitly stated otherwise.

NOTE 2: In this version of the specification, the SRS in the procedural description includes Positioning SRS except for the Positioning SRS for transmission in RRC_INACTIVE as in clause 5.26. Positioning SRS except for the Positioning SRS for transmission in RRC_INACTIVE is treated the same as SRS by the UE unless explicitly stated otherwise.
3.2 Abbreviations

For the purposes of the present document, the abbreviations given in TR 21.905 [1] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in TR 21.905 [1].

\begin{tabular}{ll} 
A2X & Aircraft-to-Everything \\
AP & Aperiodic \\
BFR & Beam Failure Recovery \\
BRID & Broadcast Remote Identification
\end{tabular}

ETSI


--- Page 15  ---


3GPP TS 38.321 version 18.2.0 Release 18
14
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|}
\hline BSR & Buffer Status Report \\
\hline BWP & Bandwidth Part \\
\hline CE & Control Element \\
\hline CG & Cell Group \\
\hline CG-SDT & Configured Grant-based SDT \\
\hline CI-RNTI & Cancellation Indication RNTI \\
\hline CSI & Channel State Information \\
\hline CSI-IM & CSI Interference Measurement \\
\hline CSI-RS & CSI Reference Signal \\
\hline CS-RNTI & Configured Scheduling RNTI \\
\hline DAA & Detect And Avoid \\
\hline DAPS & Dual Active Protocol Stack \\
\hline DCP & DCI with CRC scrambled by PS-RNTI \\
\hline DL-PRS & DownLink-Positioning Reference Signal \\
\hline DSR & Delay Status Report \\
\hline DTX & Discontinuous Transmission \\
\hline G-CS-RNTI & Group Configured Scheduling RNTI \\
\hline G-RNTI & Group RNTI \\
\hline [AB & Integrated Access and Backhaul \\
\hline [NT-RNTI & Interruption RNTI \\
\hline LBT & Listen Before Talk \\
\hline LCG & Logical Channel Group \\
\hline LCP & Logical Channel Prioritization \\
\hline LTM & L1/L2 Triggered Mobility \\
\hline MBS & Multicast/Broadcast Services \\
\hline MCCH & MBS Control Channel \\
\hline MCCH-RNTI & MBS Control Channel RNTI \\
\hline MCG & Master Cell Group \\
\hline MO-SDT & Mobile Originated SDT \\
\hline MPE & Maximum Permissible Exposure \\
\hline MTCH & MBS Traffic Channel \\
\hline MT-SDT & Mobile Terminated SDT \\
\hline N3C & Non-3GPP Connection \\
\hline NCD-SSB & Non Cell Defining SSB \\
\hline NCR & Network-Controlled Repeater \\
\hline NSAG & Network Slice AS Group \\
\hline NUL & Normal Uplink \\
\hline NZP CSI-RS & Non-Zero Power CSI-RS \\
\hline PDB & Packet Delay Budget \\
\hline PEI-RNTI & Paging Early Indication RNTI \\
\hline PHR & Power Headroom Report \\
\hline PQ[ & PC5 QoS Identifier \\
\hline PS-RNTI & Power Saving RNTI \\
\hline PSI & PDU Set Importance \\
\hline PTAG & Primary Timing Advance Group \\
\hline PTM & Point to Multipoint \\
\hline PTP & Point to Point \\
\hline QCL & Quasi-colocation \\
\hline PPW & PRS Processing Window \\
\hline PRS & Positioning Reference Signal \\
\hline RA-SDT & Random Access-based SDT \\
\hline RRH & Remote Radio Head \\
\hline RS & Reference Signal \\
\hline SCG & Secondary Cell Group \\
\hline SDT & Small Data Transmission \\
\hline SFI-RNTI & Slot Format Indication RNTI \\
\hline SI & System Information \\
\hline SL-PRS-CS-RNTI & SL-PRS Configured Scheduling RNTI \\
\hline SL-PRS-RNTI & SL-PRS RNTI \\
\hline SL-CS-RNTI & Sidelink Configured Scheduling RNTI \\
\hline SL-PRS & Sidelink PRS \\
\hline SL-RNTI & Sidelink RNTI \\
\hline
\end{tabular}

ETSI


--- Page 16  ---


3GPP TS 38.321 version 18.2.0 Release 18
15
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|}
\hline SpCell & Special Cell \\
\hline SP & Semi-Persistent \\
\hline SP-CSI-RNTI & Semi-Persistent CSI RNTI \\
\hline SPS & Semi-Persistent Scheduling \\
\hline SR & Scheduling Request \\
\hline SRI & SRS Resource Indicator \\
\hline SS & Synchronization Signals \\
\hline SSB & Synchronization Signal Block \\
\hline STAG & Secondary Timing Advance Group \\
\hline STx2P & Simultaneous Transmission with 2 Panels \\
\hline SUL & Supplementary Uplink \\
\hline TAG & Timing Advance Group \\
\hline TCI & Transmission Configuration Indicator \\
\hline TPC-SRS-RNTI & Transmit Power Control-Sounding Reference Signal-RNTI \\
\hline TRIV & Time Resource Indicator Value \\
\hline TRP & Transmit/Receive Point \\
\hline TRS & CSI-RS for tracking \\
\hline U2N & UE-to-Network \\
\hline U2U & UE-to-UE \\
\hline UCI & Uplink Control Information \\
\hline UTO-UCI & Unused Transmission Occasion - UCI \\
\hline UTW & Uplink Time Window \\
\hline V2X & Vehicle-to-Everything \\
\hline ZP CSI-RS & Zero Power CSI-RS \\
\hline
\end{tabular}

4 General
4.1 Introduction

The objective of this clause is to describe the MAC architecture and the MAC entity of the UE from a functional point of view.
4.2 MAC architecture
4.2.1 General

This clause describes a model of the MAC i.e it does not specify or restrict implementations.
RRC is in control of the MAC configuration.
4.2.2 MAC Entities

The MAC entity of the UE handles the following transport channels:
- Broadcast Channel (BCH);
- Downlink Shared Channel(s) (DL-SCH);
- Paging Channel (PCH);
- Uplink Shared Channel(s) (UL-SCH);
- Random Access Channel(s) (RACH).

When the UE is configured with SCG, two MAC entities are configured to the UE: one for the MCG and one for the SCG.

ETSI


--- Page 17  ---


3GPP TS 38.321 version 18.2.0 Release 18
16
ETSI TS 138321 V18.2.0 (2024-08)

When the UE is configured with DAPS handover, two MAC entities are used by the UE: one for the source cell (source MAC entity) and one for the target cell (target MAC entity).

The functions of the different MAC entities in the UE operate independently unless otherwise specified. The timers and parameters used in each MAC entity are configured independently unless otherwise specified. The Serving Cells, CRNTI, radio bearers, logical channels, upper and lower layer entities, LCGs, and HARQ entities considered by each MAC entity refer to those mapped to that MAC entity unless otherwise specified.

If the MAC entity is configured with one or more SCells, there are multiple DL-SCH and there may be multiple ULSCH as well as multiple RACH per MAC entity; one DL-SCH, one UL-SCH, and one RACH on the SpCell, one DLSCH, zero or one UL-SCH and zero or one RACH for each SCell.

If the MAC entity is not configured with any SCell, there is one DL-SCH, one UL-SCH, and one RACH per MAC entity.

If the UE is configured with LTM candidate cell(s), there may be zero or one RACH for each LTM candidate cell, which shares the same corresponding MAC entity with Serving Cell.

Figure 4.2.2-1 illustrates one possible structure of the MAC entity when SCG is not configured and for each MAC entity during DAPS handover.

Figure 4.2.2-1: MAC structure overview

Figure 4.2.2-2 illustrates one possible structure for the MAC entities when MCG and SCG are configured.

ETSI


--- Page 18  ---


3GPP TS 38.321 version 18.2.0 Release 18
17
ETSI TS 138321 V18.2.0 (2024-08)

Figure 4.2.2-2: MAC structure overview with two MAC entities

In addition, the MAC entity of the UE handles the following transport channel for sidelink:
- Sidelink Shared Channel (SL-SCH);
- Sidelink Broadcast Channel (SL-BCH).

Figure 4.2.2-3 illustrates one possible structure for the MAC entity when sidelink is configured.

Figure 4.2.2-3: MAC structure overview for sidelink
4.3 Services
4.3.1 Services provided to upper layers

The MAC sublayer provides the following services to upper layers:
- data transfer;
- radio resource allocation.
4.3.2 Services expected from physical layer

The MAC sublayer expects the following services from the physical layer:

ETSI


--- Page 19  ---


3GPP TS 38.321 version 18.2.0 Release 18
18
ETSI TS 138321 V18.2.0 (2024-08)
- data transfer services;
- signalling of HARQ feedback;
- signalling of Scheduling Request;
- measurements (e.g. Channel Quality Indication (CQI)).
4.4 Functions

The MAC sublayer supports the following functions:
- mapping between logical channels and transport channels;
- multiplexing of MAC SDUs from one or different logical channels onto transport blocks (TB) to be delivered to the physical layer on transport channels;
- demultiplexing of MAC SDUs to one or different logical channels from transport blocks (TB) delivered from the physical layer on transport channels;
- scheduling information reporting;
- error correction through HARQ;
- logical channel prioritization;
- priority handling between overlapping resources of one UE;
- radio resource selection.

The relevance of MAC functions for uplink, downlink, and sidelink is indicated in Table 4.4-1.

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 4.4-1: The link direction association of MAC functions.}
\begin{tabular}{|l|l|l|l|l|}
\hline MAC function & Downlink & Uplink & Sidelink TX & Sidelink RX \\
\hline Mapping between logical channels and transport channels & X & X & X & X \\
\hline Multiplexing & & X & X & \\
\hline Demultiplexing & X & & & X \\
\hline Scheduling information reporting & & X & X & \\
\hline Error correction through HARQ & X & X & X & X \\
\hline Logical Channel prioritization & & X & X & \\
\hline Radio resource selection & & & X & \\
\hline
\end{tabular}
\end{table}
4.5 Channel structure
4.5.1 General

The MAC sublayer operates on the channels defined below; transport channels are SAPs between MAC and Layer 1, logical channels are SAPs between MAC and RLC.
4.5.2 Transport Channels

The MAC sublayer uses the transport channels listed in Table 4.5.2-1 below.

ETSI


--- Page 20  ---


3GPP TS 38.321 version 18.2.0 Release 18
19
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 4.5.2-1: Transport channels used by MAC}
\begin{tabular}{|l|c|c|c|c|}
\hline \multicolumn{1}{|c|}{ Transport channel name } & Acronym & Downlink & Uplink & Sidelink \\
\hline Broadcast Channel & BCH & X & & \\
\hline Downlink Shared Channel & DL-SCH & X & & \\
\hline Paging Channel & PCH & X & & \\
\hline Uplink Shared Channel & UL-SCH & & X & \\
\hline Random Access Channel & RACH & & X & \\
\hline Sidelink Broadcast Channel & SL-BCH & & & X \\
\hline Sidelink Shared Channel & SL-SCH & & & X \\
\hline
\end{tabular}
\end{table}
4.5.3 Logical Channels

The MAC sublayer provides data transfer services on logical channels. To accommodate different kinds of data transfer services, multiple types of logical channels are defined i.e. each supporting transfer of a particular type of information.

Each logical channel type is defined by what type of information is transferred.
The MAC sublayer provides the control and traffic channels listed in Table 4.5.3-1 below.

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 4.5.3-1: Logical channels provided by MAC.}
\begin{tabular}{|l|l|l|l|}
\hline Logical channel name & Acronym & Control channel & Traffic channel \\
\hline Broadcast Control Channel & BCCH & X & \\
\hline Paging Control Channel & PCCH & X & \\
\hline Common Control Channel & CCCH & X & \\
\hline Dedicated Control Channel & DCCH & X & \\
\hline Dedicated Traffic Channel & DTCH & & X \\
\hline MBS Control Channel & MCCH & X & \\
\hline MBS Traffic Channel & MTCH & & X \\
\hline Sidelink Broadcast Control Channel & SBCCH & X & \\
\hline Sidelink Control Channel & SCCH & X & \\
\hline Sidelink Traffic Channel & STCH & & X \\
\hline
\end{tabular}
\end{table}
4.5.4 Mapping of Transport Channels to Logical Channels
4.5.4.1 General

The MAC entity is responsible for mapping logical channels onto transport channels. This mapping depends on the multiplexing that is configured by RRC.
4.5.4.2 Uplink mapping

The uplink logical channels can be mapped as described in Table 4.5.4.2-1.

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 4.5.4.2-1: Uplink channel mapping.}
\begin{tabular}{|c|c|c|}
\hline Logical channel & UL-SCH & RACH \\
\hline CCCH & X & \\
\hline DCCH & X & \\
\hline DTCH & X & \\
\hline
\end{tabular}
\end{table}
4.5.4.3 Downlink mapping

The downlink logical channels can be mapped as described in Table 4.5.4.3-1.

ETSI


--- Page 21  ---


3GPP TS 38.321 version 18.2.0 Release 18
20
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 4.5.4.3-1: Downlink channel mapping.}
\begin{tabular}{|l|l|l|l|}
\hline Transport channel Logical channel & BCH & PCH & DL-SCH \\
\hline BCCH & X & & X \\
\hline PCCH & & X & \\
\hline CCCH & & & X \\
\hline DCCH & & & X \\
\hline DTCH & & & X \\
\hline MCCH & & & X \\
\hline MTCH & & & X \\
\hline
\end{tabular}
\end{table}
4.5.4.4 Sidelink mapping

The sidelink logical channels can be mapped as described in Table 4.5.4.4-1.

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 4.5.4.4-1: Sidelink channel mapping.}
\begin{tabular}{|c|c|c|}
\hline Logical channel & SL-BCH & SL-SCH \\
\hline SBCCH & X & \\
\hline SCCH & & X \\
\hline STCH & & X \\
\hline
\end{tabular}
\end{table}

5 MAC procedures
5.1 Random Access procedure
5.1.1 Random Access procedure initialization

The Random Access procedure described in this clause is initiated by a PDCCH order, by the MAC entity itself, or by RRC for the events in accordance with TS 38.300 [2]. There is only one Random Access procedure ongoing at any point in time in a MAC entity. The Random Access procedure on an SCell or an LTM candidate cell shall only be initiated by a PDCCH order with ra-PreambleIndex different from 0 b 000000 .

NOTE 1: If a new Random Access procedure is triggered while another is already ongoing in the MAC entity, it is up to UE implementation whether to continue with the ongoing procedure or start with the new procedure (e.g. for SI request).

NOTE 2: If there was an ongoing Random Access procedure that is triggered by a PDCCH order while the UE receives another PDCCH order indicating the same Random Access Preamble, PRACH mask index and uplink carrier, the Random Access procedure is considered as the same Random Access procedure as the ongoing one and not initialized again.

When a Random Access procedure is initiated, UE selects a set of Random Access resources as specified in clause 5.1.1b and initialises the following parameters for the Random Access procedure according to the values configured by RRC for the selected set of Random Access resources:
- prach-ConfigurationIndex: the available set of PRACH occasions for the transmission of the Random Access Preamble for Msg1. These are also applicable to the MSGA PRACH if the PRACH occasions are shared between 2 -step and 4 -step RA types;
- prach-ConfigurationPeriodScaling-IAB: the scaling factor defined in TS 38.211 [8] and applicable to [AB-MTs, extending the periodicity of the PRACH occasions baseline configuration indicated by prachConfigurationIndex;
- prach-ConfigurationFrameOffset-IAB: the frame offset defined in TS 38.211 [8] and applicable to IAB-MTs, altering the ROs frame defined in the baseline configuration indicated by prach-ConfigurationIndex;

ETSI


--- Page 22  ---


3GPP TS 38.321 version 18.2.0 Release 18
21
ETSI TS 138321 V18.2.0 (2024-08)
- prach-ConfigurationSOffset-IAB: the subframe/slot offset defined in TS 38.211 [8] and applicable to [AB-MTs, altering the ROs subframe or slot defined in the baseline configuration indicated by prach-ConfigurationIndex;
- msgA-PRACH-ConfigurationIndex: the available set of PRACH occasions for the transmission of the Random Access Preamble for MSGA in 2-step RA type;
- preambleReceivedTargetPower: initial Random Access Preamble power for 4-step RA type;
- msgA-PreambleReceivedTargetPower: initial Random Access Preamble power for 2-step RA type;
- rsrp-ThresholdSSB: an RSRP threshold for the selection of the SSB for 4-step RA type. If the Random Access procedure is initiated for beam failure recovery, rsrp-ThresholdSSB used for the selection of the SSB within candidateBeamRSList refers to rsrp-ThresholdSSB in BeamFailureRecoveryConfig IE;
- rsrp-ThresholdCSI-RS: an RSRP threshold for the selection of CSI-RS for 4-step RA type. If the Random Access procedure is initiated for beam failure recovery, rsrp-ThresholdCSI-RS is equal to rsrp-ThresholdSSB in BeamFailureRecoveryConfig IE;
- msgA-RSRP-ThresholdSSB: an RSRP threshold for the selection of the SSB for 2-step RA type;
- rsrp-ThresholdSSB-SUL: an RSRP threshold for the selection between the NUL carrier and the SUL carrier;
- msgA-RSRP-Threshold: an RSRP threshold for selection between 2-step RA type and 4-step RA type when both 2-step and 4-step RA type Random Access Resources are configured in the UL BWP;
- rsrp-ThresholdMsgl-RepetitionNum2: an RSRP threshold for Msg1 repetition with repetition number 2 (see clause 5.1.1b);
- rsrp-ThresholdMsgl-RepetitionNum4: an RSRP threshold for Msg1 repetition with repetition number 4 (see clause 5.1.1b);
- rsrp-ThresholdMsgl-RepetitionNum8: an RSRP threshold for Msg1 repetition with repetition number 8 (see clause 5.1.1b);
- rsrp-ThresholdMsg3: an RSRP threshold for Msg3 repetition (see clause 5.1.1b);
- FeatureCombination: feature or a combination of features associated with a set of Random Access resources;
- featurePriorities: priorities for features, such as (e)RedCap, Slicing, etc. (see clause 5.1.1d);
- msgA-TransMax: The maximum number of MSGA transmissions when both 4 -step and 2 -step RA type Random Access Resources are configured;
- candidateBeamRSList: a list of reference signals (CSI-RS and/or SSB) identifying the candidate beams for recovery and the associated Random Access parameters;
- recoverySearchSpaceld: the search space identity for monitoring the response of the beam failure recovery request;
- powerRampingStep: the power-ramping factor;
- msgA-PreamblePowerRampingStep: the power ramping factor for MSGA preamble;
- powerRampingStepHighPriority: the power-ramping factor in case of prioritized Random Access procedure;
- scalingFactorBI: a scaling factor for prioritized Random Access procedure;
- ra-PreambleIndex: Random Access Preamble;
- ra-ssb-OccasionMaskIndex: defines PRACH occasion(s) associated with an SSB in which the MAC entity may transmit a Random Access Preamble (see clause 7.4);
- msgA-SSB-SharedRO-MaskIndex: Indicates the subset of 4-step RA type PRACH occasions shared with 2-step RA type PRACH occasions for each SSB. If 2-step RA type PRACH occasions are shared with 4-step RA type PRACH occasions and \( m s g A \)-SSB-SharedRO-MaskIndex is not configured, then all 4-step RA type PRACH occasions are available for 2-step RA type (see clause 7.4);

ETSI


--- Page 23  ---


3GPP TS 38.321 version 18.2.0 Release 18
22
ETSI TS 138321 V18.2.0 (2024-08)
- ssb-SharedRO-MaskIndex: defines PRACH occasions, on which preambles are allocated for a feature or a combination of features, associated with an SSB in which the MAC entity may transmit a Random Access Preamble (see clause 7.4);
- ra-OccasionList: defines PRACH occasion(s) associated with a CSI-RS in which the MAC entity may transmit a Random Access Preamble;
- ra-PreambleStartIndex: the starting index of Random Access Preamble(s) for on-demand SI request;
- startPreambleForThisPartition: the first preamble associated with the set of Random Access Resources applicable to the Random Access procedure;
- preambleTransMax: the maximum number of Random Access Preamble transmission;
- preambleTransMax-Msgl-Repettion: the maximum number of Random Access Preamble transmissions with a given Msgl repetition number before switching to Msgl repetition with the next available higher Msg1 repetition number;
- ssb-perRACH-OccasionAndCB-PreamblesPerSSB: defines the number of SSBs mapped to each PRACH occasion for 4-step RA type and the number of contention-based Random Access Preambles mapped to each SSB;
- msgA-CB-PreamblesPerSSB-PerSharedRO: defines the number of contention-based Random Access Preambles for 2-step RA type mapped to each SSB when the PRACH occasions are shared between 2-step and 4-step RA types;
- msgA-SSB-PerRACH-OccasionAndCB-PreamblesPerSSB: defines the number of SSBs mapped to each PRACH occasion for 2-step RA type and the number of contention-based Random Access Preambles mapped to each SSB;
- numberOfPreamblesPerSSB-ForThisPartition: defines the number of consecutive preambles for a feature or a combination of features mapped to each SSB;
- msgA-PUSCH-ResourceGroupA: defines MSGA PUSCH resources that the UE shall use when performing MSGA transmission using Random Access Preambles group A;
- msgA-PUSCH-ResourceGroupB: defines MSGA PUSCH resources that the UE shall use when performing MSGA transmission using Random Access Preambles group B;
- msgA-PUSCH-Resource-Index: identifies the index of the PUSCH resource used for MSGA in case of contention-free Random Access with 2 -step RA type;
- if groupBconfigured is configured, then Random Access Preambles group B is configured for 4-step RA type.
- Amongst the contention-based Random Access Preambles associated with an SSB (as defined in TS 38.213 [6]), the first numberOfRA-PreamblesGroupA included in groupBconfigured Random Access Preambles belong to Random Access Preambles group A. The remaining Random Access Preambles associated with the SSB belong to Random Access Preambles group B (if configured).
- if groupB-ConfiguredTwoStepRA is configured, then Random Access Preambles group B is configured for 2step RA type.
- Amongst the contention-based Random Access Preambles for 2-step RA type associated with an SSB (as defined in TS 38.213 [6]), the first numberOfRA-PreamblesGroupA included in GroupBConfiguredTwoStepRA Random Access Preambles belong to Random Access Preambles group A. The remaining Random Access Preambles associated with the SSB belong to Random Access Preambles group B (if configured).

NOTE 3: If Random Access Preambles group B is supported by the cell Random Access Preambles group B is included for each SSB.
- if Random Access Preambles group B is configured for 4-step RA type:
- ra-Msg3SizeGroupA: the threshold to determine the groups of Random Access Preambles for 4-step RA type;
- msg3-DeltaPreamble: \( \Delta_{\text {preamble_Mgg }} \) in TS 38.213 [6];

ETSI


--- Page 24  ---


3GPP TS 38.321 version 18.2.0 Release 18
23
ETSI TS 138321 V18.2.0 (2024-08)
- messagePowerOffsetGroupB: the power offset for preamble selection included in groupBconfigured;
- numberOfRA-PreamblesGroupA: defines the number of Random Access Preambles in Random Access Preamble group A for each SSB included in groupBconfigured.
- if Random Access Preambles group B is configured for 2-step RA type:
- msgA-DeltaPreamble: \( \Delta_{M s g} A_{-} P U S C H \) in TS 38.213 [6];
- messagePowerOffsetGroupB: the power offset for preamble selection included in GroupBConfiguredTwoStepRA;
- numberOfRA-PreamblesGroupA: defines the number of Random Access Preambles in Random Access Preamble group A for each SSB included in GroupB-ConfiguredTwoStepRA;
- ra-MsgA-SizeGroupA: the threshold to determine the groups of Random Access Preambles for 2-step RA type.
- the set of Random Access Preambles and/or PRACH occasions for SI request, if any;
- the set of Random Access Preambles and/or PRACH occasions for beam failure recovery request, if any;
- the set of Random Access Preambles and/or PRACH occasions for reconfiguration with sync, if any;
- ra-ResponseWindow: the time window to monitor RA response(s) (SpCell only);
- ra-ContentionResolutionTimer: the Contention Resolution Timer (SpCell only);
- msgB-ResponseWindow: the time window to monitor RA response(s) for 2-step RA type (SpCell only).

In addition, the following information for related Serving Cell is assumed to be available for UEs:
- if Random Access Preambles group B is configured:
- if the Serving Cell for the Random Access procedure is configured with supplementary uplink as specified in TS 38.331 [5], and SUL carrier is selected for performing Random Access Procedure:
- \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) of the SUL carrier as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16].
- else:
- P \( _{\text {CMAX, }, \mathrm{C}} \) of the NUL carrier as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16].

The following UE variables are used for the Random Access procedure:
- PREAMBLE_INDEX;
- PREAMBLE_TRANSMISSION_COUNTER;
- PREAMBLE_POWER_RAMPING_COUNTER;
- PREAMBLE_POWER_RAMPING_STEP;
- PREAMBLE_RECEIVED_TARGET_POWER;
- PREAMBLE_BACKOFF;
- PCMAX;
- SCALING_FACTOR_BI;
- TEMPORARY_C-RNTI;
- RA_TYPE;
- POWER_OFFSET_2STEP_RA;
- MSGA_PREAMBLE_POWER_RAMPING_STEP.

ETSI


--- Page 25  ---


3GPP TS 38.321 version 18.2.0 Release 18
24
ETSI TS 138321 V18.2.0 (2024-08)

When the Random Access procedure is initiated on a Serving Cell or for an LTM candidate cell, the MAC entity shall:
1> flush the Msg3 buffer;
1> flush the MSGA buffer;
\( 1> \) set the PREAMBLE_TRANSMISSION_COUNTER to 1 ;
\( 1> \) if the Random Access procedure is initiated on a Serving Cell; or
1> if the Random Access procedure is initiated by the PDCCH order for an LTM candidate cell and the PDCCH order indicates preamble initial transmission; or

1> if the Random Access procedure is initiated by the PDCCH order for an LTM candidate cell, which is different from the cell to which the UE performed the last Random Access Preamble transmission, and the PDCCH order indicates preamble re-transmission:

2> set the PREAMBLE_POWER_RAMPING_COUNTER to 1 ;
1> set the PREAMBLE_BACKOFF to 0 ms ;
\( 1>\operatorname{set} \) POWER_OFFSET_2STEP_RA to 0 dB ;
\( 1> \) if the carrier to use for the Random Access procedure is explicitly signalled:
\( 2> \) select the signalled carrier for performing Random Access procedure;
\( 2> \) set the PCMAX to \( \mathrm{P}_{\text {CMAX, }, \mathrm{C}} \) of the signalled carrier.
\( 1> \) else if the carrier to use for the Random Access procedure is not explicitly signalled; and
1> if the Serving Cell for the Random Access procedure is configured with supplementary uplink as specified in TS \( 38.331[5] \); and

1> if the RSRP of the downlink pathloss reference is less than rsrp-ThresholdSSB-SUL:
\( 2> \) select the SUL carrier for performing Random Access procedure;
\( 2> \) set the PCMAX to \( \mathrm{P}_{\text {CMAX, }, \mathrm{C}} \) of the SUL carrier.
1> else:
\( 2> \) select the NUL carrier for performing Random Access procedure;
\( 2> \) set the PCMAX to \( \mathrm{P}_{\text {CMAX }, \mathrm{C}, \mathrm{C}} \) of the NUL carrier.
NOTE 4: Void.
1> perform the BWP operation as specified in clause 5.15, except when the Random Access procedure is initiated by the PDCCH order for an LTM candidate cell;

1> select the set of Random Access resources applicable to the current Random Access procedure according to clause 5.1.1b;
\( 1> \) if the Random Access procedure is initiated by PDCCH order and if the \( r a \)-PreambleIndex explicitly provided by PDCCH is not 0 b 000000 ; or

1> if the Random Access procedure was initiated for SI request (as specified in TS 38.331 [5]) and the Random Access Resources for SI request have been explicitly provided by RRC; or
\( 1> \) if the Random Access procedure was initiated for SpCell beam failure recovery (as specified in clause 5.17) and if the contention-free Random Access Resources for beam failure recovery request for 4 -step RA type have been explicitly provided by RRC for the BWP selected for Random Access procedure; or

1> if the Random Access procedure was initiated for reconfiguration with sync and if the contention-free Random Access Resources for 4-step RA type have been explicitly provided in rach-ConfigDedicated for the BWP selected for Random Access procedure; or

ETSI


--- Page 26  ---


3GPP TS 38.321 version 18.2.0 Release 18
25
ETSI TS 138321 V18.2.0 (2024-08)

1> if the Random Access procedure was initiated for LTM cell switch and if the contention-free Random Access Resources have been explicitly provided in LTM Cell Switch Command MAC CE:
\( 2> \) set the RA_TYPE to 4-stepRA.
1> else if the BWP selected for Random Access procedure is configured with both 2-step and 4-step RA type Random Access Resources within the selected set of Random Access resources (as specified in clause 5.1.1b) and the RSRP of the downlink pathloss reference is above msgA-RSRP-Threshold; or
\( 1> \) if the BWP selected for Random Access procedure is only configured with 2 -step RA type Random Access resources within the selected set of Random Access resources according to clause 5.1.1b; or
\( 1> \) if the Random Access procedure was initiated for reconfiguration with sync and if the contention-free Random Access Resources for 2-step RA type have been explicitly provided in rach-ConfigDedicated for the BWP selected for Random Access procedure:
\( 2> \) set the RA_TYPE to 2-stepRA.
1> else:
\( 2> \) set the RA_TYPE to 4-stepRA.
\( 1> \) perform initialization of variables specific to Random Access type as specified in clause 5.1.1a;
\( 1> \) if RA_TYPE is set to 2-stepRA:
\( 2> \) perform the Random Access Resource selection procedure for 2-step RA type (see clause 5.1.2a).
1> else:
\( 2> \) perform the Random Access Resource selection procedure (see clause 5.1.2).
5.1.1a Initialization of variables specific to Random Access type

The MAC entity shall:
\( 1> \) if RA_TYPE is set to 2-stepRA:
\( 2> \) set PREAMBLE_POWER_RAMPING_STEP to msgA-PreamblePowerRampingStep;
\( 2>\operatorname{set} \) SCALING_FACTOR_BI to 1;
2> apply preambleTransMax included in the RACH-ConfigGenericTwoStepRA;
\( 2> \) if the Random Access procedure was initiated for reconfiguration with sync or for SCG activation; and
\( 2> \) if cfra-TwoStep is configured for the selected carrier:
\( 3> \) if msgA-TransMax is configured in the cfra-TwoStep:
4> apply msgA-TransMax configured in the cfra-TwoStep.
\( 2> \) else if msgA-TransMax is included in the RACH-ConfigCommonTwoStepRA:
3> apply msgA-TransMax included in the RACH-ConfigCommonTwoStepRA.
\( 2> \) if the Random Access procedure was initiated for SpCell beam failure recovery (as specified in clause 5.17); and
\( 2> \) if beamFailureRecoveryConfig is configured for the active UL BWP of the selected carrier; and
\( 2> \) if ra-PrioritizationTwoStep is configured in the beamFailureRecoveryConfig:
3> set PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority included in the raPrioritizationTwoStep in beamFailureRecoveryConfig;

3> if scalingFactorBI is configured in the ra-PrioritizationTwoStep in beamFailureRecoveryConfig:

ETSI


--- Page 27  ---


3GPP TS 38.321 version 18.2.0 Release 18
26
ETSI TS 138321 V18.2.0 (2024-08)

4> set SCALING_FACTOR_BI to the scalingFactorBI.
\( 2> \) else if the Random Access procedure was initiated for reconfiguration with sync or for SCG activation; and
\( 2> \) if rach-ConfigDedicated is configured for the selected carrier; and
\( 2> \) if ra-PrioritizationTwoStep is configured in the rach-ConfigDedicated:
3> set PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority included in the raPrioritization TwoStep in rach-ConfigDedicated;

3> if scalingFactorBI is configured in ra-PrioritizationTwoStep in the rach-ConfigDedicated:
\( 4> \) set SCALING_FACTOR_BI to the scalingFactorBI.
2> else if both ra-PrioritizationForSicingTwoStep for a NSAG-ID and ra-
PrioritizationForAccessIdentityTwoStep are configured for the selected carrier; and
\( 2> \) if the MAC entity is provided by upper layers with both this NSAG-ID and Access Identity 1 or 2; and
\( 2> \) if for at least one of these Access [dentities the corresponding bit in the \( r a \)-PrioritizationForAI is set to one:
3> if enableRA-PrioritizationForSlicing is set to true:
4> if powerRampingStepHighPriority is configured in the ra-PrioritizationForSlicingTwoStep for this NSAG-ID:
\( 5> \) set PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.
4> if scalingFactorB/is configured in the ra-PrioritizationForSlicingTwoStep for this NSAG-ID:
\( 5> \) set SCALING_FACTOR_BI to the scalingFactorBI.
3> else if enableRA-PrioritizationForSlicing is set to false:
4> if powerRampingStepHighPriority is configured in the ra-PrioritizationForAccessIdentityTwoStep:
\( 5> \) set PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.
4> if scalingFactorBI is configured in the ra-PrioritizationForAccessIdentityTwoStep:
\( 5> \) set SCALING_FACTOR_BI to the scalingFactorBI.
\( 2> \) else if ra-PrioritizationForSlicingTwoStep for a NSAG-ID is configured for the selected carrier; and
\( 2> \) if the MAC entity is provided by upper layers with this NSAG-ID:
3> if powerRampingStepHighPriority is configured in the ra-PrioritizationForSlicingTwoStep for this NSAG-ID:

4> set PREAMBLE_POWER_RAMPING_STEP to the power_RampingStepHighPriority.
3> if scalingFactorBI is configured in the ra-PrioritizationForSlicingTwoStep for this NSAG-ID:
4> set SCALING_FACTOR_BI to the scalingFactorBI.
\( 2> \) else if ra-PrioritizationForAccessIdentityTwoStep is configured for the selected carrier; and
\( 2> \) if the MAC entity is provided by upper layers with Access Identity 1 or 2; and
\( 2> \) if for at least one of these Access [dentities the corresponding bit in the ra-PrioritizationForAI is set to one:
3> if powerRampingStepHighPriority is configured in the ra-PrioritizationForAccessIdentityTwoStep:
4> set PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.
3> if scalingFactorBI is configured in the ra-PrioritizationForAccessIdentityTwoStep:
4> set SCALING_FACTOR_BI to the scalingFactorBI.

ETSI


--- Page 28  ---


3GPP TS 38.321 version 18.2.0 Release 18
27
ETSI TS 138321 V18.2.0 (2024-08)

\( 2>\operatorname{set} M S G A \_P R E A M B L E \_P O W E R \_R A M P I N G \_S T E P \) to \( P R E A M B L E \_P O W E R \_R A M P I N G \_S T E P \).
\( 1> \) else (i.e. \( R A \_ \)TYPE is set to 4 -stepRA):
\( 2> \) set PREAMBLE_POWER_RAMPING_STEP to powerRampingStep;
\( 2> \) set SCALING_FACTOR_BI to 1;
\( 2> \) set preambleTransMax to preambleTransMax included in the RACH-ConfigGeneric;
\( 2> \) if the Random Access procedure was initiated for SpCell beam failure recovery (as specified in clause 5.17 ); and
\( 2> \) if beamFailureRecoveryConfig is configured for the active UL BWP of the selected carrier:
\( 3> \) start the beamFailureRecoveryTimer, if configured;
\( 3> \) apply the parameters powerRampingStep, preambleReceivedTargetPower, and preambleTransMax configured in the beamFailureRecoveryConfig-
\( 2> \) if the Random Access procedure was initiated for beam failure recovery (as specified in clause 5.17 ); and
\( 2> \) if beamFailureRecoveryConfig is configured for the active UL BWP of the selected carrier; and
\( 2> \) if ra-Prioritization is configured in the beamFailureRecoveryConfig:
\( 3> \) set PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority included in the raPrioritization in beamFailureRecoveryConfig;
\( 3> \) if scalingFactorB/is configured in ra-Prioritization in the beamFailureRecoveryConfig:
\( 4> \) set SCALING_FACTOR_BI to the scalingFactorBI.
\( 2> \) else if the Random Access procedure was initiated for reconfiguration with sync or for SCG activation; and
\( 2> \) if rach-ConfigDedicated is configured for the selected carrier; and
\( 2> \) if \( r a \)-Prioritization is configured in the rach-ConfigDedicated:
\( 3> \) set PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority included in the raPrioritization in rach-ConfigDedicated;
\( 3> \) if scalingFactorBI is configured in \( r a \)-Prioritization in the rach-ConfigDedicated:
\( 4> \) set \( S C A L I N G \) FACTOR_BI to the scalingFactorBI
\( 2> \) else if both ra-PrioritizationForSlicing for a NSAG-ID and ra-PrioritizationForAccessldentity are configured for the selected carrier; and
\( 2> \) if the MAC entity is provided by upper layers with both this NSAG-ID and Access Identity 1 or 2; and
\( 2> \) if for at least one of these Access [dentities the corresponding bit in the ra-PrioritizationForAI is set to one:
\( 3> \) if enableRA-PrioritizationForShicing is set to true:
4 if powerRampingStepHighPriority is configured in the ra-PrioritizationForShicing for this NSAG-ID:
\( 5> \) set PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.
4 if scalingFactorBI is configured in the ra-PrioritizationForSlicing for this NSAG-ID:
\( 5> \) set \( S C A L I N G \) FACTOR_BI to the scalingFactorBI.
\( 3> \) else if enableRA-PrioritizationForShicing is set to false:
\( 4> \) if powerRampingStepHighPriority is configured in the ra-PrioritizationForAccessIdentity:
\( 5> \) set PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.

ETSI


--- Page 29  ---


3GPP TS 38.321 version 18.2.0 Release 18
28
ETSI TS 138321 V18.2.0 (2024-08)

4> if scalingFactorBI is configured in the ra-PrioritizationForAccessIdentity:
\( 5> \) set \( S C A L I N G \) FACTOR_BI to the scalingFactorBI_
\( 2> \) else if ra-PrioritizationForSlicing for a NSAG-ID is configured for the selected carrier; and
\( 2> \) if the MAC entity is provided by upper layers with this NSAG-ID:
\( 3> \) if powerRampingStepHighPriority is configured in the ra-PrioritizationForSlicing for this NSAG-ID:
\( 4> \) set PREAMBLE_POWER_RAMPING_STEP to the power_RampingStepHighPriority.
\( 3> \) if scalingFactorBI is configured in the ra-PrioritizationForShicing for this NSAG-ID:
\( 4> \) set SCALING_FACTOR_BI to the scalingFactorBI.
\( 2> \) else if ra-PrioritizationForAccessldentity is configured for the selected carrier; and
\( 2> \) if the MAC entity is provided by upper layers with Access [dentity 1 or 2 ; and
\( 2> \) if for at least one of these Access [dentities the corresponding bit in the ra-PrioritizationForAI is set to one:
\( 3> \) if powerRampingStepHighPriority is configured in the ra-PrioritizationForAccessldentity:
\( 4> \) set PREAMBLE_POWER_RAMPING_STEP to the powerRampingStepHighPriority.
\( 3> \) if scalingFactorBI is configured in the ra-PrioritizationForAccessIdentity:
\( 4> \) set \( S C A L I N G \) FACTOR_BI to the scalingFactorBI.
\( 2> \) if RA_TYPE is switched from 2-stepRA to 4-stepRA during this Random Access procedure:
\( 3> \) set POWER_OFFSET_2STEP_RA to (PREAMBLE_POWER_RAMPING_COUNTER -1\( ) \times \)
(MSGA_PREAMBLE_POWER_RAMPING_STEP-PREAMBLE_POWER_RAMPING_STEP).
NOTE: If enableRA-PrioritizationForShicing is not configured in BWP-UplinkCommon and if both the provided NSAG-ID and the provided Access Identity whose corresponding bit in the ra-PrioritizationForAI is set to one are configured with ra-Prioritization either in RACH-ConfigCommon or RACHConfigCommonTwoStepRA, it is up to UE implementation how to determine the values of PREAMBLE_POWER_RAMPING_STEP and SCALING_FACTOR_BI.
5.1.1b Selection of the set of Random Access resources for the Random Access procedure

The MAC entity shall:
\( 1> \) if the BWP selected for Random Access procedure is configured with both set(s) of Random Access resources with msg3-Repetitions set to true and set(s) of Random Access resources without msg3-Repetitions set to true and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg3; or
\( 1> \) if the BWP selected for Random Access procedure is only configured with the set(s) of Random Access resources with msg3-Repetitions set to true:
\( 2> \) assume Msg 3 repetition is applicable for the current Random Access procedure.
\( 1> \) else:
\( 2> \) assume Msg3 repetition is not applicable for the current Random Access procedure.
\( 1> \) if contention-free Random Access Resources have been provided for this Random Access procedure in the LTM Cell Switch Command MAC CE and a non-zero Msgl repetition number is indicated in the LTM Cell Switch Command MAC CE:
\( 2> \) assume that Msgl repetition is applicable and that the Msgl repetition number applicable for the current Random Access procedure is the Msgl repetition number indicated in the LTM Cell Switch Command MAC CE.

ETSI


--- Page 30  ---


3GPP TS 38.321 version 18.2.0 Release 18
29
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) else if contention-free Random Access Resources have been provided for this Random Access procedure and a Msgl repetition number is indicated in rach-ConfigDedicated:
\( 2> \) assume Msgl repetition is applicable and Msgl repetition number applicable for the current Random Access procedure is the Msg1 repetition number indicated in rach-ConfigDedicated.

1> else if contention free Random Access Resources have not been provided for this Random Access procedure and the BWP selected for the Random Access procedure is configured with set(s) of Random Access resources with msg 1-Repetitions set to true and set(s) of Random Access resources without msgl-Repetitions set to true:
\( 2> \) if the BWP selected for the Random Access procedure is configured with set(s) of Random Access resources associated with Msgl repetition number 8 and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum8:

3> assume Msg1 repetition is applicable and Msg1 repetition number applicable for the current Random Access procedure includes 8.
\( 2> \) if the BWP selected for the Random Access procedure is configured with set(s) of Random Access resources associated with Msgl repetition number 4 and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsgl-RepetitionNum4:

3> assume Msg1 repetition is applicable and Msg1 repetition number applicable for the current Random Access procedure includes 4.
\( 2> \) if the BWP selected for the Random Access procedure is configured with set(s) of Random Access resources associated with Msgl repetition number 2 and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum2:

3> assume Msg1 repetition is applicable and Msg1 repetition number applicable for the current Random Access procedure includes 2.
\( 2> \) else if the RSRP of the downlink pathloss reference is not less than any configured rsrp-ThresholdMsglRepetitionNumX:
\( 3> \) assume Msgl repetition is not applicable for the current Random Access procedure.
\( 1> \) else if the BWP selected for Random Access procedure is configured only with Random Access resources with msg1-Repetitions set to true:
\( 2> \) assume Msgl repetition is applicable for the current Random Access procedure;
\( 2> \) if at least one of rsrp-ThresholdMsgl-RepetitionNumX is configured:
\( 3> \) if rsrp-ThresholdMsgl-RepetitionNum 8 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg/-RepetitionNum8;

4> assume Msg1 repetition number applicable for the current Random Access procedure includes 8 .
\( 3> \) if rsrp-ThresholdMsgl-RepetitionNum 4 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsgl-RepetitionNum4:

4> assume Msg1 repetition number applicable for the current Random Access procedure includes 4.
\( 3> \) if rsrp-ThresholdMsgl-RepetitionNum 2 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum2:

4> assume Msg1 repetition number applicable for the current Random Access procedure includes 2.
\( 3> \) else if the RSRP of the downlink pathloss reference is not less than any configured rsrp-ThresholdMsglRepetitionNumX:
\( 4> \) assume Msgl repetition number applicable for the current Random Access procedure is the lowest Msgl repetition number configured for this BWP.
\( 2> \) else (none of rsrp-ThresholdMsgl-RepetitionNumX is configured):

ETSI


--- Page 31  ---


3GPP TS 38.321 version 18.2.0 Release 18
30
ETSI TS 138321 V18.2.0 (2024-08)

3> assume Msg1 repetition number applicable for the current Random Access procedure is the Msg1 repetition number that configured for this BWP.

NOTE 1: Void.
1> if neither contention-free Random Access Resources nor Random Access Resources for SI request have been provided for this Random Access procedure and one or more of the features including (e)RedCap and/or Slicing and/or SDT and/or MSG3 repetition and/or MSG1 repetition is applicable for this Random Access procedure:

NOTE 2: The applicability of SDT is determined by MAC entity according to clause 5.27. The applicability of NSAG-ID is determined by upper layers when the Random Access procedure is initiated. The applicability of (e)RedCap is also determined by upper layers when Random Access procedure is initiated and it is applicable to the Random Access procedures initiated by PDCCH orders and any Random Access procedure initiated by the MAC entity.

NOTE 3: SDT is not applicable for the Random Access procedure initiated by upper layers for MT-SDT.
\( 2> \) if none of the sets of Random Access resources are available for any feature applicable to the current Random Access procedure (as specified in clause 5.1.1c):

3> select the set(s) of Random Access resources that are not associated with any feature indication (as specified in clause 5.1.1c) for this Random Access procedure.
\( 2> \) else if there is one set of Random Access resources available which can be used for indicating all features triggering this Random Access procedure:

3> select this set of Random Access resources for this Random Access procedure.
2> else if there are more than one set of Random Access resources available which can be used for indicating all features triggering this Random Access procedure and Msg1 repetition is applicable for this Random Access procedure:

3> select the set of Random Access resources that associated with highest repetition number among the sets of Random Access resources.
\( 2> \) else (i.e there are one or more sets of Random Access resources available that are configured with indication(s) for a subset of all features triggering this Random Access procedure):

3> select a set of Random Access resources from the available set(s) of Random Access resources based on the priority order indicated by upper layers as specified in clause 5.1.1d for this Random Access Procedure.

1> else if contention-free Random Access Resources have been provided for this Random Access procedure in the LTM Cell Switch Command MAC CE and a non-zero Msg1 repetition number is indicated in the LTM Cell Switch Command MAC CE, and RedCap is applicable for the current Random Access procedure:
\( 2> \) select the set of Random Access resources that is only configured with RedCap indication and Msg1 repetition indication and associated with the indicated Msgl repetition number for this Random Access procedure.

1> else if contention-free Random Access Resources with Msg1 repetition have been provided for this Random Access procedure and Msgl repetition number is indicated in rach-ConfigDedicated, and RedCap is applicable for the current Random Access procedure:

2> select the set of Random Access resources that is only configured with RedCap indication and Msg1 repetition indication and associated with the indicated Msgl repetition number for this Random Access procedure.

1> else if contention-free Random Access Resources have been provided for this Random Access procedure in LTM Cell Switch Command MAC CE and a non-zero Msgl repetition number is indicated in LTM Cell Switch Command MAC CE, and eRedCap is applicable for the current Random Access procedure:
\( 2> \) select the set of Random Access resources that is only configured with eRedCap indication and Msg1 repetition indication and associated with the indicated Msgl repetition number for this Random Access procedure.

ETSI


--- Page 32  ---


3GPP TS 38.321 version 18.2.0 Release 18
31
ETSI TS 138321 V18.2.0 (2024-08)

1> else if contention-free Random Access Resources with Msg1 repetition have been provided for this Random Access procedure and Msgl repetition number is indicated in rach-ConfigDedicated, and eRedCap is applicable for the current Random Access procedure:
\( 2> \) select the set of Random Access resources that is only configured with eRedCap indication and Msg1 repetition indication and associated with the indicated Msgl repetition number for this Random Access procedure.

1> else if contention-free Random Access Resources have been provided for this Random Access procedure and RedCap is applicable for the current Random Access procedure and there is one set of Random Access resources available that is only configured with RedCap indication; or

1> if contention-free Random Access Resources have been provided for this Random Access procedure and eRedCap is applicable for the current Random Access procedure and there is one set of Random Access resources available that is only configured with eRedCap indication; or
\( 1> \) if contention-free Random Access Resources have been provided for this Random Access procedure and eRedCap is applicable for the current Random Access procedure and there is no set of Random Access resources available that is only configured with eRedCap indication and there is one set of Random Access resources available that is only configured with RedCap indication:
\( 2> \) select this set of Random Access resources for this Random Access procedure.
\( 1> \) else:
\( 2> \) if the Random Access procedure is initiated by PDCCH order with DCI PRACH association indicator field set to 1 and SSB-MTC-AdditionalPCI is configured by upper layers, as specified in clause 7.3.1.2.1 of TS 38.212 [9]:
\( 3> \) select the set of Random Access resources corresponding to the additionalPCI associated with active TCI states.
\( 2> \) else if the Random Access procedure is initiated by PDCCH order for an LTM candidate cell:
3> select the set of Random Access resources corresponding to the field Cell indicator in PDCCH order.
\( 2> \) else if contention-free Random Access Resources have been provided for this Random Access procedure in the LTM Cell Switch Command MAC CE, and a non-zero Msg1 repetition number is indicated in the LTM Cell Switch Command MAC CE:

3> select the set of Random Access resources that is only configured with Msgl repetition indication and associated with the indicated Msg1 repetition number for this Random Access procedure.
\( 2> \) else if contention-free Random Access Resources with Msgl repetition have been provided for this Random Access procedure, and Msgl repetition number is indicated in rach-ConfigDedicated:

3> select the set of Random Access resources that is only configured with Msg1 repetition indication and associated with the indicated Msg1 repetition number for this Random Access procedure.
\( 2> \) else if the Random Access procedure was initiated for SI request and Random Access Resources associated with Msgl repetition for SI request and Msgl repetition number have been provided for this Random Access procedure:

3> if the BWP selected for Random Access procedure is indicated by initialUplinkBWP-RedCap:
4> if RedCap is applicable for the current Random Access procedure:
\( 5> \) select the set of Random Access Resources that is only configured with RedCap indication and Msgl repetition indication and associated with the indicated Msgl repetition number for this Random Access procedure.

4> else if eRedCap is applicable for the current Random Access procedure:
\( 5> \) if there is one set of Random Access resources available that is only configured with RedCap indication and Msg1 repetition indication and associated with the indicated Msg1 repetition number:

ETSI


--- Page 33  ---


3GPP TS 38.321 version 18.2.0 Release 18
32
ETSI TS 138321 V18.2.0 (2024-08)

\( 6> \) select this set of Random Access resources for this Random Access procedure. \( 5> \) else:
\( 6> \) select the set of Random Access Resources that is only configured with eRedCap indication and Msgl repetition indication and associated with the indicated Msgl repetition number.

3> else:
4> select the set of Random Access resources that is only configured with Msgl repetition indication and associated with the indicated Msgl repetition number for this Random Access procedure.
\( 2> \) else:
3> select the set of Random Access resources that are not associated with any feature indication (as specified in clause 5.1.1c) for the current Random Access procedure.
5.1.1c Availability of the set of Random Access resources

The MAC entity shall for each set of configured Random Access resources:
1> if eRedCap is set to true for a set of Random Access resources:
\( 2> \) consider the set of Random Access resources as not available for a Random Access procedure for which eRedCap is not applicable.

1> if redCap is set to true for a set of Random Access resources:
\( 2> \) consider the set of Random Access resources as not available for a Random Access procedure for which RedCap is not applicable.
\( 1> \) if smallData is set to true for a set of Random Access resources:
\( 2> \) consider the set of Random Access resources as not available for the Random Access procedure which is not triggered for RA-SDT by MO-SDT as specified in TS 38.331 [5].

1> if NSAG-List is configured for a set of Random Access resources:
\( 2> \) consider the set of Random Access resources as not available for the Random Access procedure unless it is triggered for any one of the NSAG-ID(s) in the NSAG-List.
\( 1> \) if msg3-Repetitions is set to true for a set of Random Access resources:
\( 2> \) consider the set of Random Access resources as not available for the Random Access procedure if Msg3 repetition is not applicable.

1> if msgl-Repetitions is set to true for a set of Random Access resources:
\( 2> \) if Msg1 repetition is not applicable to the current Random Access procedure; or
\( 2> \) if the set of Random Access resources is not associated with any of the Msgl repetition number that is applicable to the current Random Access procedure:
\( 3> \) consider the set of Random Access resources as not available for the Random Access procedure.
\( 1> \) if a set of Random Access resources is not configured with FeatureCombination:
\( 2> \) consider the set of Random Access resources to not associated with any feature.
5.1.1d Selection of the set of Random Access resources based on feature prioritization

The MAC entity shall:

ETSI


--- Page 34  ---


3GPP TS 38.321 version 18.2.0 Release 18
33
ETSI TS 138321 V18.2.0 (2024-08)

1> among the available sets of Random Access resources for this Random Access procedure (as specified in clause 5.1.1c), identify those configured with a feature which has the highest priority assigned in featurePriorities among all the features applicable to this Random Access procedure as specified in TS 38.331 [5].
\( 1> \) if a single set of Random Access resources is identified:
\( 2> \) select this set of Random Access resources.
\( 1> \) else if more than one set of Random Access resources is identified:
\( 2> \) if all the identified sets of Random Access resources are configured with Msgl repetition indication and the same feature Combination:
\( 3> \) select the set of Random Access resources that associated with highest Msgl repetition number among the identified sets of Random Access resources.
\( 2> \) else:
3> repeat the procedure taking as an input the identified sets of Random Access resources and the feature applicable to the current Random Access procedure with the highest priority assigned in featurePriorities among all the features applicable to this Random Access procedure, except the features considered already.
\( 1> \) else (i.e no set of Random Access resources is identified):
\( 2> \) repeat the procedure taking as an input the previous identified available sets of Random Access resources and the feature applicable to the current Random Access procedure with the highest priority assigned in featurePriorities among all the features applicable to this Random Access procedure, except the features considered already.
5.1.1e Selection of Msg1 repetition for SI request

The MAC entity shall:
\( 1> \) if si-RequestResourcesRepetitionNum 8 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsgl-RepetitionNum8:
\( 2> \) criteria to apply Msgl repetition for SI request is considered met and Msgl repetition number applicable is 8 .
\( 1> \) else if si-RequestResourcesRepetitionNum 4 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum4:
\( 2> \) criteria to apply Msgl repetition for SI request is considered met and Msgl repetition number applicable is 4 .
\( 1> \) else si-RequestResourcesRepetitionNum 2 is configured and the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg1-RepetitionNum2:
\( 2> \) criteria to apply Msgl repetition for SI request is considered met and Msgl repetition number applicable is 2.
5.1.2 Random Access Resource selection

If the selected \( R A \_ \)TYPE is set to 4 -stepRA, the MAC entity shall:
\( 1> \) if the Random Access procedure was initiated for SpCell beam failure recovery (as specified in clause 5.17 ); and
\( 1> \) if the beamFailureRecoveryTimer (in clause 5.17) is either running or not configured; and
\( 1> \) if the contention-free Random Access Resources for beam failure recovery request associated with any of the SSBs and/or CSI-RSs have been explicitly provided by RRC; and
\( 1> \) if at least one of the SSBs with SS-RSRP above rsrp-ThresholdSSB amongst the SSBs in candidateBeamRSList or the CSI-RSs with CSI-RSRP above rsrp-ThresholdCSI-RS amongst the CSI-RSs in candidateBeamRSList is available:

ETSI


--- Page 35  ---


3GPP TS 38.321 version 18.2.0 Release 18
34
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) select an SSB with SS-RSRP above rsrp-ThresholdSSB amongst the SSBs in candidateBeamRSList or a CSIRS with CSI-RSRP above rsrp-ThresholdCSI-RS amongst the CSI-RSs in candidateBeamRSList;
\( 2> \) if CSI-RS is selected, and there is no ra-PreambleIndex associated with the selected CSI-RS:
3> set the PREAMBLE_INDEX to a ra-PreambleIndex corresponding to the SSB in candidateBeamRSList which is quasi-colocated with the selected CSI-RS as specified in TS 38.214 [7].
\( 2> \) else:
3> set the PREAMBLE_INDEX to a ra-Preamblelndex corresponding to the selected SSB or CSI-RS from the set of Random Access Preambles for beam failure recovery request.

1> else if the ra-PreambleIndex has been explicitly provided by PDCCH; and
1> if the ra-PreambleIndex is not 0 b 000000 :
\( 2> \) set the PREAMBLE_INDEX to the signalled ra-PreambleIndex;
\( 2> \) select the SSB signalled by PDCCH.
1> else if contention-free Random Access Resources have been explicitly provided by an LTM Cell Switch Command MAC CE and the SS-RSRP of the SSB signalled by the LTM Cell Switch Command MAC CE is above rsrp-ThresholdSSB:
\( 2> \) set the PREAMBLE INDEX to the Random Access Preamble index signalled by the LTM Cell Switch Command MAC CE;
\( 2> \) select the SSB signalled by the LTM Cell Switch Command MAC CE.
1> else if contention-free Random Access Resources have not been explicitly provided by an LTM Cell Switch Command MAC CE, the Random Access procedure was not initiated for recovery using an LTM candidate configuration as specified in TS 38.331 [5] clause 5.3.7.3, contention-free Random Access Resources associated with SSBs have been explicitly provided in rach-ConfigDedicated and at least one SSB with SS-RSRP above rsrp-ThresholdSSB amongst the associated SSBs is available:
\( 2> \) select an SSB with SS-RSRP above rsrp-ThresholdSSB amongst the associated SSBs;
\( 2> \) set the PREAMBLE_INDEX to a ra-Preamblelndex corresponding to the selected SSB.
1> else if contention-free Random Access Resources have not been explicitly provided by an LTM Cell Switch Command MAC CE, the Random Access procedure was not initiated for recovery using an LTM candidate configuration as specified in TS 38.331 [5] clause 5.3.7.3, contention-free Random Access Resources associated with CSI-RSs have been explicitly provided in rach-ConfigDedicated and at least one CSI-RS with CSI-RSRP above rsrp-ThresholdCSI-RS amongst the associated CSI-RSs is available:
\( 2> \) select a CSI-RS with CSI-RSRP above rsrp-ThresholdCSI-RS amongst the associated CSI-RSs;
\( 2> \) set the PREAMBLE_INDEX to a ra-PreambleIndex corresponding to the selected CSI-RS.
1> else if the Random Access procedure was initiated for SI request (as specified in TS 38.331 [5]); and
\( 1> \) if the Random Access Resources for SI request have been explicitly provided by RRC:
2 if at least one of the SSBs with SS-RSRP above rsrp-ThresholdSSB is available:
3> select an SSB with SS-RSRP above rsrp-ThresholdSSB.
\( 2> \) else:
\( 3> \) select any SSB.
2> select a Random Access Preamble corresponding to the selected SSB, from the Random Access Preamble(s) determined according to ra-PreambleStartIndex as specified in TS 38.331 [5];
\( 2> \) set the PREAMBLE_INDEX to selected Random Access Preamble.

ETSI


--- Page 36  ---


3GPP TS 38.321 version 18.2.0 Release 18
35
ETSI TS 138321 V18.2.0 (2024-08)

1> else (i.e. for the contention-based Random Access preamble selection):
\( 2> \) if at least one of the SSBs with SS-RSRP above rsrp-ThresholdSSB is available:
\( 3> \) select an SSB with SS-RSRP above rsrp-ThresholdSSB.
\( 2> \) else:
\( 3> \) select any SSB.
\( 2> \) if the RA_TYPE is switched from 2-stepRA to 4-stepRA:
\( 3> \) if a Random Access Preambles group was selected during the current Random Access procedure:
\( 4> \) select the same group of Random Access Preambles as was selected for the 2 -step RA type.
\( 3> \) else:
4- if Random Access Preambles group B is configured; and
4 if the transport block size of the MSGA payload configured in the rach-ConfigDedicated corresponds to the transport block size of the MSGA payload associated with Random Access Preambles group B:
\( 5> \) select the Random Access Preambles group B.
\( 4> \) else:
\( 5> \) select the Random Access Preambles group A.
\( 2> \) else if Msg3 buffer is empty:
\( 3> \) if Random Access Preambles group \( B \) is configured:
4 if the potential Msg3 size (UL data available for transmission plus MAC subheader(s) and, where required, MAC CEs) is greater than ra-Msg3SizeGroupA and the pathloss is less than PCMAX (of the Serving Cell performing the Random Access Procedure) - preambleReceivedTargetPower - msg3DeltaPreamble - messagePowerOffsetGroupB; or
\( 4- \) if the Random Access procedure was initiated for the CCCH logical channel and the CCCH SDU size plus MAC subheader is greater than ra-Msg3SizeGroupA:
\( 5> \) select the Random Access Preambles group B.
\( 4> \) else:
\( 5> \) select the Random Access Preambles group A.
\( 3> \) else:
\( 4> \) select the Random Access Preambles group A.
\( 2> \) else (i.e. Msg3 is being retransmitted):
3> select the same group of Random Access Preambles as was used for the Random Access Preamble transmission attempt corresponding to the first transmission of Msg3.
\( 2> \) select a Random Access Preamble randomly with equal probability from the Random Access Preambles associated with the selected SSB and the selected Random Access Preambles group;
\( 2> \) set the PREAMBLE_INDEX to the selected Random Access Preamble.
\( 1> \) if the Random Access procedure was initiated for SI request (as specified in TS 38.331 [5]); and
\( 1> \) if ra-AssociationPeriodIndex and si-RequestPeriod are configured:
\( 2> \) determine the next available PRACH occasion from the PRACH occasions corresponding to the selected SSB in the association period given by ra-AssociationPeriodIndex in the si-RequestPeriod permitted by the restrictions given by the \( r a \)-ssb-OccasionMaskIndex if configured (the MAC entity shall select a PRACH

ETSI


--- Page 37  ---


3GPP TS 38.321 version 18.2.0 Release 18
36
ETSI TS 138321 V18.2.0 (2024-08)

occasion randomly with equal probability amongst the consecutive PRACH occasions according to clause 8.1 of TS 38.213 [6] corresponding to the selected SSB).
\( 1> \) else if an SSB is selected above:
\( 2> \) if the set of Random Access resources associated with Msgl repetition is selected for this Random Access procedure:
\( 3> \) determine the next available set of PRACH occasions (as specified in TS 38.213 [6]) for the Msg1 repetition number applicable for this Random Access procedure corresponding to the selected SSB (the MAC entity shall select a set of PRACH occasions randomly with equal probability amongst sets of PRACH occasions according to clause 8.1 of TS 38.213 [6] regardless the FR2 UL gap, corresponding to the selected SSB and selected Msgl repetition number for this Random Access procedure; the MAC entity may take into account the possible occurrence of measurement gaps and MUSIM gaps when determining the next available set of PRACH occasions corresponding to the selected SSB).
\( 2> \) else:
\( 3> \) determine the next available PRACH occasion from the PRACH occasions corresponding to the selected SSB permitted by the restrictions given by the ra-ssb-OccasionMaskIndex if configured, or ssb-SharedRO-MaskIndex if configured, or indicated by PDCCH, or indicated by the LTM Cell Switch Command MAC CE (the MAC entity shall select a PRACH occasion randomly with equal probability amongst the consecutive PRACH occasions according to clause 8.1 of TS 38.213 [6] regardless the FR2 UL gap, corresponding to the selected SSB; the MAC entity may take into account the possible occurrence of measurement gaps and MUSIM gaps when determining the next available PRACH occasion corresponding to the selected SSB).

1> else if a CSI-RS is selected above:
\( 2> \) if there is no contention-free Random Access Resource associated with the selected CSI-RS:
\( 3> \) determine the next available PRACH occasion from the PRACH occasions, permitted by the restrictions given by the ra-ssb-OccasionMaskIndex if configured, corresponding to the SSB in candidateBeamRSList which is quasi-colocated with the selected CSI-RS as specified in TS 38.214 [7] (the MAC entity shall select a PRACH occasion randomly with equal probability amongst the consecutive PRACH occasions according to clause 8.1 of TS 38.213 [6] regardless the FR2 UL gap, corresponding to the SSB which is quasi-colocated with the selected CSI-RS; the MAC entity may take into account the possible occurrence of measurement gaps and MUSIM gaps when determining the next available PRACH occasion corresponding to the SSB which is quasi-colocated with the selected CSI-RS).
\( 2> \) else:
\( 3> \) determine the next available PRACH occasion from the PRACH occasions in ra-OccasionList corresponding to the selected CSI-RS (the MAC entity shall select a PRACH occasion randomly with equal probability amongst the PRACH occasions occurring simultaneously but on different subcarriers regardless the FR2 UL gap, corresponding to the selected CSI-RS; the MAC entity may take into account the possible occurrence of measurement gaps and MUSIM gaps when determining the next available PRACH occasion corresponding to the selected CSI-RS).
\( 1> \) perform the Random Access Preamble transmission procedure (see clause 5.1.3).
NOTE 1: When the UE determines if there is an SSB with SS-RSRP above rsrp-ThresholdSSB or a CSI-RS with CSI-RSRP above rsrp-ThresholdCSI-RS, the UE uses the latest unfiltered L1-RSRP measurement.

NOTE 2: Void.
NOTE 3: If an (e)RedCap UE in RRC_IDLE or RRC_INACTIVE mode is configured with a BWP indicated by initial DownlinkB WP-RedCap which is not associated with any SSB, SS-RSRP measurement is performed based on the SSB associated with the BWP indicated by initia/DownlinkBWP. If an (e)RedCap UE in RRC_INACTIVE mode is configured with SDT and with a BWP indicated by initialDownlinkBWPRedCap which is associated with NCD-SSB, SS-RSRP measurement can also be performed based on this NCD-SSB during SDT.

ETSI


--- Page 38  ---


3GPP TS 38.321 version 18.2.0 Release 18
37
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 4: If an (e)RedCap UE in RRC_IDLE or RRC_INACTIVE mode is configured with a BWP indicated by initialDownlinkBWP-RedCap which is not associated with any SSB for RACH, it is up to the UE implementation to perform a new RSRP measurements before Msg1/MsgA retransmission.
5.1.2a Random Access Resource selection for 2-step RA type

If the selected \( R A \_ \)TYPE is set to 2 -stepRA, the MAC entity shall:
\( 1> \) if the contention-free 2 -step RA type Resources associated with SSBs have been explicitly provided in rachConfigDedicated and at least one SSB with SS-RSRP above msgA-RSRP-ThresholdSSB amongst the associated SSBs is available:
\( 2> \) select an SSB with SS-RSRP above \( m s g A-R S R P \)-ThresholdSSB amongst the associated SSBs;
\( 2> \) set the PREAMBLE_INDEX to a ra-PreambleIndex corresponding to the selected SSB.
\( 1> \) else (i.e. for the contention-based Random Access Preamble selection):
\( 2> \) if at least one of the SSBs with SS-RSRP above msgA-RSRP-ThresholdSSB is available:
\( 3> \) select an SSB with SS-RSRP above msgA-RSRP-ThresholdSSB.
\( 2> \) else:
\( 3> \) select any SSB.
\( 2> \) if contention-free Random Access Resources for 2 -step RA type have not been configured and if Random Access Preambles group has not yet been selected during the current Random Access procedure:
\( 3> \) if Random Access Preambles group B for 2-step RA type is configured:
4 - if the potential MSGA payload size (UL data available for transmission plus MAC subheader and, where required, MAC CEs) is greater than the ra-MsgA-SizeGroupA and the pathloss is less than PCMAX (of the Serving Cell performing the Random Access Procedure) - msgAPreambleReceivedTargetPower - msgA-DeltaPreamble - messagePowerOffsetGroupB; or

4> if the Random Access procedure was initiated for the CCCH logical channel and the CCCH SDU size plus MAC subheader is greater than ra-MsgA-SizeGroupA:
\( 5> \) select the Random Access Preambles group B.
\( 4> \) else:
\( 5> \) select the Random Access Preambles group A.
\( 3> \) else:
\( 4> \) select the Random Access Preambles group A.
\( 2> \) else if contention-free Random Access Resources for 2 -step RA type have been configured and if Random Access Preambles group has not yet been selected during the current Random Access procedure:
\( 3> \) if Random Access Preambles group B for 2-step RA type is configured; and
\( 3> \) if the transport block size of the MSGA payload configured in the rach-ConfigDedicated corresponds to the transport block size of the MSGA payload associated with Random Access Preambles group B:
\( 4> \) select the Random Access Preambles group B.
\( 3> \) else:
\( 4> \) select the Random Access Preambles group A.
\( 2> \) else (i.e. Random Access preambles group has been selected during the current Random Access procedure):
\( 3> \) select the same group of Random Access Preambles as was used for the Random Access Preamble transmission attempt corresponding to the earlier transmission of MSGA.

ETSI


--- Page 39  ---


3GPP TS 38.321 version 18.2.0 Release 18
38
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) select a Random Access Preamble randomly with equal probability from the 2 -step RA type Random Access Preambles associated with the selected SSB and the selected Random Access Preambles group;
\( 2> \) set the PREAMBLE_INDEX to the selected Random Access Preamble.
\( 1> \) determine the next available PRACH occasion from the PRACH occasions corresponding to the selected SSB permitted by the restrictions given by the msgA-SSB-SharedRO-MaskIndex if configured, or ra-ssbOccasionMaskIndex if configured, or ssb-SharedRO-MaskIndex if configured (the MAC entity shall select a PRACH occasion randomly with equal probability among the consecutive PRACH occasions allocated for 2-step RA type according to clause 8.1 of TS 38.213 [6] regardless the FR2 UL gap, corresponding to the selected SSB; the MAC entity may take into account the possible occurrence of measurement gaps and MUSIM gaps when determining the next available PRACH occasion corresponding to the selected SSB);
\( 1> \) if the Random Access Preamble was not selected by the MAC entity among the contention-based Random Access Preamble(s):
\( 2> \) select a PUSCH occasion from the PUSCH occasions configured in msgA-CFRA-PUSCH corresponding to the PRACH slot of the selected PRACH occasion, according to msgA-PUSCH-Resource-Index corresponding to the selected SSB;
\( 2> \) determine the UL grant and the associated HARQ information for the MSGA payload in the selected PUSCH occasion;
\( 2> \) deliver the UL grant and the associated HARQ information to the HARQ entity.
\( 1> \) else:
\( 2> \) select a PUSCH occasion corresponding to the selected preamble and PRACH occasion according to clause 8.1A of TS 38.213 [6];
\( 2> \) determine the UL grant for the MSGA payload according to the PUSCH configuration associated with the selected Random Access Preambles group and determine the associated HARQ information;
\( 2> \) if the selected preamble and PRACH occasion is mapped to a valid PUSCH occasion as specified in clause 8.1A of TS 38.213 [6]:
\( 3> \) deliver the UL grant and the associated HARQ information to the HARQ entity.
1> perform the MSGA transmission procedure (see clause 5.1.3a).
NOTE 1: To determine if there is an SSB with SS-RSRP above msgA-RSRP-ThresholdSSB, the UE uses the latest unfiltered \( L l-R S R P \) measurement.

NOTE 2: If an (e)RedCap UE in RRC_IDLE or RRC_INACTIVE mode is configured with a BWP indicated by initial DownlinkB WP-RedCap which is not associated with any SSB, SS-RSRP measurement is performed based on the SSB associated with the BWP indicated by mittalDownlinkBWP. If an (e)RedCap UE in RRC_INACTIVE mode is configured with SDT and with a BWP indicated by mitial DownlinkBWPRedCap which is associated with NCD-SSB, SS-RSRP measurement can also be performed based on this NCD-SSB during SDT.

NOTE 3: If an (e)RedCap UE in RRC_IDLE or RRC_INACTIVE mode is configured with a BWP indicated by initialDownlinkBWP-RedCap which is not associated with any SSB for RACH, it is up to the UE implementation to perform a new RSRP measurements before Msg1/MsgA retransmission.
5.1.3 Random Access Preamble transmission

The MAC entity shall, for each Random Access Preamble:
1> if PREAMBLE_TRANSMISSION_COUNTER is greater than one; and
\( 1> \) if the notification of suspending power ramping counter has not been received from lower layers; and
\( 1> \) if LBT failure indication was not received from lower layers for the last Random Access Preamble transmission; and

ETSI


--- Page 40  ---


3GPP TS 38.321 version 18.2.0 Release 18
39
ETSI TS 138321 V18.2.0 (2024-08)

1> if SSB or CSI-RS selected is not changed from the selection in the last Random Access Preamble transmission; and
\( 1> \) if the Random Access procedure is not initiated by the PDCCH order for an LTM candidate cell:
2 increment PREAMBLE_POWER_RAMPING_COUNTER by 1 .
1> if the Random Access procedure is initiated by the PDCCH order for an LTM candidate cell as preamble retransmission; and

1> if the PDCCH order indicates the same LTM candidate cell and the same SSB as the last Random Access Preamble transmission:
\( 2> \) increment PREAMBLE_POWER_RAMPING_COUNTER by 1 .
1> select the value of DELTA_PREAMBLE according to clause 7.3;
1> set PREAMBLE_RECEIVED_TARGET_POWER to preambleReceivedTargetPower + DELTA_PREAMBLE + (PREAMBLE_POWER_RAMPING_COUNTER -1 ) × PREAMBLE_POWER_RAMPING_STEP + POWER_OFFSET_2STEP_RA;

1> except for contention-free Random Access Preamble for beam failure recovery request and contention-free Random Access Preamble triggered by a PDCCH order for an LTM candidate cell, compute the RA-RNTI associated with the PRACH occasion in which the Random Access Preamble is transmitted;
\( 1> \) instruct the physical layer to transmit the Random Access Preamble using the selected PRACH occasion, corresponding RA-RNTI (if available), PREAMBLE_INDEX, and PREAMBLE_RECEIVED_TARGET_POWER.

1> if the Random Access Procedure is triggered by a PDCCH order for an LTM candidate cell:
\( 2> \) consider this Random Access procedure completed.
1> if LBT failure indication is received from lower layers for this Random Access Preamble transmission:
\( 2> \) if \( l b t \)-FailureRecoveryConfig is configured:
3> perform the Random Access Resource selection procedure (see clause 5.1.2).
\( 2> \) else:
3> increment PREAMBLE_TRANSMISSION_COUNTER by 1 ;
3> if PREAMBLE_TRANSMISSION_COUNTER \( = \) preambleTransMax +1 :
4/ if the Random Access Preamble is transmitted on the SpCell:
\( 5> \) indicate a Random Access problem to upper layers;
5> if this Random Access procedure was triggered for SI request:
\( 6> \) consider the Random Access procedure unsuccessfully completed.
4> else if the Random Access Preamble is transmitted on an SCell:
\( 5> \) consider the Random Access procedure unsuccessfully completed.
3> if the Random Access procedure is not completed:
\( 4> \) perform the Random Access Resource selection procedure (see clause 5.1.2).
The RA-RNTI associated with the PRACH occasion in which the Random Access Preamble is transmitted or the RARNTI associated with the last valid PRACH occasion in the set of PRACH occasions (as specified in TS 38.213 [6]) for Msg1 repetition, is computed as:
\[
\text { RA-RNTI }=1+\text { s_id }+14 \times \text { t_id }+14 \times 80 \times \text { f_id }+14 \times 80 \times 8 \times \text { ul_carrier_id }
\]
where s_id is the index of the first OFDM symbol of the PRACH occasion ( \( 0 \leq s \_i d<14 \) ), t_id is the index of the first slot of the PRACH occasion in a system frame ( \( 0 \leq \mathrm{t} \_\mathrm{id}<80 \) ), where the subcarrier spacing to determine \( \mathrm{t} \_ \)id is based

ETSI


--- Page 41  ---


3GPP TS 38.321 version 18.2.0 Release 18
40
ETSI TS 138321 V18.2.0 (2024-08)

on the value of \( \mu \) specified in clause 5.3.2 in TS 38.211 [8] for \( \mu=\{0,1,2,3\} \), and for \( \mu=\{5,6\}, \mathrm{t} \) id is the index of the 120 kHz slot in a system frame that contains the PRACH occasion ( \( 0 \leq \mathrm{t} \_\mathrm{id}<80 \) ), f_id is the index of the PRACH occasion in the frequency domain ( \( 0 \leq \mathrm{f} \_\mathrm{id}<8 \) ), and ul_carrier_id is the UL carrier used for Random Access Preamble transmission (0 for NUL carrier, and 1 for SUL carrier).
5.1.3a MSGA transmission

The MAC entity shall, for each MSGA:
1> if PREAMBLE_TRANSMISSION_COUNTER is greater than one; and
\( 1> \) if the notification of suspending power ramping counter has not been received from lower layers; and
1> if LBT failure indication was not received from lower layers for the last MSGA Random Access Preamble transmission; and

1> if SSB selected is not changed from the selection in the last Random Access Preamble transmission:
\( 2> \) increment PREAMBLE_POWER_RAMPING_COUNTER by 1 .
\( 1> \) select the value of DELTA_PREAMBLE according to clause 7.3;
1> set PREAMBLE_RECEIVED_TARGET_POWER to msgA-PreambleReceivedTargetPower +
DELTA_PREAMBLE + (PREAMBLE_POWER_RAMPING_COUNTER - 1) × PREAMBLE_POWER_RAMPING_STEP;

1> if this is the first MSGA transmission within this Random Access procedure:
\( 2> \) if the transmission is not being made for the CCCH logical channel:
3> indicate to the Multiplexing and assembly entity to include a C-RNTI MAC CE in the subsequent uplink transmission.
\( 2> \) if the Random Access procedure was initiated for SpCell beam failure recovery and spCell-BFR-CBRA with value true is configured:

3> if there is at least one Serving Cell of this MAC entity configured with two BFD-RS sets:
4> indicate to the Multiplexing and assembly entity to include an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE in the subsequent uplink transmission.

3> else:
4> indicate to the Multiplexing and assembly entity to include a BFR MAC CE or a Truncated BFR MAC CE in the subsequent uplink transmission.
\( 2> \) else if the Random Access procedure was initiated for beam failure recovery of both BFD-RS sets of SpCell:
\( 3> \) indicate to the Multiplexing and assembly entity to include an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE in the subsequent uplink transmission.
\( 2> \) obtain the MAC PDU to transmit from the Multiplexing and assembly entity according to the HARQ information determined for the MSGA payload (see clause 5.1.2a) and store it in the MSGA buffer.

1> compute the MSGB-RNTI associated with the PRACH occasion in which the Random Access Preamble is transmitted;

1> instruct the physical layer to transmit the MSGA using the selected PRACH occasion and the associated PUSCH resource of MSGA (if the selected preamble and PRACH occasion is mapped to a valid PUSCH occasion), using the corresponding RA-RNTI, MSGB-RNTI, PREAMBLE_INDEX,
PREAMBLE_RECEIVED_TARGET_POWER, msgA-PreambleReceivedTargetPower, and the amount of power ramping applied to the latest MSGA preamble transmission (i.e. (PREAMBLE_POWER_RAMPING_COUNTER \( -1) \times \) PREAMBLE_POWER_RAMPING_STEP);
\( 1> \) if LBT failure indication is received from lower layers for the transmission of this MSGA Random Access Preamble:

ETSI


--- Page 42  ---


3GPP TS 38.321 version 18.2.0 Release 18
41
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) instruct the physical layer to cancel the transmission of the MSGA payload on the associated PUSCH resource;
\( 2> \) if Ibt-FailureRecoveryConfig is configured:
3> perform the Random Access Resource selection procedure for 2-step RA type (see clause 5.1.2a).
\( 2> \) else:
3> increment PREAMBLE_TRANSMISSION_COUNTER by 1;
3> if PREAMBLE_TRANSMISSION_COUNTER \( = \) preambleTransMax +1 :
\( 4> \) indicate a Random Access problem to upper layers;
4> if this Random Access procedure was triggered for SI request:
\( 5> \) consider this Random Access procedure unsuccessfully completed.
3> if the Random Access procedure is not completed:
\( 4> \) if msgA-TransMax is applied (see clause 5.1.1a) and PREAMBLE_TRANSMISSION_COUNTER \( = \) msgA-TransMax +1 :
\( 5> \) set the RA_TYPE to 4-stepRA;
\( 5> \) perform initialization of variables specific to Random Access type as specified in clause 5.1.1a;
\( 5> \) if the Msg3 buffer is empty:
6> obtain the MAC PDU to transmit from the MSGA buffer and store it in the Msg3 buffer;
\( 5> \) flush HARQ buffer used for the transmission of MAC PDU in the MSGA buffer;
\( 5> \) discard explicitly signalled contention-free 2 -step RA type Random Access Resources, if any;
\( 5> \) perform the Random Access Resource selection procedure as specified in clause 5.1.2.
4> else:
\( 5> \) perform the Random Access Resource selection procedure for 2-step RA type (see clause 5.1.2a).
NOTE: The MSGA transmission includes the transmission of the PRACH Preamble as well as the contents of the MSGA buffer in the PUSCH resource corresponding to the selected PRACH occasion and PREAMBLE_INDEX (see TS 38.213 [6])

The MSGB-RNTI associated with the PRACH occasion in which the Random Access Preamble is transmitted, is computed as:
\[
\text { MSGB-RNTI }=1+\text { s_id }+14 \times \text { t_id }+14 \times 80 \times \text { f_id }+14 \times 80 \times 8 \times \text { ul_carrier_id }+14 \times 80 \times 8 \times 2
\]
where s_id is the index of the first OFDM symbol of the PRACH occasion ( \( 0 \leq s \_ \)id \( <14 \) ), t_id is the index of the first slot of the PRACH occasion in a system frame ( \( 0 \leq \mathrm{t} \_\mathrm{id}<80 \) ), where the subcarrier spacing to determine t id is based on the value of \( \mu \) specified in clause 5.3.2 in TS 38.211 [8] for \( \mu=\{0,1,2,3\} \), and for \( \mu=\{5,6\}, \mathrm{t} \) id is the index of the 120 kHz slot in a system frame that contains the PRACH occasion ( \( 0 \leq \mathrm{t} \_\mathrm{id}<80 \) ), f_id is the index of the PRACH occasion in the frequency domain ( \( 0 \leq \mathrm{f} \) id \( <8 \) ), and ul_carrier_id is the UL carrier used for Random Access Preamble transmission ( 0 for NUL carrier, and 1 for SUL carrier)- The RA-RNTI is calculated as specified in clause 5.1.3.
5.1.4 Random Access Response reception

Once the Random Access Preamble is transmitted and regardless of the possible occurrence of a measurement gap, the MAC entity shall:
\( 1> \) if the contention-free Random Access Preamble for beam failure recovery request was transmitted by the MAC entity:

ETSI


--- Page 43  ---


3GPP TS 38.321 version 18.2.0 Release 18
42
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if the contention-free Random Access Preamble for beam failure recovery request was transmitted on a nonterrestrial network:

3> start the ra-ResponseWindow configured in BeamFailureRecoveryConfig at the PDCCH occasion as specified in TS 38.213 [6].
\( 2> \) else:
3> start the ra-ResponseWindow configured in BeamFailureRecoveryConfig at the first PDCCH occasion as specified in TS 38.213 [6] from the end of the Random Access Preamble transmission.
\( 2> \) monitor for a PDCCH transmission on the search space indicated by recoverySearchSpaceld of the SpCell identified by the C-RNTI while ra-ResponseWindow is running.

1> else:
\( 2> \) if the Random Access Preamble was transmitted on a non-terrestrial network:
3> if the Random Access Preamble is transmitted with repetitions:
4> start the ra-ResponseWindow configured in RACH-ConfigCommon at the PDCCH occasion from the end of all repetitions of the Random Access Preamble transmission as specified in TS 38.213 [6].

3> else:
4> start the ra-ResponseWindow configured in RACH-ConfigCommon at the PDCCH occasion as specified in TS 38.213 [6].
\( 2> \) else if the Random Access Preamble is transmitted with repetitions:
3> start the ra-ResponseWindow configured in RACH-ConfigCommon at the first PDCCH occasion from the end of all repetitions of the Random Access Preamble transmission as specified in TS 38.213 [6].
\( 2> \) else:
3> start the ra-ResponseWindow configured in RACH-ConfigCommon at the first PDCCH occasion as specified in TS 38.213 [6] from the end of the Random Access Preamble transmission.
\( 2> \) monitor the PDCCH of the SpCell for Random Access Response(s) identified by the RA-RNTI while the raResponseWindow is running.
\( 1> \) if notification of a reception of a PDCCH transmission on the search space indicated by recoverySearchSpaceld is received from lower layers on the Serving Cell where the preamble was transmitted; and
\( 1> \) if PDCCH transmission is addressed to the C-RNTI; and
1> if the contention-free Random Access Preamble for beam failure recovery request was transmitted by the MAC entity:
\( 2> \) consider the Random Access procedure successfully completed.
1> else if a valid (as specified in TS 38.213 [6]) downlink assignment has been received on the PDCCH for the RARNTI and the received TB is successfully decoded:
\( 2> \) if the Random Access Response contains a MAC subPDU with Backoff Indicator:
\( 3> \) set the PREAMBLE_BACKOFF to value of the BI field of the MAC subPDU using Table 7.2-1, multiplied with SCALING_FACTOR_BI.
\( 2> \) else:
3> set the PREAMBLE_BACKOFF to 0 ms .
\( 2> \) if the Random Access Response contains a MAC subPDU with Random Access Preamble identifier corresponding to the transmitted PREAMBLE_INDEX (see clause 5.1.3):

3> consider this Random Access Response reception successful.

ETSI


--- Page 44  ---


3GPP TS 38.321 version 18.2.0 Release 18
43
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if the Random Access Response reception is considered successful:
\( 3> \) if the Random Access Response includes a MAC subPDU with RAPID only:
4> consider this Random Access procedure successfully completed;
4> indicate the reception of an acknowledgement for SI request to upper layers.
3> else:
4> apply the following actions for the Serving Cell where the Random Access Preamble was transmitted:
\( 5> \) process the received Timing Advance Command (see clause 5.2);
\( 5> \) indicate the preambleReceivedTargetPower and the amount of power ramping applied to the latest Random Access Preamble transmission to lower layers (i.e.
(PREAMBLE_POWER_RAMPING_COUNTER -1 ) × PREAMBLE_POWER_RAMPING_STEP);
\( 5> \) if the Random Access procedure for an SCell is performed on uplink carrier where pusch-Config is not configured:
\( 6> \) ignore the received UL grant.
5> else:
6> process the received UL grant value and indicate it to the lower layers.
4> if the Random Access Preamble was not selected by the MAC entity among the contention-based Random Access Preamble(s):
\( 5> \) consider the Random Access procedure successfully completed.
4> else:
\( 5> \) set the TEMPORARY_C-RNTI to the value received in the Random Access Response;
\( 5> \) if this is the first successfully received Random Access Response within this Random Access procedure:
\( 6> \) if the transmission is not being made for the CCCH logical channel:
\( 7> \) indicate to the Multiplexing and assembly entity to include a C-RNTI MAC CE in the subsequent uplink transmission.
\( 6> \) if the Random Access procedure was initiated for SpCell beam failure recovery and spCell\( B F R-C B R A \) with value true is configured:

7> if there is at least one Serving Cell of this MAC entity configured with two BFD-RS sets:
\( 8> \) indicate to the Multiplexing and assembly entity to include an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE in the subsequent uplink transmission.
\( 7> \) else:
\( 8> \) indicate to the Multiplexing and assembly entity to include a BFR MAC CE or a Truncated BFR MAC CE in the subsequent uplink transmission.

6> else if the Random Access procedure was initiated for beam failure recovery of both BFD-RS sets of SpCell:

7> indicate to the Multiplexing and assembly entity to include an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE in the subsequent uplink transmission.
\( 6> \) obtain the MAC PDU to transmit from the Multiplexing and assembly entity and store it in the Msg3 buffer.

ETSI


--- Page 45  ---


3GPP TS 38.321 version 18.2.0 Release 18
44
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 1: If within a Random Access procedure, an uplink grant provided in the Random Access Response for the same group of contention-based Random Access Preambles has a different size than the first uplink grant allocated during that Random Access procedure, the UE behavior is not defined.

1> if ra-ResponseWindow configured in BeamFailureRecoveryConfig expires and if a PDCCH transmission on the search space indicated by recoverySearchSpaceld addressed to the C-RNTI has not been received on the Serving Cell where the preamble was transmitted; or

1> if ra-ResponseWindow configured in RACH-ConfigCommon expires, and if the Random Access Response containing Random Access Preamble identifiers that matches the transmitted PREAMBLE_INDEX has not been received:
\( 2> \) consider the Random Access Response reception not successful;
\( 2> \) increment PREAMBLE TRANSMISSION_COUNTER by 1;
\( 2> \) if PREAMBLE_TRANSMISSION_COUNTER \( = \) preambleTransMax +1 :
3> if the Random Access Preamble is transmitted on the SpCell:
4> indicate a Random Access problem to upper layers;
4> if this Random Access procedure was triggered for SI request:
\( 5> \) consider the Random Access procedure unsuccessfully completed.
3> else if the Random Access Preamble is transmitted on an SCell:
4> consider the Random Access procedure unsuccessfully completed.
\( 2> \) if the Random Access procedure is not completed:
3> if the Random Access Preamble is transmitted with repetitions and neither contention-free Random Access Resources nor Random Access resources for SI request have been provided for this Random Access procedure:

4> if PREAMBLE_TRANSMISSION_COUNTER \( = \) [preambleTransMax-Msgl-Repetition] +1 ; or
\( 4> \) if PREAMBLE_TRANSMISSION_COUNTER \( =2 \times \) [preambleTransMax-Msgl-Repetition] +1 :
\( 5> \) if set of Random Access resources configured with the same prach-ConfigurationIndex and associated with a higher Msgl repetition number with the same feature or feature combination as the current set of Random Access resources is available:

6> select the set of Random Access resources associated with the next higher Msg1 repetition number with the same feature or feature combination for this Random Access procedure;

6> initialize startPreambleForThisPartition, numberOfPreamblesPerSSB-ForThisPartition, ssb-SharedRO-MaskIndex and numberOfRA-PreamblesGroupA parameters for the Random Access procedure according to the values configured by RRC for the selected set of Random Access resources.

3> select a random backoff time according to a uniform distribution between 0 and the
PREAMBLE_BACKOFF;
\( 3> \) if the criteria (as defined in clause 5.1.2) to select contention-free Random Access Resources is met during the backoff time:
\( 4> \) perform the Random Access Resource selection procedure (see clause 5.1.2).
3> else if the Random Access procedure for an SCell is performed on uplink carrier where pusch-Config is not configured:
\( 4> \) delay the subsequent Random Access transmission until the Random Access Procedure is triggered by a PDCCH order with the same ra-PreambleIndex, ra-ssb-OccasionMaskIndex, and UL/SUL indicator TS 38.212 [9].

ETSI


--- Page 46  ---


3GPP TS 38.321 version 18.2.0 Release 18
45
ETSI TS 138321 V18.2.0 (2024-08)

3> else:
4> perform the Random Access Resource selection procedure (see clause 5.1.2) after the backoff time.
The MAC entity may stop ra-ResponseWindow (and hence monitoring for Random Access Response(s)) after successful reception of a Random Access Response containing Random Access Preamble identifiers that matches the transmitted PREAMBLE_INDEX.

HARQ operation is not applicable to the Random Access Response reception.
NOTE 2: For the case that RAR PDSCH bandwidth is larger than the band width the eRedCap UE can receive or process per slot, and the UL grant in RAR indicates that the time is not enough for Msg3 transmission, as specified in TS 38.213 [6], it is up to UE implementation, e.g. either to consider the Random Access Response reception not successful, or transmit Msg3.
5.1.4a MSGB reception and contention resolution for 2-step RA type

Once the MSGA preamble is transmitted, regardless of the possible occurrence of a measurement gap, the MAC entity shall:

1> start the msgB-ResponseWindow at the PDCCH occasion as specified in TS 38.213 [6], clause 8.2A;
\( 1> \) monitor the PDCCH of the SpCell for a Random Access Response identified by MSGB-RNTI while the msgBResponseWindow is running;

1> if C-RNTI MAC CE was included in the MSGA:
\( 2> \) monitor the PDCCH of the SpCell for Random Access Response identified by the C-RNTI while the msgBResponseWindow is running.
\( 1> \) if notification of a reception of a PDCCH transmission of the SpCell is received from lower layers:
\( 2> \) if the C-RNTI MAC CE was included in MSGA:
3> if the Random Access procedure was initiated for SpCell beam failure recovery or for beam failure recovery of both BFD-RS sets of SpCell (as specified in clause 5-17) and the PDCCH transmission is addressed to the C-RNTI; or

3> if the Random Access procedure was initiated for SDT beam failure recovery (as specified in clause 5.27.1) and the PDCCH transmission is addressed to the C-RNTI:

4> consider this Random Access Response reception successful;
4> stop the msgB-ResponseWindow;
4> consider this Random Access procedure successfully completed.
\( 3> \) else if the timeAlignmentTimer associated with at least one PTAG is running; or
\( 3> \) if CG-SDT procedure is ongoing and cg-SDT-TimeAlignmentTimer is running:
4> if the PDCCH transmission is addressed to the C-RNTI and contains a UL grant for a new transmission:
\( 5> \) consider this Random Access Response reception successful;
5> stop the msgB-ResponseWindow;
\( 5> \) consider this Random Access procedure successfully completed.
3> else:
\( 4> \) if a downlink assignment has been received on the PDCCH for the C-RNTI and the received TB is successfully decoded:
\( 5> \) if the MAC PDU contains the Absolute Timing Advance Command MAC CE:

ETSI


--- Page 47  ---


3GPP TS 38.321 version 18.2.0 Release 18
46
ETSI TS 138321 V18.2.0 (2024-08)

\( 6> \) process the received Timing Advance Command (see clause 5.2);
\( 6> \) consider this Random Access Response reception successful;
6> stop the msgB-ResponseWindow;
6> consider this Random Access procedure successfully completed and finish the disassembly and demultiplexing of the MAC PDU.

2 if a valid (as specified in TS 38.213 [6]) downlink assignment has been received on the PDCCH for the MSGB-RNTI and the received TB is successfully decoded:

3> if the MSGB contains a MAC subPDU with Backoff Indicator:
4> set the PREAMBLE_BACKOFF to value of the BI field of the MAC subPDU using Table 7.2-1, multiplied with SCALING_FACTOR_BI.
\( 3> \) else:
4> set the PREAMBLE_BACKOFF to 0 ms .
\( 3> \) if the MSGB contains a fallbackRAR MAC subPDU; and
3> if the Random Access Preamble identifier in the MAC subPDU matches the transmitted PREAMBLE_INDEX (see clause 5.1_3a):

4> consider this Random Access Response reception successful;
4> apply the following actions for the SpCell:
\( 5> \) process the received Timing Advance Command (see clause 5.2);
\( 5> \) indicate the msgA-PreambleReceivedTargetPower and the amount of power ramping applied to the latest Random Access Preamble transmission to lower layers (i.e.
(PREAMBLE_POWER_RAMPING_COUNTER -1 ) × PREAMBLE_POWER_RAMPING_STEP );
\( 5> \) if the Random Access Preamble was not selected by the MAC entity among the contention-based Random Access Preamble(s):
\( 6> \) consider the Random Access procedure successfully completed;
\( 6> \) process the received UL grant value and indicate it to the lower layers.
\( 5> \) else:
6> set the TEMPORARY_C-RNTI to the value received in the Random Access Response;
6> if the Msg3 buffer is empty:
7> obtain the MAC PDU to transmit from the MSGA buffer and store it in the Msg3 buffer;
6> process the received UL grant value and indicate it to the lower layers and proceed with Msg3 transmission.

NOTE: If within a 2 -step RA type procedure, an uplink grant provided in the fallback RAR has a different size than the MSGA payload, the UE behavior is not defined.
\( 3> \) else if the MSGB contains a successRAR MAC subPDU; and
3> if the CCCH SDU was included in the MSGA and the UE Contention Resolution Identity in the MAC subPDU matches the CCCH SDU:

4> stop msgB-ResponseWindow;
4> if this Random Access procedure was initiated for SI request:
\( 5> \) indicate the reception of an acknowledgement for SI request to upper layers.

ETSI


--- Page 48  ---


3GPP TS 38.321 version 18.2.0 Release 18
47
ETSI TS 138321 V18.2.0 (2024-08)

4> else:
\( 5> \) set the C-RNTI to the value received in the successRAR;
\( 5> \) apply the following actions for the SpCell:
\( 6> \) process the received Timing Advance Command (see clause 5.2);
6> indicate the msgA-PreambleReceivedTargetPower and the amount of power ramping applied to the latest Random Access Preamble transmission to lower layers (i.e.
(PREAMBLE_POWER_RAMPING_COUNTER -1 ) × PREAMBLE_POWER_RAMPING_STEP).
\( 4> \) deliver the TPC, PUCCH resource Indicator, ChannelAccess-CPext (if indicated), and HARQ feedback Timing Indicator received in successRAR to lower layers.

4> consider this Random Access Response reception successful;
\( 4> \) consider this Random Access procedure successfully completed;
4> finish the disassembly and demultiplexing of the MAC PDU.
1> if msgB-ResponseWindow expires, and the Random Access Response Reception has not been considered as successful based on descriptions above:
\( 2> \) increment PREAMBLE_TRANSMISSION_COUNTER by 1 ;
\( 2> \) if PREAMBLE_TRANSMISSION_COUNTER \( = \) preambleTransMax +1 :
3> indicate a Random Access problem to upper layers;
3> if this Random Access procedure was triggered for SI request:
4> consider this Random Access procedure unsuccessfully completed.
\( 2> \) if the Random Access procedure is not completed:
3> if msgA-TransMax is applied (see clause 5.1.1a) and PREAMBLE_TRANSMISSION_COUNTER \( = \) msgATransMax + 1:

4> set the RA_TYPE to 4-stepRA;
\( 4> \) perform initialization of variables specific to Random Access type as specified in clause 5.1.1a;
4> if the Msg3 buffer is empty:
\( 5> \) obtain the MAC PDU to transmit from the MSGA buffer and store it in the Msg3 buffer;
4> flush HARQ buffer used for the transmission of MAC PDU in the MSGA buffer;
\( 4> \) discard explicitly signalled contention-free 2 -step RA type Random Access Resources, if any;
4> perform the Random Access Resource selection procedure as specified in clause 5.1.2.
\( 3> \) else:
4> select a random backoff time according to a uniform distribution between 0 and the PREAMBLE_BACKOFF;

4- if the criteria (as defined in clause 5.1.2a) to select contention-free Random Access Resources is met during the backoff time:
\( 5> \) perform the Random Access Resource selection procedure for 2-step RA type Random Access (see clause 5.1.2a).

4 else:

ETSI


--- Page 49  ---


3GPP TS 38.321 version 18.2.0 Release 18
48
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) perform the Random Access Resource selection procedure for 2-step RA type Random Access (see clause 5.1.2a) after the backoff time.

Upon receiving a fallbackRAR, the MAC entity may stop msgB-ResponseWindow once the Random Access Response reception is considered as successful.
5.1.5 Contention Resolution

Once Msg3 is transmitted the MAC entity shall:
\( 1> \) if the Msg3 transmission (i.e initial transmission or HARQ retransmission) is scheduled with PUSCH repetition Type A:
\( 2> \) if Msg 3 is transmitted on a non-terrestrial network:
3> start or restart the ra-ContentionResolutionTimer in the first symbol after the end of all repetitions of the Msg3 transmission plus the UE-gNB RTT.
\( 2> \) else:
\( 3> \) start or restart the \( r a \)-ContentionResolutionTimer in the first symbol after the end of all repetitions of the Msg3 transmission.

1> else if Msg3 transmission (i.e initial transmission or HARQ retransmission) is transmitted on a non-terrestrial network:
\( 2> \) start or restart the ra-ContentionResolutionTimer in the first symbol after the end of the Msg3 transmission plus the UE-gNB RTT.

1> else:
\( 2> \) start or restart the ra -ContentionResolutionTimer in the first symbol after the end of the Msg3 transmission.
1> monitor the PDCCH while the ra-ContentionResolutionTimer is running regardless of the possible occurrence of a measurement gap;
\( 1> \) if notification of a reception of a PDCCH transmission of the SpCell is received from lower layers:
\( 2> \) if the C-RNTI MAC CE was included in Msg3:
3> if the Random Access procedure was initiated for SpCell beam failure recovery or for beam failure recovery of both BFD-RS sets of SpCell (as specified in clause 5-17) and the PDCCH transmission is addressed to the C-RNTI; or

3> if the Random Access procedure was initiated by a PDCCH order and the PDCCH transmission is addressed to the C-RNTI; or

3> if the Random Access procedure was initiated for SDT beam failure recovery (as specified in clause 5.27.1) and the PDCCH transmission is addressed to the C-RNTI; or

3> if the Random Access procedure was initiated by the MAC sublayer itself or by the RRC sublayer and the PDCCH transmission is addressed to the C-RNTI and contains a UL grant for a new transmission:

4> consider this Contention Resolution successful;
4> stop ra-ContentionResolutionTimer;
\( 4> \) discard the TEMPORARY_C-RNTT;
4> consider this Random Access procedure successfully completed.
\( 2> \) else if the CCCH SDU was included in Msg3 and the PDCCH transmission is addressed to its TEMPORARY_C-RNTI:

3> if the MAC PDU is successfully decoded:

ETSI


--- Page 50  ---


3GPP TS 38.321 version 18.2.0 Release 18
49
ETSI TS 138321 V18.2.0 (2024-08)

4> stop ra-ContentionResolutionTimer;
\( 4> \) if the MAC PDU contains a UE Contention Resolution Identity MAC CE; and
4- if the UE Contention Resolution Identity in the MAC CE matches the CCCH SDU transmitted in Msg3:
\( 5> \) consider this Contention Resolution successful and finish the disassembly and demultiplexing of the MAC PDU;
\( 5> \) if this Random Access procedure was initiated for SI request:
\( 6> \) indicate the reception of an acknowledgement for SI request to upper layers.
\( 5> \) else:
6> set the C-RNTI to the value of the TEMPORARY_C-RNTI;
\( 5> \) discard the TEMPORARY_C-RNTI;
\( 5> \) consider this Random Access procedure successfully completed.
\( 4> \) else:
\( 5> \) discard the TEMPORARY_C-RNTF;
\( 5> \) consider this Contention Resolution not successful and discard the successfully decoded MAC PDU.
\( 3> \) else, for eRedCap UE, if lower layer detects that PDSCH transmission scheduled by PDCCH has a larger bandwidth than UE can receive or process per slot:

4> stop ra-ContentionResolutionTimer;
\( 4> \) discard the TEMPORARY_C-RNTI;
4> consider this Contention Resolution not successful.
1> if ra-ContentionResolutionTimer expires:
\( 2> \) if Msg3 transmission was transmitted on a non-terrestrial network:
3> if no PDCCH addressed to TC-RNTI indicating uplink grant for a Msg3 retransmission is received after the start of the ra-ContentionResolutionTimer:
\( 4> \) discard the TEMPORARY_C-RNTT;
4> consider the Contention Resolution not successful.
\( 2> \) else:
\( 3> \) discard the TEMPORARY_C-RNTI;
3> consider the Contention Resolution not successful.
1> if the Contention Resolution is considered not successful:
2 flush the HARQ buffer used for transmission of the MAC PDU in the Msg3 buffer;
\( 2> \) increment PREAMBLE_TRANSMISSION_COUNTER by 1 ;
2 if PREAMBLE_TRANSMISSION_COUNTER \( = \) preambleTransMax +1 :
3> indicate a Random Access problem to upper layers.
\( 3> \) if this Random Access procedure was triggered for SI request:
\( 4> \) consider the Random Access procedure unsuccessfully completed.

ETSI


--- Page 51  ---


3GPP TS 38.321 version 18.2.0 Release 18
50
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if the Random Access procedure is not completed:
3> if the RA_TYPE is set to 4-stepRA:
4> if the Random Access Preamble is transmitted with repetitions and contention-free Random Access Resources have not been provided for this Random Access procedure:
\( 5> \) if PREAMBLE_TRANSMISSION_COUNTER \( =[ \) preambleTransMax-Msgl-Repetition \( ]+1 \); or
\( 5> \) if PREAMBLE_TRANSMISSION_COUNTER \( =2 \times[ \) preambleTransMax-Msg 1 -Repetition \( ]+1 \) :
\( 6> \) if set of Random Access resources configured with the same prach-ConfigurationIndex and associated with a higher Msgl repetition number with the same feature or feature combination as the current set of Random Access resources is available:
\( 7> \) select the set of Random Access resources associated with the next higher Msg1 repetition number with the same feature or feature combination for this Random Access procedure;

7> initialize startPreambleForThisPartition, numberOfPreamblesPerSSB-ForThisPartition, ssb-SharedRO-MaskIndex and numberOfRA-PreamblesGroupA parameters for the Random Access procedure according to the values configured by RRC for the selected set of Random Access resources.

4> select a random backoff time according to a uniform distribution between 0 and the
PREAMBLE_BACKOFF;
\( 4> \) if the criteria (as defined in clause 5.1.2) to select contention-free Random Access Resources is met
during the backoff time:
\( 5> \) perform the Random Access Resource selection procedure (see clause 5.1.2);
4> else:
5> perform the Random Access Resource selection procedure (see clause 5.1.2) after the backoff time.

3> else (i.e. the RA_TYPE is set to 2-stepRA):
4> if msgA-TransMax is applied (see clause 5.1.1a) and PREAMBLE_TRANSMISSION_COUNTER= msgA-TransMax +1 :
\( 5> \) set the RA_TYPE to 4-stepRA;
\( 5> \) perform initialization of variables specific to Random Access type as specified in clause 5.1.1a;
\( 5> \) flush HARQ buffer used for the transmission of MAC PDU in the MSGA buffer;
\( 5> \) discard explicitly signalled contention-free 2 -step RA type Random Access Resources, if any;
\( 5> \) perform the Random Access Resource selection as specified in clause 5.1.2.
4> else:
\( 5> \) select a random backoff time according to a uniform distribution between 0 and the PREAMBLE_BACKOFF;
\( 5> \) if the criteria (as defined in clause 5.1.2a) to select contention-free Random Access Resources is met during the backoff time:
\( 6> \) perform the Random Access Resource selection procedure for 2 -step RA type as specified in clause 5.1.2a

5> else:
\( 6> \) perform the Random Access Resource selection for 2-step RA type procedure (see clause 5.1.2a) after the backoff time.

ETSI


--- Page 52  ---


3GPP TS 38.321 version 18.2.0 Release 18
51
ETSI TS 138321 V18.2.0 (2024-08)
5.1.6 Completion of the Random Access procedure

Upon completion of the Random Access procedure, the MAC entity shall:
\( 1> \) discard any explicitly signalled contention-free Random Access Resources for 2 -step RA type and 4 -step RA type except the 4 -step RA type contention-free Random Access Resources for beam failure recovery request, if any;
\( 1> \) flush the HARQ buffer used for transmission of the MAC PDU in the Msg3 buffer and the MSGA buffer.
Upon successful completion of the Random Access procedure initiated for DAPS handover, the target MAC entity shall:
\( 1> \) indicate the successful completion of the Random Access procedure to the upper layers.
5.2 Maintenance of Uplink Time Alignment

RRC configures the following parameters for the maintenance of UL time alignment:
- timeAlignmentTimer (per TAG) which controls how long the MAC entity considers the Serving Cells to the associated TAG to be uplink time aligned for the TAG;
- inactivePosSRS-TimeAlignmentTimer which controls how long the MAC entity considers the Positioning SRS transmission in RRC_INACTIVE in clause 5.26 to be uplink time aligned;
- cg-SDT-TimeAlignmentTimer which controls how long the MAC entity considers the uplink transmission for CG-SDT to be uplink time aligned;
- inactivePosSRS-ValidityAreaTAT which controls how long the MAC entity considers Positioning SRS transmission in RRC_INACTIVE in clause 5.26 to be uplink time aligned when SRS positioning validity area is configured.

The MAC entity shall:
1> when a Timing Advance Command MAC CE is received, and if an \( \mathrm{N}_{\mathrm{TA}} \) (as defined in TS 38.211 [8]) has been maintained with the indicated TAG:
\( 2> \) apply the Timing Advance Command for the indicated TAG;
\( 2> \) if there is ongoing Positioning SRS Transmission in RRC_INACTIVE as in clause 5.26:
3> if SRS positioning validity area is configured:
4> start or restart the inactivePosSRS-ValidityAreaTAT associated with the indicated TAG.
\( 3> \) else:
4> start or restart the inactivePosSRS-TimeAlignmentTimer associated with the indicated TAG.
\( 2> \) if CG-SDT procedure triggered as in clause 5.27 is ongoing:
3> start or restart the cg-SDT-TimeAlignmentTimer associated with the indicated TAG.
\( 2> \) else:
3> start or restart the timeAlignmentTimer associated with the indicated TAG.
1> when a Timing Advance Command is received in a Random Access Response message for a Serving Cell configured with two TAGs or in a MSGB for an SpCell configured with two TAGs:
\( 2> \) if the Random Access Preamble was not selected by the MAC entity among the contention-based Random Access Preamble:
\( 3> \) apply the Timing Advance Command for the TAG indicated in the received Random Access Response message or MSGB;

ETSI


--- Page 53  ---


3GPP TS 38.321 version 18.2.0 Release 18
52
ETSI TS 138321 V18.2.0 (2024-08)

3> start or restart the timeAlignmentTimer associated with TAG indicated in the received Random Access Response message or MSGB.
\( 2> \) else if the timeAlignmentTimer associated with the TAG indicated in the received Random Access Response message or MSGB is not running:
\( 3> \) apply the Timing Advance Command for this TAG;
3> start the timeAlignmentTimer associated with this TAG;
3> when the Contention Resolution is considered not successful as described in clause 5.1.5:
4> stop the timeAlignmentTimer associated with this TAG.
\( 2> \) else:
3> ignore the received Timing Advance Command.
\( 1> \) when a Timing Advance Command is received in a Random Access Response message for a Serving Cell not configured with two TAGs or in a MSGB for an SpCell not configured with two TAGs:
\( 2> \) if the Random Access Preamble was not selected by the MAC entity among the contention-based Random Access Preamble:

3> apply the Timing Advance Command for this TAG;
3> start or restart the timeAlignmentTimer associated with this TAG.
\( 2> \) else if the timeAlignmentTimer associated with this TAG is not running:
3> apply the Timing Advance Command for this TAG;
3> start the timeAlignmentTimer associated with this TAG;
3> when the Contention Resolution is considered not successful as described in clause 5.1.5; or
3> when the Contention Resolution is considered successful for SI request as described in clause 5.1.5, after transmitting HARQ feedback for MAC PDU including UE Contention Resolution Identity MAC CE:

4> stop timeAlignmentTimer associated with this TAG.
3> when the Contention Resolution is considered not successful as described in clause 5.1.5:
4> if CG-SDT procedure triggered as in clause 5.27 is ongoing:
\( 5> \) set the \( \mathrm{N}_{\text {TA }} \) value to the value before applying the received Timing Advance Command as in TS 38.211 [8].

3> when the Contention Resolution is considered successful for Random Access procedure while the CGSDT procedure is ongoing:

4> stop timeAlignmentTimer associated with this TAG;
\( 4> \) start or restart the cg-SDT-TimeAlignmentTimer associated with this TAG.
3> when the Contention Resolution is considered successful for Random Access procedure while SRS transmission in RRC_INACTIVE is ongoing:

4> if SRS positioning validity area is configured:
\( 5> \) start or restart the inactivePosSRS-ValidityAreaTAT associated with the indicated TAG.
4> else:
\( 5> \) start or restart the inactivePosSRS-TimeAlignmentTimer associated with this TAG.
\( 2> \) else:

ETSI


--- Page 54  ---


3GPP TS 38.321 version 18.2.0 Release 18
53
ETSI TS 138321 V18.2.0 (2024-08)

3> ignore the received Timing Advance Command.
1> when an Absolute Timing Advance Command is received in response to a MSGA transmission including CRNTI MAC CE, as specified in clause 5.1.4a, for an SpCell configured with two TAGs:
\( 2> \) apply the Timing Advance Command for the PTAG indicated in the Absolute Timing Advance Command MAC CE
\( 2> \) start or restart the timeAlignmentTimer associated with this PTAG.
\( 1> \) when an Absolute Timing Advance Command is received in response to a MSGA transmission including CRNTI MAC CE, as specified in clause 5.1.4a, for an SpCell not configured with two TAGs:
\( 2> \) apply the Timing Advance Command for PTAG;
\( 2> \) if there is ongoing Positioning SRS Transmission in RRC_INACTIVE as in clause 5.26:
3> if SRS positioning validity area is configured:
4> start or restart the inactivePosSRS-ValidityAreaTAT associated with the indicated TAG.
\( 3> \) else:
\( 4> \) start or restart the inactivePosSRS-TimeAlignmentTimer associated with the indicated TAG.
\( 2> \) if CG-SDT procedure is ongoing:
3> start or restart the cg-SDT-TimeAlignmentTimer associated with PTAG.
\( 2> \) else:
3> start or restart the timeAlignmentTimer associated with PTAG.
\( 1> \) when the MAC entity is configured with rach-LessHO:
\( 2> \) set the \( \mathrm{N}_{\text {TA }} \) value (as defined in TS 38.211 [8]) to the value indicated by targetNTA in rach-LessHO for PTAG;
\( 2> \) start the timeAlignmentTimer associated with PTAG.
\( 1> \) when the indication is received from upper layer for stopping the inactivePosSRS-TimeAlignmentTimer:
\( 2> \) stop the inactivePosSRS-TimeAlignmentTimer.
\( 1> \) when the indication is received from upper layer for starting the inactivePosSRS-TimeAlignmentTimer:
\( 2> \) start or restart the inactivePosSRS-TimeAlignmentTimer.
1> when instruction from the upper layer has been received for starting the cg-SDT-TimeAlignmentTimer:
\( 2> \) start the cg-SDT-TimeAlignmentTimer.
\( 1> \) when instruction from the upper layer has been received for stopping the cg-SDT-TimeAlignmentTimer:
\( 2> \) consider the cg-SDT-TimeAlignmentTimer as expired.
\( 1> \) when the indication is received from upper layer for starting the inactivePosSRS-ValidityAreaTAT:
\( 2> \) start or restart the inactivePosSRS-ValidityAreaTAT.
\( 1> \) when the indication is received from upper layer for stopping the inactivePosSRS-ValidityAreaTAT:
\( 2> \) stop the inactivePosSRS-ValidityAreaTAT.
1> when instruction from the upper layer has been received for starting the TimeAlignmentTimer associated with PTAG:
\( 2> \) start the TimeAlignmentTimer associated with the indicated PTAG.

ETSI


--- Page 55  ---


3GPP TS 38.321 version 18.2.0 Release 18
54
ETSI TS 138321 V18.2.0 (2024-08)

1> when an LTM Cell Switch Command MAC CE is received and the Timing Advance Command is not set as FFF:
\( 2> \) apply the Timing Advance Command for the PTAG indicated by the LTM Cell Switch Command MAC CE;
\( 2> \) start or restart the timeAlignmentTimer associated with the PTAG indicated by LTM Cell Switch Command MAC CE
\( 1> \) when an LTM Cell Switch Command MAC CE is received, and the Timing Advance Command is set as FFF, and the UE has successfully measured the Timing Advance as in clause 5.18.35:
\( 2> \) apply the measured Timing Advance for the PTAG;
\( 2> \) start or restart the timeAlignmentTimer associated with the PTAG.
\( 1> \) when a timeAlignmentTimer expires:
\( 2> \) if the timeAlignmentTimer is associated with a PTAG and the SpCell is not configured with two PTAGs; or
\( 2> \) if the timeAlignmentTimer is associated with a PTAG, the SpCell is configured with two PTAGs, and the timeAlignmentTimer associated with the other PTAG is not running:

3> flush all HARQ buffers for all Serving Cells;
\( 3> \) notify RRC to release PUCCH for all Serving Cells, if configured;
3> notify RRC to release SRS for all Serving Cells, if configured;
3> clear any configured downlink assignments and configured uplink grants;
\( 3> \) clear any PUSCH resource for semi-persistent CSI reporting;
\( 3> \) consider all running timeAlignmentTimers as expired;
\( 3> \) maintain \( \mathrm{N}_{\mathrm{TA}} \) (defined in TS 38.211 [8]) of all TAGs.
\( 2> \) else:
3> if the timeAlignmentTimer is associated with a TAG for an SCell configured with only this TAG; or
3> if the timeAlignmentTimer is associated with a TAG for an SCell, and if the SCell is configured with two TAGs and the timeAlignmentTimer associated with the other TAG is not running:

4> flush all HARQ buffers for all such SCells;
\( 4> \) notify RRC to release PUCCH, if configured for all such SCells;
\( 4> \) notify RRC to release SRS, if configured for all such SCells;
\( 4> \) clear any configured downlink assignments and configured uplink grants for all such SCells;
\( 4> \) clear any PUSCH resource for semi-persistent CSI reporting for all such SCells;
\( 4> \) maintain \( \mathrm{N}_{\mathrm{TA}} \) (defined in TS 38.211 [8]) of this TAG.
3> else if the timeAlignmentTimer is associated with a TAG for a Serving Cell configured with two TAGs, and if the timeAlignmentTimer associated with the other TAG is running, for all such Serving Cells:
\( 4> \) clear any configured downlink assignment, if the activated TCI state(s) for all PUCCH resources configured for the configured downlink assignment is associated with the TAG of the expired timeAlignmentTimer;
\( 4> \) clear any configured uplink grant, if the activated TCI state(s) for the configured uplink grant is associated with the TAG of the expired timeAlignmentTimer;

4> clear any PUSCH resource for semi-persistent CSI reporting, if the activated TCI state(s) for the PUSCH resource is associated with the TAG of the expired timeAlignmentTimer;

ETSI


--- Page 56  ---


3GPP TS 38.321 version 18.2.0 Release 18
55
ETSI TS 138321 V18.2.0 (2024-08)

\( 4> \) maintain \( \mathrm{N}_{\mathrm{TA}} \) (defined in TS 38.211 [8]) of this TAG.
\( 1> \) when the inactivePosSRS-TimeAlignmentTimer expires:
\( 2> \) notify RRC to release Positioning SRS for RRC_INACTIVE configuration(s).
\( 1> \) when the cg-SDT-TimeAlignmentTimer expires:
\( 2> \) clear any configured uplink grants;
2 if a PDCCH addressed to the MAC entity's C-RNTI after initial transmission for the CG-SDT with CCCH message has not been received:

3> consider ongoing CG-SDT procedure as terminated;
\( 3> \) indicate the expiry of cg-SDT-TimeAlignmentTimer to the upper layer.
\( 2> \) flush all HARQ buffers;
\( 2> \) maintain \( \mathrm{N}_{\mathrm{TA}} \) (defined in TS 38.211 [8]) of this TAG.
When the MAC entity stops uplink transmissions for an SCell not configured with two TAGs due to the fact that the maximum uplink transmission timing difference between TAGs of the MAC entity or the maximum uplink transmission timing difference between TAGs of any MAC entity of the UE is exceeded, the MAC entity considers the timeAlignmentTimer associated with the SCell as expired.

When the MAC entity stops uplink transmissions associated to a STAG for an SCell configured with two TAGs due to the fact that the maximum uplink transmission timing difference between TAGs of the MAC entity or the maximum uplink transmission timing difference between TAGs of any MAC entity of the UE is exceeded, the MAC entity considers the timeAlignmentTimer associated with the STAG as expired.

The MAC entity shall not perform any uplink transmission on a Serving Cell except the Random Access Preamble and MSGA transmission when the timeAlignmentTimer(s) associated with all TAG(s) to which this Serving Cell belongs is not running, CG-SDT procedure is not ongoing and SRS transmission in RRC_INACTIVE as in clause 5.26 is not ongoing. Furthermore, when the timeAlignmentTimer(s) associated with all PTAG(s) is not running, CG-SDT procedure is not ongoing and SRS transmission in RRC_INACTIVE as in clause 5.26 is not ongoing, the MAC entity shall not perform any uplink transmission on any Serving Cell except the Random Access Preamble and MSGA transmission on the SpCell. The MAC entity shall not perform any uplink transmission except the Random Access Preamble and MSGA transmission when the cg-SDT-TimeAlignmentTimer is not running during the ongoing CG-SDT procedure as triggered in clause 5.27 and the inactivePosSRS-TimeAlignmentTimer or inactivePosSRS-ValidityAreaTAT is not running. The MAC entity shall not perform any uplink transmission except the Random Access Preamble and MSGA transmission on a Serving Cell using TCI state(s) associated with a TAG for which the timeAlignmentTimer is not running.
5.2a Maintenance of UL Synchronization

The MAC entity shall for each Serving Cell:
\( 1> \) if an indication of uplink synchronization has been received from upper layers (see clauses 5.2.2.6 and 5.7.19 of TS 38.331 [5]):
\( 2> \) if indication of uplink synchronization is received after indication of uplink synchronization loss due to satellite switch with re-synchronization (see clause 5.7 .19 of TS 38.331 [5]):
\( 3> \) set \( \mathrm{N}_{\text {TA }} \) value (as defined in TS 38.211 [8]) to zero for PTAG;
3> indicate to lower layers a Differential Koffset with value zero.
\( 2> \) allow uplink transmission on the Serving Cell.
1> if an indication of uplink synchronization loss is received from upper layers (see clause 5.2.2.6 and 5.7.19 of TS 38.331 [5]):
\( 2> \) if uplink synchronization loss is due to satellite switch with re-synchronization (see clause 5.7 .19 of TS 38.331 [5]):

ETSI


--- Page 57  ---


3GPP TS 38.321 version 18.2.0 Release 18
56
ETSI TS 138321 V18.2.0 (2024-08)

3> not perform any uplink transmission on the Serving Cell.
\( 2> \) else:
3> flush all HARQ buffers;
3> not perform any uplink transmission on the Serving Cell.
NOTE: The MAC entity suspends all UL operations (e.g. stop RACH, SR, and UL HARQ operation) after receiving the indication of an uplink synchronization loss and resumes the operation when receiving an indication of uplink synchronization.
5.3 DL-SCH data transfer
5.3.1 DL Assignment reception

Downlink assignments received on the PDCCH both indicate that there is a transmission on a DL-SCH for a particular MAC entity and provide the relevant HARQ information.

When the MAC entity has a C-RNTI, Temporary C-RNTI, CS-RNTI, G-RNTI or G-CS-RNTI, the MAC entity shall for each PDCCH occasion during which it monitors PDCCH and for each Serving Cell:

1> if a downlink assignment for this PDCCH occasion and this Serving Cell has been received on the PDCCH for the MAC entity's C-RNTI, or Temporary C-RNTI, or G-RNTI configured for multicast MTCH:

2 if this is the first downlink assignment for this Temporary C-RNTI:
\( 3> \) consider the NDI to have been toggled.
\( 2> \) if the downlink assignment is for the MAC entity's C-RNTI, and if the previous downlink assignment indicated to the HARQ entity of the same HARQ process was either a downlink assignment received for the MAC entity's CS-RNTI or G-CS-RNTI, or a configured downlink assignment for unicast or MBS multicast; or
\( 2> \) if the downlink assignment is for the MAC entity's G-RNTI configured for multicast MTCH, and if the previous downlink assignment indicated to the HARQ entity of the same HARQ process was either a downlink assignment received for the MAC entity's CS-RNTI or G-CS-RNTI, or other G-RNTI, or C-RNTI, or a configured downlink assignment for unicast or MBS multicast:
\( 3> \) consider the NDI to have been toggled regardless of the value of the NDI.
\( 2> \) stop the cg-SDT-RetransmissionTimer, if it is running, for the corresponding HARQ process for initial transmission with CCCH message;
\( 2> \) stop the cg-RRC-RetransmissionTimer, if it is running, for the corresponding HARQ process for initial transmission of RACH-less handover or for the first PUSCH transmission at RACH-less LTM cell switch;
\( 2> \) stop the configuredGrantTimer, if it is running, for the corresponding HARQ process for initial transmission with CCCH message;
\( 2> \) if the downlink assignment has been received on the PDCCH for the MAC entity's C-RNTI after the first PUSCH transmission to the Serving Cell; and
\( 2> \) if the downlink assignment is for a new transmission:
\( 3> \) if there is an ongoing RACH-less handover procedure:
\( 4> \) consider the RACH-less handover to be successfully completed and indicate it to upper layers.
\( 3> \) else if there is an ongoing RACH-less LTM cell switch:
4> consider the LTM cell switch to be successfully completed and indicate it to upper layers.
\( 2> \) indicate the presence of a downlink assignment and deliver the associated HARQ information to the HARQ entity.

ETSI


--- Page 58  ---


3GPP TS 38.321 version 18.2.0 Release 18
57
ETSI TS 138321 V18.2.0 (2024-08)

1> else if a downlink assignment for this PDCCH occasion has been received for this Serving Cell on the PDCCH for the MAC entity's CS-RNTI or G-CS-RNTI:
\( 2> \) if the NDI in the received HARQ information is 1 :
\( 3> \) consider the NDI for the corresponding HARQ process not to have been toggled;
\( 3> \) indicate the presence of a downlink assignment for this Serving Cell and deliver the associated HARQ information to the HARQ entity.

2 if the NDI in the received HARQ information is 0 :
\( 3> \) if PDCCH contents indicate SPS deactivation:
\( 4> \) clear the configured downlink assignment for this Serving Cell (if any);
4> if the timeAlignmentTimer, associated with the TAG containing the Serving Cell on which the HARQ feedback is to be transmitted, is running, and the Serving Cell is not configured with two TAGs; or

4> if the Serving Cell on which the HARQ feedback is to be transmitted is configured with two TAGs and if the timeAlignmentTimer of the TAG, associated with the TCI state(s) used for transmitting the HARQ feedback, is running:
\( 5> \) indicate a positive acknowledgement for the SPS deactivation to the physical layer.
3> else if PDCCH content indicates SPS activation:
4> store the downlink assignment for this Serving Cell and the associated HARQ information as configured downlink assignment;

4> initialise or re-initialise the configured downlink assignment for this Serving Cell to start in the associated PDSCH duration and to recur according to rules in clause 5.8.1 or in clause 5.8.1a;

For each Serving Cell and each configured downlink assignment, if configured and activated, the MAC entity shall:
1> if the PDSCH duration of the configured downlink assignment does not overlap with the PDSCH duration of a downlink assignment received on the PDCCH for this Serving Cell:
\( 2> \) instruct the physical layer to receive, in this PDSCH duration, transport block on the DL-SCH according to the configured downlink assignment and to deliver it to the HARQ entity;
\( 2> \) set the HARQ Process ID to the HARQ Process ID associated with this PDSCH duration;
\( 2> \) consider the NDI bit for the corresponding HARQ process to have been toggled;
\( 2> \) indicate the presence of a configured downlink assignment and deliver the stored HARQ information to the HARQ entity.

For configured downlink assignments without harq-ProcID-Offset, the HARQ Process ID associated with the slot where the DL transmission starts is derived from the following equation:

HARQ Process ID \( =[ \) floor \( ( \) CURRENT_slot × \( 10 / \) (numberOfSlotsPerFrame × periodicity) \( )] \) modulo nrofHARQ-Processes
where CURRENT_slot \( =[( \) SFN × numberOfSlotsPerFrame \( )+ \) slot number in the frame \( ] \) and numberOfSlotsPerFrame refers to the number of consecutive slots per frame as specified in TS 38.211 [8].

For configured downlink assignments with harq-ProcID-Offset, the HARQ Process ID associated with the slot where the DL transmission starts is derived from the following equation:

HARQ Process ID \( =[ \) floor \( ( \) CURRENT_slot × \( 10 /( \) numberOfSiotsPerFrame × periodicity \( ))] \) modulo nrofHARQ-Processes + harq-ProcID-Offset
where CURRENT_slot \( =[( \) SFN × numberOfSIotsPerFrame \( )+ \) slot number in the frame \( ] \) and numberOfSlotsPerFrame refers to the number of consecutive slots per frame as specified in TS 38.211 [8].

ETSI


--- Page 59  ---


3GPP TS 38.321 version 18.2.0 Release 18
58
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 1: In case of unaligned SFN across carriers in a cell group, the SFN of the concerned Serving Cell is used to calculate the HARQ Process ID used for configured downlink assignments.

NOTE 2: CURRENT_slot refers to the slot index of the first transmission occasion of a bundle of configured downlink assignment.

When the MAC entity needs to read BCCH, the MAC entity may, based on the scheduling information from RRC:
\( 1> \) if a downlink assignment for this PDCCH occasion has been received on the PDCCH for the \( \mathrm{SI}-\mathrm{RNTI} \);
\( 2> \) indicate a downlink assignment and redundancy version for the dedicated broadcast HARQ process to the HARQ entity.

When the MAC entity needs to read MCCH, the MAC entity may, based on the scheduling information from RRC:
\( 1> \) if a downlink assignment for this PDCCH occasion has been received on the PDCCH for the MCCH -RNTI or Multicast MCCH-RNTI:
\( 2> \) indicate a downlink assignment and redundancy version for the selected HARQ process to the HARQ entity.
When the MAC entity needs to read broadcast MTCH, the MAC entity may, based on the scheduling information from RRC and DCI:
\( 1> \) if a downlink assignment for this PDCCH occasion has been received on the PDCCH for the G-RNTI configured for broadcast MTCH:
\( 2> \) indicate the presence of a downlink assignment and deliver the associated HARQ information for the selected HARQ process to the HARQ entity.
5.3.2 HARQ operation
5.3.2.1 HARQ Entity

The MAC entity includes a HARQ entity for each Serving Cell, which maintains a number of parallel HARQ processes. Each HARQ process is associated with a HARQ process identifier. The HARQ entity directs HARQ information and associated TBs received on the DL-SCH to the corresponding HARQ processes (see clause 5.3.2.2).

The number of parallel DL HARQ processes per HARQ entity is specified in TS 38.214 [7]. The dedicated broadcast HARQ process is used for BCCH .

The HARQ process supports one TB when the physical layer is not configured for downlink spatial multiplexing. The HARQ process supports one or two TBs when the physical layer is configured for downlink spatial multiplexing.

When the MAC entity is configured with pdsch-AggregationFactor \( >1 \), the parameter pdsch-AggregationFactor provides the number of transmissions of a TB within a bundle of the downlink assignment. Bundling operation relies on the HARQ entity for invoking the same HARQ process for each transmission that is part of the same bundle. After the initial transmission, pdsch-AggregationFactor-1 HARQ retransmissions follow within a bundle.

The MAC entity shall:
1> if a downlink assignment has been indicated:
\( 2> \) allocate the TB(s) received from the physical layer and the associated HARQ information to the HARQ process indicated by the associated HARQ information.
\( 1> \) if a downlink assignment has been indicated for the broadcast HARQ process:
\( 2> \) allocate the received TB to the broadcast HARQ process.
NOTE: It is up to UE implementation to allocate the received TB for multicast MCCH or broadcast MCCH or broadcast MTCH to one HARQ process.

ETSI


--- Page 60  ---


3GPP TS 38.321 version 18.2.0 Release 18
59
ETSI TS 138321 V18.2.0 (2024-08)
5.3.2.2 HARQ process

When a transmission takes place for the HARQ process, one or two (in case of downlink spatial multiplexing) TBs and the associated HARQ information are received from the HARQ entity.

For each received TB and associated HARQ information, the HARQ process shall:
\( 1> \) if the NDI, when provided, has been toggled compared to the value of the previous received transmission corresponding to this TB; or
\( 1> \) if the HARQ process is equal to the broadcast process, and this is the first received transmission for the TB according to the system information schedule indicated by RRC; or
\( 1> \) if the HARQ process is associated with a transmission indicated with a MCCH-RNTI for MBS broadcast, and this is the first received transmission for the TB according to the broadcast MCCH schedule indicated by RRC; or
\( 1> \) if the HARQ process is associated with a transmission indicated with a Multicast MCCH-RNTI for MBS multicast in RRC_INACTIVE, and this is the first received transmission for the TB according to the multicast MCCH schedule indicated by RRC; or
\( 1> \) if the HARQ process is associated with a transmission indicated with a G-RNTI for MBS broadcast, and this is the first received transmission for the TB according to the MTCH schedule indicated by RRC or according to the scheduling indicated by DCI as specified in TS 38.214 [7]; or
\( 1> \) if this is the very first received transmission for this TB (i.e there is no previous NDI for this TB):
\( 2> \) consider this transmission to be a new transmission.
1> else:
\( 2> \) consider this transmission to be a retransmission.
The MAC entity then shall:
\( 1> \) if this is a new transmission:
\( 2> \) attempt to decode the received data.
\( 1> \) else if this is a retransmission:
\( 2> \) if the data for this TB has not yet been successfully decoded:
\( 3> \) instruct the physical layer to combine the received data with the data currently in the soft buffer for this TB and attempt to decode the combined data.
\( 1> \) if the data which the MAC entity attempted to decode was successfully decoded for this TB; or
\( 1> \) if the data for this TB was successfully decoded before:
\( 2> \) if the HARQ process is equal to the broadcast process:
\( 3> \) deliver the decoded MAC PDU to upper layers.
\( 2> \) else if this is the first successful decoding of the data for this TB:
\( 3> \) deliver the decoded MAC PDU to the disassembly and demultiplexing entity.
1> else:
\( 2> \) instruct the physical layer to replace the data in the soft buffer for this TB with the data which the MAC entity attempted to decode.
\( 1> \) if the HARQ process is associated with a transmission indicated with a Temporary C-RNTI and the Contention Resolution is not yet successful (see clause 5.1.5); or

ETSI


--- Page 61  ---


3GPP TS 38.321 version 18.2.0 Release 18
60
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) if the HARQ process is associated with a transmission indicated with a MSGB-RNTI and the Random Access procedure is not yet successfully completed (see clause 5.1.4a); or
\( 1> \) if the HARQ process is equal to the broadcast process; or
1> if the HARQ process is associated with a transmission indicated with a MCCH-RNTI or a G-RNTI for MBS broadcast; or

1> if the HARQ process is associated with a transmission indicated with a Multicast MCCH-RNTI for MBS multicast; or

1> if the HARQ process is associated with a transmission indicated with a G-RNTI or a G-CS-RNTI or a configured downlink assignment for MBS multicast and HARQ feedback is disabled for this G-RNTI or G-CS-RNTI or the corresponding G-CS-RNTI, as specified in clause 18 of TS 38.213 [6]; or

1> if the HARQ process is associated with a transmission indicated with a G-RNTI or a G-CS-RNTI or a configured downlink assignment for MBS multicast and NACK only HARQ feedback is used for this G-RNTI or G-CSRNTI or the corresponding G-CS-RNTI and the data for this TB is successfully decoded and the transmission is not the first transmission of PDSCH where the configured downlink assignment was (re-)initialised; or
\( 1> \) if the timeAlignmentTimer, associated with the TAG containing the Serving Cell on which the HARQ feedback is to be transmitted, is stopped or expired, and the Serving Cell is not configured with two TAGs, and if the cg-SDT-TimeAlignmentTimer, if configured, is not running; or

1> if the Serving Cell on which the HARQ feedback is to be transmitted is configured with two TAGs and if the timeAlignmentTimer of the TAG, associated with the TCI state(s) used for transmitting the HARQ feedback, is stopped or expired:
\( 2> \) not instruct the physical layer to generate acknowledgement(s) of the data in this TB.
\( 1> \) else if the HARQ process is configured with disabled HARQ feedback:
2 if harq-FeedbackEnablingforSPSactive is configured with value true and the transmission is the first transmission on the configured downlink assignment after activation of the configured downlink assignment:

3> instruct the physical layer to generate acknowledgement(s) of the data in this TB.
\( 2> \) else:
3> not instruct the physical layer to generate acknowledgement(s) of the data in this TB.
1> else:
\( 2> \) instruct the physical layer to generate acknowledgement(s) of the data in this TB.
The MAC entity shall ignore NDI received in all downlink assignments on PDCCH for its Temporary C-RNTI when determining if NDI on PDCCH for its C-RNTI has been toggled compared to the value in the previous transmission.

NOTE: If the MAC entity receives a retransmission with a TB size different from the last TB size signalled for this TB , the UE behavior is left up to UE implementation.
5.3.3 Disassembly and demultiplexing

The MAC entity shall disassemble and demultiplex a MAC PDU as defined in clauses 6.1.2 and 6.1.5a.
When a MAC entity receives a MAC PDU for MAC entity's G-RNTI or G-CS-RNTI, or by the configured downlink assignment for MBS multicast containing an LCID or eLCID which is not configured, the MAC entity shall at least:
\( 1> \) discard the received subPDU.

ETSI


--- Page 62  ---


3GPP TS 38.321 version 18.2.0 Release 18
61
ETSI TS 138321 V18.2.0 (2024-08)
5.4 UL-SCH data transfer
5.4.1 UL Grant reception

Uplink grant is either received dynamically on the PDCCH , in a Random Access Response, configured semipersistently by RRC or determined to be associated with the PUSCH resource of MSGA as specified in clause 5.1.2a. The MAC entity shall have an uplink grant to transmit on the UL-SCH. To perform the requested transmissions, the MAC layer receives HARQ information from lower layers. An uplink grant addressed to CS-RNTI with NDI \( =0 \) is considered as a configured uplink grant. An uplink grant addressed to CS-RNTI with NDI \( =1 \) is considered as a dynamic uplink grant.

For a BWP configured with \( s T x-2 P \) anel, the MAC entity considers the PUSCH duration of one uplink grant overlaps with the PUSCH duration of another uplink grant if they are overlapping in time and associated with an srsResourceSetld corresponding to the same coresetPoollndex.

If the MAC entity has a C-RNTI, a Temporary C-RNTI, or CS-RNTI, the MAC entity shall for each PDCCH occasion and for each Serving Cell belonging to a TAG that has a running timeAlignmentTimer or a running cg-SDTTimeAlignmentTimer and for each grant received for this PDCCH occasion:
\( 1> \) if an uplink grant for this Serving Cell has been received on the PDCCH for the MAC entity's C-RNTI or Temporary C-RNTI; or
\( 1> \) if an uplink grant has been received in a Random Access Response:
\( 2> \) if the uplink grant is for MAC entity's C-RNTI and if the previous uplink grant delivered to the HARQ entity for the same HARQ process was either an uplink grant received for the MAC entity's CS-RNTI or a configured uplink grant:
\( 3> \) consider the NDI to have been toggled for the corresponding HARQ process regardless of the value of the NDI.
\( 2> \) if the uplink grant is for MAC entity's C-RNTI, and the identified HARQ process is configured for a configured uplink grant:
\( 3> \) start or restart the configuredGrantTimer for the corresponding HARQ process, if configured;
\( 3> \) stop the cg-RetransmissionTimer for the corresponding HARQ process, if running-
\( 2> \) stop the cg-SDT-RetransmissionTimer for the corresponding HARQ process, if running.
\( 2> \) stop the cg-RRC-RetransmissionTimer for the corresponding HARQ process, if running.
\( 2> \) if the uplink grant has been received on the PDCCH for the MAC entity's C-RNTI after the first PUSCH transmission to the Serving Cell; and
\( 2> \) if the uplink grant is for a new transmission on the same HARQ process used for the first PUSCH transmission to the Serving Cell:
\( 3> \) if there is an ongoing RACH-less handover procedure:
4> consider the RACH-less handover to be successfully completed and indicate to upper layers.
3> else if there is an ongoing RACH-less LTM cell switch:
\( 4> \) consider the LTM cell switch to be successfully completed and indicate it to upper layers.
\( 2> \) deliver the uplink grant and the associated HARQ information to the HARQ entity.
\( 1> \) else if an uplink grant for this PDCCH occasion has been received for this Serving Cell on the PDCCH for the MAC entity's CS-RNTI:
\( 2> \) if the NDI in the received HARQ information is 1 :
\( 3> \) consider the NDI for the corresponding HARQ process not to have been toggled;

ETSI


--- Page 63  ---


3GPP TS 38.321 version 18.2.0 Release 18
62
ETSI TS 138321 V18.2.0 (2024-08)

3> start or restart the configuredGrantTimer for the corresponding HARQ process, if configured;
3> stop the cg-RetransmissionTimer for the corresponding HARQ process, if running;
3> stop the cg-SDT-RetransmissionTimer for the corresponding HARQ process, if running;
\( 3> \) stop the cg-RRC-RetransmissionTimer for the corresponding HARQ process, if running;
\( 3> \) deliver the uplink grant and the associated HARQ information to the HARQ entity;
\( 3> \) if a logical channel associated with a DRB configured with survivalTimeStateSupport is multiplexed in the MAC PDU stored in the HARQ buffer for the corresponding HARQ process:
\( 4> \) trigger activation of PDCP duplication for all configured RLC entities of the DRB.
\( 2> \) else if the NDI in the received HARQ information is 0 :
\( 3> \) if PDCCH contents indicate configured grant Type 2 deactivation:
4> trigger configured uplink grant confirmation.
3> else if PDCCH contents indicate configured grant Type 2 activation:
4> trigger configured uplink grant confirmation;
4> store the uplink grant for this Serving Cell and the associated HARQ information as configured uplink grant;

4 - initialise or re-initialise the configured uplink grant for this Serving Cell to start in the associated PUSCH duration and to recur according to rules in clause 5.8.2;

4> stop the configuredGrantTimer for the corresponding HARQ process, if running;
4> stop the cg-RetransmissionTimer for the corresponding HARQ process, if running.
For each Serving Cell and each configured uplink grant, if configured and activated and available for use as specified in clause 5.8.2, the MAC entity shall:
\( 1> \) if the MAC entity is configured with lch-basedPrioritization, and the PUSCH duration of the configured uplink grant does not overlap with the PUSCH duration of an uplink grant received in a Random Access Response or with the PUSCH duration of an uplink grant addressed to Temporary C-RNTI or the PUSCH duration of a MSGA payload for this Serving Cell; or
\( 1> \) if the MAC entity is not configured with lch-basedPrioritization, and the PUSCH duration of the configured uplink grant does not overlap with the PUSCH duration of an uplink grant received on the PDCCH or in a Random Access Response or the PUSCH duration of a MSGA payload for this Serving Cell:
\( 2> \) set the HARQ Process ID to the HARQ Process ID associated with this PUSCH duration;
\( 2> \) if, for the corresponding HARQ process, the configuredGrantTimer is not running and cgRetransmissionTimer is not configured and cg-SDT-RetransmissionTimer is not configured, and cg-RRCRetransmissionTimer is not configured (i.e. new transmission):

3> if the configured uplink grant is for the initial transmission for the CG-SDT with CCCH message; or
3> if there is an ongoing CG-SDT procedure and PDCCH addressed to the MAC entity's C-RNTI has been received; or

3> if the configured uplink grant is for the first PUSCH transmission during an on-going LTM cell switch; or
3> if the configured uplink grant is for the first PUSCH transmission during an ongoing RACH-less handover procedure; or

3> if there is no ongoing CG-SDT nor ongoing RACH-less LTM cell switch nor ongoing RACH-less handover procedure:
\( 4> \) consider the NDI bit for the corresponding HARQ process to have been toggled;

ETSI


--- Page 64  ---


3GPP TS 38.321 version 18.2.0 Release 18
63
ETSI TS 138321 V18.2.0 (2024-08)

\( 4> \) deliver the configured uplink grant and the associated HARQ information to the HARQ entity.
\( 2> \) else if the cg-RetransmissionTimer for the corresponding HARQ process is configured and not running, then for the corresponding HARQ process:
\( 3> \) if the configuredGrantTimer is not running, and the HARQ process is not pending (i.e. new transmission):

4> consider the NDI bit to have been toggled;
\( 4> \) deliver the configured uplink grant and the associated HARQ information to the HARQ entity.
\( 3> \) else if the previous uplink grant delivered to the HARQ entity for the same HARQ process was a configured uplink grant (i.e. retransmission on configured grant):
\( 4> \) deliver the configured uplink grant and the associated HARQ information to the HARQ entity.
\( 2> \) else if the cg-SDT-RetransmissionTimer is configured and not running for the corresponding HARQ process; or
\( 2> \) if the cg-RRC-RetransmissionTimer is configured and not running for the corresponding HARQ process:
3> if the configured uplink grant is for the first PUSCH transmission at RACH-less LTM cell switch (i.e., initial new transmission); or
\( 3> \) if the configured uplink grant is for the initial transmission of RACH-less handover (i.e., initial new transmission); or

3> if the configured uplink grant is for the initial transmission for the CG-SDT with CCCH message (i.e., initial new transmission); or

3> if the configuredGrantTimer is not running or not configured, and PDCCH addressed to the MAC entity's C-RNTI has been received after the initial transmission of the CG-SDT with CCCH message (i.e., subsequent new transmission):

4> consider the NDI bit to have been toggled;
\( 4> \) deliver the configured uplink grant and the associated HARQ information to the HARQ entity.
3> if PDCCH addressed to the MAC entity's C-RNTI has not been received and if the previous uplink grant delivered to the HARQ entity for the same HARQ process was a configured uplink grant for initial transmission of CG-SDT with CCCH message or for its retransmission (i.e., retransmission for initial CG-SDT transmission); or

3> if RACH-less handover is not successfully completed and if the previous uplink grant delivered to the HARQ entity for the same HARQ process was a configured uplink grant for initial transmission of RACH-less handover or for its retransmission (i.e., retransmission for initial RACH-less handover transmission); or

3> if RACH-less LTM cell switch is not successfully completed and if the previous uplink grant delivered to the HARQ entity for the same HARQ process was a configured uplink grant for first PUSCH transmission at RACH-less LTM cell switch or for its retransmission (i.e., retransmission for initial transmission at RACH-less LTM cell switch):

4> consider the NDI bit to have not been toggled;
\( 4> \) deliver the configured uplink grant and the associated HARQ information to the HARQ entity.
For configured uplink grants that are not part of a multi-PUSCH configured grant and neither configured with harq-ProcID-Offset2 nor with cg-RetransmissionTimer, the HARQ Process ID associated with the first symbol of a UL transmission is derived from the following equation:

HARQ Process ID \( =[ \) floor(CURRENT_symbol/periodicity) \( ] \) modulo nrofHARQ-Processes

ETSI


--- Page 65  ---


3GPP TS 38.321 version 18.2.0 Release 18
64
ETSI TS 138321 V18.2.0 (2024-08)

For configured uplink grants that are not part of a multi-PUSCH configured grant and configured with harq-ProcIDOffset2, the HARQ Process ID associated with the first symbol of a UL transmission is derived from the following equation:

HARQ Process ID \( =[ \) floor(CURRENT_symbol / periodicity) \( ] \) modulo nrofHARQ-Processes + harq-ProcID-Offset 2
For a multi-PUSCH configured grant (as specified in clause 5.8.2) configured with neither harq-ProcID-Offset2 nor cgRetransmissionTimer, the HARQ Process ID associated with the first symbol of a UL transmission is derived from the following equation:

HARQ Process \( \mathrm{ID}=[ \) nrofSilotsInCG-Period × floor \( ( \) CURRENT_symbol \( / \) periodicity \( )+ \) ID_OFFSET \( ] \) modulo nrofHARQ-Processes

For a multi-PUSCH configured grant configured with harq-ProcID-Offset2, the HARQ Process ID associated with the first symbol of a UL transmission is derived from the following equation:

HARQ Process \( [\mathrm{D}=[ \) nrofSlotsInCG-Period × floor \( ( \) CURRENT_symbol \( / \) periodicity \( )+ \) [D_OFFSET] modulo nrofHARQ-Processes + harq-ProcID-Offset 2
where, if cg-SDT-PeriodicityExt (as defined in TS 38.331 [5]) is not configured, CURRENT_symbol \( = \) (SFN × numberOfSlotsPerFrame × numberOfSymbolsPerSlot + slot number in the frame × numberOfSymbolsPerSlot + symbol number in the slot), and numberOfSlotsPerFrame and numberOfSymbolsPerSlot refer to the number of consecutive slots per frame and the number of consecutive symbols per slot, respectively as specified in TS 38.211 [8]; alternatively, if cg-SDT-PeriodicityExt (as defined in TS 38.331 [5]) is configured, CURRENT_symbol \( = \) ((H-SFN × numberOfSFNperH-SFN + SFN ) × numberOfSlotsPerFrame × numberOfSymbolsPerSlot + slot number in the frame × numberOfSymbolsPerSlot + symbol number in the slot), and numberOfSFNperH-SFN, numberOfSlotsPerFrame and numberOfSymbolsPerSlot refer to the number of consecutive frames per H-SFN, the number of consecutive slots per frame and the number of consecutive symbols per slot, respectively as specified in TS 38.211 [8]. For a multi-PUSCH configured grant, ID_OFFSET equals 0 for the first configured uplink grant within a periodicity of the configuration and K for the \( \mathrm{K}^{\text {th }}(1 \leq \mathrm{K}< \) nrofSiotsInCG-Period \( ) \) valid configured uplink grant after the first configured uplink grant within the same periodicity. A configured uplink grant in a multi-PUSCH configured grant is considered valid if it satisfies the conditions specified in clause 6.1 in TS 38.214 [7].

For configured uplink grants configured with cg-RetransmissionTimer, the UE implementation selects an HARQ Process ID among the HARQ process IDs available for the configured grant configuration. If the MAC entity is configured with intraCG-Prioritization, for HARQ Process ID selection, the UE shall prioritize the HARQ Process ID with the highest priority, where the priority of HARQ process is determined by the highest priority among priorities of the logical channels that are multiplexed (i.e. the MAC PDU to transmit is already stored in the HARQ buffer) or have data available that can be multiplexed (i.e. the MAC PDU to transmit is not stored in the HARQ buffer) in the MAC PDU, according to the mapping restrictions as described in clause 5.4.3.1.2. If the MAC entity is configured with intraCG-Prioritization, for HARQ Process ID selection among initial transmission and retransmission with equal priority, the UE shall prioritize retransmissions before initial transmissions. The priority of a HARQ Process for which no data for logical channels is multiplexed or can be multiplexed in the MAC PDU is lower than the priority of a HARQ Process for which data for any logical channels is multiplexed or can be multiplexed in the MAC PDU. If the MAC entity is not configured with intraCG-Prioritization, for HARQ Process [D selection, the UE shall prioritize retransmissions before initial transmissions. The UE shall toggle the NDI in the CG-UCI for new transmissions and not toggle the NDI in the CG-UCI in retransmissions.

NOTE 1: If a configured uplink grant is associated with a multi-PUSCH configured grant, CURRENT_symbol refers to the symbol index of the first transmission occasion in the first configured uplink grant within the same periodicity. Otherwise, CURRENT_symbol refers to the symbol index of the first transmission occasion of a bundle of configured uplink grant.

NOTE 2: A HARQ process is configured for a configured uplink grant where neither harq-ProcID-Offset nor harq-ProcID-Offset 2 is configured, if the configured uplink grant is activated and the associated HARQ process ID is less than nrofHARQ-Processes. A HARQ process is configured for a configured uplink grant where harq-ProcID-Offset 2 is configured, if the configured uplink grant is activated and the associated HARQ process ID is greater than or equal to harq-ProcID-Offset2 and less than sum of harq-ProcID-Offset 2 and nrofHARQ-Processes for the configured grant configuration.

ETSI


--- Page 66  ---


3GPP TS 38.321 version 18.2.0 Release 18
65
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 3: If the MAC entity receives a grant in a Random Access Response (i.e. MAC RAR or fallbackRAR), or addressed to Temporary C-RNTI or determines a grant as specified in clause 5.1.2a for MSGA payload and if the MAC entity also receives an overlapping grant for its C-RNTI or CS-RNTI, requiring concurrent transmissions on the SpCell, the MAC entity may choose to continue with either the grant for its RA-RNTI/Temporary C-RNTI/MSGB-RNTI/the MSGA payload transmission or the grant for its CRNTI or CS-RNTI.

NOTE 4: In case of unaligned SFN across carriers in a cell group, the SFN of the concerned Serving Cell is used to calculate the HARQ Process ID used for configured uplink grants.

NOTE 5: If \( c g \)-RetransmissionTimer is not configured, a HARQ process is not shared between different configured grant configurations in the same BWP.

For the MAC entity configured with lch-basedPrioritization, priority of an uplink grant is determined by the highest priority among priorities of the logical channels that are multiplexed (i.e. the MAC PDU to transmit is already stored in the HARQ buffer) or have data available that can be multiplexed (i.e. the MAC PDU to transmit is not stored in the HARQ buffer) in the MAC PDU, according to the mapping restrictions as described in clause 5-4.3.1.2. The priority of an uplink grant for which no data for logical channels is multiplexed or can be multiplexed in the MAC PDU is lower than either the priority of an uplink grant for which data for any logical channels is multiplexed or can be multiplexed in the MAC PDU or the priority of the logical channel triggering an SR.

For the MAC entity configured with lch-basedPrioritization, if the corresponding PUSCH transmission of a configured uplink grant is cancelled by CI-RNTI as specified in clause 11.2A of TS 38.213 [6] or cancelled by a high PHY-priority PUCCH transmission as specified in clause 9 of TS 38.213 [6], this configured uplink grant is considered as a deprioritized uplink grant. If this de-prioritized uplink grant is configured with autonomousTx, the configuredGrantTimer for the corresponding HARQ process of this de-prioritized uplink grant shall be stopped if it is running. If this deprioritized uplink grant is configured with autonomousTx, the cg-RetransmissionTimer for the corresponding HARQ process of this de-prioritized uplink grant shall be stopped if it is running.

When the MAC entity is configured with lch-basedPrioritization, for each uplink grant delivered to the HARQ entity and whose associated PUSCH can be transmitted by lower layers, the MAC entity shall:
\( 1> \) if this uplink grant is received in a Random Access Response (i.e in a MAC RAR or fallback RAR), or addressed to Temporary C-RNTI, or is determined as specified in clause 5.1.2a for the transmission of the MSGA payload:
\( 2> \) consider this uplink grant as a prioritized uplink grant.
\( 1> \) else if this uplink grant is addressed to CS-RNTI with NDI \( =1 \) or C-RNTI:
\( 2> \) if there is no overlapping PUSCH duration of a configured uplink grant which was not already de-prioritized, in the same BWP, whose priority is higher than the priority of the uplink grant; and
\( 2> \) if there is no overlapping PUCCH resource with an SR transmission which was not already de-prioritized and the simultaneous transmission of the SR and the uplink grant is not allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCH-Groups or simultaneousPUCCH-PUSCH-SamePriority or simultaneousPUCCH-PUSCH-SamePriority-SecondaryPUCCHgroup, and the priority of the logical channel that triggered the SR is higher than the priority of the uplink grant:
\( 3> \) consider this uplink grant as a prioritized uplink grant;
\( 3> \) consider the other overlapping uplink grant(s), if any, as a de-prioritized uplink grant(s);
\( 3> \) consider the other overlapping SR transmission(s), if any, as a de-prioritized SR transmission(s), except for the SR transmission(s) whose simultaneous transmission is allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCH-Groups or simultaneous PUCCH-PUSCH-SamePriority or simultaneousPUCCH-PUSCH-SamePriority-SecondaryPUCCHgroup;

3> if the de-prioritized uplink grant(s) is a configured uplink grant configured with autonomous \( T x \) whose PUSCH has already started:

4> stop the configuredGrantTimer for the corresponding HARQ process of the de-prioritized uplink grant(s);

ETSI


--- Page 67  ---


3GPP TS 38.321 version 18.2.0 Release 18
66
ETSI TS 138321 V18.2.0 (2024-08)

\( 4> \) stop the cg-RetransmissionTimer for the corresponding HARQ process of the de-prioritized uplink grant(s).
\( 1> \) else if this uplink grant is a configured uplink grant:
\( 2> \) if there is no overlapping PUSCH duration of another configured uplink grant which was not already deprioritized, in the same BWP, whose priority is higher than the priority of the uplink grant; and
\( 2> \) if there is no overlapping PUSCH duration of an uplink grant addressed to CS-RNTI with NDI \( =1 \) or CRNTI which was not already de-prioritized, in the same BWP, whose priority is higher than or equal to the priority of the uplink grant; and
\( 2> \) if there is no overlapping PUCCH resource with an SR transmission which was not already de-prioritized and the simultaneous transmission of the SR and the uplink grant is not allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCH-Groups or simultaneousPUCCH-PUSCH-SamePriority or simultaneousPUCCH-PUSCH-SamePriority-SecondaryPUCCHgroup, and the priority of the logical channel that triggered the SR is higher than the priority of the uplink grant:
\( 3> \) consider this uplink grant as a prioritized uplink grant;
\( 3> \) consider the other overlapping uplink grant(s), if any, as a de-prioritized uplink grant(s);
\( 3> \) if the de-prioritized uplink grant(s) is a configured uplink grant configured with autonomous \( T x \) whose PUSCH has already started:

4> stop the configuredGrantTimer for the corresponding HARQ process of the de-prioritized uplink grant(s);
\( 4> \) stop the cg-RetransmissionTimer for the corresponding HARQ process of the de-prioritized uplink grant(s).
\( 3> \) consider the other overlapping SR transmission(s), if any, as a de-prioritized SR transmission(s), except for the SR transmission(s) whose simultaneous transmission is allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCH-Groups or simultaneousPUCCH-PUSCH-SamePriority or simultaneousP UCCH-PUSCH-SamePriority-SecondaryPUCCHgroup-

NOTE 6: If the MAC entity is configured with ch-basedPrioritization and if there is overlapping PUSCH duration of at least two configured uplink grants whose priorities are equal, the prioritized uplink grant is determined by UE implementation.

NOTE 7: If the MAC entity is not configured with lch-basedPrioritization and if there is overlapping PUSCH duration of at least two configured uplink grants, it is up to UE implementation to choose one of the configured uplink grants.

NOTE 8: If the MAC entity is configured with lch-basedPrioritization, the MAC entity does not take UCI multiplexing according to the procedure specified in TS 38.213 [6] into account when determining whether the PUSCH duration of an uplink grant overlaps with the PUCCH resource for an SR transmission.
5.4.2 HARQ operation
5.4.2.1 HARQ Entity

The MAC entity includes a HARQ entity for each Serving Cell with configured uplink (including the case when it is configured with supplementaryUplink), which maintains a number of parallel HARQ processes.

The number of parallel UL HARQ processes per HARQ entity is specified in TS 38.214 [7].
Each HARQ process supports one or two TBs.
Each HARQ process is associated with a HARQ process identifier. For UL transmission with UL grant in RA Response or for UL transmission for MSGA payload, HARQ process identifier 0 is used.

ETSI


--- Page 68  ---


3GPP TS 38.321 version 18.2.0 Release 18
67
ETSI TS 138321 V18.2.0 (2024-08)

NOTE: When a single DCI is used to schedule multiple PUSCH , the UE is allowed to map generated TB(s) internally to different HARQ processes in case of LBT failure(s), i.e. UE may transmit a new TB on any HARQ process in the grants that have the same TBS, the same RV and the NDIs indicate new transmission.

The maximum number of transmissions of a TB within a bundle of the dynamic grant or configured grant or the uplink grant received in a MAC RAR is given by REPETITION_NUMBER as follows:
- For a dynamic grant, REPETITION_NUMBER is set to a value provided by lower layers, as specified in clause 6.1.2.1 of TS 38.214 [7];
- For a configured grant, REPETITION_NUMBER is set to a value provided by lower layers, as specified in clause 6.1.2.3 of TS 38.214 [7];
- For an uplink grant received in a MAC RAR, REPETITION_NUMBER is set to a value provided by lower layers, as specified in clause 6.1.2.1 of TS 38.214 [7].

If REPETITION_NUMBER \( >1 \), after the first transmission within a bundle, at most REPETITION_NUMBER -1 HARQ retransmissions follow within the bundle. For both dynamic grant and configured uplink grant, and uplink grant received in a MAC RAR bundling operation relies on the HARQ entity for invoking the same HARQ process for each transmission that is part of the same bundle. Within a bundle, HARQ retransmissions are triggered without waiting for feedback from previous transmission according to REPETITION_NUMBER for a dynamic grant or configured uplink grant or uplink grant received in a MAC RAR unless they are terminated as specified in clause 6.1 of TS 38.214 [7]. Each transmission within a bundle is a separate uplink grant delivered to the HARQ entity.

For each transmission within a bundle of the dynamic grant or uplink grant received in a MAC RAR, the sequence of redundancy versions is determined according to clause 6.1.2.1 of TS 38.214 [7]. For each transmission within a bundle of the configured uplink grant, the sequence of redundancy versions is determined according to clause 6.1.2.3 of TS 38.214 [7].

For each uplink grant, the HARQ entity shall:
\( 1> \) identify the HARQ process associated with this grant, and for each identified HARQ process:
\( 2> \) if the received grant was not addressed to a Temporary C-RNTI on PDCCH, and the NDI provided in the associated HARQ information has been toggled compared to the value in the previous transmission of this TB of this HARQ process; or

2 if the uplink grant was received on PDCCH for the C-RNTI and the HARQ buffer of the identified process is empty; or
\( 2> \) if the uplink grant was received in a Random Access Response (i.e. in a MAC RAR or a fallback RAR); or
\( 2> \) if the uplink grant was determined as specified in clause 5.1.2a for the transmission of the MSGA payload; or
\( 2> \) if the uplink grant was received on PDCCH for the C-RNTI in ra-ResponseWindow and this PDCCH successfully completed the Random Access procedure initiated for beam failure recovery; or
\( 2> \) if the uplink grant is part of a bundle of the configured uplink grant, and may be used for initial transmission according to clause 6.1.2.3 of TS 38.214 [7], and if no MAC PDU has been obtained for this bundle:

3> if there is a MAC PDU in the MSGA buffer and the uplink grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload was selected; or

3> if there is a MAC PDU in the MSGA buffer and the uplink grant was received in a fallbackRAR and this fallbackRAR successfully completed the Random Access procedure:
\( 4> \) obtain the MAC PDU to transmit from the MSGA buffer.
3> else if there is a MAC PDU in the Msg3 buffer and the uplink grant was received in a fallbackRAR:
4> obtain the MAC PDU to transmit from the Msg3 buffer.
3> else if there is a MAC PDU in the Msg3 buffer and the uplink grant was received in a MAC RAR; or

ETSI


--- Page 69  ---


3GPP TS 38.321 version 18.2.0 Release 18
68
ETSI TS 138321 V18.2.0 (2024-08)

3> if there is a MAC PDU in the Msg3 buffer and the uplink grant was received on PDCCH for the C-RNTI in ra-ResponseWindow and this PDCCH successfully completed the Random Access procedure initiated for beam failure recovery:

4> obtain the MAC PDU to transmit from the Msg3 buffer.
4 - if the uplink grant size does not match with size of the obtained MAC PDU; and
4> if the Random Access procedure was successfully completed upon receiving the uplink grant:
5> indicate to the Multiplexing and assembly entity to include MAC subPDU(s) carrying MAC SDU from the obtained MAC PDU in the subsequent uplink transmission;
\( 5> \) obtain the MAC PDU to transmit from the Multiplexing and assembly entity.
\( 3> \) else if this uplink grant is a configured grant configured with autonomous \( T x \); and
\( 3> \) if the previous configured uplink grant, in the BWP, for this HARQ process was not prioritized; and
\( 3> \) if a MAC PDU had already been obtained for this HARQ process; and
\( 3> \) if the uplink grant size matches with size of the obtained MAC PDU; and
\( 3> \) if none of PUSCH transmission(s) of the obtained MAC PDU has been completely performed:
4> consider the MAC PDU has been obtained.
3> else if the MAC entity is not configured with lch-basedPrioritization; or
3> if this uplink grant is a prioritized uplink grant:
4> obtain the MAC PDU to transmit from the Multiplexing and assembly entity, if any;
3> if a MAC PDU to transmit has been obtained:
\( 4> \) if the uplink grant is not a configured grant configured with autonomous \( T x \); or
4> if the uplink grant is a prioritized uplink grant:
\( 5> \) deliver the MAC PDU and the uplink grant and the HARQ information of the TB to the identified HARQ process;
\( 5> \) instruct the identified HARQ process to trigger a new transmission;
\( 5> \) if the uplink grant is a configured uplink grant:
6> start or restart the configuredGrantTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers;
\( 6> \) start or restart the cg-RetransmissionTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers.
\( 6> \) if the configured uplink grant is for the initial transmission for CG-SDT with CCCH message:
7> start or restart the cg-SDT-RetransmissionTimer, if configured, for the corresponding HARQ process when the transmission is performed.
\( 6> \) if the configured uplink grant is for the initial transmission at RACH-less LTM cell switch; or
6> if the configured uplink grant is for the initial transmission of RACH-less handover:
7> start or restart the cg-RRC-RetransmissionTimer, if configured, for the corresponding HARQ process when the transmission is performed.
\( 5> \) if the uplink grant is addressed to C-RNTI, and the identified HARQ process is configured for a configured uplink grant:

ETSI


--- Page 70  ---


3GPP TS 38.321 version 18.2.0 Release 18
69
ETSI TS 138321 V18.2.0 (2024-08)

6> start or restart the configuredGrantTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers.
\( 5> \) if cg-RetransmissionTimer is configured for the identified HARQ process; and
\( 5> \) if the transmission is performed and LBT failure indication is received from lower layers:
\( 6> \) consider the identified HARQ process as pending.
\( 3> \) else:
\( 4> \) flush the HARQ buffer of the identified HARQ process.
\( 2> \) else (i.e retransmission):
\( 3> \) if the uplink grant received on PDCCH was addressed to CS-RNTI and if the HARQ buffer of the identified process is empty; or
\( 3> \) if the uplink grant is part of a bundle and if no MAC PDU has been obtained for this bundle; or
\( 3> \) if the uplink grant is part of a bundle of the configured uplink grant, and the PUSCH duration of the uplink grant overlaps with an uplink grant received in a Random Access Response (i.e. MAC RAR or fallbackRAR) or an uplink grant determined as specified in clause 5.1 .2 a for MSGA payload for this Serving Cell; or
\( 3> \) if the MAC entity is not configured with lch-basedPrioritization and the BWP is not configured with \( s T x \) 2Panel, and if this uplink grant is part of a bundle of the configured uplink grant and the PUSCH duration of the uplink grant overlaps with a PUSCH duration of another uplink grant received on the PDCCH; or
\( 3> \) if the MAC entity is not configured with lch-basedPrioritization and the BWP is configured with sTx2Panel, and if this uplink grant is part of a bundle of the configured uplink grant associated with an srsResourceSetld corresponding to a coresetPoollndex, and the PUSCH duration of the uplink grant overlaps with a PUSCH duration of another uplink grant received on the PDCCH associated with the same coresetPoollndex; or
\( 3> \) if the MAC entity is configured with lch-basedPrioritization and this uplink grant is not a prioritized uplink grant:
\( 4> \) ignore the uplink grant.
\( 3> \) else:
4 deliver the uplink grant and the HARQ information (redundancy version) of the TB to the identified HARQ process;
\( 4> \) instruct the identified HARQ process to trigger a retransmission;
4 if the uplink grant is addressed to CS-RNTL; or
\( 4> \) if the uplink grant is addressed to C-RNTI, and the identified HARQ process is configured for a configured uplink grant:
\( 5> \) start or restart the configuredGrantTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers.

4> if the uplink grant is a configured uplink grant:
\( 5> \) if the identified HARQ process is pending:
\( 6> \) start or restart the configuredGrantTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers;
\( 5> \) start or restart the cg-RetransmissionTimer, if configured, for the corresponding HARQ process when the transmission is performed if LBT failure indication is not received from lower layers.
\( 5> \) if the configured uplink grant is for the retransmission of the initial transmission of the CG-SDT with CCCH message:

ETSI


--- Page 71  ---


3GPP TS 38.321 version 18.2.0 Release 18
70
ETSI TS 138321 V18.2.0 (2024-08)

\( 6> \) start or restart the cg-SDT-RetransmissionTimer for the corresponding HARQ process when transmission is performed.
\( 5> \) if the configured uplink grant is for the retransmission of the initial transmission of RACH-less handover or RACH-less LTM cell switch:

6> start or restart the cg-RRC-RetransmissionTimer for the corresponding HARQ process when transmission is performed.

4> if the identified HARQ process is pending and the transmission is performed and LBT failure indication is not received from lower layers:
\( 5> \) consider the identified HARQ process as not pending.
When determining if NDI has been toggled compared to the value in the previous transmission the MAC entity shall ignore NDI received in all uplink grants on PDCCH for its Temporary C-RNTI.

When configuredGrantTimer or cg-RetransmissionTimer or cg-SDT-RetransmissionTimer or cg-RRCRetransmissionTimer is started or restarted by a PUSCH transmission, it shall be started at the beginning of the first symbol of the PUSCH transmission.
5.4.2.2 HARQ process

Each HARQ process is associated with a HARQ buffer.
New transmissions are performed on the resource and with the MCS indicated on PDCCH or indicated in the Random Access Response (i.e. MAC RAR or fallbackRAR), or signalled in RRC or determined as specified in clause 5.1.2a for MSGA payload. Retransmissions are performed on the resource and, if provided, with the MCS indicated on PDCCH, or on the same resource and with the same MCS as was used for last made transmission attempt within a bundle, or on stored configured uplink grant resources and stored MCS when cg-RetransmissionTimer or cg-SDT-
RetransmissionTimer or cg-RRC-RetransmissionTimer is configured. If cg-RetransmissionTimer is configured, retransmissions with the same HARQ process may be performed on any configured grant configuration if the configured grant configurations have the same TBS. If cg-SDT-RetransmissionTimer is configured, retransmission for the initial CG-SDT transmission with the same HARQ process may be performed on any configured grant configuration if the configured grant configurations have the same TBS.

When cg-RetransmissionTimer is configured and the HARQ entity obtains a MAC PDU to transmit and LBT failure indication is received from lower layer, the corresponding HARQ process is considered to be pending. For a configured uplink grant, configured with cg-RetransmissionTimer, each associated HARQ process is considered as not pending when:
- a transmission is performed on that HARQ process and LBT failure indication is not received from lower layers; or
- the configured uplink grant is initialised and this HARQ process is not associated with another active configured uplink grant; or
- the HARQ buffer for this HARQ process is flushed.

If the HARQ entity requests a new transmission for a TB, the HARQ process shall:
\( 1> \) store the MAC PDU in the associated HARQ buffer;
\( 1> \) store the uplink grant received from the HARQ entity;
1> generate a transmission as described below.
If the HARQ entity requests a retransmission for a TB, the HARQ process shall:
\( 1> \) store the uplink grant received from the HARQ entity;
1> generate a transmission as described below.
To generate a transmission for a TB, the HARQ process shall:
\( 1> \) if the MAC PDU was obtained from the Msg3 buffer; or

ETSI


--- Page 72  ---


3GPP TS 38.321 version 18.2.0 Release 18
71
ETSI TS 138321 V18.2.0 (2024-08)

1> if the MAC PDU was obtained from the MSGA buffer; or
1> if there is no measurement gap at the time of the transmission and, in case of retransmission, the retransmission does not collide with a transmission for a MAC PDU obtained from the Msg3 buffer or the MSGA buffer:
\( 2> \) if there are neither NR sidelink transmission nor transmission of V2X sidelink communication at the time of the transmission; or
\( 2> \) if the transmission of the MAC PDU is prioritized over sidelink transmission or can be simultaneously performed with sidelink transmission:

3> instruct the physical layer to generate a transmission according to the stored uplink grant.
If a HARQ process receives downlink feedback information, the HARQ process shall:
\( 1> \) stop the cg-RetransmissionTimer, if running;
1> if acknowledgement is indicated:
\( 2> \) stop the configuredGrantTimer, if running.
If the configuredGrantTimer expires for a HARQ process, the HARQ process shall:
\( 1> \) stop the cg-RetransmissionTimer, if running;
1> stop the cg-SDT-RetransmissionTimer, if running.
\( 1> \) stop the cg-RRC-RetransmissionTimer, if running;
1> if a PDCCH addressed to the MAC entity's C-RNTI has not been received after initial transmission for the CGSDT with CCCH message to which the configuredGrantTimer corresponds:
\( 2> \) indicate failure to perform SDT procedure to the upper layer.
The transmission of the MAC PDU is prioritized over sidelink transmission or can be performed simultaneously with sidelink transmission if one of the following conditions is met:
- if there are both a sidelink grant for NR sidelink transmissionand configured grant(s) for transmission of V2X sidelink communication on SL-SCH as determined in clause 5.14.1.2.2 of TS 36.321 [22] at the time of the transmission, and neither the NR sidelink transmission is prioritized as determined in clause 5.22.1.3.1 a nor the transmission(s) of V2X sidelink communication is prioritized as determined in clause 5.14.1.2.2 of TS 36.321 [22]; or
- if there are both a sidelink grant NR sidelink transmission and configured grant(s) for transmission of V2X sidelink communication on SL-SCH as determined in clause 5.14.1.2.2 of TS 36.321 [22] at the time of the transmission, and the MAC entity is able to perform this UL transmission simultaneously with the NR sidelink transmission and/or the transmission(s) of V2X sidelink communication; or
- if there is only configured grant(s) for transmission of V2X sidelink communication on SL-SCH as determined in clause 5.14.1.2.2 of TS 36.321 [22] at the time of the transmission, and either none of the transmission(s) of V2X sidelink communication is prioritized as determined in clause 5.14.1.2.2 of TS 36.321 [22] or the MAC entity is able to perform this UL transmission simultaneously with the transmission(s) of V2X sidelink communication; or
- if there is only a sidelink grant for NR sidelink transmission at the time of the transmission, and if the NR sidelink transmission is not prioritized as determined in clause 5.22.1.3.1a, or there is a sidelink grant for NR sidelink transmission at the time of the transmission and the MAC entity is able to perform this UL transmission simultaneously with the NR sidelink transmission; or
- if there are both a sidelink grant for NR sidelink transmission and configured grant(s) for transmission of V2X sidelink communication on SL-SCH as determined in clause 5.14.1.2.2 of TS 36.321 [22] at the time of the transmission, and either only the of NR sidelink transmission is prioritized as determined in clause 5.22.1.3.1a or only the transmission(s) of V2X sidelink communication is prioritized as determined in clause 5.14.1-2.2 of TS 36.321 [22] and the MAC entity is able to perform this UL transmission simultaneously with the prioritized NR sidelink transmission or the transmission of V2X sidelink communication:

ETSI


--- Page 73  ---


3GPP TS 38.321 version 18.2.0 Release 18
72
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 1: Among the UL transmissions where the MAC entity is able to perform the transmission of NR sidelink communication prioritized simultaneously, if there are more than one UL transmission which the MAC entity is not able to perform simultaneously, it is up to UE implementation whether this UL transmission is performed.

NOTE 2: Among the UL transmissions that the MAC entity is able to perform simultaneously with all transmission(s) of V2X sidelink communication prioritized, if there are more than one UL transmission which the MAC entity is not able to perform simultaneously, it is up to UE implementation whether this UL transmission is performed.

NOTE 3: Among the UL transmissions where the MAC entity is able to perform the NR sidelink transmission prioritized simultaneously with all transmission(s) of V2X sidelink communication prioritized, if there are more than one UL transmission which the MAC entity is not able to perform simultaneously, it is up to UE implementation whether this UL transmission is performed.

NOTE 4: If there is configured grant(s) for transmission of V2X sidelink communication on SL-SCH as determined in clause 5.14.1.2.2 of TS 36.321 [22] at the time of the transmission, and the MAC entity is not able to perform this UL transmission simultaneously with the transmission(s) of V2X sidelink communication, and prioritization-related information is not available prior to the time of the transmission due to processing time restriction, it is up to UE implementation whether this UL transmission is performed.
5.4.3 Multiplexing and assembly
5.4.3.1 Logical Channel Prioritization
5.4.3.1.1 General

The Logical Channel Prioritization (LCP) procedure is applied whenever a new transmission is performed.
RRC controls the scheduling of uplink data by signalling for each logical channel per MAC entity:
- priority where an increasing priority value indicates a lower priority level;
- prioritisedBitRate which sets the Prioritized Bit Rate (PBR);
- bucketSizeDuration which sets the Bucket Size Duration (BSD).

RRC additionally controls the LCP procedure by configuring mapping restrictions for each logical channel:
- allowedSCS-List which sets the allowed Subcarrier Spacing(s) for transmission;
- maxPUSCH-Duration which sets the maximum PUSCH duration allowed for transmission;
- configuredGrantTypelAllowed which sets whether a configured grant Type 1 can be used for transmission;
- allowedServingCells which sets the allowed cell(s) for transmission;
- allowedCG-List which sets the allowed configured grant(s) for transmission;
- allowedPHY-PriorityIndex which sets the allowed PHY priority index(es) of a dynamic grant for transmission;
- allowedHARQ-mode which sets the allowed UL HARQ mode for transmission.

The following UE variable is used for the Logical channel prioritization procedure:
- Bj which is maintained for each logical channel j.

The MAC entity shall initialize Bj of the logical channel to zero when the logical channel is established.
For each logical channel \( j \), the MAC entity shall:
\( 1> \) increment \( B j \) by the product \( \mathrm{PBR} \times \mathrm{T} \) before every instance of the LCP procedure, where T is the time elapsed since Bj was last incremented;
\( 1> \) if the value of \( B j \) is greater than the bucket size (i.e. \( \mathrm{PBR} \times \mathrm{BSD} \) ):

ETSI


--- Page 74  ---


3GPP TS 38.321 version 18.2.0 Release 18
73
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) set \( B j \) to the bucket size.
NOTE: The exact moment(s) when the UE updates Bj between LCP procedures is up to UE implementation, as long as Bj is up to date at the time when a grant is processed by LCP.
5.4.3.1.2 Selection of logical channels

The MAC entity shall, when a new transmission is performed:
\( 1> \) select the logical channels for each UL grant that satisfy all the following conditions:
\( 2> \) the set of allowed Subcarrier Spacing index values in allowedSCS-List, if configured, includes the Subcarrier Spacing index associated to the UL grant; and
\( 2> \) maxPUSCH-Duration, if configured, is larger than or equal to the PUSCH transmission duration associated to the UL grant; and
\( 2> \) configuredGrantTypelAllowed, if configured, is set to true in case the UL grant is a Configured Grant Type 1; and
\( 2> \) allowedServingCells, if configured, includes the Cell information associated to the UL grant. Does not apply to logical channels associated with a DRB configured with PDCP duplication within the same MAC entity (i.e. CA duplication) when CA duplication is deactivated for this DRB in this MAC entity; and
\( 2> \) allowedCG-List, if configured, includes the configured grant index associated to the UL grant; and
2> allowedPHY-PriorityIndex, if configured, includes the priority index (as specified in clause 9 of TS 38.213 [6]) associated to the dynamic UL grant; and
\( 2> \) allowedHARQ-mode, if configured, includes the allowed UL HARQ mode for the HARQ process associated to the UL grant.

NOTE: The Subcarrier Spacing index, PUSCH transmission duration, Cell information, and priority index are included in Uplink transmission information received from lower layers for the corresponding scheduled uplink transmission.
5.4.3.1.3 Allocation of resources

Before the successful completion of the Random Access procedure initiated for DAPS handover, the target MAC entity shall not select the logical channel(s) corresponding to non-DAPS DRB(s) for the uplink grant received in a Random Access Response or the uplink grant for the transmission of the MSGA payload. The source MAC entity shall select only the logical channel(s) corresponding to DAPS DRB(s) during DAPS handover.

The MAC entity shall, when a new transmission is performed:
\( 1> \) allocate resources to the logical channels as follows:
\( 2> \) logical channels selected in clause 5.4.3.1.2 for the UL grant with \( B j>0 \) are allocated resources in a decreasing priority order. If the PBR of a logical channel is set to infinity, the MAC entity shall allocate resources for all the data that is available for transmission on the logical channel before meeting the PBR of the lower priority logical channel(s);
\( 2> \) decrement \( B j \) by the total size of MAC SDUs served to logical channel \( j \) above;
\( 2> \) if any resources remain, all the logical channels selected in clause 5.4.3.1.2 are served in a strict decreasing priority order (regardless of the value of \( B j \) ) until either the data for that logical channel or the UL grant is exhausted, whichever comes first. Logical channels configured with equal priority should be served equally.

NOTE 1: The value of \( B j \) can be negative.
If the MAC entity is requested to simultaneously transmit multiple MAC PDUs, or if the MAC entity receives the multiple UL grants within one or more coinciding PDCCH occasions (i.e on different Serving Cells), it is up to UE implementation in which order the grants are processed.

The UE shall also follow the rules below during the scheduling procedures above:

ETSI


--- Page 75  ---


3GPP TS 38.321 version 18.2.0 Release 18
74
ETSI TS 138321 V18.2.0 (2024-08)
- the UE should not segment an RLC SDU (or partially transmitted SDU or retransmitted RLC PDU) if the whole SDU (or partially transmitted SDU or retransmitted RLC PDU) fits into the remaining resources of the associated MAC entity;
- if the UE segments an RLC SDU from the logical channel, it shall maximize the size of the segment to fill the grant of the associated MAC entity as much as possible;
- the UE should maximise the transmission of data;
- if the MAC entity is given a UL grant size that is equal to or larger than 8 bytes (when eLCID is not used) or 10 bytes (when eLCID is used) while having data available and allowed (according to clause 5.4.3.1) for transmission, the MAC entity shall not transmit only padding BSR and/or padding.

The MAC entity shall:
\( 1> \) if the MAC entity is configured with enhancedSkipUplinkTxDynamic with value true and the grant indicated to the HARQ entity was addressed to a C-RNTI, or if the MAC entity is configured with enhancedSkipUplinkTxConfigured with value true and the grant indicated to the HARQ entity is a configured uplink grant:
\( 2> \) if there is no UCI to be multiplexed on this PUSCH transmission as specified in TS 38.213 [6]; and
\( 2> \) if there is no aperiodic CSI requested for this PUSCH transmission as specified in TS 38.212 [9]; and
\( 2> \) if the MAC PDU includes zero MAC SDUs; and
\( 2> \) if the MAC PDU includes only the periodic BSR and there is no data available for any LCG, or the MAC PDU includes only the padding BSR:
\( 3> \) not generate a MAC PDU for the HARQ entity.
1> else if the MAC entity is configured with skipUplinkTxDynamic with value true and the grant indicated to the HARQ entity was addressed to a C-RNTI, or the grant indicated to the HARQ entity is a configured uplink grant:
\( 2> \) if there is no aperiodic CSI requested for this PUSCH transmission as specified in TS 38.212 [9]; and
\( 2> \) if the MAC PDU includes zero MAC SDUs; and
\( 2> \) if the MAC PDU includes only the periodic BSR and there is no data available for any LCG, or the MAC PDU includes only the padding BSR:
\( 3> \) not generate a MAC PDU for the HARQ entity.
Logical channels shall be prioritised in accordance with the following order (highest priority listed first):
- MAC CE for C-RNTI, or data from UL-CCCH;
- MAC CE for (Enhanced) BFR, or MAC CE for Configured Grant Confirmation, or MAC CE for Multiple Entry Configured Grant Confirmation;
- MAC CE for Sidelink Configured Grant Confirmation;
- MAC CE for LBT failure;
- MAC CE for SL LBT failure according to clause 5.31.2;
- MAC CE for Timing Advance Report;
- MAC CE for Delay Status Report;
- MAC CE for SL-BSR prioritized according to clause 5.22.1.6;
- MAC CE for (Extended) BSR, with exception of BSR included for padding;
- MAC CE for (Enhanced) Single Entry PHR, or MAC CE for (Enhanced) Multiple Entry PHR or MAC CE for Single Entry PHR with assumed PUSCH, or MAC CE for Multiple Entry PHR with assumed PUSCH, or MAC

ETSI


--- Page 76  ---


3GPP TS 38.321 version 18.2.0 Release 18
75
ETSI TS 138321 V18.2.0 (2024-08)

CE for Enhanced Single Entry PHR for multiple TRP or MAC CE for Enhanced Multiple Entry PHR for multiple TRP, or MAC CE for Enhanced Single Entry PHR for multiple TRP STx2P or MAC CE for Enhanced Multiple Entry PHR for multiple TRP STx2P;
- MAC CE for Positioning Measurement Gap Activation/Deactivation Request;
- MAC CE for the number of Desired Guard Symbols;
- MAC CE for Case-6 Timing Request;
- MAC CE for (Extended) Pre-emptive BSR;
- MAC CE for SL-BSR, with exception of SL-BSR prioritized according to clause 5.22.1.6 and SL-BSR included for padding;
- MAC CE for IAB-MT Recommended Beam Indication, or MAC CE for Desired IAB-MT PSD range, or MAC CE for Desired DL Tx Power Adjustment;
- data from any Logical Channel, except data from UL-CCCH;
- MAC CE for Recommended bit rate query;
- MAC CE for BSR included for padding;
- MAC CE for SL-BSR included for padding.

NOTE 2: Prioritization among MAC CEs of same priority is up to UE implementation.
The MAC entity shall prioritize any MAC CE listed in a higher order than 'data from any Logical Channel, except data from UL-CCCH' over NR sidelink transmission.
5.4.3.2 Multiplexing of MAC Control Elements and MAC SDUs

The MAC entity shall multiplex MAC CEs and MAC SDUs in a MAC PDU according to clauses 5.4.3.1 and 6.1.2.
NOTE: Content of a MAC PDU does not change after being built for transmission on a dynamic uplink grant, regardless of LBT outcome.
5.4.4 Scheduling Request

The Scheduling Request (SR) is used for requesting UL-SCH resources for new transmission.
The MAC entity may be configured with zero, one, or more SR configurations. An SR configuration consists of a set of PUCCH resources for SR across different BWPs and cells. For a logical channel or for SCell beam failure recovery (see clause 5.17) and for consistent LBT failure recovery (see clause 5.21), at most one PUCCH resource for SR is configured per BWP. For a logical channel serving a radio bearer configured with SDT, PUCCH resource for SR is not configured for SDT. For beam failure recovery of BFD-RS set(s) of Serving Cell, up to two PUCCH resources for SR is configured per BWP. For positioning measurement gap activation/deactivation request, a dedicated SR configuration is configured.

Each SR configuration corresponds to one or more logical channels and/or to SCell beam failure recovery and/or to consistent LBT failure recovery and/or to beam failure recovery of a BFD-RS set and/or to positioning measurement gap activation/deactivation request. Each logical channel, SCell beam failure recovery, beam failure recovery of a BFDRS set and consistent LBT failure recovery, may be mapped to zero or one SR configuration, which is configured by RRC. The SR configuration of the logical channel that triggered a BSR (clause 5.4.5) or a DSR (clause 5.4.9) or the SCell beam failure recovery or the beam failure recovery of a BFD-RS set or the consistent LBT failure recovery (clause 5.21) (if such a configuration exists) or positioning measurement gap activation/deactivation request (clause 5.25 ) is considered as corresponding SR configuration for the triggered SR. Any SR configuration may be used for an SR triggered by Pre-emptive BSR (clause 5.4.7) or Timing Advance reporting (clause 5.4.8).

RRC configures the following parameters for the scheduling request procedure:
- sr-ProhibitTimer (per SR configuration);
- sr-TransMax (per SR configuration).

ETSI


--- Page 77  ---


3GPP TS 38.321 version 18.2.0 Release 18
76
ETSI TS 138321 V18.2.0 (2024-08)

The following UE variables are used for the scheduling request procedure:
- SR_COUNTER (per SR configuration).

If an SR is triggered and there are no other SRs pending corresponding to the same SR configuration, the MAC entity shall set the SR_COUNTER of the corresponding SR configuration to 0 .

When an SR is triggered, it shall be considered as pending until it is cancelled.
All pending SR(s) for BSR triggered according to the BSR procedure (clause 5.4.5) prior to the MAC PDU assembly shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the MAC PDU is transmitted and this PDU includes a Long, Refined Long or Short BSR MAC CE which contains buffer status up to (and including) the last event that triggered a BSR (see clause 5.4.5) prior to the MAC PDU assembly. All pending SR(s) for BSR triggered according to the BSR procedure (clause 5.4.5) shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the UL grant(s) can accommodate all pending data available for transmission.

The MAC entity shall for each pending SR not triggered according to the BSR procedure (clause 5.4.5) for a Serving Cell:

1> if this SR was triggered by Pre-emptive BSR procedure (see clause 5.4.7) prior to the MAC PDU assembly and a MAC PDU containing the relevant Pre-emptive BSR MAC CE is transmitted; or

1> if this SR was triggered by beam failure recovery (see clause 5.17) of an SCell and a MAC PDU is transmitted and this PDU includes a MAC CE for BFR which contains beam failure recovery information for this SCell; or

1> if this SR was triggered by beam failure recovery (see clause 5.17) for a BFD-RS set of a Serving Cell and a MAC PDU is transmitted and this PDU includes an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE which contains beam failure recovery information for this BFD-RS set of the Serving Cell; or
\( 1> \) if this SR was triggered by beam failure recovery (see clause 5.17) of an SCell and this SCell is deactivated (see clause 5.9); or

1> if this SR was triggered by beam failure recovery (see clause 5.17) for a BFD-RS set of an SCell and this SCell is deactivated (see clause 5.9); or
\( 1> \) if the SR is triggered by positioning measurement gap activation/deactivation request (see clause 5.25 ) and the Positioning Measurement Gap Activation/Deactivation Request MAC CE that triggers the SR has already been cancelled; or

1> if this SR was triggered by consistent LBT failure recovery (see clause 5.21) of an SCell and a MAC PDU is transmitted and the MAC PDU includes an LBT failure MAC CE that indicates consistent LBT failure for this SCell; or
\( 1> \) if this SR was triggered by consistent LBT failure recovery (see clause 5.21) of an SCell and all the triggered consistent LBT failure(s) for this SCell are cancelled; or
\( 1> \) if this SR was triggered by Timing Advance reporting (see clause 5.4.8) and all the triggered Timing Advance reports are cancelled; or
\( 1> \) if this SR was triggered by DSR procedure (see clause 5.4.9) and the DSR that triggered the SR has been cancelled:
\( 2> \) cancel the pending SR and stop the corresponding sr-ProhibitTimer, if running.
Only PUCCH resources on a BWP which is active at the time of SR transmission occasion are considered valid.
As long as at least one SR is pending, the MAC entity shall for each pending SR:
\( 1> \) if the MAC entity has no valid PUCCH resource configured for the pending SR; and
1> if there is no ongoing RACH-less LTM cell switch; and
\( 1> \) if rach-LessHO is not configured:
\( 2> \) initiate a Random Access procedure (see clause 5.1) on the SpCell and cancel the pending SR.
\( 1> \) else, for the SR configuration corresponding to the pending SR:

ETSI


--- Page 78  ---


3GPP TS 38.321 version 18.2.0 Release 18
77
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) when the MAC entity has an SR transmission occasion on the valid PUCCH resource for SR configured; and
\( 2> \) if sr-ProhibitTimer is not running at the time of the SR transmission occasion; and
\( 2> \) if the PUCCH resource for the SR transmission occasion does not overlap with a measurement gap:
3> if the PUCCH resource for the SR transmission occasion overlaps with neither a UL-SCH resource whose simultaneous transmission with the SR is not allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCHGroups or simultaneousPUCCH-PUSCH-SamePriority or simultaneousPUCCH-PUSCH-SamePrioritySecondaryPUCCHgroup nor an SL-SCH resource; or

3> if the MAC entity is able to perform this SR transmission simultaneously with the transmission of the SLSCH resource; or

3> if the MAC entity is configured with lch-basedPrioritization, and the PUCCH resource for the SR transmission occasion does not overlap with the PUSCH duration of an uplink grant received in a Random Access Response or with the PUSCH duration of an uplink grant addressed to Temporary CRNTI or with the PUSCH duration of a MSGA payload, and the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.4 .5 overlaps with any other UL-SCH resource(s), and the physical layer can signal the SR on one valid PUCCH resource for SR, and the priority of the logical channel that triggered SR is higher than the priority of the uplink grant(s) for any UL-SCH resource(s) where the uplink grant was not already de-prioritized and its simultaneous transmission with the SR is not allowed by configuration of simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCHgroups or simultaneousPUCCH-PUSCH-SamePriority or simultaneousPUCCH-PUSCH-SamePrioritySecondaryPUCCHgroup, and the priority of the uplink grant is determined as specified in clause 5.4.1; or

3> if both sl-PrioritizationThres and ul-PrioritizationThres are configured and the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.22.1.5 overlaps with any UL-SCH resource(s) carrying a MAC PDU, and the value of the priority of the triggered SR determined as specified in clause 5.22.1.5 is lower than sl-PrioritizationThres and the value of the highest priority of the logical channel(s) in the MAC PDU is higher than or equal to ul-PrioritizationThres and any MAC CE prioritized as described in clause 5.4.3.1.3 is not included in the MAC PDU and the MAC PDU is not prioritized by upper layer according to TS 23.287 [19]; or

3> if an SL-SCH resource overlaps with the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.4.5, and the MAC entity is not able to perform this SR transmission simultaneously with the transmission of the SL-SCH resource, and either transmission on the SL-SCH resource is not prioritized as described in clause 5.22.1.3.1a or the priority value of the logical channel that triggered SR is lower than \( u l \)-PrioritizationThres, if configured; or

3> if an SL-SCH resource overlaps with the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.22.1.5, and the MAC entity is not able to perform this SR transmission simultaneously with the transmission of the SL-SCH resource, and the priority of the triggered SR determined as specified in clause 5.22.1.5 is higher than the priority of the MAC PDU determined as specified in clause 5.22.1.3.1a for the SL-SCH resource; or

3> if an SL-PRS resource overlaps with the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.4.5, and the MAC entity is not able to perform this SR transmission simultaneously with the transmission of the SL-PRS resource, and either transmission on the SL-PRS resource is not prioritized as described in clause 5.22.1.3.1a or the priority value of the logical channel that triggered SR is lower than \( u \)-PrioritizationThres, if configured; or

3> if an SL-PRS resource overlaps with the PUCCH resource for the SR transmission occasion for the pending SR triggered as specified in clause 5.22.1.5, and the MAC entity is not able to perform this SR transmission simultaneously with the transmission of the SL-PRS resource, and the priority of the triggered SR determined as specified in clause 5.22.1.5 is higher than the priority of the MAC PDU and SL-PRS, if available, determined as specified in clause 5.22.1.3.1a for the SL-PRS resource:
\( 4> \) consider the SR transmission as a prioritized SR transmission.
\( 4> \) consider the other overlapping uplink grant(s), if any, as a de-prioritized uplink grant(s), except for the overlapping uplink grant(s) whose simultaneous transmission is allowed by configuration of

ETSI


--- Page 79  ---


3GPP TS 38.321 version 18.2.0 Release 18
78
ETSI TS 138321 V18.2.0 (2024-08)

simultaneousPUCCH-PUSCH or simultaneousPUCCH-PUSCH-SecondaryPUCCHgroup or simultaneousSR-PUSCH-diffPUCCH-Groups or simultaneousPUCCH-PUSCH-SamePriority or simultaneousPUCCH-PUSCH-SamePriority-SecondaryPUCCHgroup;

4> if the de-prioritized uplink grant(s) is a configured uplink grant configured with autonomous \( T x \) whose PUSCH has already started:
\( 5> \) stop the configuredGrantTimer for the corresponding HARQ process of the de-prioritized uplink grant(s);
\( 5> \) stop the cg-RetransmissionTimer for the corresponding HARQ process of the de-prioritized uplink grant(s).
\( 4> \) if SR_COUNTER<sr-TransMax:
\( 5> \) instruct the physical layer to signal the SR on one valid PUCCH resource for SR;
\( 5> \) if LBT failure indication is not received from lower layers:
\( 6> \) increment SR_COUNTER by 1;
\( 6>s \) start the sr-ProhibitTimer.
\( 5> \) else if \( I b t \)-FailureRecoveryConfig is not configured:
\( 6> \) increment SR_COUNTER by 1 .
4> else:
\( 5> \) notify RRC to release PUCCH for all Serving Cells;
\( 5> \) notify RRC to release SRS for all Serving Cells;
\( 5> \) clear any configured downlink assignments and uplink grants;
\( 5> \) clear any PUSCH resources for semi-persistent CSI reporting;
\( 5> \) if rach-LessHO is not configured and if there is no ongoing RACH-less LTM cell switch:
\( 6> \) initiate a Random Access procedure (see clause 5.1) on the SpCell and cancel all pending SRs.
3> else:
\( 4> \) consider the SR transmission as a de-prioritized SR transmission.
NOTE 1: Except for SR for SCell beam failure recovery, the selection of which valid PUCCH resource for SR to signal SR on when the MAC entity has more than one overlapping valid PUCCH resource for the SR transmission occasion is left to UE implementation.

NOTE 2: If more than one individual SR triggers an instruction from the MAC entity to the PHY layer to signal the SR on the same valid PUCCH resource, the SR_COUNTER for the relevant SR configuration is incremented only once.

NOTE 3: When the MAC entity has pending SR for SCell beam failure recovery and the MAC entity has one or more PUCCH resources (other than PUCCH resources of pending SR for beam failure recovery of a BFD-RS set) overlapping with PUCCH resource for SCell beam failure recovery for the SR transmission occasion, the MAC entity considers only the PUCCH resource for SCell beam failure recovery as valid. When the MAC entity has pending SR for beam failure recovery of a BFD-RS set of Serving Cell and the MAC entity has one or more PUCCH resources (other than PUCCH resources of pending SR for beam failure recovery) overlapping with PUCCH resource for beam failure recovery of that BFD-RS set for the SR transmission occasion, the MAC entity considers only the PUCCH resource for beam failure recovery of that BFD-RS set as valid.

NOTE 4: For a UE operating in a semi-static channel access mode as described in TS 37.213 [18], PUCCH resources overlapping with the set of consecutive symbols where the UE does not transmit before the start of a next channel occupancy time are not considered valid.

ETSI


--- Page 80  ---


3GPP TS 38.321 version 18.2.0 Release 18
79
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 5: If the MAC entity is configured with lch-basedPrioritization, the MAC entity does not take UCI multiplexing according to the procedure specified in TS 38.213 [6] into account when determining whether the valid PUCCH resource for the SR transmission can be signalled by the physical layer and the SR transmission occasion overlaps with the PUSCH duration of an uplink grant of a MSGA payload.

NOTE 6: When the MAC entity has PUCCH resource for pending SR for SCell beam failure recovery overlapping with PUCCH resource for pending SR for beam failure recovery of a BFD-RS set for the SR transmission occasion, it's up to UE implementation to select PUCCH resource for SCell beam failure recovery or PUCCH resource for beam failure recovery of a BFD-RS set.

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for BSR, which was initiated by the MAC entity prior to the MAC PDU assembly and which has no valid PUCCH resources configured, if:
- a MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes a BSR MAC CE which contains buffer status up to (and including) the last event that triggered a BSR (see clause 5.4.5) prior to the MAC PDU assembly; or
- the UL grant(s) can accommodate all pending data available for transmission.

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for SL-BSR, which has no valid PUCCH resources configured, if:
- a MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5-1.2a for the transmission of the MSGA payload, and the ongoing Random Access procedure was initiated by the MAC entity prior to the MAC PDU assembly, and this PDU includes an SL-BSR MAC CE which contains buffer status up to (and including) the last event that triggered an SL-BSR (see clause 5.22.1.6) prior to the MAC PDU assembly; or
- the SL grant(s) can accommodate all pending data available for transmission, and the ongoing Random Access procedure was initiated by the MAC entity prior to the sidelink MAC PDU assembly.

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for SL-CSI reporting, which has no valid PUCCH resources configured, if:
- the SL grant can accommodate SL-CSI reporting MAC CE for transmission.

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for SL-DRX command indication, which has no valid PUCCH resources configured, if:
- the SL grant can accommodate SL-DRX command indication for transmission.

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for BFR of an SCell, which has no valid PUCCH resources configured, if:
- a MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU contains a MAC CE for BFR which includes beam failure recovery information of that SCell; or
- the SCell is deactivated (as specified in clause 5.9) and all triggered BFRs for SCells are cancelled.

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for BFR of a BFD-RS set of a Serving Cell, which has no valid PUCCH resources configured, if:
- a MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU contains an Enhanced BFR MAC CE or a Truncated Enhanced BFR MAC CE which includes beam failure recovery information of that BFD-RS set of the Serving Cell.

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for consistent LBT failure recovery, which has no valid PUCCH resources configured, if:
- a MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes an LBT failure MAC CE that indicates consistent LBT failure for all the SCells that triggered consistent LBT failure; or

ETSI


--- Page 81  ---


3GPP TS 38.321 version 18.2.0 Release 18
80
ETSI TS 138321 V18.2.0 (2024-08)
- all the SCells that triggered consistent LBT failure recovery are deactivated (see clause 5.9).

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for Sidelink consistent LBT failure recovery, which has no valid PUCCH resources configured, if one of the following conditions is met:
- a MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes an SL LBT failure MAC CE that indicates Sidelink consistent LBT failure; or
- all the triggered Sidelink consistent LBT failure recovery are cancelled (see clause 5.31.2).

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for positioning measurement gap activation/deactivation request, which has no valid PUCCH resources configured, if:
- the Positioning Measurement Gap Activation/Deactivation Request MAC CE that triggers the SR corresponding to the Random Access procedure has already been cancelled.

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for Timing Advance report, which has no valid PUCCH resources configured, if:
- a MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes a Timing Advance Report MAC CE (see clause 5.4.8).

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for DSR, which has no valid PUCCH resources configured, if:
- a MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes either a DSR MAC CE or
- all the PDCP SDUs associated with the DSR (see clause 5.4.9); or
- all the PDCP SDUs associated with the DSR have been discarded (see clause 5.4.9).

The MAC entity may stop, if any, ongoing Random Access procedure due to a pending SR for SL-PRS Resource Request, which has no valid PUCCH resources configured, if:
- a MAC PDU is transmitted using a UL grant other than a UL grant provided by Random Access Response or a UL grant determined as specified in clause 5.1.2a for the transmission of the MSGA payload, and this PDU includes a SL-PRS Resource Request MAC CE (see clause 5.22.1.12).
5.4.5 Buffer Status Reporting

The Buffer Status reporting (BSR) procedure is used to provide the serving gNB with information about UL data volume in the MAC entity.

RRC configures the following parameters to control the BSR:
- periodicBSR-Timer;
- retxBSR-Timer;
- logicalChannelSR-DelayTimerApplied,
- logicalChannelSR-DelayTimer;
- logicalChannelSR-Mask;
- logicalChannelGroup, logicalChannelGroupIAB-Ext;
- sdt-LogicalChannelSR-DelayTimer;
- additionalBS-TableAllowed.

ETSI


--- Page 82  ---


3GPP TS 38.321 version 18.2.0 Release 18
81
ETSI TS 138321 V18.2.0 (2024-08)

Each logical channel may be allocated to an LCG using the logicalChannelGroup. The maximum number of LCGs is eight except for [AB-MTs configured with logicalChannelGrouplAB-Ext, for which the maximum number of LCGs is 256.

The MAC entity determines the amount of UL data available for a logical channel according to the data volume calculation procedure in TSs 38.322 [3] and 38.323 [4].

A BSR shall be triggered if any of the following events occur for activated cell group:
- UL data, for a logical channel which belongs to an LCG, becomes available to the MAC entity; and either
- this UL data belongs to a logical channel with higher priority than the priority of any logical channel containing available UL data which belong to any LCG; or
- none of the logical channels which belong to an LCG contains any available UL data.
in which case the BSR is referred below to as 'Regular BSR';
- UL resources are allocated and number of padding bits is equal to or larger than the size of the Buffer Status Report MAC CE plus its subheader, in which case the BSR is referred below to as 'Padding BSR';
- retxBSR-Timer expires, and at least one of the logical channels which belong to an LCG contains UL data, in which case the BSR is referred below to as 'Regular BSR';
- periodicBSR-Timer expires, in which case the BSR is referred below to as 'Periodic BSR'.

NOTE 1: When Regular BSR triggering events occur for multiple logical channels simultaneously, each logical channel triggers one separate Regular BSR.

For Regular BSR, the MAC entity shall:
1> if the BSR is triggered for a logical channel for which logicalChannelSR-DelayTimerApplied with value true is configured by upper layers and SDT procedure is not ongoing according to clause 5.27:
\( 2> \) start or restart the logicalChannelSR-DelayTimer.
\( 1> \) else if BSR is triggered for a logical channel for which logicalChannelSR-DelayTimerApplied with value true is configured by upper layers and SDT procedure is ongoing according to clause 5.27:
\( 2> \) start or restart logicalChannelSR-DelayTimer with the value as configured by the sdt-LogicalChannelSRDelayTimer, if configured.

1> else:
\( 2> \) if running, stop the logicalChannelSR-DelayTimer.
For Regular and Periodic BSR, the MAC entity for which logicalChannelGrouplAB-Ext is not configured by upper layers shall:

1> if for at least one LCG configured with additionalBS-TableAllowed, the amount of UL data available for transmission when the MAC PDU containing the BSR is to be built is within the buffer sizes specified in Table 6.1.3.1-3:
\( 2> \) report Refined Long BSR for all LCGs which have data available for transmission;
1> else:
\( 2> \) if more than one LCG has data available for transmission when the MAC PDU containing the BSR is to be built:

3> report Long BSR for all LCGs which have data available for transmission.
\( 2> \) else if one LCG has data available and is configured with additionalBS-TableAllowed and the amount of UL data available for transmission when the MAC PDU containing the BSR is to be built is greater than the largest buffer size specified in Table 6.1.3.1-3:
\( 3> \) report Long BSR.

ETSI


--- Page 83  ---


3GPP TS 38.321 version 18.2.0 Release 18
82
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) else:
\( 3> \) report Short BSR.
For Regular and Periodic BSR, the MAC entity for which logicalChannelGroupIAB-Ext is configured by upper layers shall:
\( 1> \) if more than one LCG has data available for transmission when the MAC PDU containing the BSR is to be built:
\( 2> \) if the maximum LCG ID among the configured LCGs is 7 or lower:
\( 3> \) report Long BSR for all LCGs which have data available for transmission.
\( 2> \) else:
3> report Extended Long BSR for all LCGs which have data available for transmission.
1> else:
\( 2> \) report Extended Short BSR.
For Padding BSR, the MAC entity for which logicalChannelGrouplAB-Ext is not configured by upper layers shall:
\( 1> \) if the number of padding bits is equal to or larger than the size of the Short BSR plus its subheader but smaller than the size of the Long BSR plus its subheader:
\( 2> \) if more than one LCG has data available for transmission when the BSR is to be built:
\( 3> \) if the number of padding bits is equal to the size of the Short BSR plus its subheader:
\( 4> \) report Short Truncated BSR of the LCG with the highest priority logical channel with data available for transmission.
\( 3> \) else:
\( 4> \) report Long Truncated BSR of the LCG(s) with the logical channels having data available for transmission following a decreasing order of the highest priority logical channel (with or without data available for transmission) in each of these LCG(s), and in case of equal priority, in increasing order of LCGID.
\( 2> \) else:
\( 3> \) report Short BSR.
1> else if for at least one LCG configured with additionalBS-TableAllowed, the amount of UL data available for transmission when the MAC PDU containing the BSR is to be built is within the buffer sizes specified in Table 6.1.3.1-3 and the number of padding bits is equal to or larger than the size of the Refined Long BSR plus its subheader:
\( 2> \) report Refined Long BSR for all LCGs which have data available for transmission.
\( 1> \) else if the number of padding bits is equal to or larger than the size of the Long BSR plus its subheader:
\( 2> \) report Long BSR for all LCGs which have data available for transmission.
For Padding BSR, the MAC entity for which logicalChannelGroupIAB-Ext is configured by upper layers shall:
\( 1> \) if the number of padding bits is equal to or larger than the size of the Extended Short BSR plus its subheader but smaller than the size of the Extended Long BSR plus its subheader:
\( 2> \) if more than one LCG has data available for transmission when the BSR is to be built:
\( 3> \) if the number of padding bits is smaller than the size of the Extended Long Truncated BSR with zero Buffer Size field plus its subheader:
\( 4> \) report Extended Short Truncated BSR of the LCG with the highest priority logical channel with data available for transmission.

ETSI


--- Page 84  ---


3GPP TS 38.321 version 18.2.0 Release 18
83
ETSI TS 138321 V18.2.0 (2024-08)

3> else:
\( 4> \) report Extended Long Truncated BSR of the LCG(s) with the logical channels having data available for transmission following a decreasing order of the highest priority logical channel (with or without data available for transmission) in each of these LCG(s), and in case of equal priority, in increasing order of LCGID.
\( 2> \) else:
3> report Extended Short BSR.
\( 1> \) else if the number of padding bits is equal to or larger than the size of the Extended Long BSR plus its subheader:
\( 2> \) report Extended Long BSR for all LCGs which have data available for transmission.
For BSR triggered by retxBSR-Timer expiry, the MAC entity considers that the logical channel that triggered the BSR is the highest priority logical channel that has data available for transmission at the time the BSR is triggered.

The MAC entity shall:
1> if the Buffer Status reporting procedure determines that at least one BSR has been triggered and not cancelled:
\( 2> \) if UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the BSR MAC CE plus its subheader as a result of logical channel prioritization:
\( 3> \) instruct the Multiplexing and Assembly procedure to generate the BSR MAC CE(s) as defined in clause 6.1.3.1;

3> start or restart periodicBSR-Timer except when all the generated BSRs are long or short Truncated or Extended long or short Truncated BSRs;

3> start or restart retxBSR-Timer.
\( 2> \) if a Regular BSR has been triggered and logicalChannelSR-DelayTimer is not running:
\( 3> \) if there is no UL-SCH resource available for a new transmission; or
3> if the MAC entity is configured with configured uplink grant(s) and the Regular BSR was triggered for a logical channel for which logicalChannelSR-Mask is set to false; or

3> if the UL-SCH resources available for a new transmission do not meet the LCP mapping restrictions (see clause 5.4.3.1) configured for the logical channel that triggered the BSR:

4> trigger a Scheduling Request.
NOTE 2: UL-SCH resources are considered available if the MAC entity has been configured with, receives, or determines an uplink grant. If the MAC entity has determined at a given point in time that UL-SCH resources are available, this need not imply that UL-SCH resources are available for use at that point in time.

A MAC PDU shall contain at most one BSR MAC CE, even when multiple events have triggered a BSR. The Regular BSR and the Periodic BSR shall have precedence over the padding BSR.

The MAC entity shall restart retxBSR-Timer upon reception of a grant for transmission of new data on any UL-SCH.
All triggered BSRs may be cancelled when the UL grant(s) can accommodate all pending data available for transmission but is not sufficient to additionally accommodate the BSR MAC CE plus its subheader. All BSRs triggered prior to MAC PDU assembly shall be cancelled when a MAC PDU is transmitted and this PDU includes a Long, Refined Long, Extended Long, Short, or Extended Short BSR MAC CE which contains buffer status up to (and including) the last event that triggered a BSR prior to the MAC PDU assembly.

NOTE 3: MAC PDU assembly can happen at any point in time between uplink grant reception and actual transmission of the corresponding MAC PDU. BSR and SR can be triggered after the assembly of a MAC PDU which contains a BSR MAC CE, but before the transmission of this MAC PDU. In addition, BSR and SR can be triggered during MAC PDU assembly.

ETSI


--- Page 85  ---


3GPP TS 38.321 version 18.2.0 Release 18
84
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 4: Void
NOTE 5: If a HARQ process is configured with cg-RetransmissionTimer and if the BSR is already included in a MAC PDU for transmission on configured grant by this HARQ process, but not yet transmitted by lower layers, it is up to UE implementation how to handle the BSR content.
5.4.6 Power Headroom Reporting

The Power Headroom reporting procedure is used to provide the serving gNB with the following information:
- Type 1 power headroom: the difference between the nominal UE maximum transmit power and the estimated power for UL-SCH transmission per activated Serving Cell;
- Type 2 power headroom: the difference between the nominal UE maximum transmit power and the estimated power for UL-SCH and PUCCH transmission on SpCell of the other MAC entity (i.e. E-UTRA MAC entity in EN-DC, NE-DC, and NGEN-DC cases);
- Type 3 power headroom: the difference between the nominal UE maximum transmit power and the estimated power for SRS transmission per activated Serving Cell;
- MPE P-MPR: the power backoff to meet the MPE FR2 requirements for a Serving Cell operating on FR2;
- DPC: the adjustment to maximum output power for a given power class for a Serving Cell operating on FR1;
- \( \quad \mathrm{DPC}_{\mathrm{BC}} \) : the adjustment to maximum output power for a given power class for a Band Combination operating on FR1.

RRC controls Power Headroom reporting by configuring the following parameters:
- dpc-Reporting-FRI;
- phr-AssumedPUSCH-Reporting;
- phr-PeriodicTimer;
- phr-ProhibitTimer;
- phr-Tx-PowerFactorChange;
- phr-Type2OtherCell;
- phr-ModeOtherCG;
- multiplePHR;
- mpe-Reporting-FR2;
- mpe-ProhibitTimer;
- mpe-Threshold;
- numberOfN;
- mpe-ResourcePoolToAddModList;
- twoPHRMode.

A Power Headroom Report (PHR) shall be triggered if any of the following events occur:
- phr-ProhibitTimer expires or has expired and the path loss has changed more than phr-Tx-PowerFactorChange dB for at least one RS used as pathloss reference for one activated Serving Cell of any MAC entity of which the active DL BWP is not dormant BWP since the last transmission of a PHR in this MAC entity when the MAC entity has UL resources for new transmission;

ETSI


--- Page 86  ---


3GPP TS 38.321 version 18.2.0 Release 18
85
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 1: The path loss variation for one cell assessed above is between the pathloss measured at present time on the current pathloss reference and the pathloss measured at the transmission time of the last transmission of PHR on the pathloss reference in use at that time, irrespective of whether the pathloss reference has changed in between. The current pathloss reference for this purpose does not include any pathloss reference configured using pathlossReferenceRS-Pos in TS 38.331 [5].
- phr-PeriodicTimer expires;
- upon configuration or reconfiguration of the power headroom reporting functionality by upper layers, which is not used to disable the function;
- activation of an SCell of any MAC entity with configured uplink of which firstActiveDownlinkBWP-Id is not set to dormant BWP;
- activation of an SCG;
- addition of the PSCell except if the SCG is deactivated (i.e. PSCell is newly added or changed);
- phr-ProhibitTimer expires or has expired, when the MAC entity has UL resources for new transmission, and the following is true for any of the activated Serving Cells of any MAC entity with configured uplink:
- there are UL resources allocated for transmission or there is a PUCCH transmission on this cell, and the required power backoff due to power management (as allowed by \( \mathrm{P}-\mathrm{MPR}_{\mathrm{c}} \) as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]) for this cell has changed more than phr-Tx-PowerFactorChange dB since the last transmission of a PHR when the MAC entity had UL resources allocated for transmission or PUCCH transmission on this cell.
- Upon switching of activated BWP from dormant BWP to non-dormant DL BWP of an SCell of any MAC entity with configured uplink;
- if dpc-Reporting-FRI is configured, \( \Delta \mathrm{P}_{\text {PowerClass }} / \Delta \mathrm{P}_{\text {PowerClass, }} \mathrm{CA} / \Delta \mathrm{P}_{\text {PowerClass, }} \mathrm{EN}-\mathrm{DC} / \Delta \mathrm{P}_{\text {PowerClass, }} \mathrm{NR}-\mathrm{DC} \) reporting is triggered upon uplink duty cycle exceedance or upon return to the power class after the duty cycle exceedance, as specified in TS 38.101-1 [14] and TS 38.101-3 [16]).
- if mpe-Reporting-FR2 is configured, and mpe-ProhibitTimer is not running:
- the measured P-MPR applied to meet FR2 MPE requirements as specified in TS 38.101-2 [15] is equal to or larger than mpe-Threshold for at least one activated FR2 Serving Cell since the last transmission of a PHR in this MAC entity; or
- the measured P-MPR applied to meet FR2 MPE requirements as specified in TS 38.101-2 [15] has changed more than phr-Tx-PowerFactorChange dB for at least one activated FR2 Serving Cell since the last transmission of a PHR due to the measured P-MPR applied to meet MPE requirements being equal to or larger than mpe-Threshold in this MAC entity.
in which case the PHR is referred below to as 'MPE P-MPR report'.
NOTE 2: The MAC entity should avoid triggering a PHR when the required power backoff due to power management decreases only temporarily (e.g. for up to a few tens of milliseconds) and it should avoid reflecting such temporary decrease in the values of \( \mathrm{P}_{\text {CMAX, } 5, \mathrm{C}} / \mathrm{PH} \) when a PHR is triggered by other triggering conditions.

NOTE 3: If a HARQ process is configured with cg-RetransmissionTimer and if the PHR is already included in a MAC PDU for transmission on configured grant by this HARQ process, but not yet transmitted by lower layers, it is up to UE implementation how to handle the PHR content.

If the MAC entity has UL resources allocated for a new transmission the MAC entity shall:
1> if it is the first UL resource allocated for a new transmission since the last MAC reset:
\( 2> \) start phr-PeriodicTimer.
\( 1> \) if the Power Headroom reporting procedure determines that at least one PHR has been triggered and not cancelled; and

ETSI


--- Page 87  ---


3GPP TS 38.321 version 18.2.0 Release 18
86
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) if the allocated UL resources can accommodate the MAC CE for PHR which the MAC entity is configured to transmit, plus its subheader, as a result of LCP as defined in clause 5.4.3.1:
\( 2> \) if multiplePHR with value true is configured:
3> for each activated Serving Cell with configured uplink associated with any MAC entity of which the active DL BWP is not dormant BWP; and

3> for each activated Serving Cell with configured uplink associated with E-UTRA MAC entity:
\( 4> \) if this MAC entity is configured with twoPHRMode:
\( 5> \) if this Serving Cell is configured with multipanelSchemeSDM or multipanelSchemeSFN and the MAC entity this Serving Cell belongs to is configured with twoPHRMode:

6> obtain two values of the Type 1 power headroom for the corresponding uplink carrier as specified in clause 7.7 of TS 38.213 [6] for NR Serving Cell.
\( 5> \) else if this Serving Cell is configured with multiple TRP PUSCH repetition (i.e., not configured with multipanelSchemeSDM or multipanelSchemeSFN) and the MAC entity this Serving Cell belongs to is configured with twoPHRMode:
\( 6> \) obtain two values of the Type 1 or the value of Type 3 power headroom for the corresponding uplink carrier as specified in clause 7.7 of TS 38.213 [6] for NR Serving Cell.

5> else:
\( 6> \) obtain the value of the Type 1 or Type 3 power headroom for the corresponding uplink carrier as specified in clause 7.7 of TS 38.213 [6] for NR Serving Cell and clause 5.1.1.2 of TS 36.213 [17] for E-UTRA Serving Cell.

4> else (i.e. this MAC entity is not configured with twoPHRMode):
\( 5> \) if this Serving Cell is configured with multiple TRP PUSCH repetition or multipanelSchemeSDM or multipanelSchemeSFN and if the MAC entity this Serving Cell belongs to is configured with twoPHRMode:
\( 6> \) if there is at least one real PUSCH transmission at the slot where the PHR MAC CE is transmitted:

7> obtain the value of the Type 1 power headroom of the first real transmission of the corresponding uplink carrier as specified in clause 7.7 of TS 38.213[6] for NR Serving Cell.
\( 6> \) else if there is no real PUSCH transmission at the slot where the PHR MAC CE is transmitted:
\( 7> \) obtain the value of the type 1 power headroom of the reference PUSCH transmission associated with the SRS-ResourceSet with a lower SRS-resourceSetID or the value of the type 3 power headroom for the corresponding uplink carrier as specified in clause 7.7 of TS 38.213[6] for NR Serving Cell.
\( 5> \) else:
\( 6> \) obtain the value of the Type 1 or Type 3 power headroom for the corresponding uplink carrier as specified in clause 7.7 of TS 38.213 [6] for NR Serving Cell and clause 5.1.1.2 of TS 36.213 [17] for E-UTRA Serving Cell.

4> if this MAC entity is configured with phr-AssumedPUSCH-Reporting:
\( 5> \) if this MAC entity has UL resources allocated for transmission on this Serving Cell; or
\( 5> \) if the other MAC entity, if configured, has UL resources allocated for transmission on this Serving Cell and phr-ModeOtherCG is set to real by upper layers:
\( 6> \) if dynamicTransformPrecoderFieldPresenceDCI-0-1-r18 or dynamicTransformPrecoderFieldPresenceDCI-0-2-r18 is set to enabled in the active BWP of this Serving Cell:

ETSI


--- Page 88  ---


3GPP TS 38.321 version 18.2.0 Release 18
87
ETSI TS 138321 V18.2.0 (2024-08)

\( 7> \) obtain the value for the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \Gamma, c} \) field for assumed PUSCH from the physical layer if available, as specified in clause 7.7 of TS 38.213 [6].
\( 6> \) obtain the value for the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) field from the physical layer.
6> if mpe-Reporting-FR2 is configured and this Serving Cell operates on FR2 and this Serving Cell is associated to this MAC entity:
\( 7> \) obtain the value for the corresponding MPE field from the physical layer.
\( 4> \) else (ie if this MAC entity is not configured with phr-AssumedPUSCH-Reporting):
\( 5> \) if this MAC entity is configured with twoPHRMode and if this Serving Cell is configured with multipanelSchemeSDM or multipanelSchemeSFN:
\( 6> \) obtain two values for the corresponding \( P_{C M A X, 5, c, k} \) fields from the physical layer.
6> if mpe-Reporting-FR2 is configured and this Serving Cell operates on FR2 and this Serving Cell is associated to this MAC entity:
\( 7> \) obtain two values for the corresponding \( \mathrm{MPE}_{\mathrm{k}} \) fields from the physical layer.
\( 5> \) else:
6> if this MAC entity has UL resources allocated for transmission on this Serving Cell; or
\( 6> \) if the other MAC entity, if configured, has UL resources allocated for transmission on this Serving Cell and phr-ModeOtherCG is set to real by upper layers:
\( 7> \) obtain the value for the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}, \mathrm{C}} \) field from the physical layer.
\( 7> \) if mpe-Reporting-FR2 is configured and this Serving Cell operates on FR2 and this Serving Cell is associated to this MAC entity:
\( 8> \) obtain the value for the corresponding MPE field from the physical layer.
\( 7> \) if mpe-Reporting-FR2-r17 is configured and this Serving Cell operates on FR2 and this Serving Cell is associated to this MAC entity:
\( 8> \) obtain the value for the corresponding MPE, field from the physical layer;
\( 8> \) obtain the value for the corresponding Resource, field from the physical layer.
\( 7> \) if dpc-Reporting-FRI is configured and \( \Delta \mathrm{P}_{\text {PowerClass }} / \Delta \mathrm{P}_{\text {PowerClass, }} \mathrm{CA} / \Delta \mathrm{P}_{\text {PowerClass, }} \) ENDC/ \( \Delta \mathrm{P}_{\text {PowerClass, } \mathrm{NR} \text {-DC reporting is triggered and this Serving Cell operates on FR1 and this }} \) Serving Cell is associated to this MAC entity:
\( 8> \) obtain the value for the corresponding DPC field(s) from the physical layer.
\( 3> \) if phr-Type2OtherCell with value true is configured:
4> if the other MAC entity is E-UTRA MAC entity:
\( 5> \) obtain the value of the Type 2 power headroom for the SpCell of the other MAC entity (i.e. EUTRA MAC entity);
\( 5> \) if phr-ModeOther \( C G \) is set to real by upper layers:
\( 6> \) obtain the value for the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) field for the SpCell of the other MAC entity (i.e. E-UTRA MAC entity) from the physical layer.
\( 3> \) if this MAC entity is configured with mpe-Reporting-FR2-r17:
\( 4> \) instruct the Multiplexing and Assembly procedure to generate and transmit the Enhanced Multiple entry PHR as defined in clause 6-1 3-49 based on the values reported by the physical layer.

ETSI


--- Page 89  ---


3GPP TS 38.321 version 18.2.0 Release 18
88
ETSI TS 138321 V18.2.0 (2024-08)

3> else if this MAC entity is configured with twoPHRMode and any associated Serving Cell is configured with multipanelSchemeSDM or multipanelSchemeSFN:

4> instruct the Multiplexing and Assembly procedure to generate and transmit the Enhanced Multiple Entry PHR for multiple TRP STx2P MAC CE as defined in clause 6.1.3.82 based on the values reported by the physical layer.
\( 3> \) else if this MAC entity is configured with twoPHRMode and any associated Serving Cell is configured with multiple TRP PUSCH repetition:

4> instruct the Multiplexing and Assembly procedure to generate and transmit the Enhanced Multiple Entry PHR for multiple TRP MAC CE as defined in clause 6.1.3.51 based on the values reported by the physical layer.
\( 3> \) else if this MAC entity is configured with phr-AssumedPUSCH-Reporting:
\( 4> \) instruct the Multiplexing and Assembly procedure to generate and transmit the Multiple Entry PHR with assumed PUSCH MAC CE as defined in clause 6.1_3.79 based on the values reported by the physical layer.
\( 3> \) else:
\( 4> \) instruct the Multiplexing and Assembly procedure to generate and transmit the Multiple Entry PHR MAC CE as defined in clause 6.1.3.9 based on the values reported by the physical layer.
\( 2> \) else (i.e. Single Entry PHR format is used):
3> if this MAC entity is configured with twoPHRMode for multiple TRP PUSCH repetition or multipanelSchemeSDM or multipanelSchemeSFN:

4> obtain two values of the Type 1 power headroom from the physical layer for the corresponding uplink carrier of the PCell.
\( 3> \) else:
\( 4> \) obtain the value of the Type 1 power headroom from the physical layer for the corresponding uplink carrier of the PCell.
\( 3> \) if this MAC entity is configured with phr-AssumedPUSCH-Reporting:
4> if dynamicTransformPrecoderFieldPresenceDCI-0-1-r18 or
dynamicTransformPrecoderFieldPresenceDCI-0-2-r18 is set to enabled in the active BWP of this Serving Cell:
\( 5> \) obtain the value for the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) field for assumed PUSCH from the physical layer, if available, as specified in clause 7.7 of TS 38.213 [6].
\( 3> \) if this MAC entity is configured with twoPHRMode and if this Serving Cell is configured with multipanelSchemeSDM or multipanelSchemeSFN:
\( 4> \) obtain two values for the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}, \mathrm{C}, \mathrm{k}} \) fields from the physical layer.
\( 4> \) if mpe-Reporting-FR2 is configured and this Serving Cell operates on FR2 and this Serving Cell is associated to this MAC entity:
\( 5> \) obtain two values for the corresponding \( \mathrm{MPE}_{\mathrm{k}} \) fields from the physical layer.
3> else:
\( 4> \) obtain the value for the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{JC}} \) field from the physical layer;
\( 4> \) if mpe-Reporting-FR2 is configured and this Serving Cell operates on FR2:
\( 5> \) obtain the value for the corresponding MPE field from the physical layer.
4> if mpe-Reporting-FR2-r17 is configured and this Serving Cell operates on FR2 and this Serving Cell is associated to this MAC entity:

ETSI


--- Page 90  ---


3GPP TS 38.321 version 18.2.0 Release 18
89
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) obtain the value for the corresponding MPE, field from the physical layer;
\( 5> \) obtain the value for the corresponding Resource, field from the physical layer.
\( 4> \) if dpc-Reporting-FRI is configured and this Serving Cell operates on FR1:
\( 5> \) obtain the value for the corresponding DPC field from the physical layer.
\( 3> \) if this MAC entity is configured with mpe-Reporting-FR2-r17:
4> instruct the Multiplexing and Assembly procedure to generate and transmit the Enhanced Single entry PHR as defined in clause 6.1.3.48 based on the values reported by the physical layer.
\( 3> \) else if this MAC entity is configured with twoPHRMode and this Serving Cell is configured with multipanelSchemeSDM or multipanelSchemeSFN:
\( 4> \) instruct the Multiplexing and Assembly procedure to generate and transmit the Enhanced Single Entry PHR for multiple TRP STx2P MAC CE as defined in clause 6.1.3.81 based on the values reported by the physical layer.

3> else if this MAC entity is configured with twoPHRMode and this Serving Cell is configured with multiple TRP PUSCH repetition:
\( 4> \) instruct the Multiplexing and Assembly procedure to generate and transmit the Enhanced Single Entry PHR for multiple TRP MAC CE as defined in clause 6.1.3.50 based on the values reported by the physical layer.
\( 3> \) else if this MAC entity is configured with phr-AssumedPUSCH-Reporting:
\( 4> \) instruct the Multiplexing and Assembly procedure to generate and transmit the Single Entry PHR with assumed PUSCH MAC CE as defined in clause 6.1.3.78 based on the values reported by the physical layer.

3> else:
\( 4> \) instruct the Multiplexing and Assembly procedure to generate and transmit the Single Entry PHR MAC CE as defined in clause 6.1.3.8 based on the values reported by the physical layer.
\( 2> \) if this PHR report is an MPE P-MPR report:
3> start or restart the mpe-ProhibitTimer;
\( 3> \) cancel triggered MPE P-MPR reporting for Serving Cells included in the PHR MAC CE.
\( 2> \) start or restart phr-PeriodicTimer;
\( 2> \) start or restart phr-ProhibitTimer;
\( 2> \) cancel all triggered PHR(s).
All triggered PHRs shall be cancelled when there is an ongoing SDT procedure as in clause 5.27 and the UL grant(s) can accommodate all pending data available for transmission but is not sufficient to additionally accommodate the PHR MAC CE plus its subheader.
5.4.7 Pre-emptive Buffer Status Reporting

The Pre-emptive Buffer Status reporting (Pre-emptive BSR) procedure is used by an [AB-MT to provide its parent [ABDU(s) or [AB-donor-DU(s) with the information about the amount of the data expected to arrive at the [AB-MT from its child node(s) and/or UE(s) connected to it.

If configured, Pre-emptive BSR may be triggered for the specific case of an IAB-MT if any of the following events occur:
- UL grant is provided to child IAB node or UE;
- BSR is received from child IAB node or UE.

ETSI


--- Page 91  ---


3GPP TS 38.321 version 18.2.0 Release 18
90
ETSI TS 138321 V18.2.0 (2024-08)

IAB-MT may report Extended Pre-emptive BSR (as defined in clause 6.1.3.1) if the MAC entity of the IAB-MT is configured with logicalChannelGrouplAB-Ext by upper layers. Otherwise IAB-MT may report Pre-emptive BSR (as defined in clause 6.1.3.1).

The MAC entity shall:
1> if the Pre-emptive Buffer Status reporting procedure determines that at least one Pre-emptive BSR has been triggered and not cancelled:
\( 2> \) if UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the Extended Pre-emptive BSR or Pre-emptive BSR MAC CE plus its subheader as a result of logical channel prioritization:

3> instruct the Multiplexing and Assembly procedure to generate the Extended Pre-emptive BSR or Preemptive BSR MAC CE as defined in clause 6.1.3.1.
\( 2> \) else:
3> trigger a Scheduling Request.
A MAC PDU shall contain at most one Pre-emptive BSR MAC CE or Extended Pre-emptive BSR MAC CE, even when multiple events have triggered a Pre-emptive BSR.

All triggered Pre-emptive BSR(s) shall be cancelled when a MAC PDU is transmitted and this PDU includes the corresponding Pre-emptive BSR MAC CE or Extended Pre-emptive BSR MAC CE.

NOTE: Pre-emptive BSR may be used for the case of dual-connected [AB node. It is up to network implementation to work out the associated MAC entity or entities which report the Pre-emptive BSR, and the associated expected amount of data reported by any such entity or entities. For the case of dualconnected IAB node, if two ingress BH RLC channels belonging to the same ingress LCG are mapped to two different egress Cell Groups (corresponding to different parent nodes), there may be ambiguity in Pre-emptive BSR calculations and interpretation by the receiving parent node(s) and the [AB node reporting pre-emptive BSR.
5.4.8 Timing Advance Reporting

The Timing Advance reporting procedure is used in a non-terrestrial network or an air to ground network to provide the gNB with an estimate of the UE's Timing Advance value (i.e., \( T_{\text {TA }} \) as defined in the UE's TA formula, see TS 38.211 [8] clause 4.3.1).

RRC controls Timing Advance reporting by configuring the following parameters:
- offsetThresholdTA;
- timingAdvanceSR.

A Timing Advance report (TAR) shall be triggered if any of the following events occur:
- upon indication from upper layers to trigger a Timing Advance report;
- upon configuration of offsetThresholdTA by upper layers, if the UE has not previously reported Timing Advance value to current Serving Cell;
- if the variation between the current estimate of the Timing Advance value and the last reported Timing Advance value is equal to or larger than offsetThresholdTA, if configured.

The MAC entity shall:
1> if the Timing Advance reporting procedure determines that at least one TAR has been triggered and not cancelled:
\( 2> \) if UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the Timing Advance Report MAC CE plus its subheader as a result of logical channel prioritization:

ETSI


--- Page 92  ---


3GPP TS 38.321 version 18.2.0 Release 18
91
ETSI TS 138321 V18.2.0 (2024-08)

3> instruct the Multiplexing and Assembly procedure to generate the Timing Advance Report MAC CE as defined in clause 6.1.3.56.
\( 2> \) else
\( 3> \) if timingAdvanceSR is configured with value enabled:
4> trigger a Scheduling Request.
NOTE: UL-SCH resources are considered available if the MAC entity has been configured with, receives, or determines an uplink grant. If the MAC entity has determined at a given point in time that UL-SCH resources are available, this need not imply that UL-SCH resources are available for use at that point in time.

A MAC PDU shall contain at most one Timing Advance Report MAC CE, even when multiple events have triggered a Timing Advance report. The Timing Advance Report MAC CE shall be generated based on the latest available estimate of the UE's Timing Advance value prior to the MAC PDU assembly.

All triggered Timing Advance reports shall be cancelled when a MAC PDU is transmitted and this PDU includes a Timing Advance Report MAC CE.
5.4.9 Delay status reporting

The Delay Status Reporting (DSR) procedure is used to provide the serving gNB with delay status of LCGs. This delay status for an LCG includes remaining time, which is the smallest remaining value of the running PDCP discardTimers among PDCP SDUs that are buffered for the LCG but have not been transmitted in any MAC PDU as specified in clause 7.3 in TS 38.323 [4], and the total amount of delay-critical UL data for the LCG according to the data volume calculation procedure specified in clause 5.5 in TS 38.322 [3] and clause 5.15 in TS 38.323 [4] for the associated RLC and PDCP entities, respectively.

RRC controls the DSR procedure by configuring the following parameter:
- remainingTimeThreshold (per LCG): the threshold on remaining time for triggering a DSR for a logical channel within an LCG.

If an LCG is configured for delay status reporting, the MAC entity shall for each logical channel within the LCG:
\( 1> \) if the smallest remaining value of the running PDCP discardTimers among all the PDCP SDUs buffered for the logical channel that have not been transmitted in any MAC PDU and have not been reported as data volume in a DSR MAC CE becomes below remainingTimeThreshold of the LCG; and
\( 1> \) if there is no DSR pending for the logical channel:
\( 2> \) trigger a DSR for the logical channel.
If there is at least one DSR pending, the MAC entity shall:
1> if UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the DSR MAC CE plus its subheader as a result of logical channel prioritization:
\( 2> \) instruct the Multiplexing and Assembly procedure to generate the DSR MAC CE as specified in clause 6.1.3.72.

1> else if there is no pending SR already triggered by the DSR procedure for the same logical channel as of this DSR:
\( 2> \) trigger a Scheduling Request.
NOTE 1: The availability of UL-SCH resources for the transmission of the DSR MAC CE follows the same critieria specified in clause 5.4.5.

A PDCP SDU is considered to be associated with a DSR if it has not been transmitted in any MAC PDU and is a delaycritical PDCP SDU (as defined in TS 38.323 [4]) associated with the logical channel which triggered the DSR.

ETSI


--- Page 93  ---


3GPP TS 38.321 version 18.2.0 Release 18
92
ETSI TS 138321 V18.2.0 (2024-08)

A MAC PDU shall contain at most one DSR MAC CE. A MAC PDU shall not contain a DSR MAC CE if it includes all PDCP SDUs associated with all the pending DSRs.

After a DSR is triggered, it is considered as pending until it is cancelled. The MAC entity shall cancel a pending DSR, when all the PDCP SDUs associated with the DSR have been discarded, or when a MAC PDU is transmitted and this MAC PDU includes a DSR MAC CE that contains the delay information of all the PDCP SDUs associated with the DSR (as described in the clause 6.1_3.72), or when a MAC PDU is transmitted and this MAC PDU includes all the PDCP SDUs associated with the DSR.

NOTE 2: It is up to UE implementation whether the MAC entity includes a DSR MAC CE in a MAC PDU if the MAC PDU can accommodate all PDCP SDUs associated with all the pending DSRs but is not sufficient to additionally accommodate the DSR MAC CE plus its subheader.
5.5 PCH reception

When the MAC entity needs to receive PCH , the MAC entity shall:
\( 1> \) if a PCH assignment has been received on the PDCCH for the P -RNTI:
\( 2> \) attempt to decode the TB on the PCH as indicated by the PDCCH information;
\( 2> \) if the TB on the PCH has been successfully decoded:
\( 3> \) deliver the decoded MAC PDU to upper layers.
5.6 BCH reception

When the MAC entity needs to receive BCH, the MAC entity shall:
\( 1> \) receive and attempt to decode the BCH ;
\( 1> \) if a TB on the BCH has been successfully decoded:
\( 2> \) deliver the decoded MAC PDU to upper layers.
5.7 Discontinuous Reception (DRX)

The MAC entity may be configured by RRC with a DRX functionality that controls the UE's PDCCH monitoring activity for the MAC entity's C-RNTI, CI-RNTI, CS-RNTI, INT-RNTI, SFI-RNTI, SP-CSI-RNTI, TPC-PUCCH-RNTI, TPC-PUSCH-RNTI, TPC-SRS-RNTI, AI-RNTI, SL-RNTI, SL-CS-RNTI, SL Semi-Persistent Scheduling V-RNTI and cellDTRX-RNTL. When using DRX operation, the MAC entity shall also monitor PDCCH according to requirements found in other clauses of this specification. When in RRC_CONNECTED, if DRX is configured, for all the activated Serving Cells, the MAC entity may monitor the PDCCH discontinuously using the DRX operation specified in this clause; otherwise the MAC entity shall monitor the PDCCH as specified in TS 38.213 [6].

NOTE 1: Void
RRC controls DRX operation by configuring the following parameters:
- drx-onDurationTimer: the duration at the beginning of a DRX cycle;
- drx-SlotOffset: the delay before starting the drx-onDurationTimer;
- drx-InactivityTimer: the duration after the PDCCH occasion in which a PDCCH indicates a new UL, DL or SL transmission for the MAC entity;
- drx-RetransmissionTimerDL (per DL HARQ process except for the broadcast process): the maximum duration until a DL retransmission is received;
- drx-RetransmissionTimerUL (per UL HARQ process): the maximum duration until a grant for UL retransmission is received;

ETSI


--- Page 94  ---


3GPP TS 38.321 version 18.2.0 Release 18
93
ETSI TS 138321 V18.2.0 (2024-08)
- drx-LongCycleStartOffset: the Long DRX cycle and drx-StartOffset which defines the subframe where the Long and Short DRX cycle starts;
- drx-NonIntegerLongCycleStartOffset (optional): the Long DRX cycle and drx-StartOffset which defines the subframe where the Long and Short DRX cycle start, when the length of the Long DRX cycle and/or the short DRX cycle is not an integer;
- drx-ShortCycle (optional): the Short DRX cycle;
- \( d r x \)-NonIntegerShortCycle (optional): the Short DRX cycle whose length is not an integer;
- drx-ShortCycleTimer (optional): the duration the UE shall follow the Short DRX cycle;
- drx-HARQ-RTT-TimerDL (per DL HARQ process except for the broadcast process): the minimum duration before a DL assignment for HARQ retransmission is expected by the MAC entity;
- drx-HARQ-RTT-Timer UL (per UL HARQ process): the minimum duration before a UL HARQ retransmission grant is expected by the MAC entity;
- drx-RetransmissionTimerSL (per sidelink process): the maximum duration until a grant for SL retransmission is received;
- drx-HARQ-RTT-TimerSL (per sidelink process): the minimum duration before an SL retransmission grant is expected by the MAC entity;
- drx-LastTransmissionUL (optional): the configuration to start drx-HARQ-RTT-TimerUL after the last transmission within a bundle;
- \( p s \)-Wakeup (optional): the configuration to start associated drx-onDurationTimer in case DCP is monitored but not detected;
- ps-TransmitOtherPeriodicCSI (optional): the configuration to report periodic CSI that is not L1-RSRP on PUCCH during the time duration indicated by drx-onDurationTimer in case DCP is configured but associated drx-onDurationTimer is not started;
- ps-TransmitPeriodicL1-RSRP (optional): the configuration to transmit periodic CSI that is L1-RSRP on PUCCH during the time duration indicated by drx-onDurationTimer in case DCP is configured but associated drxonDurationTimer is not started;
- downlinkHARQ-FeedbackDisabled (optional): the configuration to disable HARQ feedback per DL HARQ process;
- uplinkHARQ-Mode (optional): the configuration to set HARQmodeA or HARQmodeB per UL HARQ process;
- disableCG-RetransmissionMonitoring (optional): the configuration to disable starting drx-HARQ-RTT-Timer UL for UL transmission over a configured uplink grant;
- drx-TimeReferenceSFN (optional): the configuration to indicate how UE initializes of \( D R X_{-} S F N \_ \)COUNTER

The following UE variable is used for the DRX operation if drx-NonIntegerLongCycleStartOffset is configured:
- DRX_SFN_COUNTER: the counter that increments when SFN changes to 0 . The maximum value of this counter is at least 65535 .

Serving Cells of a MAC entity may be configured by RRC in two DRX groups with separate DRX parameters. When RRC does not configure a secondary DRX group, there is only one DRX group and all Serving Cells belong to that one DRX group. When two DRX groups are configured, each Serving Cell is uniquely assigned to either of the two groups. The DRX parameters that are separately configured for each DRX group are: drx-onDurationTimer, drxInactivityTimer. The DRX parameters that are common to the DRX groups are: drx-SlotOffset, drxRetransmissionTimerDL, drx-RetransmissionTimerUL, drx-LongCycleStartOffset, drxNonIntegerLongCycleStartOffset, drx-ShortCycle (optional), drx-NonIntegerShortCycle (optional), drxShortCycleTimer (optional), drx-HARQ-RTT-TimerDL, and drx-HARQ-RTT-TimerUL.

When DRX is configured, the Active Time for Serving Cells in a DRX group includes the time while:
- drx-onDurationTimer or drx-InactivityTimer configured for the DRX group is running; or

ETSI


--- Page 95  ---


3GPP TS 38.321 version 18.2.0 Release 18
94
ETSI TS 138321 V18.2.0 (2024-08)
- drx-RetransmissionTimerDL, drx-RetransmissionTimer UL or drx-RetransmissionTimerSL is running on any Serving Cell in the DRX group; or
- ra-ContentionResolutionTimer (as described in clause 5.1.5) or msgB-ResponseWindow (as described in clause 5.1.4a) is running; or
- a Scheduling Request is sent on PUCCH and is pending (as described in clause 5.4 .4 or 5.22 .1 .5 ). If this Serving Cell is part of a non-terrestrial network, the Active Time is started after the Scheduling Request transmission that is performed when the SR_COUNTER is 0 for all the SR configurations with pending SR(s) plus the UE-gNB RTT; or
- a PDCCH indicating a new transmission addressed to the C-RNTI of the MAC entity has not been received after successful reception of a Random Access Response for the Random Access Preamble not selected by the MAC entity among the contention-based Random Access Preamble (as described in clauses 5.1.4 and 5.1.4a); or
- there is an ongoing RACH-less LTM cell switch; or
- there is an ongoing RACH-less handover in a terrestrial network.

The following MAC timers are used for DRX operation in a non-terrestrial network:
- HARQ-RTT-TimerDL-NTN (per DL HARQ process configured with HARQ feedback enabled): the minimum duration before a DL assignment for HARQ retransmission is expected by the MAC entity;
- HARQ-RTT-TimerUL-NTN (per UL HARQ process configured with HARQModeA): the minimum duration before a UL HARQ retransmission grant is expected by the MAC entity.

When DRX is not configured and multicast DRX is configured for a G-RNTI or G-CS-RNTI, the MAC entity shall:
\( 1> \) monitor the PDCCH as specified in TS 38.213 [6];
\( 1> \) if a MAC PDU is received in a configured downlink assignment for unicast; or
1> if the PDCCH indicates a DL unicast transmission:
\( 2> \) stop the \( d r x \)-RetransmissionTimerDL-PTM for the corresponding HARQ process.
When DRX is configured, the MAC entity shall:
\( 1> \) if a MAC PDU is received in a configured downlink assignment for unicast:
\( 2> \) if this Serving Cell is configured with downlinkHARQ-FeedbackDisabled:
\( 3> \) if the corresponding HARQ process is configured with HARQ feedback enabled:
\( 4> \) set \( H A R Q-R T T \)-TimerDL-NTN for the corresponding HARQ process equal to \( d r x-H A R Q-R T T \) Timer \( D L \) plus the latest available UE-gNB RTT value;
\( 4> \) start the HARQ-RTT-TimerDL-NTN for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.
\( 2> \) else:
\( 3> \) start the \( d r x-H A R Q-R T T \)-TimerDL for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.

NOTE 1a: Void.
NOTE 1b:Void.
\( 2> \) stop the \( d r x \)-RetransmissionTimerDL for the corresponding HARQ process;
\( 2> \) stop the \( d r x \)-RetransmissionTimerDL-PTM for the corresponding HARQ process.
\( 1> \) if a MAC PDU is transmitted in a configured uplink grant and LBT failure indication is not received from lower layers:

ETSI


--- Page 96  ---


3GPP TS 38.321 version 18.2.0 Release 18
95
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if this Serving Cell is configured with uplinkHARQ-Mode:
\( 3> \) if the corresponding HARQ process is configured as HARQModeA:
\( 4> \) set HARQ-RTT-TimerUL-NTN for the corresponding HARQ process equal to drx-HARQ-RTTTimer UL plus the latest available UE-gNB RTT value;

4> if drx-LastTransmission UL is configured:
\( 5> \) start the HARQ-RTT-TimerUL-NTN for the corresponding HARQ process in the first symbol after the end of the last transmission (within a bundle) of the corresponding PUSCH transmission.
\( 4> \) else:
5> start the HARQ-RTT-TimerUL-NTN for the corresponding HARQ process in the first symbol after the end of the first transmission (within a bundle) of the corresponding PUSCH transmission.
\( 2> \) else:
3> if disableCG-RetransmissionMonitoring is not configured for the configured uplink grant:
\( 4> \) if \( d r x \)-LastTransmission \( U L \) is configured:
\( 5> \) start the drx-HARQ-RTT-TimerUL for the corresponding HARQ process in the first symbol after the end of the last transmission (within a bundle) of the corresponding PUSCH transmission.

4 else:
\( 5> \) start the drx-HARQ-RTT-TimerUL for the corresponding HARQ process in the first symbol after the end of the first transmission (within a bundle) of the corresponding PUSCH transmission.
\( 2> \) stop the \( d r x \)-RetransmissionTimer \( U L \) for the corresponding HARQ process at the first transmission (within a bundle) of the corresponding PUSCH transmission.

1> if a MAC PDU is transmitted in a configured sidelink grant:
\( 2> \) if the PUCCH resource is configured:
\( 3> \) start the drx-HARQ-RTT-TimerSL for the corresponding HARQ process in the first symbol after the end of the corresponding PUCCH transmission carrying the SL HARQ feedback; or

3> start the drx-HARQ-RTT-TimerSL for the corresponding HARQ process in the first symbol after the end of the corresponding PUCCH resource for the SL HARQ feedback when the PUCCH is not transmitted;

3> stop the drx-RetransmissionTimerSL for the corresponding HARQ process.
\( 2> \) else:
3> start the drx-HARQ-RTT-TimerSL for the corresponding HARQ process at the first symbol after the end of the corresponding PSSCH transmission;

3> stop the drx-RetransmissionTimerSL for the corresponding HARQ process.
\( 1> \) if a \( d r x \)-HARQ-RTT-TimerDL expires:
\( 2> \) if the data of the corresponding HARQ process was not successfully decoded:
3> start the \( d r x \)-RetransmissionTimerDL for the corresponding HARQ process in the first symbol after the expiry of drx-HARQ-RTT-TimerDL.

1> if a HARQ-RTT-TimerDL-NTN expires:
\( 2> \) if the data of the corresponding HARQ process was not successfully decoded:
3> start the drx-RetransmissionTimerDL for the corresponding HARQ process in the first symbol after the expiry of HARQ-RTT-TimerDL-NTN.
\( 1> \) if a \( d r x \)-HARQ-RTT-Timer \( U L \) expires:

ETSI


--- Page 97  ---


3GPP TS 38.321 version 18.2.0 Release 18
96
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) start the \( d r x \)-RetransmissionTimer \( U L \) for the corresponding HARQ process in the first symbol after the expiry of drx-HARQ-RTT-TimerUL.
\( 1> \) if a HARQ-RTT-Timer UL-NTN expires:
\( 2> \) start the \( d r x \)-RetransmissionTimerUL for the corresponding HARQ process in the first symbol after the expiry of HARQ-RTT-Timer UL-NTN.

1> if a drx-HARQ-RTT-TimerSL expires:
\( 2> \) if a HARQ NACK feedback for the corresponding HARQ process is transmitted on PUCCH; or
\( 2> \) if a HARQ NACK feedback for the corresponding HARQ process is generated but not transmitted on PUCCH; or
\( 2> \) if the PUCCH resource is not configured for the SL grant:
3> start the drx-RetransmissionTimerSL for the corresponding HARQ process in the first symbol after the expiry of drx-HARQ-RTT-TimerSL.

NOTE: The UE handles the drx-RetransmissionTimerSL operation when sl-PUCCH-Config is configured by RRC but PUCCH resource is not scheduled same as when sl-PUCCH-Config is not configured.
\( 1> \) if a DRX Command MAC CE indicated by PDCCH addressed to C-RNTI or CS-RNTI, or by a configured downlink assignment for unicast transmission or a Long DRX Command MAC CE is received:
\( 2> \) stop drx-onDurationTimer for each DRX group;
\( 2> \) stop drx-InactivityTimer for each DRX group.
\( 1> \) if drx-InactivityTimer for a DRX group expires:
\( 2> \) if the Short DRX cycle is configured:
3> start or restart drx-ShortCycleTimer for this DRX group in the first symbol after the expiry of \( d r x \) InactivityTimer;
\( 3> \) use the Short DRX cycle for this DRX group.
\( 2> \) else:
\( 3> \) use the Long DRX cycle for this DRX group.
1> if a DRX Command MAC CE indicated by PDCCH addressed to C-RNTI or CS-RNTI, or by a configured downlink assignment for unicast transmission is received:
\( 2> \) if the Short DRX cycle is configured:
3> start or restart drx-ShortCycleTimer for each DRX group in the first symbol after the end of DRX Command MAC CE reception;

3> use the Short DRX cycle for each DRX group.
\( 2> \) else:
3> use the Long DRX cycle for each DRX group.
\( 1> \) if drx-ShortCycleTimer for a DRX group expires:
\( 2> \) use the Long DRX cycle for this DRX group.
\( 1> \) if a Long DRX Command MAC CE is received:
\( 2> \) stop drx-ShortCycleTimer for each DRX group;
\( 2> \) use the Long DRX cycle for each DRX group.
1> if the drx-NonIntegerLongCycleStartOffset is configured:

ETSI


--- Page 98  ---


3GPP TS 38.321 version 18.2.0 Release 18
97
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) increment \( D R X_{\text {_ }} S F N_{\text {_ }} \) COUNTER by 1 in the first symbol of a slot in which SFN changes to 0 ;
\( 2> \) if DRX is (re-)configured by RRC:
\( 3> \) if dr \( x \)-TimeReferenceSFN is included in the RRC (re-)configuration which is received during the first half of a hyper frame (i.e., SFN is between 0 and 511):
\( 4> \) set DRX_SFN_COUNTER to 1 .
\( 3> \) else:
\( 4>\operatorname{set} D R X_{-} S F N_{-} \)COUNTER to 0 .
\( 1> \) if the Short DRX cycle is used for a DRX group and the drx-NonIntegerShortCycle is not configured, and [(SFN \( \times 10)+ \) subframe number] modulo \( ( \) drx-ShortCycle \( )=( \) drx-StartOffset \( ) \) modulo \( ( \) drx-ShortCycle \( ) \); or
\( 1> \) if the Short DRX cycle is used for a DRX group and the drx-NonIntegerShortCycle is configured, and floor \( [[( \) DRX_SFN_COUNTER \( \times 10240)+( \) SFN \( \times 10)+ \) subframe number - drx-StartOffset \( ] \) modulo \( ( \) drx NonIntegerShort(Cycle)) \( =0 \) :
\( 2> \) start drx-onDurationTimer for this DRX group after drx-SlotOffset from the beginning of the subframe.
\( 1> \) if the Long DRX cycle is used for a DRX group and the drx-NonIntegerLongCycleStartOffset is not configured, and \( [(\mathrm{SFN} \times 10)+ \) subframe number \( ] \) modulo \( ( \) drx-LongCycle \( )= \) drx-StartOffset; or
\( 1> \) if the Long DRX cycle is used for a DRX group and the dr \( x \)-NonIntegerLongCycleStartOffset is configured, and floor \( ([ \) DRX_SFN_COUNTER \( \times 10240)+( \) SFN \( \times 10)+ \) subframe number \( ] \) modulo (drx-NonIntegerLongCycle)) \( = \) drx-StartOffset:
\( 2> \) if DCP monitoring is configured for the active DL BWP as specified in TS 38.213 [6], clause 10.3:
\( 3> \) if DCP indication associated with the current DRX cycle received from lower layer indicated to start \( d r x \) onDurationTimer, as specified in TS 38.213 [6]; or
\( 3> \) if all DCP occasion(s) in time domain, as specified in TS 38.213 [6], associated with the current DRX cycle occurred in Active Time considering grants/assignments/DRX Command MAC CE/Long DRX Command MAC CE received and Scheduling Request sent until 4 ms prior to start of the last DCP occasion, or during a measurement gap, or when the MAC entity monitors for a PDCCH transmission on the search space indicated by recoverySearchSpaceld of the SpCell identified by the C-RNTI while the ra-ResponseWindow is running (as specified in clause 5.1.4); or
\( 3> \) if \( p s \)-Wakeup is configured with value true and DCP indication associated with the current DRX cycle has not been received from lower layers:
\( 4> \) start drx-onDurationTimer after drx-SlotOffset from the beginning of the subframe.
\( 2> \) else:
\( 3> \) start drx-onDurationTimer for this DRX group after drx-SlotOffset from the beginning of the subframe.
NOTE 2: In case of unaligned SFN across carriers in a cell group, the SFN of the SpCell is used to calculate the DRX duration.
\( 1> \) if a DRX group is in Active Time:
\( 2> \) monitor the PDCCH on the Serving Cells in this DRX group as specified in TS 38.213 [6];
\( 2> \) if the PDCCH indicates a DL transmission; or
\( 2> \) if the PDCCH indicates a one-shot HARQ feedback as specified in clause 9.1.4 of TS 38.213[6]; or
\( 2> \) if the PDCCH indicates a retransmission of HARQ feedback as specified in clause 9.1.5 of TS 38.213 [6]:
\( 3> \) if this Serving Cell is configured with downlinkHARQ-FeedbackDisabled:
\( 4> \) if the corresponding HARQ process is configured with HARQ feedback enabled:

ETSI


--- Page 99  ---


3GPP TS 38.321 version 18.2.0 Release 18
98
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) set HARQ-RTT-TimerDL-NTN for the corresponding HARQ process equal to drx-HARQ-RTTTimer D L plus the latest available UE-gNB RTT value;
\( 5> \) start the HARQ-RTT-TimerDL-NTN for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.
\( 3> \) else:
4> start or restart the drx-HARQ-RTT-TimerDL for the corresponding HARQ process(es) whose HARQ feedback is reported in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.

NOTE 3: When HARQ feedback is postponed by PDSCH-to-HARQ_feedback timing indicating an inapplicable k1 value, as specified in TS 38.213 [6], the corresponding transmission opportunity to send the DL HARQ feedback is indicated in a later PDCCH requesting the HARQ-ACK feedback.
\( 3> \) stop the drx-RetransmissionTimerDL for the corresponding HARQ process(es) whose HARQ feedback is reported;

3> stop the drx-RetransmissionTimerDL-PTM for the corresponding HARQ process;
3> if the PDSCH-to-HARQ_feedback timing indicate an inapplicable k 1 value as specified in TS 38.213 [6]:
4> start the drx-RetransmissionTimerDL in the first symbol after the (end of the last) PDSCH transmission (within a bundle) for the corresponding HARQ process.
\( 2> \) if the PDCCH indicates a UL transmission:
3> if this Serving Cell is configured with uplinkHARQ-Mode:
4 - if the corresponding HARQ process is configured as HARQModeA:
\( 5> \) set HARQ-RTT-TimerUL-NTN for the corresponding HARQ process equal to drx-HARQ-RTTTimer \( U L \) plus the latest available UE-gNB RTT value;
\( 5> \) if drx-LastTransmissionUL is configured:
6> start the HARQ-RTT-TimerUL-NTN for the corresponding HARQ process in the first symbol after the end of the last transmission (within a bundle) of the corresponding PUSCH transmission.

5> else:
6> start the HARQ-RTT-TimerUL-NTN for the corresponding HARQ process in the first symbol after the end of the first transmission (within a bundle) of the corresponding PUSCH transmission.

3> else:
4> if drx-LastTransmission UL is configured:
\( 5> \) start the \( d r x \)-HARQ-RTT-TimerUL for the corresponding HARQ process in the first symbol after the end of the last transmission (within a bundle) of the corresponding PUSCH transmission.

4 else:
\( 5> \) start the drx-HARQ-RTT-Timer UL for the corresponding HARQ process in the first symbol after the end of the first transmission (within a bundle) of the corresponding PUSCH transmission.

3> stop the drx-RetransmissionTimer UL for the corresponding HARQ process.
\( 2> \) if the PDCCH indicates an SL transmission:
\( 3> \) if the PUCCH resource is configured:
4> start the drx-HARQ-RTT-TimerSL for the corresponding HARQ process in the first symbol after the end of the corresponding PUCCH transmission carrying the SL HARQ feedback; or

ETSI


--- Page 100  ---


3GPP TS 38.321 version 18.2.0 Release 18
99
ETSI TS 138321 V18.2.0 (2024-08)

\( 4> \) start the \( d r x-H A R Q-R T T \)-TimerSL for the corresponding HARQ process in the first symbol after the end of the corresponding PUCCH resource for the SL HARQ feedback when the PUCCH is not transmitted;
\( 4> \) stop the \( d r x \)-RetransmissionTimerSL for the corresponding HARQ process.
\( 3> \) else:
\( 4> \) start the \( d r x-H A R Q-R T T \)-TimerSL for the corresponding HARQ process at the first symbol after end of PDCCH occasion;
\( 4> \) stop the \( d r x \)-RetransmissionTimerSL for the corresponding HARQ process.
\( 2> \) if the PDCCH indicates a new transmission (DL, UL or SL) on a Serving Cell in this DRX group:
\( 3> \) start or restart drx-InactivityTimer for this DRX group in the first symbol after the end of the PDCCH reception.

NOTE 3a: A PDCCH indicating activation of SPS, configured grant type 2, or configured sidelink grant of configured grant Type 2 is considered to indicate a new transmission.

NOTE 3b: If the PDCCH reception includes two PDCCH candidates from corresponding search spaces, as described in clause 10.1 in 38.213, start or restart drx-InactivityTimer for this DRX group in the first symbol after the end of the PDCCH candidate that ends later in time.
\( 2> \) if a HARQ process receives downlink feedback information and acknowledgement is indicated:
\( 3> \) stop the \( d r x \)-RetransmissionTimer \( U L \) for the corresponding HARQ process.
\( 1> \) if DCP monitoring is configured for the active DL BWP as specified in TS 38.213 [6], clause 10.3; and
\( 1> \) if the current symbol n occurs within drx-onDurationTimer duration; and
\( 1> \) if drx-onDurationTimer associated with the current DRX cycle is not started as specified in this clause:
\( 2> \) if the MAC entity would not be in Active Time considering grants/assignments/DRX Command MAC CE/Long DRX Command MAC CE received and Scheduling Request sent until 4 ms prior to symbol n when evaluating all DRX Active Time conditions as specified in this clause; and
\( 2> \) if allowCSI-SRS-Tx-MulticastDRX-Active is not configured, or if cfr-ConfigMulticast is not configured for any of the active BWP(s) of the Serving Cell(s), or if all multicast DRXes would not be in Active Time considering multicast assignments/DRX Command MAC CE for MBS multicast received until 4 ms prior to symbol \( n \) when evaluating all DRX Active Time conditions as specified in Clause 5.7b and all multicast sessions are configured with multicast DRX:
\( 3> \) not transmit periodic SRS and semi-persistent SRS defined in TS 38.214 [7];
\( 3> \) not report semi-persistent CSI configured on PUSCH;
\( 3> \) not report semi-persistent CSI on PUCCH;
\( 3> \) if \( p s \)-TransmitPeriodicLl-RSRP is not configured with value true:
4 not report periodic CSI that is L1-RSRP on PUCCH.
\( 3> \) if \( p s \)-TransmitOtherPeriodicCSI is not configured with value true:
4 not report periodic CSI that is not L1-RSRP on PUCCH.
1> else:
\( 2> \) in current symbol \( n \), if a DRX group would not be in Active Time considering grants/assignments scheduled on Serving Cell(s) in this DRX group and DRX Command MAC CE/Long DRX Command MAC CE received and Scheduling Request sent until 4 ms prior to symbol n when evaluating all DRX Active Time conditions as specified in this clause; and

ETSI


--- Page 101  ---


3GPP TS 38.321 version 18.2.0 Release 18
100
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if allowCSI-SRS-Tx-MulticastDRX-Active is not configured, or if cfr-ConfigMulticast is not configured for any of the active BWP(s) of the Serving Cell(s), or, in current symbol \( n \), if all multicast DRXes corresponding to the DRX group would not be in Active Time considering multicast assignments/DRX Command MAC CE for MBS multicast received until 4 ms prior to symbol n when evaluating all DRX Active Time conditions as specified in Clause 5.7b and all multicast sessions corresponding to the DRX group are configured with multicast DRX:

3> not transmit periodic SRS and semi-persistent SRS defined in TS 38.214 [7] in this DRX group;
3> not report CSI on PUCCH and semi-persistent CSI configured on PUSCH in this DRX group.
\( 2> \) if CSI masking ( \( c s i-M a s k \) ) is setup by upper layers:
\( 3> \) in current symbol n , if drx-onDurationTimer of a DRX group would not be running considering grants/assignments scheduled on Serving Cell(s) in this DRX group and DRX Command MAC CE/Long DRX Command MAC CE received until 4 ms prior to symbol n when evaluating all DRX Active Time conditions as specified in this clause; and

3> if allowCSI-SRS-Tx-MulticastDRX-Active is not configured, or if cfr-ConfigMulticast is not configured for any of the active BWP(s) of the Serving Cell(s), or, in current symbol n, if drxonDurationTimerPTM(s) of all multicast DRXes corresponding to the DRX group would not be running considering DRX Command MAC CE for MBS multicast received until 4 ms prior to symbol n when evaluating all DRX Active Time conditions as specified in Clause 5.7b and all multicast sessions corresponding to the DRX group are configured with multicast DRX:
\( 4> \) not report CSI on PUCCH in this DRX group.
NOTE 4: If a UE multiplexes a CSI configured on PUCCH with other overlapping UCI(s) according to the procedure specified in TS 38.213 [6] clause 9.2.5 and this CSI multiplexed with other UCI(s) would be reported on a PUCCH resource either outside DRX Active Time of the DRX group in which this PUCCH is configured or outside the on-duration period of the DRX group in which this PUCCH is configured if CSI masking is setup by upper layers, it is up to UE implementation whether to report this CSI multiplexed with other \( \mathrm{UCl}(\mathrm{s}) \).

The MAC entity shall ensure no rounding error is generated when performing the modulus operation with \( d r x \) NonIntegerShortCycle or drx-NonIntegerLongCycle as the divisor.

Regardless of whether the MAC entity is monitoring PDCCH or not on the Serving Cells in a DRX group, the MAC entity transmits HARQ feedback, aperiodic CSI on PUSCH, and aperiodic SRS defined in TS 38.214 [7] on the Serving Cells in the DRX group when such is expected.

The MAC entity needs not to monitor the PDCCH if it is not a complete PDCCH occasion (e.g. the Active Time starts or ends in the middle of a PDCCH occasion).

When drx-LastTransmissionUL is configured, drx-HARQ-RTT-TimerUL or HARQ-RTT-TimerUL-NTN is started after the last PUSCH transmission occasion of a bundle regardless of whether that last PUSCH transmission occasion is used for a PUSCH transmission for that bundle or not.
5.7a Discontinuous Reception (DRX) for MBS Broadcast

For MBS broadcast, the MAC entity may be configured by RRC with a DRX functionality per G-RNTI that controls the UE's PDCCH monitoring activity for the MAC entity's G-RNTI(s) as specified in TS 38.331 [5]. When in RRC_IDLE or RRC_INACTIVE or RRC_CONNECTED, if broadcast DRX is configured for a G-RNTI, the MAC entity is allowed to monitor the PDCCH for this G-RNTI discontinuously using the broadcast DRX operation specified in this clause; otherwise the MAC entity monitors each PDCCH for this G-RNTI as specified in TS 38.213 [6]. The broadcast DRX operation specified in this clause is performed independently for each G-RNTI and independently from the DRX operation specified in clauses 5.7 and 5.7b.

RRC controls broadcast DRX operation by configuring the following parameters:
- drx-onDurationTimerPTM: the duration at the beginning of a DRX cycle;
- drx-SlotOffsetPTM : the delay before starting the drx-onDurationTimerPTM;

ETSI


--- Page 102  ---


3GPP TS 38.321 version 18.2.0 Release 18
101
ETSI TS 138321 V18.2.0 (2024-08)
- drx-InactivityTimerPTM: the duration after the PDCCH occasion in which a PDCCH indicates a new DL broadcast transmission for the MAC entity;
- drx-LongCycleStartOffsetPTM: the long DRX cycle drx-LongCycle-PTM and drx-StartOffset-PTM which defines the subframe where the DRX cycle starts.

When broadcast DRX is configured for a G-RNTI, the Active Time includes the time while:
- drx-onDurationTimerPTM or drx-InactivityTimerPTM for this G-RNTI is running.

When broadcast DRX is configured for a G-RNTI, the MAC entity shall for this G-RNTI:
\( 1> \) if \( [(\mathrm{SFN} \times 10)+ \) subframe number \( ] \) modulo \( ( \) drx-LongCycle-PTM \( )= \) drx-StartOffset-PTM
\( 2> \) start drx-onDurationTimerPTM after drx-SlotOffsetPTM from the beginning of the subframe.
\( 1> \) if the MAC entity is in Active Time for this G-RNTI:
◇ monitor the PDCCH for this G-RNTI as specified in TS 38.213 [6];
\( 2> \) if the PDCCH indicates a DL transmission for MBS broadcast:
3> start or restart drx-InactivityTimerPTM in the first symbol after the end of the PDCCH reception.
NOTE: If a cell is configured for MBS broadcast reception, the SFN of this cell is used to calculate the DRX duration of MBS broadcast on this cell.
5.7b Discontinuous Reception (DRX) for MBS Multicast

For MBS multicast, the MAC entity may be configured by RRC with a DRX functionality per G-RNTI or per G-CSRNTI that controls the UE's PDCCH monitoring activity for the MAC entity's G-RNTI(s) and G-CS-RNTI(s) as specified in TS 38.331 [5]. When in RRC_CONNECTED, if multicast DRX is configured for a G-RNTI or G-CSRNTI, the MAC entity is allowed to monitor the PDCCH for this G-RNTI or G-CS-RNTI discontinuously using the multicast DRX operation specified in this clause; otherwise the MAC entity monitors the PDCCH for this G-RNTI or G-CS-RNTI as specified in TS 38.213 [6]. When in RRC_INACTIVE, if the UE is configured to receive multicast in RRC_INACTIVE and multicast DRX is configured for a G-RNTI, the MAC entity is allowed to monitor the PDCCH for this G-RNTI discontinuously using the multicast DRX operation specified in this clause; otherwise the MAC entity monitors the PDCCH for this G-RNTI as specified in TS 38.213 [6]. The multicast DRX operation specified in this clause is performed independently for each G-RNTI or G-CS-RNTI and independently from the DRX operation specified in clauses 5.7 and 5.7a.

RRC controls multicast DRX operation per G-RNTI or per G-CS-RNTI by configuring the following parameters:
- drx-onDurationTimerPTM: the duration at the beginning of a DRX cycle;
- drx-SlotOffsetPTM : the delay before starting the drx-onDurationTimerPTM;
- drx-InactivityTimerPTM: the duration after the PDCCH occasion in which a PDCCH indicates a new DL multicast transmission for the MAC entity;
- drx-LongCycleStartOffsetPTM: the long DRX cycle drx-LongCycle-PTM and drx-StartOffset-PTM which defines the subframe where the long DRX cycle starts;
- drx-RetransmissionTimerDL-PTM (per DL HARQ process for MBS multicast): the maximum duration until a DL multicast retransmission is received;
- drx-HARQ-RTT-TimerDL-PTM (per DL HARQ process for MBS multicast): the minimum duration before a DL multicast assignment for HARQ retransmission is expected by the MAC entity.

The following MAC timer is used for DRX operation in a non-terrestrial network:
- HARQ-RTT-TimerDL-PTM-NTN (per DL HARQ process for MBS multicast): the minimum duration before a DL multicast assignment for HARQ retransmission is expected by the MAC entity.

When multicast DRX is configured for a G-RNTI or G-CS-RNTI, the Active Time includes the time while:

ETSI


--- Page 103  ---


3GPP TS 38.321 version 18.2.0 Release 18
102
ETSI TS 138321 V18.2.0 (2024-08)
- drx-onDurationTimerPTM or drx-InactivityTimerPTM or drx-RetransmissionTimerDL-PTM for this G-RNTI or G-CS-RNTI is running.

When multicast DRX is not configured for a G-RNTI or G-CS-RNTI, and the cfr-ConfigMulticast is configured for at least one of the active BWP(s) of the Serving Cell(s), and unicast DRX is configured, the MAC entity shall for this GRNTI or G-CS-RNTI:
\( 1> \) monitor the PDCCH as specified in TS 38.213 [6];
\( 1> \) if the PDCCH indicates a DL multicast transmission; or
\( 1> \) if a MAC PDU is received in a configured downlink multicast assignment:
\( 2> \) stop the \( d r x \)-RetransmissionTimerDL for the corresponding HARQ process.
\( 1> \) if the PDCCH addressed to G-RNTI indicates a DL multicast transmission; or
\( 1> \) if the PDCCH addressed to G-CS-RNTI indicates a DL multicast transmission and CS-RNTI is configured; or
\( 1> \) if a MAC PDU is received in a configured downlink multicast assignment and CS-RNTI is configured:
\( 2> \) if the first HARQ-ACK reporting mode (i.e ack-nack) is used as specified in TS 38.213 [6]; and
2 if HARQ feedback for MBS multicast is enabled:
\( 3> \) if the MAC PDU is received on a non-terrestrial network and the UE supports harq-RTT-TimerDL-ForNTN-MulticastMBS-r17:
\( 4> \) set \( H A R Q-R T T \)-TimerDL-NTN for the corresponding HARQ process equal to \( d r x-H A R Q-R T T \) Timer \( D L \) plus the latest available UE-gNB RTT value;
\( 4> \) start the HARQ-RTT-TimerDL-NTN for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.
\( 3> \) else:
\( 4> \) start the \( d r x \)-HARQ-RTT-TimerDL for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.

When multicast DRX is configured for a G-RNTI or G-CS-RNTI, and the cfr-ConfigMulticast is configured for at least one of the active BWP(s) of the Serving Cell(s), or when multicast DRX is configured for a G-RNTI for multicast in RRC_INACTVE, the MAC entity shall for this G-RNTI or G-CS-RNTI:
\( 1> \) if a MAC PDU is received in a configured downlink multicast assignment:
\( 2> \) if HARQ feedback for MBS multicast is enabled:
\( 3> \) if the MAC PDU is received on a non-terrestrial network and the UE supports harq-RTT-TimerDL-ForNTN-MulticastMBS-r17:
\( 4> \) set \( H A R Q-R T T \)-TimerDL-PTM-NTN for the corresponding HARQ process equal to \( d r x-H A R Q-R T T \) Timer D L-PTM plus the latest available UE-gNB RTT value;
\( 4> \) start the HARQ-RTT-TimerDL-PTM-NTN for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.
\( 3> \) else:
\( 4> \) start the drx-HARQ-RTT-TimerDL-PTM for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback;
\( 3> \) if the first HARQ-ACK reporting mode (i.e. ack-nack) is used as specified in TS 38.213 [6]; and
\( 3> \) if CS-RNTI is configured:
4 if the MAC PDU is received on a non-terrestrial network and the UE supports harq-RTT-TimerDL-ForNTN-MulticastMBS-r17:

ETSI


--- Page 104  ---


3GPP TS 38.321 version 18.2.0 Release 18
103
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) set HARQ-RTT-TimerDL-NTN for the corresponding HARQ process equal to drx-HARQ-RTTTimer D L plus the latest available UE-gNB RTT value;
\( 5> \) start the HARQ-RTT-TimerDL-NTN for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.

4> else:
5> start the drx-HARQ-RTT-TimerDL for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.
\( 2> \) else if drx-HARQ-RTT-TimerDL-PTM is configured:
3> if the MAC PDU is received on a non-terrestrial network and the UE supports harq-RTT-TimerDL-ForNTN-MulticastMBS-r17:

4> set HARQ-RTT-TimerDL-PTM-NTN for the corresponding HARQ process equal to drx-HARQ-RTT-TimerDL-PTM plus the latest available UE-gNB RTT value;

4> start the HARQ-RTT-TimerDL-PTM-NTN for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback that would be performed if HARQ feedback were enabled.
\( 3> \) else:
4> start the drx-HARQ-RTT-TimerDL-PTM for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback that would be performed if HARQ feedback were enabled.
\( 2> \) stop the \( d r x \)-RetransmissionTimerDL-PTM for the corresponding HARQ process;
\( 2> \) stop the drx-RetransmissionTimerDL for the corresponding HARQ process.
1> if a drx-HARQ-RTT-TimerDL-PTM expires:
\( 2> \) if the data of the corresponding HARQ process was not successfully decoded:
3> start the drx-RetransmissionTimerDL-PTM for the corresponding HARQ process in the first symbol after the expiry of drx-HARQ-RTT-TimerDL-PTM.

1> if a HARQ-RTT-TimerDL-PTM-NTN expires:
\( 2> \) if the data of the corresponding HARQ process was not successfully decoded:
3> start the drx-RetransmissionTimerDL-PTM for the corresponding HARQ process in the first symbol after the expiry of HARQ-RTT-TimerDL-PTM-NTN.

1> if a DRX Command MAC CE indicated by PDCCH addressed to a G-RNTI or G-CS-RNTI, or by a configured downlink multicast assignment is received:
\( 2> \) stop drx-onDurationTimerPTM of the DRX for this G-RNTI or G-CS-RNTI, or the corresponding G-CSRNTI;
\( 2> \) stop drx-InactivityTimerPTM of the DRX for this G-RNTI or G-CS-RNTI, or the corresponding G-CS-RNTI.
\( 1> \) if \( [( \) SFN \( \times 10)+ \) subframe number \( ] \) modulo \( ( \) drx-LongCycle-PTM \( )= \) drx-StartOffset-PTM:
\( 2> \) start drx-onDurationTimerPTM after drx-SlotOffsetPTM from the beginning of the subframe.
1> if the MAC entity is in Active Time for this G-RNTI or G-CS-RNTI:
2> monitor the PDCCH for this G-RNTI or G-CS-RNTI as specified in TS 38.213 [6];
\( 2> \) if the PDCCH indicates a DL multicast transmission:
3> if HARQ feedback for MBS multicast is enabled:

ETSI


--- Page 105  ---


3GPP TS 38.321 version 18.2.0 Release 18
104
ETSI TS 138321 V18.2.0 (2024-08)

\( 4> \) if the PDCCH is indicated on a non-terrestrial network and the UE supports harq-RTT-TimerDL-ForNTN-MulticastMBS-r17:
\( 5> \) set HARQ-RTT-TimerDL-PTM-NTN for the corresponding HARQ process equal to drx-HARQ-RTT-TimerDL-PTM plus the latest available UE-gNB RTT value;
\( 5> \) start the HARQ-RTT-TimerDL-PTM-NTN for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.

4> else:
\( 5> \) start the drx-HARQ-RTT-TimerDL-PTM for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback;

4> if the first HARQ-ACK reporting mode (i.e. ack-nack) is used as specified in TS 38.213 [6]:
\( 5> \) if the PDCCH addressed to G-RNTI indicates a DL multicast transmission; or
\( 5> \) if the PDCCH addressed to G-CS-RNTI indicates a DL multicast transmission and CS-RNTI is configured:
\( 6> \) if the PDCCH is indicated on a non-terrestrial network and the UE supports harq-RTT-TimerDL-ForNTN-MulticastMBS-r17:
\( 7> \) set HARQ-RTT-TimerDL-NTN for the corresponding HARQ process equal to drx-HARQ-RTT-TimerDL plus the latest available UE-gNB RTT value;
\( 7> \) start the HARQ-RTT-TimerDL-NTN for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.
\( 6> \) else:
7> start the drx-HARQ-RTT-TimerDL for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback.

3> else if drx-HARQ-RTT-TimerDL-PTM is configured for multicast in RRC_INACTIVE, and the UE supports ptm-RetransmissionInactive:

4> start the drx-HARQ-RTT-TimerDL-PTM for the corresponding HARQ process in the first symbol after the end of the corresponding multicast transmission.

3> else if drx-HARQ-RTT-TimerDL-PTM is configured:
\( 4> \) if the PDCCH is indicated on a non-terrestrial network and the UE supports harq-RTT-TimerDL-
ForNTN-MulticastMBS-r17:
\( 5> \) set HARQ-RTT-TimerDL-PTM-NTN for the corresponding HARQ process equal to drx-HARQ-RTT-TimerDL-PTM plus the latest available UE-gNB RTT value;
\( 5> \) start the HARQ-RTT-TimerDL-PTM-NTN for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback that would be performed if HARQ feedback were enabled.

4> else:
\( 5> \) start the drx-HARQ-RTT-TimerDL-PTM for the corresponding HARQ process in the first symbol after the end of the corresponding transmission carrying the DL HARQ feedback that would be performed if HARQ feedback were enabled.

3> stop the drx-RetransmissionTimerDL-PTM for the corresponding HARQ process;
\( 3> \) stop the drx-RetransmissionTimerDL for the corresponding HARQ process.
2 if the PDCCH indicates a new multicast transmission for this G-RNTI or G-CS-RNTI:
3> start or restart drx-InactivityTimerPTM in the first symbol after the end of the PDCCH reception.

ETSI


--- Page 106  ---


3GPP TS 38.321 version 18.2.0 Release 18
105
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 1: A PDCCH indicating activation of multicast SPS is considered to indicate a new transmission.
NOTE 2: The UE may start the drx-HARQ-RTT-TimerDL or HARQ-RTT-TimerDL-NTN after receiving a PTM transmission only if ptp-Retx-Multicast or ptp-Retx-SPS-Multicast was included in the UECapabilityInformation message to network.

The MAC entity needs not to monitor the PDCCH for a G-RNTI or a G-CS-RNTI if it is not a complete PDCCH occasion (e.g. the Active Time for a G-RNTI or a G-CS-RNTI starts or ends in the middle of a PDCCH occasion).
5.8 Transmission and reception without dynamic scheduling
5.8.1 Downlink

Semi-Persistent Scheduling (SPS) is configured by RRC for a Serving Cell per BWP. Multiple assignments can be active simultaneously in the same BWP. Activation and deactivation of the DL SPS are independent among the Serving Cells.

For the DL SPS, a DL assignment is provided by PDCCH, and stored or cleared based on L1 signalling indicating SPS activation or deactivation.

RRC configures the following parameters when the SPS is configured:
- cs-RNTI: CS-RNTI for activation, deactivation, and retransmission;
- nrofHARQ-Processes: the number of configured HARQ processes for SPS;
- harq-ProcID-Offset: Offset of HARQ process for SPS;
- periodicity: periodicity of configured downlink assignment for SPS.

When the SPS is released by upper layers, all the corresponding configurations shall be released.
After a downlink assignment is configured for SPS, the MAC entity shall consider sequentially that the \( \mathrm{N}^{\text {th }} \) downlink assignment occurs in the slot for which:
```
    (numberOfSiotsPerFrame × SFN + slot number in the frame \( )= \)
[(numberOfSlotsPerFrame × SF \( \left.\mathrm{N}_{\text {start ume }}+\operatorname{slot}_{\text {start ume }}\right)+\mathrm{N} \times \) periodicity × numberOfSlotsPerFrame / 10]
        modulo (1024 × numberOfSlotsPerFrame)
```

where \( \mathrm{SFN}_{\text {start ume }} \) and slot \( { }_{\text {start ume }} \) are the SFN and slot, respectively, of the first transmission of PDSCH where the configured downlink assignment was (re-)initialised.

NOTE: In case of unaligned SFN across carriers in a cell group, the SFN of the concerned Serving Cell is used to calculate the occurrences of configured downlink assignments.
5.8.1a Downlink for Multicast

MBS Semi-Persistent Scheduling (SPS) is only applicable for UEs in RRC_CONNECTED and is configured by RRC on one Serving Cell per BWP. Multiple assignments can be active simultaneously in the same BWP.

For the DL MBS SPS, a DL assignment is provided by PDCCH, and stored or cleared based on L1 signalling indicating SPS activation or deactivation.

RRC configures the following parameters when the MBS SPS is configured:
- cs-RNTI: CS-RNTI for MBS SPS deactivation, PTP for PTM retransmission if configured;
- \( g \)-cs-RNTI: G-CS-RNTI for activation, deactivation, and retransmission;
- nrofHARQ-Processes: the number of configured HARQ processes for MBS SPS;
- harq-ProcID-Offset: Offset of HARQ process for MBS SPS;
- periodicity: periodicity of configured downlink assignment for MBS SPS.

ETSI


--- Page 107  ---


3GPP TS 38.321 version 18.2.0 Release 18
106
ETSI TS 138321 V18.2.0 (2024-08)

When the MBS SPS is released by upper layers, all the corresponding configurations shall be released.
After a downlink assignment is configured for MBS SPS, the MAC entity shall consider sequentially that the \( \mathrm{N}^{\text {th }} \) downlink assignment occurs in the slot for which:
\[
\begin{array}{c}
\text { (numberOfSlotsPerFrame } \text { × } \mathrm{SFN}+\text { slot number in the frame })= \\
{\left[\left(\text { numberOfSlotsPerFrame } \text { × } \text { SFN }_{\text {start ume }}+\text { slot } \text { t }_{\text {start }} \text { ume }\right)+\mathrm{N} \times \text { periodicity } \text { × } \text { numberOfSlotsPerFrame } / 10\right]} \\
\text { modulo }(1024 \times \text { numberOfSlotsPerFrame })
\end{array}
\]
where \( \mathrm{SFN}_{\text {start ame }} \) and slot \( { }_{\text {start tume }} \) are the SFN and slot, respectively, of the first transmission of PDSCH where the configured downlink assignment was (re-)initialised.
5.8.2 Uplink

There are two types of transmission without dynamic grant:
- configured grant Type 1 where an uplink grant is provided by RRC, and stored as configured uplink grant;
- configured grant Type 2 where an uplink grant is provided by PDCCH, and stored or cleared as configured uplink grant based on L1 signalling indicating configured uplink grant activation or deactivation.

Type 1 and Type 2 are configured by RRC for a Serving Cell per BWP. Multiple configurations can be active simultaneously in the same BWP. For Type 2, activation and deactivation are independent among the Serving Cells. For the same BWP, the MAC entity can be configured with both Type 1 and Type 2.

A multi-PUSCH configured grant has multiple consecutive configured uplink grants within a periodicity. Both Type 1 and Type 2 can be configured for a multi-PUSCH configured grant by RRC.

Only configured grant Type 1 can be configured for CG-SDT or for RACH-less LTM cell switch or for RACH-less handover. CG-SDT can only be configured on initial BWP.

RRC configures the following parameters when the configured grant Type 1 is configured:
- cs-RNTI: CS-RNTI for retransmission;
- cg-SDT-CS-RNTI: CS-RNTI for CG-SDT retransmission;
- cg-SDT-RSRP-ThresholdSSB: an RSRP threshold configured for SSB selection for CG-SDT;
- cg-RRC-RSRP-ThresholdSSB: an RSRP threshold configured for SSB selection for RACH-less handover;
- periodicity: periodicity of the configured grant Type 1;
- timeDomainOffset: Offset of a resource with respect to SFN = timeReferenceSFN in time domain;
- timeDomainAllocation: Allocation of configured uplink grant in time domain which contains startSymbolAndLength (i.e. SLIV in TS 38.214 [7]) or startSymbol (i.e. S in TS 38.214 [7]);
- nrofHARQ-Processes: the number of HARQ processes for configured grant;
- harq-ProcID-Offset: offset of HARQ process for configured grant configured with cg-RetransmissionTimer for operation with shared spectrum channel access;
- harq-ProcID-Offset2: offset of HARQ process for configured grant not configured with cgRetransmissionTimer;
- timeReferenceSFN: SFN used for determination of the offset of a resource in time domain. The UE uses the closest SFN with the indicated number preceding the reception of the configured grant configuration;
- timeReferenceH-SFN: H-SFN used for determination of the offset of a resource in time domain. The UE uses the closest H-SFN with the indicated number preceding the reception of the configured grant configuration.

RRC configures the following parameters when the configured grant Type 2 is configured:
- cs-RNTI: CS-RNTI for activation, deactivation, and retransmission;

ETSI


--- Page 108  ---


3GPP TS 38.321 version 18.2.0 Release 18
107
ETSI TS 138321 V18.2.0 (2024-08)
- periodicity: periodicity of the configured grant Type 2;
- nrofHARQ-Processes: the number of HARQ processes for configured grant;
- harq-ProcID-Offset: offset of HARQ process for configured grant configured with cg-RetransmissionTimer for operation with shared spectrum channel access;
- harq-ProcID-Offset2: offset of HARQ process for configured grant not configured with cgRetransmissionTimer.

RRC configures the following parameter when retransmissions on configured uplink grant is configured:
- cg-RetransmissionTimer: the duration after a configured grant (re)transmission of a HARQ process when the UE shall not autonomously retransmit that HARQ process;
- cg-SDT-RetransmissionTimer: the duration after a configured grant (re)transmission of a HARQ process of the initial CG-SDT transmission with CCCH message when the UE shall not autonomously retransmit the HARQ process;
- cg-RRC-RetransmissionTimer: the duration after a configured grant (re)transmission of a HARQ process of the initial transmission of RACH-less handover and RACH-less LTM cell switch when the UE shall not autonomously retransmit the HARQ process.

RRC configures the following parameter when a multi-PUSCH configured grant is configured:
- nrofSIotsInCG-Period: the number of configured uplink grants in a periodicity of a multi-PUSCH configured grant.

RRC configures the following parameter when UTO-UCI (as specified in clause 9.3 in TS 38.213 [6]) is configured for a configured grant:
- nrofBitsInUTO-UCI: number of bits in a UTO-UCI bitmap.

For a configured uplink grant, the MAC entity shall:
\( 1> \) if its associated configured grant is configured with UTO-UCI and it has not been indicated to the lower layers as unused for PUSCH transmission; or
\( 1> \) if its associated configured grant is not configured with UTO-UCI:
\( 2> \) if it is associated with a multi-PUSCH configured grant and meets the validity conditions specified in the clause 6.1 in TS 38.214 [7]; or

2 if it is not associated with a multi-PUSCH configured grant:
\( 3> \) consider it available for use.
The MAC entity shall not include the UL-SCH resource of a configured uplink grant not available for use in its procedures (e.g. in clause 5.4.4).

For a configured grant configured with UTO-UCI, the MAC entity determines if a configured uplink grant which is within the subsequent nrofBitsInUTO-UCI valid occasions of its associated configured grant configuration is going to be used for PUSCH transmission by considering at least the amount of buffered data that can be transmitted on the available occasions of the associated configured grant and other available UL-SCH resources. Upon this determination, the MAC entity sends an indication to lower layers, for use in the procedure for reporting UTO-UCI.

Upon configuration of a configured grant Type 1 for a BWP of a Serving Cell by upper layers, the MAC entity shall:
\( 1> \) store the uplink grant provided by upper layers as a configured uplink grant for the indicated BWP of the Serving Cell;
\( 1> \) initialise or re-initialise the configured uplink grant to start in the symbol according to timeDomainOffset, timeReferenceSFN, and S (derived from SLIV or provided by startSymbol as specified in TS 38.214 [7]), and to reoccur with periodicity.

If cg-SDT-PeriodicityExt (as defined in TS 38.331 [5]) is not configured, after an uplink grant is configured for a configured grant Type 1, the MAC entity shall consider sequentially that the configured uplink grant, or the first

ETSI


--- Page 109  ---


3GPP TS 38.321 version 18.2.0 Release 18
108
ETSI TS 138321 V18.2.0 (2024-08)

configured uplink grant in a multi-PUSCH configured grant, in the \( \mathrm{N}^{\text {th }}(\mathrm{N} \geq 0) \) periodicity occurs in the symbol for which:
```
            [(SFN × numberOfSlotsPerFrame × numberOfSymbolsPerSlot)
\( +( \) slot number in the frame × numberOfSymbolsPerSlot \( )+ \) symbol number in the slot \( ]= \)
    (timeReferenceSFN × numberOfSlotsPerFrame × numberOfSymbolsPerSlot
        + timeDomainOffset × numberOfSymbolsPerSlot \( +\mathrm{S}+\mathrm{N} \times \) periodicity)
        modulo (1024 × numberOfSlotsPerFrame × numberOfSymbolsPerSlot)
```


If cg-SDT-PeriodicityExt (as defined in TS 38.331 [5]) is configured, after an uplink grant is configured for a configured grant Type 1, the MAC entity shall consider sequentially that the configured uplink grant, or the first configured uplink grant in a multi-PUSCH configured grant, in the \( \mathrm{N}^{\text {th }}(\mathrm{N} \geq 0) \) periodicity occurs in the symbol for which:
```
[( H -SFN × numberOfSFNperH-SFN +SFN\( ) \times \) numberOfSlotsPerFrame × numberOfSymbolsPerSlot
    + (slot number in the frame × numberOfSymbolsPerSlot \( )+ \) symbol number in the slot] \( = \)
            ((timeReferenceH-SFN × numberOfSFNperH-SFN + timeReferenceSFN)
                × numberOfSlotsPerFrame × numberOfSymbolsPerSlot
            + timeDomainOffset × numberOfSymbolsPerSlot \( +\mathrm{S}+\mathrm{N} \times \) periodicity)
        modulo ( \( 1024 \times 1024 \times \) numberOfSlotsPerFrame × numberOfSymbolsPerSlot)
```


For a multi-PUSCH configured grant Type 1 , the \( \mathrm{M}^{\text {th }}(1<\mathrm{M} \leq \) nrofSlotsInCG-Period) configured uplink grant within a periodicity occurs (M-1) × numberOfSymbolsPerSlot symbols after the symbol in which the first configured uplink grant in that periodicity occurs.

For an uplink grant configured for configured grant Type 1 for CG-SDT on the selected uplink carrier as in clause 5.27, when CG-SDT is triggered and not terminated, for each configured uplink grant valid according to TS 38.214 [7] for which the above formula is satisfied, the MAC entity shall:

1> if, after initial transmission for CG-SDT with CCCH message has been performed according to clause 5.4.1, PDCCH addressed to the MAC entity's C-RNTI has not been received:
\( 2> \) if the SSB corresponding to the configured UL grant has the same SSB index as the SSB selected for initial transmission for CG-SDT with CCCH message (i.e., retransmission of initial transmission of CG-SDT):

3> select this SSB;
3> indicate the SSB index corresponding to the configured uplink grant to the lower layer;
\( 3> \) consider this configured uplink grant as valid.
1> else if at least one SSB configured for CG-SDT with SS-RSRP above cg-SDT-RSRP-ThresholdSSB is available:
\( 2> \) if at least one SSB corresponding to the configured uplink grant with SS-RSRP above the cg-SDT-RSRPThresholdSSB is available:

3> if this is the initial transmission of CG-SDT with CCCH message after the CG-SDT procedure is initiated as in clause 5.27 (i.e., initial transmission for CG-SDT):

4> select an SSB with SS-RSRP above cg-SDT-RSRP-ThresholdSSB amongst the SSB(s) associated with the configured uplink grant.

3> else if PDCCH addressed to C-RNTI has been received after the initial transmission of CG-SDT with CCCH message (i.e., subsequent new transmission for CG-SDT):
\( 4> \) if SS-RSRP of the SSB selected for the previous transmission for CG-SDT is above cg-SDT-RSRPThresholdSSB and this SSB is associated with this configured uplink grant:
\( 5> \) select this SSB.
4> else if SS-RSRP of the SSB selected for the previous transmission for CG-SDT is not above cg-SDT-RSRP-ThresholdSSB:
\( 5> \) select an SSB with SS-RSRP above cg-SDT-RSRP-ThresholdSSB amongst the SSB(s) associated with the configured uplink grant.

ETSI


--- Page 110  ---


3GPP TS 38.321 version 18.2.0 Release 18
109
ETSI TS 138321 V18.2.0 (2024-08)

\( 3> \) if SSB is selected above:
\( 4> \) indicate the SSB index to the lower layer;
\( 4> \) consider this configured uplink grant as valid.
1> else:
\( 2> \) consider this configured uplink grant as not valid.
\( 2> \) if PDCCH addressed to C-RNTI after the initial transmission of the CG-SDT with CCCH message has been received:
\( 3> \) if there is data available for transmission for at least one RB configured for SDT:
\( 4> \) initiate Random Access procedure in clause 5.1
NOTE 1: Void.
For an uplink grant configured for configured grant Type 1 for RACH-less LTM cell switch, when there is an ongoing RACH-less LTM cell switch procedure, for each configured uplink grant valid according to TS 38.214 [7] for which the above formula is satisfied, the MAC entity shall:

1> if an SSB corresponding to the configured UL grant has the same SSB index as the SSB associated with the TCI state indicated by the TCI state ID field in LTM Cell Switch Command MAC CE, as specified in clause 5.18.35:
\( 2> \) select the SSB associated with the TCI state indicated by LTM Cell Switch Command MAC CE.
\( 2> \) indicate the SSB index to the lower layer;
\( 2> \) consider this configured uplink grant as valid.
1> else:
\( 2> \) consider this configured uplink grant as not valid.
NOTE 1a: When there is an ongoing RACH-less LTM cell switch, the configured grant Type 1 which is not specifically configured for LTM (see cg-LTM-Configuration in TS 38.331 [5]) is not used.

NOTE 1b:After completion of LTM cell switch, the UE stops using the grant configured for RACH-less LTM cell switch (see cg-LTM-Configuration in TS 38.331 [5]).

For the uplink grant configured for configured grant Type 1 for RACH-less handover, if the configured uplink grant is valid according to TS 38.214 [7] for which the above formula is satisfied, the MAC entity shall:
\( 1> \) if, after the initial transmission of RACH-less handover has been performed according to clause 5.4 .1 and 5.33 , PDCCH addressed to the MAC entity's C-RNTI has not been received:
\( 2> \) if the SSB corresponding to the configured UL grant has the same SSB index as the SSB selected for the initial transmission of RACH-less handover (ie-, retransmission of initial transmission of RACH-less handover):
\( 3> \) select this SSB;
\( 3> \) indicate the SSB index corresponding to the configured uplink grant to the lower layer;
\( 3> \) consider this configured uplink grant as valid.
\( 1> \) else if at least one SSB corresponding to the configured uplink grant with SS-RSRP above cg-RRC-RSRP-
ThresholdSSB is available:
\( 2> \) select an SSB with SS-RSRP above cg-RRC-RSRP-ThresholdSSB amongst the SSB(s) associated with the configured uplink grant;
\( 2> \) indicate the selected SSB index to the lower layer;
\( 2> \) consider this configured uplink grant as valid.

ETSI


--- Page 111  ---


3GPP TS 38.321 version 18.2.0 Release 18
110
ETSI TS 138321 V18.2.0 (2024-08)

1> else:
\( 2> \) consider this configured uplink grant as not valid;
\( 2> \) initiate Random Access procedure in clause 5.1.
NOTE 1A: When the UE determines if there is an SSB with SS-RSRP above cg-RRC-RSRP-ThresholdSSB or cg-SDT-RSRP-ThresholdSSB, the UE uses the latest unfiltered L1-RSRP measurement.

After an uplink grant is configured for a configured grant Type 2, the MAC entity shall consider sequentially that the configured uplink grant, or the first configured uplink grant in a multi-PUSCH configured grant, in the \( \mathrm{N}^{\text {th }}(\mathrm{N} \geq 0) \) periodicity occurs in the symbol for which:
```
                [(SFN × numberOfSlotsPerFrame × numberOfSymbolsPerSlot)
\( +( \) slot number in the frame × numberOfSymbolsPerSlot \( )+ \) symbol number in the slot \( ]= \)
            [(SFN \( \mathrm{N}_{\text {start ume }} \times \) numberOfSlotsPerFrame × numberOfSymbolsPerSlot
        + slot \( _{\text {start ture }} \times \) numberOfSymbolsPerSlot + symbol \( \left._{\text {start ture }}\right)+\mathrm{N} \times \) periodicity]
            modulo ( \( 1024 \times \) numberOfSlotsPerFrame × numberOfSymbolsPerSlot)
```

where \( \mathrm{SFN}_{\text {start tume }} \), \( \operatorname{slot}_{\text {start tume }} \), and symbol \( { }_{\text {start tume }} \) are the SFN, slot, and symbol, respectively, of the first transmission opportunity of PUSCH where the configured uplink grant was (re-)initialised.

For a multi-PUSCH configured grant Type 2, the \( \mathrm{M}^{\text {th }}(1<\mathrm{M} \leq \) nrofSlotsInCG-Period) configured uplink grant within the same periodicity occurs (M-1) × numberOfSymbolsPerSlot symbols after the symbol in which the first configured uplink grant in that periodicity occurs.

If cg-nrofPUSCH-InSlot or cg-nrofNlots is configured for a configured grant Type 1 or Type 2, the MAC entity shall consider the uplink grants occur in those additional PUSCH allocations as specified in clause 6.1.2.3 of TS 38.214 [7].

NOTE 2: In case of unaligned SFN across carriers in a cell group, the SFN of the concerned Serving Cell is used to calculate the occurrences of configured uplink grants.

When the configured uplink grant is released by upper layers, all the corresponding configurations shall be released and all corresponding uplink grants shall be cleared.

The MAC entity shall:
\( 1> \) if at least one configured uplink grant confirmation has been triggered and not cancelled; and
1> if the MAC entity has UL resources allocated for new transmission:
\( 2> \) if, in this MAC entity, at least one configured uplink grant is configured by
configuredGrantConfigToAddModList:
3> instruct the Multiplexing and Assembly procedure to generate a Multiple Entry Configured Grant Confirmation MAC CE as defined in clause 6.1.3.31.
\( 2> \) else:
3> instruct the Multiplexing and Assembly procedure to generate a Configured Grant Confirmation MAC CE as defined in clause 6.1.3.7.
\( 2> \) cancel all triggered configured uplink grant confirmation(s).
For a configured grant Type 2, the MAC entity shall clear the configured uplink grant(s) immediately after first transmission of Configured Grant Confirmation MAC CE or Multiple Entry Configured Grant Confirmation MAC CE which confirms the configured uplink grant deactivation.

Retransmissions use:
- repetition of configured uplink grants; or
- received uplink grants addressed to CS-RNTI; or
- configured uplink grants with cg-RetransmissionTimer, cg-RRC-RetransmissionTimer or cg-SDTRetransmissionTimer configured

ETSI


--- Page 112  ---


3GPP TS 38.321 version 18.2.0 Release 18
111
ETSI TS 138321 V18.2.0 (2024-08)
5.8.3 Sidelink

There are two types of transmission without dynamic sidelink grant:
- configured grant Type 1 where an sidelink grant is provided by RRC, and stored as configured sidelink grant;
- configured grant Type 2 where an sidelink grant is provided by PDCCH, and stored or cleared as configured sidelink grant based on L1 signalling indicating configured sidelink grant activation or deactivation.

Type 1 and/or Type 2 are configured with a single BWP. Multiple configurations of up to 8 configured grants (including both Type 1 and Type 2, if configured) can be active simultaneously on the BWP.

RRC configures the following parameters when the configured grant Type 1 is configured, as specified in TS 38.331 [5] or TS 36.331 [21]:
- sl-ConfigIndexCG: the identifier of a configured grant for sidelink;
- sl-CS-RNTI: SL-CS-RNTI for retransmission;
- sl-NrOfHARQ-Processes: the number of HARQ processes for configured grant;
- sl-Period \( C G \) : periodicity of the configured grant Type 1;
- sl-TimeOffsetCG-Typel: Offset of a resource with respect to reference logical slot defined by sl-TimeReferenceSFN-Typel in time domain, referring to the number of logical slots in a resource pool;
- s/-TimeResourceCG-Typel: time resource location of the configured grant Type 1;
- sl-CG-MaxTransNumList: the maximum number of times that a TB can be transmitted using the configured grant;
- sl-HARQ-ProcID-offset: offset of HARQ process for configured grant Type 1;
- sl-PRS-ResourceID: SL-PRS configuration index for configured grant Type 1;
- sl-TimeReferenceSFN-Typel: SFN used for determination of the offset of a resource in time domain. If it is present, the UE uses the first logical slot of associated resource pool after the starting time of the closest SFN with the indicated number preceding the reception of the sidelink configured grant configuration Type 1 as reference logical slot. If it is absent, the indicated reference SFN is zero.

RRC configures the following parameters when the configured grant Type 2 is configured, as specified in TS 38.331 [5]:
- sl-ConfigIndexCG: the identifier of a configured grant for sidelink;
- sl-CS-RNTI: SL-CS-RNTI for activation, deactivation, and retransmission;
- sl-PRS-CS-RNTI: SL-PRS-CS-RNTI for activation, and deactivation;
- sl-NrOfHARQ-Processes: the number of HARQ processes for configured grant;
- sl-Period \( C G \) : periodicity of the configured grant Type 2;
- sl-CG-MaxTransNumList: the maximum number of times that a TB can be transmitted using the configured grant;
- sl-HARQ-ProcID-offset: offset of HARQ process for configured grant Type 2.

Upon configuration of a configured grant Type 1, the MAC entity shall for each configured sidelink grant:
\( 1> \) store the sidelink grant provided by RRC as a configured sidelink grant;
\( 1> \) initialise or re-initialise the configured sidelink grant to determine PSCCH duration(s) and PSSCH duration(s) and SL-PRS transmission occasion(s) according to sl-TimeOffsetCG-Typel and sl-TimeResourceCG-Typel, and to reoccur with sl-period \( C G \) for transmissions of multiple MAC PDUs and SL-PRS(s) according to clause 8.1.2 of TS 38.214 [7].

ETSI


--- Page 113  ---


3GPP TS 38.321 version 18.2.0 Release 18
112
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 1: If the MAC entity is configured with multiple configured sidelink grants, collision among the configured sidelink grants may occur. How to handle the collision is left to UE implementation.

After a sidelink grant is configured for a configured grant Type 1, the MAC entity shall consider sequentially that the first slot of the \( S^{\text {th }} \) sidelink grant occurs in the logical slot for which:
\[
\text { CURRENT_slot }=(s l \text {-ReferenceSlotCG-Typel }+s l \text {-TimeOffsetCG-Typel }+\mathrm{S} \times \text { PeriodicitySL }) \text { modulo } \mathrm{T}_{\max }^{\prime}
\]
where CURRENT_slot refers to current logical slot in the associated resource pool, PeriodicitySL = \( \left\lceil\frac{T^{\prime} \max ^{2}}{10240 \mathrm{~ms}} \times s\right. \) l-PeriodCG \( \rceil \) and \( \mathrm{T}_{\text {max }}^{\prime} \) is the number of slots that belongs to the associated resource pool as defined in clause 8 of TS 38.214[7]. sl-ReferenceSlotCG-Typel refers to reference logical slot defined by sl-TimeReferenceSFNTypel.

After a sidelink grant is configured for a configured grant Type 2, the MAC entity shall consider sequentially that the first slot of \( \mathrm{S}^{\text {th }} \) sidelink grant occurs in the logical slot for which:
\[
\text { CURRENT_slot }=(\text { sl-StartSlotCG-Type } 2+\mathrm{S} \times \text { PeriodicitySL }) \text { modulo } \mathrm{T}_{\max }^{\prime}
\]
where sl-StartSlotCG-Type2 refers to the logical slot of the first transmission opportunity of PSSCH or SL-PRS where the configured sidelink grant was (re)initialised.

When a configured sidelink grant is released by RRC, all the corresponding configurations shall be released and all corresponding sidelink grants shall be cleared.

The MAC entity shall:
1> if the configured sidelink grant confirmation has been triggered and not cancelled; and
\( 1> \) if the MAC entity has UL resources allocated for new transmission:
\( 2> \) instruct the Multiplexing and Assembly procedure to generate a Sidelink Configured Grant Confirmation MAC CE as defined in clause 6.1.3.34;
\( 2> \) cancel the triggered configured sidelink grant confirmation.
For a configured grant Type 2, the MAC entity shall clear the corresponding configured sidelink grant immediately after first transmission of Sidelink Configured Grant Confirmation MAC CE triggered by the configured sidelink grant deactivation.
5.9 Activation/Deactivation of SCells

If the MAC entity is configured with one or more SCells, the network may activate and deactivate the configured SCells. Upon configuration of an SCell, the SCell is deactivated unless the parameter sCellState is set to activated for the SCell by upper layers.

The configured SCell(s) is activated and deactivated by:
- receiving the SCell Activation/Deactivation MAC CE described in clause 6.1.3.10;
- receiving the Enhanced SCell Activation/Deactivation MAC CE described in clause 6.1.3.55;
- configuring sCellDeactivationTimer timer per configured SCell (except the SCell configured with PUCCH, if any): the associated SCell is deactivated upon its expiry;
- configuring sCellState per configured SCell: if configured, the associated SCell is activated upon SCell configuration;
- receiving scg-State: the SCells of SCG are deactivated.

The MAC entity shall for each configured SCell:
1> if an SCell is configured with sCellState set to activated upon SCell configuration, or an SCell Activation/Deactivation MAC CE or an Enhanced SCell Activation/Deactivation MAC CE is received activating the SCell:

ETSI


--- Page 114  ---


3GPP TS 38.321 version 18.2.0 Release 18
113
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if the SCell was deactivated prior to receiving this Enhanced SCell Activation/Deactivation MAC CE and a TRS is indicated for this SCell:
\( 3> \) indicate to lower layers the information regarding the TRS.
\( 2> \) if the SCell was deactivated prior to receiving this SCell Activation/Deactivation MAC CE or this Enhanced SCell Activation/Deactivation MAC CE; or
\( 2> \) if the SCell is configured with sCellState set to activated upon SCell configuration:
\( 3> \) if firstActiveDownlinkBWP-Id is not set to dormant BWP:
4> activate the SCell according to the timing defined in TS 38.213 [6] for MAC CE activation and according to the timing defined in TS 38.133 [11] for direct SCell activation; i.e. apply normal SCell operation including:

5> SRS transmissions on the SCell;
5> CSI reporting for the SCell;
\( 5>\mathrm{PDCCH} \) monitoring on the SCell;
\( 5>\mathrm{PDCCH} \) monitoring for the SCell;
5> PUCCH transmissions on the SCell, if configured.
3> else (i.e. firstActiveDownlinkBWP-Id is set to dormant BWP):
\( 4> \) stop the bwp-InactivityTimer of this Serving Cell, if running.
3> activate the DL BWP and UL BWP indicated by firstActiveDownlinkBWP-Id and firstActiveUplinkBWPId respectively.

2> start or restart the sCellDeactivationTimer associated with the SCell according to the timing defined in TS 38.213 [6] for MAC CE activation and according to the timing defined in TS 38.133 [11] for direct SCell activation;
\( 2> \) if the active DL BWP is not the dormant BWP:
\( 3> \) (re-)initialize any suspended configured uplink grants of configured grant Type 1 associated with this SCell according to the stored configuration, if any, and to start in the symbol according to rules in clause 5.8.2;
\( 3> \) trigger PHR according to clause 5.4.6.
1> else if an SCell Activation/Deactivation MAC CE or an Enhanced SCell Activation/Deactivation MAC CE is received deactivating the SCell; or

1> if the sCellDeactivationTimer associated with the activated SCell expires; or
1> if the SCG associated with the activated SCell is deactivated:
\( 2> \) deactivate the SCell according to the timing defined in TS 38.213 [6];
\( 2> \) stop the sCellDeactivationTimer associated with the SCell;
\( 2> \) stop the bwp-InactivityTimer associated with the SCell;
\( 2> \) deactivate any active BWP associated with the SCell;
\( 2> \) clear any configured downlink assignment and any configured uplink grant Type 2 associated with the SCell respectively;
\( 2> \) clear any PUSCH resource for semi-persistent CSI reporting associated with the SCell;
\( 2> \) suspend any configured uplink grant Type 1 associated with the SCell;
\( 2> \) flush all HARQ buffers associated with the SCell;

ETSI


--- Page 115  ---


3GPP TS 38.321 version 18.2.0 Release 18
114
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) cancel, if any, triggered consistent LBT failure for the SCell.
\( 1> \) if PDCCH on the activated SCell indicates an uplink grant or downlink assignment; or
1> if PDCCH on the Serving Cell scheduling the activated SCell indicates an uplink grant or a downlink assignment for the activated SCell; or

1> if a MAC PDU is transmitted in a configured uplink grant and LBT failure indication is not received from lower layers; or
\( 1> \) if a MAC PDU is received in a configured downlink assignment:
\( 2> \) restart the sCellDeactivationTimer associated with the SCell.
\( 1> \) if the SCell is deactivated:
\( 2> \) not transmit SRS on the SCell;
\( 2> \) not report CSI for the SCell;
\( 2> \) not transmit on UL-SCH on the SCell;
\( 2> \) not transmit on RACH on the SCell;
\( 2> \) not monitor the PDCCH on the SCell;
\( 2> \) not monitor the PDCCH for the SCell;
\( 2> \) not transmit PUCCH on the SCell;
\( 2> \) if the SCell is configured as a scheduled cell in MC-DCI-SetOfCells and with the search space for DCI to schedule multiple cells (as specified in TS 38.213 [6]) of the same searchSpaceld as the serving cell in which MC-DCI-SetOfCells containing the SCell is configured:

3> not monitor the PDCCH for scheduling multiple cells (as specified in TS 38.213 [6]) for the set of cells in MC-DCI-SetOfCells including the SCell.

When the measurement reporting for fast unknown SCell activation is configured by RRC, the MAC entity shall:
1> if SCell Activation/Deactivation MAC CE or an Enhanced SCell Activation/Deactivation MAC CE is received activating the SCell(s):
\( 2> \) if SCell(s) was deactivated prior to receiving this SCell Activation/Deactivation MAC CE or this Enhanced SCell Activation/Deactivation MAC CE:
\( 3> \) indicate to upper layers SCell(s) activation indication.
HARQ feedback for the MAC PDU containing SCell Activation/Deactivation MAC CE or Enhanced SCell Activation/Deactivation MAC CE shall not be impacted by PCell, PSCell and PUCCH SCell interruptions due to SCell activation/deactivation in TS 38.133 [11].

When SCell is deactivated, the ongoing Random Access procedure on the SCell, if any, is aborted.
5.10 Activation/Deactivation of PDCP duplication

If one or more DRBs are configured with PDCP duplication, the network may activate and deactivate the PDCP duplication for all or a subset of associated RLC entities for the configured DRB(s).

The PDCP duplication for the configured \( \operatorname{DRB}(s) \) is activated and deactivated by:
- receiving the Duplication Activation/Deactivation MAC CE described in clause 6.1.3.11;
- receiving the Duplication RLC Activation/Deactivation MAC CE described in clause 6.1.3.32;
- indication by RRC.

ETSI


--- Page 116  ---


3GPP TS 38.321 version 18.2.0 Release 18
115
ETSI TS 138321 V18.2.0 (2024-08)

The PDCP duplication for all or a subset of associated RLC entities for the configured DRB(s) is activated and deactivated by:
- receiving the Duplication RLC Activation/Deactivation MAC CE described in clause 6.1.3.32;
- indication by RRC.

The PDCP duplication for all associated RLC entities for the configured DRB(s) is activated by:
- receiving an uplink grant addressed to CS-RNTI with NDI=1 for a logical channel associated with the DRB configured with survivalTimeStateSupport, described in clause 5.4.1.

The MAC entity shall for each DRB configured with PDCP duplication:
\( 1> \) if a Duplication Activation/Deactivation MAC CE is received activating the PDCP duplication of the DRB: \( 2> \) indicate the activation of PDCP duplication of the DRB to upper layers.
\( 1> \) if a Duplication Activation/Deactivation MAC CE is received deactivating the PDCP duplication of the DRB: \( 2> \) indicate the deactivation of PDCP duplication of the DRB to upper layers.

1> if a Duplication RLC Activation/Deactivation MAC CE is received activating PDCP duplication for associated RLC entities of a DRB configured with PDCP duplication:
\( 2> \) indicate the activation of PDCP duplication for the indicated secondary RLC entity(ies) of the DRB to upper layers.

1> if a Duplication RLC Activation/Deactivation MAC CE is received deactivating PDCP duplication for associated RLC entities of a DRB configured with PDCP duplication:
\( 2> \) indicate the deactivation of PDCP duplication for the indicated secondary RLC entity(ies) of the DRB to upper layers.
\( 1> \) if activation of a PDCP duplication for all configured RLC entities is triggered for the DRB as specified in clause 5.4.1:
\( 2> \) indicate the activation of PDCP duplication for all configured RLC entities of the DRB to upper layers.
NOTE: How to identify "associated RLC entity" or equivalent entity in N3C indirect path for a configured DRB is out of scope of 3GPP.
5.11 MAC reconfiguration

When a reconfiguration of the MAC entity is requested by upper layers, the MAC entity shall:
\( 1> \) initialize the corresponding HARQ entity upon addition of an SCell;
\( 1> \) remove the corresponding HARQ entity upon removal of an SCell;
\( 1> \) apply the new value for timers when the timer is (re)started;
\( 1> \) apply the new maximum parameter value when counters are initialized;
1> apply immediately the configurations received from upper layers for other parameters.
5.12 MAC Reset

If a reset of the MAC entity is requested by upper layers upon receiving RRCResume or RRCSetup, the MAC entity shall:
\( 1> \) stop the MBS multicast DRX timers;
\( 1> \) flush the soft buffers for all DL HARQ processes used for MBS multicast;

ETSI


--- Page 117  ---


3GPP TS 38.321 version 18.2.0 Release 18
116
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) for each DL HARQ process used for MBS multicast, consider the next received transmission for a TB as the very first transmission.

Otherwise, if a reset of the MAC entity is requested by upper layers or the reset of the MAC entity is triggered due to SCG deactivation as defined in clause 5.29 , the MAC entity shall:

1> if the MAC reset is not due to SCG deactivation:
\( 2> \) initialize \( B j \) for each logical channel to zero;
\( 1> \) initialize \( S B j \) for each logical channel to zero if Sidelink resource allocation mode 1 is configured by RRC;
\( 1> \) if upper layers indicate SCG deactivation and \( b f d \)-and-RLM with value true is configured for the deactivated SCG:
\( 2> \) stop (if running) all timers except beamFailureDetectionTimer associated with PSCell and timeAlignmentTimers.

1> else:
\( 2> \) stop (if running) all timers, except MBS broadcast DRX timers;
\( 2> \) consider all timeAlignmentTimers, inactivePosSRS-TimeAlignmentTimer, and cg-SDT-TimeAlignmentTimer, if configured, as expired and perform the corresponding actions in clause 5.2;
\( 1> \) set the NDIs for all uplink HARQ processes to the value 0 ;
\( 1> \) sets the NDIs for all HARQ process [Ds to the value 0 for monitoring PDCCH in Sidelink resource allocation mode 1;
\( 1> \) stop, if any, ongoing Random Access procedure;
\( 1> \) discard explicitly signalled contention-free Random Access Resources for 4 -step RA type and 2 -step RA type, if any;
\( 1> \) flush Msg3 buffer;
\( 1> \) flush MSGA buffer;
\( 1> \) cancel, if any, triggered Scheduling Request procedure;
\( 1> \) cancel, if any, triggered Buffer Status Reporting procedure;
\( 1> \) cancel, if any, triggered Delay Status Reporting procedure;
\( 1> \) cancel, if any, triggered Power Headroom Reporting procedure;
\( 1> \) cancel, if any, triggered consistent LBT failure;
\( 1> \) cancel, if any, triggered Sidelink consistent LBT failure;
\( 1> \) cancel, if any, triggered BFR ;
\( 1> \) cancel, if any, triggered Sidelink Buffer Status Reporting procedure;
\( 1> \) cancel, if any, triggered Pre-emptive Buffer Status Reporting procedure;
\( 1> \) cancel, if any, triggered Timing Advance Reporting procedure;
\( 1> \) cancel, if any, triggered Recommended bit rate query procedure;
\( 1> \) cancel, if any, triggered Configured uplink grant confirmation;
\( 1> \) cancel, if any, triggered configured sidelink grant confirmation;
\( 1> \) clear, if any, configured sidelink grants;
\( 1> \) cancel, if any, triggered Desired Guard Symbol query;

ETSI


--- Page 118  ---


3GPP TS 38.321 version 18.2.0 Release 18
117
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) cancel, if any, triggered Positioning Measurement Gap Activation/Deactivation Request procedure;
\( 1> \) cancel, if any, triggered SDT procedure;
\( 1> \) cancel, if any, triggered [AB-MT Recommended Beam Indication query;
\( 1> \) cancel, if any, triggered Desired DL TX Power Adjustment query;
\( 1> \) cancel, if any, triggered Desired IAB-MT PSD range query;
\( 1> \) cancel, if any, triggered Case-6 Timing Request query;
\( 1> \) cancel, if any, triggered SL-PRS resource request;
\( 1> \) flush the soft buffers for all DL HARQ processes, except for the DL HARQ process being used for MBS broadcast;
\( 1> \) for each DL HARQ process, except for the DL HARQ process being used for MBS broadcast, consider the next received transmission for a TB as the very first transmission;

1> release, if any, Temporary C-RNTI;
\( 1> \) clear, if any, Differential Koffset;
\( 1> \) if upper layers indicate SCG deactivation and \( b f d \)-and-RLM with value true is not configured; or
\( 1> \) if the MAC reset is not due to SCG deactivation:
\( 2> \) reset all BFI_COUNTERs;
\( 1> \) reset all \( L B T \_ \)COUNTERs .
If a Sidelink specific reset of the MAC entity is requested for a PC5-RRC connection by upper layers, the MAC entity shall:
\( 1> \) flush the soft buffers for all Sidelink processes for all TB(s) associated to the PC5-RRC connection;
\( 1> \) consider all Sidelink processes for all TB(s) associated to the PC5-RRC connection as unoccupied;
\( 1> \) cancel, if any, triggered Scheduling Request procedure only associated to the PC5-RRC connection;
\( 1> \) cancel, if any, triggered Sidelink Buffer Status Reporting procedure only associated to the PC5-RRC connection;
1> cancel, if any, triggered Sidelink CSI Reporting procedure associated to the PC5-RRC connection;
\( 1> \) cancel, if any, triggered Sidelink DRX Command MAC CE associated to the PC5-RRC connection;
\( 1> \) cancel, if any, triggered Sidelink [UC-Request transmission procedure associated to the PC5-RRC connection;
\( 1> \) cancel, if any, triggered Sidelink IUC-Information Reporting procedure associated to the PC5-RRC connection;
\( 1> \) stop (if running) all timers associated to the PC5-RRC connection;
\( 1> \) reset the numConsecutiveDTX associated to the PC5-RRC connection;
\( 1> \) initialize \( S B j \) for each logical channel associated to the PC5-RRC connection to zero.
5.12a Void
5.13 Handling of unknown, unforeseen and erroneous protocol data

When a MAC entity receives a MAC PDU for the MAC entity's C-RNTI, CS-RNTI, G-RNTI, G-CS-RNTI or by the configured downlink assignment, containing a Reserved LCID or eLCID value, or an LCID or eLCID value the MAC Entity does not support, the MAC entity shall at least:

ETSI


--- Page 119  ---


3GPP TS 38.321 version 18.2.0 Release 18
118
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) discard the received subPDU and any remaining subPDUs in the MAC PDU.
When a MAC entity receives a MAC PDU for the MAC entity's C-RNTI, CS-RNTI or G-RNTI, or by the configured downlink assignment, containing an LCID or eLCID value which is not configured, or an LCID or eLCID value associated with a suspended RB as specified in TS 38.331 [5], the MAC entity shall at least:
\( 1> \) discard the received subPDU.
When a MAC entity receives a MAC PDU on SL-SCH containing a Reserved LCID value for broadcast or groupcast, or an LCID value which is not configured, the MAC entity shall:
\( 1> \) discard the received subPDU.
When a MAC entity receives a MAC PDU on SL-SCH containing a Reserved LCID value for unicast, the MAC entity shall:
\( 1> \) discard the received subPDU and any remaining subPDUs in the MAC PDU.
5.14 Handling of measurement gaps

During an activated measurement gap, the MAC entity shall, on the Serving Cell(s) in the corresponding frequency range of the measurement gap configured by measGapConfig as specified in TS 38.331 [5]:
\( 1> \) not perform the transmission of HARQ feedback, SR, and CSI;
\( 1> \) not report SRS;
1> not transmit on UL-SCH except for Msg3 or the MSGA payload as specified in clause 5.4.2.2;
\( 1> \) if the ra-ResponseWindow or the ra-ContentionResolutionTimer or the msgB-ResponseWindow is running, or if there is an ongoing RACH-less LTM cell switch, or if there is an ongoing RACH-less handover:
\( 2> \) monitor the PDCCH as specified in clauses 5.1.4, 5.1.5, and 5.7.
1> else:
\( 2> \) not monitor the PDCCH ;
\( 2> \) not receive on DL-SCH.
5.15 Bandwidth Part (BWP) operation
5.15.1 Downlink and Uplink

In addition to clause 12 of TS 38.213 [6], this clause specifies requirements on BWP operation.
A Serving Cell may be configured with one or multiple BWPs, and the maximum number of BWP per Serving Cell is specified in TS 38.213 [6].

The BWP switching for a Serving Cell is used to activate an inactive BWP and deactivate an active BWP at a time. The BWP switching is controlled by the PDCCH indicating a downlink assignment or an uplink grant, by the bwpInactivityTimer, by RRC signalling, or by the MAC entity itself upon initiation of Random Access procedure or upon detection of consistent LBT failure on SpCell. Upon RRC (re-)configuration of firstActiveDownlinkBWP-Id and/or firstActiveUplinkBWP-Id for SpCell except for PSCell when SCG is deactivated (see clause 5.29) or activation of an SCell, the DL BWP and/or UL BWP indicated by firstActiveDownlinkBWP-Id and/or firstActiveUplinkBWP-Id respectively (as specified in TS 38.331 [5]) is active without receiving PDCCH indicating a downlink assignment or an uplink grant. Upon RRC (re-)configuration of firstActiveDownlinkBWP-Id for PSCell when SCG is deactivated, the DL BWP is switched to the firstActiveDownlinkBWP-Id as specified in TS 38.331 [5]. The active BWP for a Serving Cell is indicated by either RRC or PDCCH (as specified in TS 38.213 [6]). For unpaired spectrum, a DL BWP is paired with a UL BWP, and BWP switching is common for both UL and DL.

For each SCell a dormant BWP may be configured with dormantBWP-Id by RRC signalling as described in TS 38.331 [5]. Entering or leaving dormant BWP for SCells is done by BWP switching per SCell or per dormancy SCell group

ETSI


--- Page 120  ---


3GPP TS 38.321 version 18.2.0 Release 18
119
ETSI TS 138321 V18.2.0 (2024-08)

based on instruction from PDCCH (as specified in TS 38.213 [6]). The dormancy SCell group configurations are configured by RRC signalling as described in TS 38.331 [5]. Upon reception of the PDCCH indicating leaving dormant BWP, the DL BWP indicated by firstOutsideActiveTimeBWP-Id or by firstWithinActiveTimeBWP-Id (as specified in TS 38.331 [5] and TS 38.213 [6]) is activated. Upon reception of the PDCCH indicating entering dormant BWP, the DL BWP indicated by dormantBWP-Id (as specified in TS 38.331 [5]) is activated. The dormant BWP configuration for SpCell or PUCCH SCell is not supported.

BWP for SRS for positioning Tx frequency hopping can be configured for a Serving Cell in TS 38.331 [5]. BWP for SRS Tx frequency hopping is considered as activated when it is configured. BWP switching is not applicable for BWP for SRS Tx frequency hopping.

For each activated Serving Cell configured with a BWP, the MAC entity shall:
1> if a BWP is activated and the active DL BWP for the Serving Cell is not the dormant BWP and the Serving Cell is not the PSCell of deactivated SCG:
\( 2> \) transmit on UL-SCH on the BWP;
\( 2> \) transmit on RACH on the BWP, if PRACH occasions are configured;
\( 2> \) monitor the PDCCH on the BWP ;
◇ transmit PUCCH on the BWP, if configured;
\( 2> \) report CSI for the BWP;
\( 2> \) transmit SRS on the BWP, if configured;
\( 2> \) receive DL-SCH on the BWP;
2 (re-)initialize any suspended configured uplink grants of configured grant Type 1 on the active BWP according to the stored configuration, if any, and to start in the symbol according to rules in clause 5.8.2;
\( 2> \) if Ibt-FailureRecoveryConfig is configured:
\( 3> \) stop the Ibt-FailureDetectionTimer, if running;
\( 3> \) set LBT_COUNTER to 0;
3> monitor LBT failure indications from lower layers as specified in clause 5.21.2.
\( 1> \) if a BWP is activated and the active DL BWP for the Serving Cell is dormant BWP:
\( 2> \) stop the bwp-InactivityTimer of this Serving Cell, if running.
\( 2> \) not monitor the PDCCH on the BWP;
\( 2> \) not monitor the PDCCH for the BWP;
\( 2> \) not receive DL-SCH on the BWP;
2 not report CSI on the BWP, report CSI except aperiodic CSI for the BWP;
\( 2> \) not transmit SRS on the BWP;
\( 2> \) not transmit on UL-SCH on the BWP;
\( 2> \) not transmit on RACH on the BWP;
\( 2> \) not transmit PUCCH on the BWP;
\( 2> \) clear any configured downlink assignment and any configured uplink grant Type 2 associated with the SCell respectively;
\( 2> \) suspend any configured uplink grant Type 1 associated with the SCell;
\( 2> \) if configured, perform beam failure detection and beam failure recovery for the SCell if beam failure is detected;

ETSI


--- Page 121  ---


3GPP TS 38.321 version 18.2.0 Release 18
120
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if the SCell is configured as a scheduled cell in MC-DCI-SetOfCells and with the search space for DCI to schedule multiple cells (as specified in TS 38.213 [6]) of the same searchSpaceld as the serving cell in which MC-DCI-SetOfCells containing the SCell is configured:

3> not monitor the PDCCH for scheduling multiple cells (as specified in TS 38.213 [6]) for the set of cells in MC-DCI-SetOfCells including the SCell.

1> if a BWP is deactivated or the Serving Cell is PSCell of deactivated SCG:
\( 2> \) not transmit on UL-SCH on the BWP;
\( 2> \) not transmit on RACH on the BWP;
\( 2> \) not monitor the PDCCH on the BWP ;
\( 2> \) not transmit PUCCH on the BWP ;
\( 2> \) not report CSI for the BWP;
\( 2> \) not transmit SRS on the BWP;
\( 2> \) not receive \( \mathrm{DL}-\mathrm{SCH} \) on the BWP ;
\( 2> \) clear any configured downlink assignment and configured uplink grant of configured grant Type 2 on the BWP;
\( 2> \) suspend any configured uplink grant of configured grant Type 1 on the inactive BWP.
Upon initiation of the Random Access procedure on a Serving Cell, after the selection of carrier for performing Random Access procedure as specified in clause 5-1-1, the MAC entity shall for the selected carrier of this Serving Cell:
\( 1> \) if PRACH occasions are not configured for the active UL BWP:
\( 2> \) if the UE is an (e)RedCap UE; and
\( 2> \) if initialUplinkBWP-RedCap is configured:
3> switch the active UL BWP to BWP indicated by initialUplinkBWP-RedCap.
\( 2> \) else:
\( 3> \) switch the active UL BWP to BWP indicated by initialUplinkBWP.
\( 2> \) if the Serving Cell is an SpCell:
3> if the UE is an (e)RedCap UE; and
3> if initialDownlinkBWP-RedCap is configured:
\( 4> \) switch the active DL BWP to BWP indicated by mittalDownlinkBWP-RedCap.
3> else:
4> switch the active DL BWP to BWP indicated by mittalDownlinkBWP.
1> else:
\( 2> \) if the Serving Cell is an SpCell:
\( 3> \) if the active DL BWP does not have the same bwp-Id as the active UL BWP:
4> switch the active DL BWP to the DL BWP with the same bwp-Id as the active UL BWP.
1> stop the bwp-InactivityTimer associated with the active DL BWP of this Serving Cell, if running.
1> if the Serving Cell is SCell:
\( 2> \) stop the bwp-InactivityTimer associated with the active DL BWP of SpCell, if running.

ETSI


--- Page 122  ---


3GPP TS 38.321 version 18.2.0 Release 18
121
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) perform the Random Access procedure on the active DL BWP of SpCell and active UL BWP of this Serving Cell.

If the MAC entity receives a PDCCH for BWP switching of a Serving Cell, the MAC entity shall:
\( 1> \) if there is no ongoing Random Access procedure associated with this Serving Cell; or
\( 1> \) if the ongoing Random Access procedure associated with this Serving Cell is successfully completed upon reception of this PDCCH addressed to C-RNTI (as specified in clauses 5.1.4, 5.1.4a, and 5.1.5):
\( 2> \) cancel, if any, triggered consistent LBT failure for this Serving Cell;
\( 2> \) perform BWP switching to a BWP indicated by the PDCCH .
If the MAC entity receives a PDCCH for BWP switching for a Serving Cell(s) or a dormancy SCell group(s) while a Random Access procedure associated with that Serving Cell is ongoing in the MAC entity, it is up to UE implementation whether to switch BWP or ignore the PDCCH for BWP switching, except for the PDCCH reception for BWP switching addressed to the C-RNTI for successful Random Access procedure completion (as specified in clauses 5.1.4, 5.1.4a, and 5.1.5) in which case the UE shall perform BWP switching to a BWP indicated by the PDCCH. Upon reception of the PDCCH for BWP switching other than successful contention resolution, if the MAC entity decides to perform BWP switching, the MAC entity shall stop the ongoing Random Access procedure and initiate a Random Access procedure after performing the BWP switching; if the MAC decides to ignore the PDCCH for BWP switching, the MAC entity shall continue with the ongoing Random Access procedure on the Serving Cell.

Upon reception of RRC (re-)configuration for BWP switching for a Serving Cell while a Random Access procedure associated with that Serving Cell is ongoing in the MAC entity, the MAC entity shall stop the ongoing Random Access procedure and initiate a Random Access procedure after performing the BWP switching.

Upon reception of RRC (re-)configuration for BWP switching for a Serving Cell, cancel any triggered consistent LBT failure in this Serving Cell.

The MAC entity shall for each activated Serving Cell configured with bwp-InactivityTimer:
\( 1> \) if the defaultDownlinkBWP-Id is configured, and the active DL BWP is not the BWP indicated by the defaultDownlinkBWP-Id, and the active DL BWP is not the BWP indicated by the dormantBWP-Id if configured; or

1> if the UE is neither a RedCap nor an eRedCap UE, and if the defaultDownlinkBWP-Id is not configured, and the active DL BWP is not the initial DownlinkBWP, and the active DL BWP is not the BWP indicated by the dormantB WP-Id if configured; or
\( 1> \) if the UE is an (e)RedCap UE, and if the defaultDownlinkBWP-Id is not configured, and mitialDownlinkBWPRedCap is not configured, and the active DL BWP is not the initialDownlinkBWP; or

1> if the UE is an (e)RedCap UE, and if the defaultDownlinkBWP-Id is not configured, and mitialDownlinkBWPRedCap is configured, and the active DL BWP is not the initialDownlinkBWP-RedCap:
\( 2> \) if a PDCCH addressed to C-RNTI or CS-RNTI indicating downlink assignment or uplink grant is received on the active BWP; or
\( 2> \) if a PDCCH addressed to G-RNTI or G-CS-RNTI configured for multicast indicating downlink assignment is received on the active BWP; or

2 if a PDCCH addressed to C-RNTI or CS-RNTI indicating downlink assignment or uplink grant is received for the active BWP; or

2 if a MAC PDU is transmitted in a configured uplink grant and LBT failure indication is not received from lower layers; or
\( 2> \) if a MAC PDU is received in a configured downlink assignment for unicast or MBS multicast:
\( 3> \) if there is no ongoing Random Access procedure associated with this Serving Cell; or
3> if the ongoing Random Access procedure associated with this Serving Cell is successfully completed upon reception of this PDCCH addressed to C-RNTI (as specified in clauses 5.1.4, 5.1.4a and 5.1.5):

ETSI


--- Page 123  ---


3GPP TS 38.321 version 18.2.0 Release 18
122
ETSI TS 138321 V18.2.0 (2024-08)

\( 4> \) start or restart the bwp-InactivityTimer associated with the active DL BWP.
\( 2> \) if the bwp-InactivityTimer associated with the active DL BWP expires:
\( 3> \) if the defaultDownlinkBWP-Id is configured:
\( 4> \) perform BWP switching to a BWP indicated by the defaultDownlinkBWP-Id.
\( 3> \) else:
4 if the UE is a (e)RedCap UE; and
\( 4> \) if mitialDownlinkBWP-RedCap is configured:
\( 5> \) perform BWP switching to the initialDownlinkBWP-RedCap.
\( 4> \) else:
\( 5> \) perform BWP switching to the initialDownlinkBWP.
NOTE: If a Random Access procedure is initiated on an SCell, both this SCell and the SpCell are associated with this Random Access procedure.
\( 1> \) if a PDCCH for BWP switching is received, and the MAC entity switches the active DL BWP:
\( 2> \) if the defaultDownlinkBWP-Id is configured, and the MAC entity switches to the DL BWP which is not indicated by the defaultDownlinkBWP-Id and is not indicated by the dormantBWP-Id if configured; or
\( 2> \) if the UE is neither a RedCap nor an eRedCap UE, and if the defaultDownlinkBWP-Id is not configured, and the MAC entity switches to the DL BWP which is not the mittialDownlinkBWP and is not indicated by the dormantBWP-Id if configured; or
\( 2> \) if the UE is an (e)RedCap UE, and if the defaultDownlinkBWP-Id is not configured, and initialDownlinkBWP-RedCap is not configured, and the MAC entity switches to the DL BWP which is not the initial DownlinkB WP; or
\( 2> \) if the UE is an (e)RedCap UE, and if the defaultDownlinkBWP-Id is not configured, and initial DownlinkB WP-RedCap is configured, and the MAC entity switches to the DL BWP which is not the initial-DownlinkBWP-RedCap:
\( 3> \) start or restart the bwp-InactivityTimer associated with the active DL BWP.
Upon initiation of the Random Access procedure, after selection of the carrier for performing Random Access procedure as specified in clause 5.1.1, if the UE is an (e)RedCap UE in RRC_IDLE or RRC_INACTIVE mode, the MAC entity shall:
\( 1> \) if initialUplinkBWP-RedCap is configured for the selected carrier:
\( 2> \) perform the Random Access procedure as specified in clause 5.1 by using the BWP configured by initialUplinkBWP-RedCap-

1> else:
\( 2> \) perform the Random Access procedure as specified in clause 5.1 by using the BWP configured by initialUplinkBWP.
\( 1> \) if initialDownlinkBWP-RedCap is configured:
\( 2> \) if the Random Access procedure was initiated for SI request (as specified in TS 38.331 [5]) and the Random Access Resources for SI request have been explicitly provided by RRC, and if the selected carrier is SUL carrier:
\( 3> \) monitor the PDCCH on the BWP configured by initialDownlinkBWP.
\( 2> \) else:
\( 3> \) monitor the PDCCH on the BWP configured by intialDownlinkBWP-RedCap.

ETSI


--- Page 124  ---


3GPP TS 38.321 version 18.2.0 Release 18
123
ETSI TS 138321 V18.2.0 (2024-08)

1> else:
\( 2> \) monitor the PDCCH on the BWP configured by initialDownlinkBWP.
5.15.2 Sidelink

In addition to clause 16 of TS 38.213 [6], this clause specifies requirements on BWP operation for sidelink.
The MAC entity is configured with at most a single SL BWP per sidelink carrier where sidelink transmission and reception are performed.

For a BWP, the MAC entity shall:
\( 1> \) if the BWP is activated:
\( 2> \) transmit SL-BCH on the BWP, if configured;
\( 2> \) transmit S-PSS and S-SSS on the BWP, if configured;
\( 2> \) transmit PSCCH on the BWP;
\( 2> \) transmit SL-PRS on the BWP;
\( 2> \) transmit SL-SCH on the BWP;
\( 2> \) receive PSFCH on the BWP , if configured;
\( 2> \) receive S-PSS and S-SSS on the BWP, if configured;
\( 2> \) receive SL-BCH on the BWP, if configured;
\( 2> \) receive PSCCH on the BWP ;
\( 2> \) receive SL-PRS on the BWP;
\( 2> \) receive SL-SCH on the BWP;
\( 2> \) transmit PSFCH on the BWP, if configured;
\( 2> \) (re-)initialize any suspended configured sidelink grant of configured grant Type 1.
\( 2> \) if \( s l \)-lbt-FailureRecoveryConfig is configured:
\( 3> \) set \( S L_{-} L B T_{-} \)COUNTER to 0 for all RB sets in the SLBWP;
\( 3> \) monitors SL LBT failure indications from lower layers as specified in clause 5.31 .2 .
\( 1> \) if the BWP is deactivated:
\( 2> \) not transmit SL-BCH on the BWP, if configured;
\( 2> \) not transmit S-PSS and S-SSS on the BWP, if configured;
\( 2> \) not transmit PSCCH on the BWP;
\( 2> \) not transmit SL-PRS on the BWP;
\( 2> \) not transmit SL-SCH on the BWP;
\( 2> \) not receive PSFCH on the BWP, if configured;
\( 2> \) not receive SL-BCH on the BWP, if configured;
\( 2> \) not receive S-PSS and S-SSS on the BWP, if configured;
\( 2> \) not receive PSCCH on the BWP;
\( 2> \) not receive SL-PRS on the BWP;

ETSI


--- Page 125  ---


3GPP TS 38.321 version 18.2.0 Release 18
124
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) not receive SL-SCH on the BWP;
\( 2> \) not transmit PSFCH on the BWP, if configured;
\( 2> \) suspend any configured sidelink grant of configured grant Type 1;
\( 2> \) clear any configured sidelink grant of configured grant Type 2;
\( 2> \) cancel, if any, triggered Scheduling Request procedure for sidelink;
\( 2> \) cancel, if any, triggered Sidelink Buffer Status Reporting procedure;
\( 2> \) cancel, if any, triggered Sidelink CSI Reporting procedure;
\( 2> \) cancel, if any, triggered Sidelink DRX Command MAC CE;
\( 2> \) cancel, if any, triggered Sidelink IUC-Request transmission procedure;
\( 2> \) cancel, if any, triggered Sidelink IUC-Information Reporting procedure;
\( 2> \) cancel, if any, triggered Sidelink consistent LBT failure.
5.16 SUL operation

The Supplementary UL (SUL) carrier can be configured as a complement to the normal UL (NUL) carrier. Switching between the NUL carrier and the SUL carrier means that the UL transmissions move from one carrier to the other carrier, which is done by:
- an indication in DCl;
- the Random Access procedure as specified in clause 5.1.1;
- the SDT procedure as specified in clause 5.27.

If the MAC entity receives a UL grant indicating an SUL switch while a Random Access procedure is ongoing, the MAC entity shall ignore the UL grant.

The Serving Cell configured with supplementaryUplink belongs to a single TAG.
5.17 Beam Failure Detection and Recovery procedure

The MAC entity may be configured by RRC per Serving Cell or per BFD-RS set with a beam failure recovery procedure which is used for indicating to the serving gNB of a new SSB or CSI-RS when beam failure is detected on the serving SSB(s)/CSI-RS(s). Beam failure is detected by counting beam failure instance indication from the lower layers to the MAC entity. If beamFailureRecoveryConfig is reconfigured by upper layers during an ongoing Random Access procedure for beam failure recovery for SpCell, the MAC entity shall stop the ongoing Random Access procedure and initiate a Random Access procedure using the new configuration. The Serving Cell is configured with two BFD-RS sets if and only if failureDetectionSet 1 and failureDetectionSet2 are configured for the active DL BWP of the Serving Cell. When the SCG is deactivated, the UE performs beam failure detection on the PSCell if bfd-and-RLM is set to true.

RRC configures the following parameters in the beamFailureRecoveryConfig, beamFailureRecoverySpCellConfig, beamFailureRecoverySCellConfig and the radioLinkMonitoringConfig for the Beam Failure Detection and Recovery procedure:
- beamFailurelnstanceMaxCount for the beam failure detection (per Serving Cell or per BFD-RS set of Serving Cell configured with two BFD-RS sets);
- beamFailureDetectionTimer for the beam failure detection (per Serving Cell or per BFD-RS set of Serving Cell configured with two BFD-RS sets);
- beamFailureRecoveryTimer for the beam failure recovery procedure for SpCell;
- rsrp-ThresholdSSB: an RSRP threshold for the SpCell beam failure recovery;

ETSI


--- Page 126  ---


3GPP TS 38.321 version 18.2.0 Release 18
125
ETSI TS 138321 V18.2.0 (2024-08)
- rsrp-ThresholdBFR: an RSRP threshold for the SCell beam failure recovery or for the beam failure recovery of BFD-RS set of Serving Cell;
- powerRampingStep: powerRampingStep for the SpCell beam failure recovery;
- powerRampingStepHighPriority: powerRampingStepHighPriority for the SpCell beam failure recovery;
- preambleReceivedTargetPower: preambleReceivedTargetPower for the SpCell beam failure recovery;
- preambleTransMax: preambleTransMax for the SpCell beam failure recovery;
- scalingFactorBI: scalingFactorBI for the SpCell beam failure recovery;
- ssb-perRACH-Occasion: ssb-perRACH-Occasion for the SpCell beam failure recovery using contention-free Random Access Resources;
- ra-ResponseWindow: the time window to monitor response(s) for the SpCell beam failure recovery using contention-free Random Access Resources;
- prach-ConfigurationIndex: prach-ConfigurationIndex for the SpCell beam failure recovery using contention-free Random Access Resources;
- ra-ssb-OccasionMaskIndex: ra-ssb-OccasionMaskIndex for the SpCell beam failure recovery using contentionfree Random Access Resources;
- ra-OccasionList: ra-OccasionList for the SpCell beam failure recovery using contention-free Random Access Resources;
- candidateBeamRSList: list of candidate beams for SpCell beam failure recovery;
- candidateBeamRS-List-r16: list of candidate beams for SCell beam failure recovery or list of candidate beams for beam failure recovery of a Serving Cell for BFD-RS set one;
- candidateBeamRS-List2-r17: list of candidate beams for beam failure recovery of a Serving Cell for BFD-RS set two.

The following UE variables are used for the beam failure detection procedure:
- BFI_COUNTER (per Serving Cell or per BFD-RS set of Serving Cell configured with two BFD-RS sets): counter for beam failure instance indication which is initially set to 0 .

The MAC entity shall for each Serving Cell configured for beam failure detection:
1> if the Serving Cell is configured with two BFD-RS sets:
\( 2> \) if beam failure instance indication for a BFD-RS set has been received from lower layers:
3> start or restart the beamFailureDetectionTimer of the BFD-RS set;
3> increment BFI_COUNTER of the BFD-RS set by 1 ;
3> if BFI_COUNTER of the BFD-RS set >= beamFailureInstanceMaxCount:
4> trigger a BFR for this BFD-RS set of the Serving Cell;
\( 2> \) if BFR is triggered for both BFD-RS sets of the SpCell and the Beam Failure Recovery procedure is not successfully completed for any of the BFD-RS sets:
\( 3> \) initiate a Random Access procedure (see clause 5.1) on the SpCell;
\( 2> \) if the Serving Cell is SpCell and the Random Access procedure initiated for beam failure recovery of both BFD-RS sets of SpCell is successfully completed (see clause 5.1):

3> set BFI_COUNTER of each BFD-RS set of SpCell to 0 .
3> consider the Beam Failure Recovery procedure successfully completed.
\( 2> \) if the beamFailureDetectionTimer of this BFD-RS set expires; or

ETSI


--- Page 127  ---


3GPP TS 38.321 version 18.2.0 Release 18
126
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if beamFailureDetectionTimer, beamFailureInstanceMaxCount, or any of the reference signals used for beam failure detection is reconfigured by upper layers or by the BFD-RS Indication MAC CE associated with a BFD-RS set of the Serving Cell; or
\( 2> \) if the reference signal(s) associated with a BFD-RS set of the Serving Cell used for beam failure detection is changed:
\( 3> \) set BFI_COUNTER of the BFD-RS set to 0 .
\( 2> \) if a PDCCH addressed to C-RNTI indicating uplink grant for a new transmission is received for the HARQ process used for the transmission of the Enhanced BFR MAC CE or Truncated Enhanced BFR MAC CE which contains beam failure recovery information of this BFD-RS set of the Serving Cell:
\( 3> \) set BFI_COUNTER of the BFD-RS set to 0;
3> consider the Beam Failure Recovery procedure successfully completed for this BFD-RS set and cancel all the triggered BFRs of this BFD-RS set of the Serving Cell.
\( 2> \) if the Serving Cell is SCell and the SCell is deactivated as specified in clause 5.9:
3> set BFI_COUNTER of each BFD-RS set of SCell to 0;
3> consider the Beam Failure Recovery procedure successfully completed and cancel all the triggered BFRs of all BFD-RS sets of the Serving Cell.

1> else:
\( 2> \) if beam failure instance indication has been received from lower layers:
3> start or restart the beamFailureDetectionTimer;
\( 3> \) increment BFI_COUNTER by 1;
3> if BFI_COUNTER>= beamFailureInstanceMaxCount:
4> if the Serving Cell is SCell:
\( 5> \) trigger a BFR for this Serving Cell;
4> else if the Serving Cell is PSCell and, the SCG is deactivated:
\( 5> \) if beam failure of the PSCell has not been indicated to upper layers since the SCG was deactivated or since the deactivated SCG was last reconfigured with BFD-RS:
\( 6> \) indicate beam failure of the PSCell to upper layers.
NOTE: After beam failure is indicated to upper layers, the UE may stop the beamFailureDetectionTimer and lower layer beam failure indication while BFI_COUNTER>= beamFailurelnstanceMaxCount for the deactivated SCG.

4> else:
5> initiate a Random Access procedure (see clause 5.1) on the SpCell;
\( 5> \) if beam failure is detected for an NCR-MT:
\( 6> \) indicate to NCR-Fwd to cease forwarding.
\( 2> \) if the beamFailureDetectionTimer expires; or
\( 2> \) if beamFailureDetectionTimer, beamFailureInstanceMaxCount, or any of the reference signals used for beam failure detection is reconfigured by upper layers associated with this Serving Cell; or
\( 2> \) if the reference signal(s) associated with this Serving Cell used for beam failure detection is changed:
3> set BFI_COUNTER to 0 .

ETSI


--- Page 128  ---


3GPP TS 38.321 version 18.2.0 Release 18
127
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if the Serving Cell is SpCell and the Random Access procedure initiated for SpCell beam failure recovery is successfully completed (see clause 5.1):
\( 3> \) set BFI_COUNTER to 0;
3> stop the beamFailureRecoveryTimer, if configured;
3> if the Random Access procedure was triggered by beam failure recovery for NCR-MT:
4> indicate to NCR-Fwd to resume forwarding using the last forwarding configuration received by NCRMT as part of side control information before beam failure detection;

3> consider the Beam Failure Recovery procedure successfully completed.
\( 2> \) else if the Serving Cell is SCell, and a PDCCH addressed to C-RNTI indicating uplink grant for a new transmission is received for the HARQ process used for the transmission of the MAC CE for BFR which contains beam failure recovery information of this Serving Cell; or
\( 2> \) if the SCell is deactivated as specified in clause 5.9:
\( 3> \) set BFI_COUNTER to 0;
3> consider the Beam Failure Recovery procedure successfully completed and cancel all the triggered BFRs for this Serving Cell.

The MAC entity shall:
1> if the Beam Failure Recovery procedure determines that at least one BFR has been triggered and not cancelled for an SCell for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed and if none of the Serving Cell(s) of this MAC entity are configured with two BFD-RS sets:
\( 2> \) if UL-SCH resources are available for a new transmission and if the UL-SCH resources can accommodate the BFR MAC CE plus its subheader as a result of LCP:
\( 3> \) instruct the Multiplexing and Assembly procedure to generate the BFR MAC CE.
\( 2> \) else if UL-SCH resources are available for a new transmission and if the UL-SCH resources can accommodate the Truncated BFR MAC CE plus its subheader as a result of LCP:

3> instruct the Multiplexing and Assembly procedure to generate the Truncated BFR MAC CE.
\( 2> \) else:
3> trigger the SR for SCell beam failure recovery for each SCell for which BFR has been triggered, not cancelled, and for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed.

1> if the Beam Failure Recovery procedure determines that at least one BFR for any BFD-RS set has been triggered and not cancelled for an SCell for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed; or

1> if the Beam Failure Recovery procedure determines that at least one BFR for only one BFD-RS set has been triggered and not cancelled for an SpCell for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed; or

1> if the Beam Failure Recovery procedure determines that at least one BFR has been triggered and not cancelled for an SCell for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed and if at least one Serving Cell of this MAC entity is configured with two BFD-RS sets:
\( 2> \) if UL-SCH resources are available for a new transmission and if the UL-SCH resources can accommodate the Enhanced BFR MAC CE plus its subheader as a result of LCP:

3> instruct the Multiplexing and Assembly procedure to generate the Enhanced BFR MAC CE.
\( 2> \) else if UL-SCH resources are available for a new transmission and if the UL-SCH resources can accommodate the Truncated Enhanced BFR MAC CE plus its subheader as a result of LCP:

ETSI


--- Page 129  ---


3GPP TS 38.321 version 18.2.0 Release 18
128
ETSI TS 138321 V18.2.0 (2024-08)

3> instruct the Multiplexing and Assembly procedure to generate the Truncated Enhanced BFR MAC CE. \( 2> \) else:
\( 3> \) trigger the SR for beam failure recovery of each BFD-RS set for which BFR has been triggered, not cancelled, and for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed;

3> trigger the SR for SCell beam failure recovery for each SCell for which BFR has been triggered, not cancelled, and for which evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed.

All BFRs triggered for an SCell shall be cancelled when a MAC PDU is transmitted and this PDU includes a MAC CE for BFR which contains beam failure information of that SCell. All BFRs triggered for a BFD-RS set of a Serving Cell shall be cancelled when a MAC PDU is transmitted and this PDU includes an Enhanced BFR MAC CE or Truncated Enhanced BFR MAC CE which contains beam failure recovery information of that BFD-RS set of the Serving Cell.
5.18 Handling of MAC CEs
5.18.1 General

This clause specifies the requirements upon reception or transmission of the following MAC CEs:
- SP CSI-RS/CSI-IM Resource Set Activation/Deactivation MAC CE;
- Aperiodic CSI Trigger State Subselection MAC CE;
- TCI States Activation/Deactivation for UE-specific PDSCH MAC CE;
- TCI State Indication for UE-specific PDCCH MAC CE;
- SP CSI reporting on PUCCH Activation/Deactivation MAC CE;
- Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE;
- SP SRS Activation/Deactivation MAC CE;
- PUCCH spatial relation Activation/Deactivation MAC CE;
- Enhanced PUCCH spatial relation Activation/Deactivation MAC CE;
- SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE;
- Recommended Bit Rate MAC CE;
- Enhanced SP/AP SRS Spatial Relation Indication MAC CE;
- SRS Pathloss Reference RS Update MAC CE;
- PUSCH Pathloss Reference RS Update MAC CE;
- Serving Cell set based SRS Spatial Relation Indication MAC CE;
- SP Positioning SRS Activation/Deactivation MAC CE;
- Timing Delta MAC CE;
- Guard Symbols MAC CEs;
- Positioning Measurement Gap Activation/Deactivation Command MAC CE;
- PPW Activation/Deactivation Command MAC CE;
- PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE;
- PUCCH Power Control Set Update for multiple TRP PUCCH repetition MAC CE;

ETSI


--- Page 130  ---


3GPP TS 38.321 version 18.2.0 Release 18
129
ETSI TS 138321 V18.2.0 (2024-08)
- Unified TCI States Activation/Deactivation MAC CE;
- Differential Koffset MAC CE;
- Case-7 Timing advance offset MAC CE;
- DL TX Power Adjustment MAC CEs;
- Child IAB-DU Restricted Beam Indication MAC CE;
- Timing Case Indication MAC CE;
- PSI-Based SDU Discard Activation/Deactivation MAC CE;
- BFD-RS Indication MAC CE;
- IAB-MT Recommended Beam Indication MAC CE;
- UL PSD range adjustment for IAB MAC CE;
- Case-6 Timing Request MAC CE;
- NCR Backhaul Link Beam Indication MAC CEs;
- NCR Access Link Beam Indication MAC CE;
- Enhanced Unified TCI States Activation/Deactivation MAC CE;
- LTM Cell Switch Command MAC CE;
- Candidate Cell TCI States Activation/Deactivation MAC CE;
- Aggregated SP Positioning SRS Activation/Deactivation MAC CE.
5.18.2 Activation/Deactivation of Semi-persistent CSI-RS/CSI-IM resource set

The network may activate and deactivate the configured Semi-persistent CSI-RS/CSI-IM resource sets of a Serving Cell by sending the SP CSI-RS/CSI-IM Resource Set Activation/Deactivation MAC CE described in clause 6.1.3.12. The configured Semi-persistent CSI-RS/CSI-IM resource sets are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.

The MAC entity shall:
1> if the MAC entity receives an SP CSI-RS/CSI-[M Resource Set Activation/Deactivation MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the SP CSI-RS/CSI-[M Resource Set Activation/Deactivation MAC CE.
5.18.3 Aperiodic CSI Trigger State Subselection

The network may select among the configured aperiodic CSI trigger states of a Serving Cell by sending the Aperiodic CSI Trigger State Subselection MAC CE described in clause 6.1.3.13.

The MAC entity shall:
\( 1> \) if the MAC entity receives an Aperiodic CSI trigger State Subselection MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding Aperiodic CSI trigger State Subselection MAC CE.
5.18.4 Activation/Deactivation of UE-specific PDSCH TCI state

The network may activate and deactivate the configured TCI states for PDSCH of a Serving Cell or a set of Serving Cells configured in simultaneousTCI-UpdateListl or simultaneousTCI-UpdateList2 by sending the TCI States

ETSI


--- Page 131  ---


3GPP TS 38.321 version 18.2.0 Release 18
130
ETSI TS 138321 V18.2.0 (2024-08)

Activation/Deactivation for UE-specific PDSCH MAC CE described in clause 6.1_3.14. The network may activate and deactivate the configured TCI states for a codepoint of the DCI Transmission configuration indication field as specified in TS 38.212 [9] for PDSCH of a Serving Cell by sending the Enhanced TCI States Activation/Deactivation for UEspecific PDSCH MAC CE described in clause 6.1.3.24. The configured TCI states for PDSCH are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.

The MAC entity shall:
\( 1> \) if the MAC entity receives a TCI States Activation/Deactivation for UE-specific PDSCH MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the TCI States Activation/Deactivation for UE-specific PDSCH MAC CE.

1> if the MAC entity receives an Enhanced TCI States Activation/Deactivation for UE-specific PDSCH MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the Enhanced TCI States Activation/Deactivation for UEspecific PDSCH MAC CE.
5.18.5 Indication of TCI state for UE-specific PDCCH

The network may indicate a TCI state for PDCCH reception for a CORESET of a Serving Cell or a set of Serving Cells configured in simultaneousTCI-UpdateList I or simultaneousTCI-UpdateList 2 by sending the TCI State Indication for UE-specific PDCCH MAC CE described in clause 6.1.3.15 or the cross-RRH TCI State Indication for UE-specific PDCCH MAC CE described in clause 6.1.3.77. The network may also indicate two TCI states for PDCCH reception for a CORESET of a Serving Cell or a set of Serving Cells configured in simultaneousTCI-UpdateListl or simultaneousTCI-UpdateList 2 by sending the Enhanced TCI States Indication for UE-specific PDCCH MAC CE described in clause 6.1.3.44.

The MAC entity shall:
1> if the MAC entity receives a TCI State Indication for UE-specific PDCCH MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the TCI State Indication for UE-specific PDCCH MAC CE.
\( 1> \) if the MAC entity receives an Enhanced TCI States Indication for UE-specific PDCCH MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the Enhanced TCI States Indication for UE-specific PDCCH MAC CE.

1> if the MAC entity receives a cross-RRH TCI State Indication for UE-specific PDCCH MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the cross-RRH TCI State Indication for UE-specific PDCCH MAC CE.
5.18.6 Activation/Deactivation of Semi-persistent CSI reporting on PUCCH

The network may activate and deactivate the configured Semi-persistent CSI reporting on PUCCH of a Serving Cell by sending the SP CSI reporting on PUCCH Activation/Deactivation MAC CE described in clause 6.1.3.16 or the Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE described in clause 6.1.3.80. The network may activate and deactivate at least one of the configured sub-configuration of a configured Semi-Persistent CSI reporting on PUCCH of a Serving Cell by sending the Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE described in clause 6.1.3.80. For each Semi-persistent CSI reporting on PUCCH configuration configured with csi-ReportSubConfigToAddModList, the network may deactivate all configured sub-configurations by sending the SP CSI reporting on PUCCH Activation/Deactivation MAC CE. The configured Semi-persistent CSI reporting on PUCCH is initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.

The MAC entity shall:

ETSI


--- Page 132  ---


3GPP TS 38.321 version 18.2.0 Release 18
131
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) if the MAC entity receives an SP CSI reporting on PUCCH Activation/Deactivation MAC CE or an Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the SP CSI reporting on PUCCH Activation/Deactivation MAC CE or the Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE.
5.18.7 Activation/Deactivation of Semi-persistent SRS and Indication of spatial relation of SP/AP SRS

The network may activate and deactivate the configured Semi-persistent SRS resource sets of a Serving Cell by sending the SP SRS Activation/Deactivation MAC CE described in clause 6.1.3.17. The network may also activate and deactivate the configured Semi-persistent SRS resource sets of a Serving Cell by sending the Enhanced SP/AP SRS Spatial Relation Indication MAC CE described in clause 6.1.3.26. The network may also activate and deactivate the configured Semi-persistent SRS resource sets of a Serving Cell by sending the SP/AP SRS TCI State Indication MAC CE described in clause 6.1.3.59. The configured Semi-persistent SRS resource sets are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync. The network may indicate the spatial relation info of SP/AP SRS resource sets of a Serving Cell by sending the Enhanced SP/AP SRS spatial relation Indication MAC CE described in clause 6.1.3.26.

The MAC entity shall:
1> if the MAC entity receives an SP SRS Activation/Deactivation MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the SP SRS Activation/Deactivation MAC CE.
\( 1> \) if the MAC entity receives an Enhanced SP/AP SRS Spatial Relation Indication MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the Enhanced SP/AP SRS Spatial Relation Indication MAC CE

1> if the MAC entity receives an SP/AP SRS TCI State Indication MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the SP/AP SRS TCI State Indication MAC CE.
5.18.8 Activation/Deactivation of spatial relation of PUCCH resource

The network may activate and deactivate a spatial relation for a PUCCH resource of a Serving Cell by sending the PUCCH spatial relation Activation/Deactivation MAC CE described in clause 6.1.3.18. The network may also activate and deactivate a spatial relation for a PUCCH resource or a PUCCH resource group of a Serving Cell by sending the Enhanced PUCCH spatial relation Activation/Deactivation MAC CE described in clause 6.1.3.25. The configured spatial relation for a PUCCH resource is initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync. The network may also activate and deactivate the two spatial relations for a PUCCH resource or a PUCCH resource group of a Serving Cell by sending the PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE described in clause 6.1.3.45.

The MAC entity shall:
\( 1> \) if the MAC entity receives a PUCCH spatial relation Activation/Deactivation MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the PUCCH spatial relation Activation/Deactivation MAC CE.
\( 1> \) if the MAC entity receives an Enhanced PUCCH spatial relation Activation/Deactivation MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the Enhanced PUCCH spatial relation Activation/Deactivation MAC CE.
\( 1> \) if the MAC entity receives a PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE.

ETSI


--- Page 133  ---


3GPP TS 38.321 version 18.2.0 Release 18
132
ETSI TS 138321 V18.2.0 (2024-08)
5.18.9 Activation/Deactivation of semi-persistent ZP CSI-RS resource set

The network may activate and deactivate the configured Semi-persistent ZP CSI-RS resource set of a Serving Cell by sending the SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE described in clause 6.1.3.19. The configured Semi-persistent ZP CSI-RS resource sets are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.

The MAC entity shall:
1> if the MAC entity receives an SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE.
5.18.10 Recommended Bit Rate

The recommended bit rate procedure is used to provide the MAC entity with information about the bit rate which the gNB recommends. The bit rate is the recommended bit rate of the physical layer. Averaging window of default value 2000 ms will apply as specified in TS 26.114 [13].

The gNB may transmit the Recommended bit rate MAC CE to the MAC entity to indicate the recommended bit rate for the UE for a specific logical channel and a specific direction (either uplink or downlink). Upon reception of a Recommended bit rate MAC CE the MAC entity shall:
- indicate to upper layers the recommended bit rate for the indicated logical channel and direction.

The MAC entity may request the gNB to indicate the recommended bit rate for a specific logical channel and a specific direction. If the MAC entity is requested by upper layers to query the gNB for the recommended bit rate for a logical channel and for a direction (i.e. for uplink or downlink), the MAC entity shall:

1> if a Recommended bit rate query for this logical channel and this direction has not been triggered:
\( 2> \) trigger a Recommended bit rate query for this logical channel, direction, and desired bit rate.
If the MAC entity has UL resources allocated for new transmission the MAC entity shall:
1> for each Recommended bit rate query that the Recommended Bit Rate procedure determines has been triggered and not cancelled:
\( 2> \) if bitRateQueryProhibitTimer for the logical channel and the direction of this Recommended bit rate query is configured, and it is not running; and
\( 2> \) if the MAC entity has UL resources allocated for new transmission and the allocated UL resources can accommodate a Recommended bit rate MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:

3> instruct the Multiplexing and Assembly procedure to generate the Recommended bit rate MAC CE for the logical channel and the direction of this Recommended bit rate query;

3> start the bitRateQueryProhibitTimer for the logical channel and the direction of this Recommended bit rate query;

3> cancel this Recommended bit rate query.

ETSI


--- Page 134  ---


3GPP TS 38.321 version 18.2.0 Release 18
133
ETSI TS 138321 V18.2.0 (2024-08)
5.18.11 Void
5.18.12 Void
5.18.13 Void
5.18.14 Update of Pathloss Reference RS of SRS

The network may activate and update a pathloss reference RS for an SRS resource of a Serving Cell by sending the SRS Pathloss Reference RS Update MAC CE described in clause 6.1.3.27.

The MAC entity shall:
\( 1> \) if the MAC entity receives an SRS Pathloss Reference RS Update MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the SRS Pathloss Reference RS Update MAC CE.
5.18.15 Update of Pathloss Reference RS of PUSCH

The network may activate and update a pathloss reference RS for PUSCH of a Serving Cell by sending the PUSCH Pathloss Reference RS Update MAC CE described in clause 6.1.3.28.

The MAC entity shall:
\( 1> \) if the MAC entity receives a PUSCH Pathloss Reference RS Update MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the PUSCH Pathloss Reference RS Update MAC CE.
5.18.16 Indication of spatial relation of SRS resource for a Serving Cell set

The network may indicate the spatial relation info of SRS resource of a set of Serving Cells configured in simultaneousSpatial-UpdatedListl or simultaneousSpatial-UpdatedList2 by sending the Serving Cell set based SRS Spatial Relation Indication MAC CE and the Serving Cell Set based SRS TCI State Indication MAC CE described in clause 6.1.3.29 and 6.1 3.60, respectively.

The MAC entity shall:
\( 1> \) if the MAC entity receives a Serving Cell set based SRS Spatial Relation Indication MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the Serving Cell set based SRS Spatial Relation Indication MAC CE.
\( 1> \) if the MAC entity receives a Serving Cell Set based SRS TCI State Indication MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the Serving Cell Set based SRS TCI State Indication MAC CE.
5.18.17 Activation/Deactivation of Semi-Persistent Positioning SRS

The network may activate and deactivate the configured resource sets of Semi-Persistent Positioning SRS of a Serving Cell by sending the SP Positioning SRS Activation/Deactivation MAC CE described in clause 6.1 3.36. The configured resource sets Semi-Persistent Positioning SRS are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.

The MAC entity shall:
\( 1> \) if the MAC entity receives an SP Positioning SRS Activation/Deactivation MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the SP Positioning SRS Activation/Deactivation MAC CE.

ETSI


--- Page 135  ---


3GPP TS 38.321 version 18.2.0 Release 18
134
ETSI TS 138321 V18.2.0 (2024-08)
5.18.18 Timing offset adjustments for IAB

For IAB operation, in order to achieve time-domain synchronization across multiple backhaul hops, a timing adjustment may be provided to an IAB node by its parent node. Two different values may be provided, related to Case-1/Case-6, and Case-7 timing modes respectively. The Timing Delta MAC CE carries \( \mathrm{T}_{\text {deta }} \) which is used to determine the [ABDU DL Tx timing adjustment for the Case-1 timing mode, and to determine the IAB-DU DL Tx and IAB-MT UL Tx timing adjustment for the Case-6 timing mode. The Case-7 Timing advance offset MAC CE carries \( \mathrm{T}_{0[5 s e, 2} \) which is used to determine the IAB-MT UL Tx timing adjustment for the Case-7 timing mode.

Upon reception of a Timing Delta MAC CE the IAB node shall:
- apply the value of \( \mathrm{T}_{\text {delta }} \) as specified in TS 38.213 [6].

Upon reception of a Case-7 Timing advance offset MAC CE the IAB node shall:
- apply the value of \( \mathrm{T}_{\text {orset, } 2} \) as specified in TS 38.213 [6].
5.18.19 Guard symbols for IAB

For [AB operation, the MAC entity on the [AB-DU or [AB-donor-DU reserves a sufficient number of symbols at the beginning and/or the end of slots where the child [AB-node switches operation from its IAB-DU to its IAB-MT function and operation from its [AB-MT to its [AB-DU function. The MAC entity on the [AB-DU or [AB-donor-DU informs the child node about the number of guard symbols it provides via the Provided Guard Symbols MAC CE. The [AB-MT on the child node may inform the parent [AB-DU or [AB-donor-DU about the number of guard symbols desired via the Desired Guard Symbols MAC CE. [AB-MT transmission timing modes are specified in clause 14 of TS 38.213 [6].

Upon reception of a Provided Guard Symbols MAC CE the MAC entity shall:
- indicate to lower layers the number of provided guard symbols and the SCS configuration for the indicated Serving Cell.

The MAC entity may:
\( 1> \) if a Desired Guard Symbol query has not been triggered:
\( 2> \) trigger a Desired Guard Symbol query for this Serving Cell.
If the MAC entity has UL resources allocated for new transmission the MAC entity shall:
1> for each Desired Guard Symbol query that has been triggered and not cancelled:
\( 2> \) if the allocated UL resources can accommodate a Desired Guard Symbols MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:

3> instruct the Multiplexing and Assembly procedure to generate the Desired Guard Symbols MAC CE;
3> cancel this Desired Guard Symbol query.
For Case-1 timing mode, a separate value for the number of guard symbols is specified for each of the following eight switching scenarios (see Table 5.18.19-1).

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 5.18.19-1: Switching scenarios and relevant guard symbols for Case-1 timing mode}
\begin{tabular}{|l|l|l|}
\hline \multicolumn{2}{|c|}{Switching scenario} & Field for number of guard symbols in MAC CE \\
\hline \multirow[t]{4}{*}{IAB-MT operation to IABDU operation} & MT Rx to DU Tx & \( \mathrm{NmbGS}_{1} \) \\
\hline & MT Rx to DU Rx & \( \mathrm{NmbGS}_{2} \) \\
\hline & MT Tx to DU Tx & \( \mathrm{NmbGS}_{3} \) \\
\hline & MT Tx to DU Rx & \( \mathrm{NmbGS}_{4} \) \\
\hline \multirow[t]{4}{*}{IAB-DU operation to IABMT operation} & DU Rx to MT Tx & \( \mathrm{NmbGS}_{5} \) \\
\hline & DU Rx to MT Rx & \( \mathrm{NmbGS}_{6} \) \\
\hline & DU Tx to MT Tx & \( \mathrm{NmbGS}_{7} \) \\
\hline & DU Tx to MT Rx & NmbGS \( { }_{8} \) \\
\hline
\end{tabular}
\end{table}

ETSI


--- Page 136  ---


3GPP TS 38.321 version 18.2.0 Release 18
135
ETSI TS 138321 V18.2.0 (2024-08)

For Case-6 and Case-7 timing modes, a separate value for the number of guard symbols is specified for each of the following eight switching scenarios (see Table 5.18.19-2):

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 5.18.19-2: Switching scenarios and relevant guard symbols for Case-6 and Case-7 timing modes}
\begin{tabular}{|l|l|l|}
\hline \multicolumn{2}{|c|}{Switching scenario} & Field for number of guard symbols in MAC CE \\
\hline \multirow[t]{4}{*}{IAB-MT operation to IABDU operation} & MT Tx (Case-6) to DU Tx (Case-1) & NmbGS \( { }_{9} \) \\
\hline & MT Tx (Case-6) to DU Rx (Case-1) & NmbGS \( { }_{10} \) \\
\hline & MT Tx (Case-7) to DU Tx (Case-1) & NmbGS \( { }_{11} \) \\
\hline & MT Tx (Case-7) to DU Rx (Case-1) & NmbGS \( { }_{12} \) \\
\hline \multirow[t]{4}{*}{IAB-DU operation to IABMT operation} & DU Tx (Case-1) to MT Tx (Case-6) & NmbGS \( { }_{13} \) \\
\hline & DU Rx (Case-1) to MT Tx (Case-6) & NmbGS \( { }_{14} \) \\
\hline & DU Tx (Case-1) to MT Tx (Case-7) & NmbGS \( { }_{15} \) \\
\hline & DU Rx (Case-1) to MT Tx (Case-7) & NmbGS \( { }_{16} \) \\
\hline
\end{tabular}
\end{table}
5.18.20 Positioning Measurement Gap Activation/Deactivation Command

If the UE is configured with pre-configured measurement gaps, the network may send DL MAC CE for Positioning Measurement Gap Activation/Deactivation Command to the UE as in clause 6.1.3.41. For the activated measurement gap, the UE shall follow the specified UE behaviour in clause 5.14.

Upon the reception of the MAC CE for Positioning Measurement Gap Activation/Deactivation Command, the MAC entity shall:

1> if the Measurement Gap Activation/Deactivation Command MAC CE indicates the deactivation of a preconfigured positioning measurement gap:
\( 2> \) deactivate the positioning measurement gap.
1> else if the Positioning Measurement Gap Activation/Deactivation Command MAC CE indicates the activation of a pre-configured measurement gap:
\( 2> \) activate the positioning measurement gap and perform the procedure specified in clause 5.14 .
5.18.21 PPW Activation/Deactivation Command

If the UE is configured with pre-configured PPW, the network may send DL MAC CE for PPW Activation/Deactivation Command to the UE as in clause 6.1.3.42. For the activated PPW, the UE shall follow the specified UE behaviour in clause 5.24.

Upon activation of DL BWP, the PPW(s) configured for that BWP are considered deactivated. Upon reconfiguration of PPW(s) of the active DL BWP, all the PPW(s) for that BWP are considered deactivated.

Upon the reception of the MAC CE for PPW Activation/Deactivation Command, the MAC entity shall:
\( 1> \) if the DL MAC CE for PPW Activation/Deactivation Command indicates the deactivation of a pre-configured PPW:
\( 2> \) deactivate the PPW.
1> else if the DL MAC CE for PPW Activation/Deactivation Command indicates the activation of a pre-configured PPW:
\( 2> \) activate the PPW according to the procedure specified in clause 5.24.

ETSI


--- Page 137  ---


3GPP TS 38.321 version 18.2.0 Release 18
136
ETSI TS 138321 V18.2.0 (2024-08)
5.18.22 Update of PUCCH Power Control Set for multiple TRP PUCCH repetition

The network may activate and deactivate PUCCH power control set(s) for multiple TRP PUCCH repetition for a PUCCH resource or a PUCCH resource group of a Serving Cell by sending the PUCCH Power Control Set Update for multiple TRP PUCCH repetition MAC CE described in clause 6.1.3.46.

The MAC entity shall:
\( 1> \) if the MAC entity receives a PUCCH Power Control Set Update for multiple TRP PUCCH repetition MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the PUCCH power control set update for multiple TRP PUCCH repetition MAC CE.
5.18.23 Unified TCI States Activation/Deactivation MAC CE

The network may activate and deactivate the configured unified TCI states of a Serving Cell or a set of Serving Cells configured in simultaneous U-TCI-UpdateList 1, simultaneous U-TCI-UpdateList2, simultaneous U-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4 by sending the Unified TCI States Activation/Deactivation MAC CE described in clause 6.1.3.47. The configured unified TCI states are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.

The MAC entity shall:
\( 1> \) if the MAC entity receives a Unified TCI States Activation/Deactivation MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the Unified TCI States Activation/Deactivation MAC CE.
5.18.24 Update of Differential Koffset

The network may provide and update the Differential Koffset of a Serving Cell in a non-terrestrial network by sending the Differential Koffset MAC CE described in clause 6.1.3.57.

The MAC entity shall:
\( 1> \) if the MAC entity receives a Differential Koffset MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the Differential Koffset MAC CE.
5.18.25 BFD-RS Indication MAC CE

The network may activate and deactivate the configured beam failure detection resources of a Serving Cell by sending the BFD-RS indication MAC CE described in clause 6.1.3.58.

The MAC entity shall:
\( 1> \) if the MAC entity receives a BFD-RS indication MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the BFD-RS Indication MAC CE.
5.18.26 Restricted and recommended beam indication for IAB

Child IAB-DU Restricted Beam Indication MAC CE is used by an IAB-node to indicate to its child node spatial resources and associated frequency information where simultaneous transmission/reception from the IAB-MT and transmission from the IAB-DU cells is restricted. IAB-MT Recommended Beam Indication MAC CE is used by an [AB-node to indicate to its parent node recommendations for such a restriction. Time resources where these restrictions/recommendations can apply are indicated via RRC, while the MAC CE further selects from these time resources the specific time resource configuration (comprising a list of slot indices) to which information provided in the MAC CE applies.

Upon reception of a Child IAB-DU Restricted Beam Indication MAC CE the IAB-node shall:

ETSI


--- Page 138  ---


3GPP TS 38.321 version 18.2.0 Release 18
137
ETSI TS 138321 V18.2.0 (2024-08)
- apply the configuration signalled in the MAC CE to the time slots indicated in IAB-ResourceConfig (as specified in TS 38.331 [5]) which contains iab-ResourceConfigID parameter which matches the Resource Configuration ID field of the MAC CE.

The MAC entity may:
\( 1> \) if an [AB-MT Recommended Beam Indication query has not been triggered:
\( 2> \) trigger an [AB-MT Recommended Beam Indication query for this Serving Cell.
If the MAC entity has UL resources allocated for new transmission the MAC entity shall:
\( 1> \) for each [AB-MT Recommended Beam Indication query that has been triggered and not cancelled:
\( 2> \) if the allocated UL resources can accommodate a [AB-MT Recommended Beam Indication MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:
\( 3> \) instruct the Multiplexing and Assembly procedure to generate the [AB-MT Recommended Beam Indication MAC CE;
\( 3> \) cancel this [AB-MT Recommended Beam Indication query.
5.18.27 DL TX power adjustment for IAB

DL TX Power Adjustment MAC CE is used by an [AB-node to indicate to its child node spatial resources and associated frequency information where the DL TX power adjustment contained in the MAC CE applies. Desired DL TX Power Adjustment MAC CE is used by an [AB-node to indicate to its parent node recommendations for such a restriction. Time resources where these restrictions/recommendations can apply are indicated via RRC, while the MAC CE further selects from these time resources the specific time resource configuration (comprising a list of slot indices) to which information provided in the MAC CE applies.

Upon reception of a DL TX Power Adjustment MAC CE the [AB-node shall:
- apply the configuration signalled in the MAC CE to the time slots indicated in IAB-ResourceConfig (as specified in TS 38.331 [5]) which contains iab-ResourceConfigID parameter which matches the Resource Configuration ID field of the MAC CE.

The MAC entity may:
\( 1> \) if a Desired DL TX Power Adjustment query has not been triggered:
\( 2> \) trigger a Desired DL TX Power Adjustment query for this Serving Cell.
If the MAC entity has UL resources allocated for new transmission the MAC entity shall:
\( 1> \) for each Desired DL TX Power Adjustment query that has been triggered and not cancelled:
\( 2> \) if the allocated UL resources can accommodate a Desired DL TX Power Adjustment MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:
\( 3> \) instruct the Multiplexing and Assembly procedure to generate the Desired DL TX Power Adjustment MAC CE;
\( 3> \) cancel this Desired DL TX Power Adjustment query.
5.18.28 UL PSD range adjustment for IAB

Desired [AB-MT PSD range MAC CE is used by an [AB-node to indicate to its parent node a recommendation of spatial resources and associated frequency information where the desired PSD range, contained in the MAC CE (and provided to help with the node's UL TX power control) could apply. Time resources where these recommendations can apply are indicated via RRC, while the MAC CE further selects from these time resources the specific time resource configuration (comprising a list of slot indices) to which information provided in the MAC CE applies.

The MAC entity may:

ETSI


--- Page 139  ---


3GPP TS 38.321 version 18.2.0 Release 18
138
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) if a Desired [AB-MT PSD range query has not been triggered:
\( 2> \) trigger a Desired IAB-MT PSD range query for this Serving Cell.
If the MAC entity has UL resources allocated for new transmission the MAC entity shall:
1> for each Desired [AB-MT PSD range query that has been triggered and not cancelled:
\( 2> \) if the allocated UL resources can accommodate a Desired IAB-MT PSD range MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:

3> instruct the Multiplexing and Assembly procedure to generate the Desired IAB-MT PSD range MAC CE;
\( 3> \) cancel this Desired [AB-MT PSD range query.
5.18.29 Timing case indication for IAB

Timing Case Indication MAC CE is used by an lAB-node to indicate to its child node timing modes which should apply to time resources indicated via RRC.

Upon reception of a Timing Case Indication MAC CE the IAB-node shall:
- apply the configuration signalled in the MAC CE to the time slots indicated in IAB-ResourceConfig which contains iab-ResourceConfigID parameter (as specified in TS 38.331 [5]) which matches the Resource Configuration ID field of the MAC CE.
5.18.30 Case-6 Timing Request

The Case-6 Timing Request MAC CE is used by the IAB-MT to inform its parent node whether Case-6 timing is required for simultaneous operation.

The MAC entity may:
\( 1> \) if a Case-6 Timing Request query has not been triggered:
\( 2> \) trigger a Case-6 Timing Request query for this Serving Cell.
If the MAC entity has UL resources allocated for new transmission the MAC entity shall:
1> for each Case-6 Timing Request query that has been triggered and not cancelled:
\( 2> \) if the allocated UL resources can accommodate a Case-6 Timing Request MAC CE plus its subheader as a result of LCP as defined in clause 5.4.3.1:

3> instruct the Multiplexing and Assembly procedure to generate the Case-6 Timing Request MAC CE;
3> cancel this Case-6 Timing Request range query.
5.18.31 Backhaul Link Beam Indication for NCR

NCR Downlink Backhaul Link Beam Indication MAC CE and NCR Uplink Backhaul Link Beam Indication MAC CE are used by a gNB to indicate to an NCR-node the beam to be used for the downlink and uplink backhaul transmission respectively between the gNB and the NCR-node.

Upon reception of an NCR Downlink Backhaul Link Beam Indication MAC CE, the NCR-node shall:
- indicate to NCR-Fwd to apply the configuration contained in NCR Downlink Backhaul Link Beam Indication MAC CE as received by the NCR-MT.

Upon reception of an NCR Uplink Backhaul Link Beam Indication MAC CE, the NCR-node shall:
- indicate to NCR-Fwd to apply the configuration contained in the NCR Uplink Backhaul Link Beam Indication MAC CE as received by the NCR-MT.

ETSI


--- Page 140  ---


3GPP TS 38.321 version 18.2.0 Release 18
139
ETSI TS 138321 V18.2.0 (2024-08)
5.18.32 Access Link Beam Indication for NCR

NCR Access Link Beam Indication MAC CE is used by a gNB to indicate to an NCR-node the forwarding resources to be used for the semi-persistent access link transmission between the NCR-node and the UE(s) served by this device.

Upon reception of an NCR Access Link Beam Indication MAC CE, the NCR-node shall:
- apply the configuration signalled in the MAC CE as received by NCR-MT to the forwarding resource lists indicated via RRC, and use it to operate the NCR-Fwd.
5.18.33 Enhanced Unified TCI States Activation/Deactivation MAC CE

The network may activate and deactivate the configured unified TCI states of a Serving Cell or a set of Serving Cells configured in simultaneousU-TCI-UpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneous U-TCI-UpdateList4 by sending the Enhanced Unified TCI States Activation/Deactivation MAC CE described in clause 6.1.3.70 and 6.1.3.71. The configured unified TCI states are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.

The MAC entity shall:
\( 1> \) if the MAC entity receives an Enhanced Unified TCI States Activation/Deactivation MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the Enhanced Unified TCI States Activation/Deactivation MAC CE.
5.18.34 Activation/deactivation of PSI-based SDU discard

The network activates and deactivates PSI-based SDU discard by sending the PSI-Based SDU Discard Activation/Deactivation MAC CE described in clause 6.1.3.73. The PSI-based SDU discard is initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.

The MAC entity shall for each DRB configured with discardTimerForLowImportance:
\( 1> \) if a PSI-Based SDU Discard Activation/Deactivation MAC CE is received activating the PSI-based SDU discard for the DRB:
\( 2> \) indicate the activation of the PSI-based SDU discard for the DRB to upper-layers.
\( 1> \) if a PSI-Based SDU Discard Activation/Deactivation MAC CE is received deactivating the PSI-based SDU discard for the DRB:
\( 2> \) indicate the deactivation of the PSI-based SDU discard for the DRB to upper-layers.
5.18.35 LTM Cell Switch Command

The network may instruct the UE to perform LTM cell switch procedure by sending the LTM Cell Switch Command MAC CE described in clause 6.1.3.75.

The MAC entity shall:
\( 1> \) if the MAC entity receives an LTM Cell Switch Command MAC CE on a Serving Cell:
\( 2> \) indicate to upper layers that the LTM cell switch procedure is triggered and the Target Configuration ID included in the LTM Cell Switch Command MAC CE;
\( 2> \) if the MAC reset operation as specified in clause 5.12 is performed, as requested by upper layers:
\( 3> \) if Timing Advance Command value (hexa-decimal) is not set as FFF:
\( 4> \) process the received Timing Advance Command (see clause 5.2);
4> consider the RACH-less LTM cell switch to be ongoing;

ETSI


--- Page 141  ---


3GPP TS 38.321 version 18.2.0 Release 18
140
ETSI TS 138321 V18.2.0 (2024-08)

4- if the MAC entity is associated with SCG:
\( 5> \) indicate to upper layers to skip the Random Access procedure for this LTM cell switch.
3> else if the Timing Advance measurement is configured as specified in TS 38.331 [5] and the UE has successfully measured the Timing Advance for the indicated LTM target:
\( 4> \) process the measured Timing Advance (see clause 5.2);
4 - consider the RACH-less LTM cell switch to be ongoing.
4> if the MAC entity is associated with SCG:
\( 5> \) indicate to upper layers to skip the Random Access procedure for this LTM cell switch.
3> consider the SSB associated to the TCI state indicated by TCI state ID field as the one used for configured uplink grant selection for the initial uplink transmission towards the candidate cell for RACH-less LTM cell switch (as in clause 5.8.2);

3> indicate to lower layers the information regarding the TCI state information included in the LTM Cell Switch Command MAC CE.
5.18.36 Candidate Cell TCI States Activation/Deactivation

The network may activate and deactivate the TCI states of LTM candidate cell(s) configured in CandidateTCI-State and CandidateTCI-UL-State by sending the Candidate Cell TCI States Activation/Deactivation MAC CE described in clause 6.13.76. The network deactivates the TCI state(s) for one LTM candidate cell by not including the corresponding TCI state ID field(s) in the Candidate Cell TCI States Activation/Deactivation MAC CE.

The MAC entity shall:
1> if the MAC entity receives a Candidate Cell TCI States Activation/Deactivation MAC CE on a Serving Cell:
\( 2> \) indicate to lower layers the information regarding the Candidate Cell TCI States Activation/Deactivation MAC CE
5.18.37 Activation/Deactivation of Aggregated Semi-Persistent Positioning SRS

The network may activate and deactivate the configured aggregated resource sets of Semi-Persistent Positioning SRS by sending the Aggregated SP Positioning SRS Activation/Deactivation MAC CE described in clause 6.1.3.83. The configured aggregated SP positioning SRS resource sets are initially deactivated upon (re-)configuration by upper layers and after reconfiguration with sync.

The MAC entity shall:
\( 1> \) if the MAC entity receives an Aggregated SP Positioning SRS Activation/Deactivation MAC CE:
\( 2> \) indicate to lower layers the information regarding the Aggregated SP Positioning SRS Activation/Deactivation MAC CE.
5.19 Data inactivity monitoring

The UE may be configured by RRC with a Data inactivity monitoring functionality, when in RRC_CONNECTED. RRC controls Data inactivity operation by configuring the timer datalnactivityTimer.

When datalnactivityTimer is configured, the UE shall:
\( 1> \) if any MAC entity receives a MAC SDU for DTCH logical channel, DCCH logical channel, or CCCH logical channel, or multicast MTCH logical channel; or

1> if any MAC entity transmits a MAC SDU for DTCH logical channel, or DCCH logical channel:

ETSI


--- Page 142  ---


3GPP TS 38.321 version 18.2.0 Release 18
141
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) start or restart datalnactivityTimer.
\( 1> \) if the datalnactivityTimer expires:
\( 2> \) indicate the expiry of the datalnactivityTimer to upper layers.
5.20 Void
5.21 LBT operation
5.21.1 General

The lower layer may perform an LBT procedure, see TS 37.213 [18], according to which a transmission is not performed by lower layers if the channel is identified as being occupied. When lower layer performs an LBT procedure before a transmission and the transmission is not performed, an LBT failure indication is sent to the MAC entity from lower layers. Unless otherwise specified, when LBT procedure is performed for a transmission, actions as specified in this specification are performed regardless of if an LBT failure indication is received from lower layers. When LBT is not performed by the lower layers, LBT failure indication is not received from lower layers.
5.21.2 LBT failure detection and recovery procedure

The MAC entity may be configured by RRC with a consistent LBT failure recovery procedure. Consistent LBT failure is detected per UL BWP by counting LBT failure indications, for all UL transmissions, from the lower layers to the MAC entity.

RRC configures the following parameters in the \( I b t \)-FailureRecoveryConfig:
- Ibt-FailureInstanceMaxCount for the consistent LBT failure detection;
- Ibt-FailureDetectionTimer for the consistent LBT failure detection;

The following UE variable is used for the consistent LBT failure detection procedure:
- LBT_COUNTER (per Serving Cell): counter for LBT failure indication which is initially set to 0 .

For each activated Serving Cell configured with Ibt-FailureRecoveryConfig, the MAC entity shall:
\( 1> \) if LBT failure indication has been received from lower layers:
\( 2> \) start or restart the \( l b t \)-FailureDetectionTimer;
\( 2> \) increment \( L B T_{-} \)COUNTER by 1 ;
\( 2> \) if LBT_COUNTER>= Ibt-FailurelnstanceMaxCount:
3> trigger consistent LBT failure for the active UL BWP in this Serving Cell;
3> if this Serving Cell is the SpCell:
4> if consistent LBT failure has been triggered in all UL BWPs configured with PRACH occasions on same carrier in this Serving Cell:
\( 5> \) indicate consistent LBT failure to upper layers.
4> else:
\( 5> \) stop any ongoing Random Access procedure in this Serving Cell;
5> switch the active UL BWP to a UL BWP, on same carrier in this Serving Cell, configured with PRACH occasion and for which consistent LBT failure has not been triggered;
\( 5> \) initiate a Random Access Procedure (as specified in clause 5.1.1).

ETSI


--- Page 143  ---


3GPP TS 38.321 version 18.2.0 Release 18
142
ETSITS 138321 V18.2.0 (2024-08)

1> if all triggered consistent LBT failures are cancelled in this Serving Cell; or
\( 1> \) if the Ibt-FailureDetectionTimer expires; or
\( 1> \) if \( I b t \)-FailureDetectionTimer or \( I b t \)-FailureInstanceMaxCount is reconfigured by upper layers:
\( 2> \) set LBT_COUNTER to 0 .
The MAC entity shall:
1> if consistent LBT failure has been triggered, and not cancelled, in the SpCell; and
1> if UL-SCH resources are available for a new transmission in the SpCell and these UL-SCH resources can accommodate the LBT failure MAC CE plus its subheader as a result of logical channel prioritization:
\( 2> \) instruct the Multiplexing and Assembly procedure to generate the LBT failure MAC CE.
\( 1> \) else if consistent LBT failure has been triggered, and not cancelled, in at least one SCell:
2 if UL-SCH resources are available for a new transmission in a Serving Cell for which consistent LBT failure has not been triggered and these UL-SCH resources can accommodate the LBT failure MAC CE plus its subheader as a result of logical channel prioritization:
\( 3> \) instruct the Multiplexing and Assembly procedure to generate the LBT failure MAC CE.
\( 2> \) else:
3> trigger a Scheduling Request for LBT failure MAC CE.
1> if a MAC PDU is transmitted and LBT failure indication is not received from lower layers and this PDU includes the LBT failure MAC CE:
\( 2> \) cancel all the triggered consistent LBT failure(s) in SCell(s) for which consistent LBT failure was indicated in the transmitted LBT failure MAC CE.

1> if consistent LBT failure is triggered and not cancelled in the SpCell; and
1> if the Random Access procedure is considered successfully completed (see clause 5.1) in the SpCell:
\( 2> \) cancel all the triggered consistent LBT failure(s) in the SpCell.
\( 1> \) if \( l b t \)-FailureRecoveryConfig is reconfigured by upper layers for a Serving Cell:
\( 2> \) cancel all the triggered consistent LBT failure(s) in this Serving Cell.
5.22 SL-SCH Data transfer and SL-PRS transmission
5.22.1 SL-SCH Data and SL-PRS transmission
5.22.1.1 SL Grant reception and SCI transmission

Sidelink grant is received dynamically on the PDCCH, configured semi-persistently by RRC or autonomously selected by the MAC entity. The MAC entity may have a sidelink grant on an active SL BWP to determine a set of PSCCH duration(s) in which transmission of SCI occurs and a set of PSSCH duration(s) in which transmission of SL-SCH associated with the SCI occurs. The MAC entity may have a sidelink grant on the Shared SL-PRS resource pool of an active BWP to determine a set of PSCCH durations(s) in which transmission of SCI occurs and a set of SL-PRS transmission occasion(s) and PSSCH duration(s) in which transmission of SL-PRS and SL-SCH associated with the SCI occur. The MAC entity may have a sidelink grant on the Dedicated SL-PRS resource pool of an active BWP to determine a set of PSCCH duration(s) in which transmission of SCI occurs and a set of SL-PRS transmission occasion(s) in which transmission of SL-PRS associated to the SCI occurs. A sidelink grant addressed to SL-CS-RNTI with NDI = 1 is considered as a dynamic sidelink grant. A sidelink grant addressed to SL-PRS-CS-RNTI with Activation/Release indication = 1 as in clause 7.3.1.4.3 in TS 38.212 [9] is considered as a dynamic sidelink grant.

ETSI


--- Page 144  ---


3GPP TS 38.321 version 18.2.0 Release 18
143
ETSI TS 138321 V18.2.0 (2024-08)

If the MAC entity has been configured with Sidelink resource allocation mode 1 as indicated in TS 38.331 [5] or if the MAC entity has been configured with Sidelink resource allocation scheme 1 as indicated in TS 38.331 [5] and PDCCH is received for resource allocation on Shared SL-PRS resource pool, the MAC entity shall for each PDCCH occasion and for each grant received for this PDCCH occasion:

1> if a sidelink grant has been received on the PDCCH for the MAC entity's SL-RNTI:
\( 2> \) if the NDI received on the PDCCH has not been toggled compared to the value in the previously received HARQ information for the HARQ Process ID:

3> use the received sidelink grant to determine PSCCH duration(s) and PSSCH duration(s) and SL-PRS transmission occasion(s), if available, for one or more retransmissions of a single MAC PDU for the corresponding Sidelink process according to clause 8.1.2 of TS 38.214 [7] and SL-PRS according to clause 8.1 . 4 of TS 38.214 [7].
\( 2> \) else:
3> use the received sidelink grant to determine PSCCH duration(s) and PSSCH duration(s) and SL-PRS transmission occasion(s), if available, for initial transmission and, if available, retransmission(s) of a single MAC PDU and SL-PRS according to clause 8.1.2 of TS 38.214 [7].

NOTE 0: When SL-PRS is transmitted on Shared SL-PRS resource pool, the PSSCH duration(s) and SL-PRS transmission occasion(s) are determined only after the LCP procedure in clause 5.22.1.4.1.
\( 1> \) else if a sidelink grant has been received on the PDCCH for the MAC entity's SL-CS-RNTI:
\( 2> \) if PDCCH contents indicate retransmission(s) for the identified HARQ process ID that has been set for an activated configured sidelink grant identified by sl-ConfigIndexCG:
\( 3> \) use the received sidelink grant to determine PSCCH duration(s) and PSSCH duration(s) and SL-PRS transmission occasion(s), if available, for one or more retransmissions of a single MAC PDU and SL-PRS according to clause 8.1.2 of TS 38.214 [7].
\( 2> \) else if PDCCH contents indicate configured grant Type 2 deactivation for a configured sidelink grant:
3> trigger configured sidelink grant confirmation for the configured sidelink grant.
\( 2> \) else if PDCCH contents indicate configured grant Type 2 activation for a configured sidelink grant:
3> trigger configured sidelink grant confirmation for the configured sidelink grant;
3> store the configured sidelink grant;
3> initialise or re-initialise the configured sidelink grant to determine the set of PSCCH durations and the set of PSSCH durations for transmissions of multiple MAC PDUs according to clause 8.1.2 of TS 38.214 [7] and the set of SL-PRS transmission occasions for transmission of multiple SL-PRS according to clause of 8.2 .4 of TS 38.214 [7], if available.
\( 1> \) if a dynamic sidelink grant is available for retransmission(s) of a MAC PDU which has been positively acknowledged as specified in clause 5.22.1.3.1a:
\( 2> \) clear the PSCCH duration(s) and PSSCH duration(s) corresponding to retransmission(s) of the MAC PDU from the sidelink grant.

If the MAC entity has been configured with Sidelink resource allocation scheme 1 as in TS 38.331 [5] and PDCCH is received for resource allocation on Dedicated SL-PRS resource pool, the MAC entity shall for each PDCCH occasion:
\( 1> \) if a sidelink grant has been received on the PDCCH for the MAC entity's SL-PRS-RNTI: (i.e., dynamic grant)
\( 2> \) use the received sidelink grant to determine the PSCCH duration(s) and the corresponding SL-PRS occasion(s) for the transmission of SL-PRS.

1> else if a sidelink grant has been received on the PDCCH for MAC entity's SL-PRS-CS-RNTI: (i.e., configured sidelink grant type 2)
\( 2> \) if the PDCCH content indicates the configured grant Type 2 activation for a configured sidelink grant:

ETSI


--- Page 145  ---


3GPP TS 38.321 version 18.2.0 Release 18
144
ETSI TS 138321 V18.2.0 (2024-08)

3> store the configured sidelink grant;
3> trigger configured grant confirmation for the configured sidelink grant;
\( 3> \) initialise or re-initialise the configured sidelink grant to determine the set of PSCCH duration(s) and the corresponding SL-PRS occasion for the transmission of SL-PRS.
\( 2> \) else if the PDCCH content indicates the configured Type 2 deactivation for a configured sidelink grant:
3> trigger configured grant confirmation for the configured sidelink grant.
If the MAC entity has been configured with Sidelink resource allocation mode 2 to transmit or Sidelink resource allocation scheme 2 using pool(s) of resources in one carrier as indicated in TS 38.331 [5] or TS 36.331 [21] based on full sensing, or partial sensing, or random selection or any combination(s); Or if the MAC entity has been configured with Sidelink resource allocation mode 2 to transmit using pool(s) of resources in multiple carriers as indicated in TS 38.331 [5] based on full sensing, or partial sensing, or random selection or any combination(s), the MAC entity shall for each Sidelink process:

NOTE 0A: For SL-PRS transmission by Sidelink resource allocation scheme 2 on Dedicated SL-PRS resource pool, partial sensing is not supported.

NOTE 1: If the MAC entity is configured with Sidelink resource allocation mode 2 or Sidelink resource allocation scheme 2 to transmit using a pool of resources in one carrier as indicated in TS 38.331 [5] or TS 36.331 [21]; Or if the MAC entity is configured with Sidelink resource allocation mode 2 transmit using pools of resources in multiple carriers as indicated in TS 38.331 [5], the MAC entity can create a selected sidelink grant on the pool of resources based on random selection, or partial sensing, or full sensing only after releasing configured sidelink grant(s), if any.

NOTE 2: For each carrier configured by upper layers associated with the concerned sidelink logical channel, the MAC entity expects that PSFCH is always configured by RRC for at least one pool of resources in \( s / \) TxPoolSelectedNormal and for the resource pool in sl-TxPoolExceptional in case that at least a logical channel configured with sl-HARQ-FeedbackEnabled is set to enabled.

NOTE 2A: For the transmission of Sidelink Inter-UE Coordination Request MAC CE, the MAC entity selects the TX pool of resource where the IUC resource set is required. For the transmission of Sidelink Inter-UE Coordination Information MAC CE, the MAC entity selects the TX pool of resource where the IUC resource set is located.

NOTE 2B: For dynamic co-channel coexistence of LTE sidelink and NR sidelink, when the same TB or different TBs are transmitted on the NR SL slots overlapping with the LTE SL subframe, it is up to UE implementation how to avoid transmitting NR PSCCH/PSSCH only in the subsequent NR SL slot overlapping with an LTE SL subframe for NR PSCCH/PSSCH transmissions of 30 kHz SCS.

1> if the MAC entity has selected to create a selected sidelink grant corresponding to transmissions of multiple MAC PDUs, and SL data is available in a logical channel; or

1> if the MAC entity has selected to create a selected sidelink grant corresponding to transmission(s) of multiple SL-PRS(s), which have been triggered by the upper layer or by the reception of a SCI from a peer UE:

NOTE 2B1: The multiplicity/singularity of SL-PRS transmission and the reservation period for multiple SL-PRS transmission is determined by the UE's own upper layers by implementation within the service layer requirement for the Ranging/Sidelink positioning.
\( 2> \) if the MAC entity has not selected a pool of resources allowed for the logical channel or SL-PRS transmission:
\( 3> \) if single carrier frequency is configured:
4> if SL data is available in the logical channel for NR sidelink discovery:
\( 5> \) if \( s \) l-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon is configured according to TS 38.331 [5]:

6> select the sl-DiscTxPoolSelected configured in sl-BWP-DiscPoolConfig or sl-BWPDiscPoolConfigCommon for the transmission of NR sidelink discovery message.

ETSI


--- Page 146  ---


3GPP TS 38.321 version 18.2.0 Release 18
145
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) else:
6> select any pool of resources among the configured pools of resources except for Dedicated SLPRS resource pool, if configured.
\( 4> \) else if SL data is available in the logical channel for BRID for A2X communication:
\( 5> \) if \( s l \)-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X is configured according to TS 38.331 [5]:

6> if resource pool(s) is configured with sl-A2X-Service indicating brid or bridAndDAA:
\( 7> \) select any pool of resources among the resource pool(s) configured with \( s l-A 2 X \)-Service indicating brid or bridAndDAA in sl-TxPoolSelectedNormal configured in sl-BWPPoolConfigA2X or sl-BWP-PoolConfigCommonA2X for the transmission of SL data for A2X communication.

6> else:
\( 7> \) select any pool of resources among the configured pools of resources except the pool(s) in sl-BWP-PoolConfigA2X, sl-BWP-PoolConfigCommonA2X, sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured or Dedicated SL-PRS resource pool, if configured.

5> else:
6> select any pool of resources among the configured pools of resources except the pool(s) in \( s l \) -BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured or Dedicated SL-PRS resource pool, if configured.
\( 4> \) else if SL data is available in the logical channel for DAA for A2X communication:
\( 5> \) if \( s l \)-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X is configured according to TS 38.331 [5]:
\( 6> \) if resource pool(s) is configured with sl-A2X-Service indicating daa or bridAndDAA:
\( 7> \) select any pool of resources among the resource pool(s) configured with \( s l-A 2 X \)-Service indicating daa or bridAndDAA in sl-TxPoolSelectedNormal configured in sl-BWPPoolConfigA2X or sl-BWP-PoolConfigCommonA2X for the transmission of SL data for A2X communication.

6> else:
\( 7> \) select any pool of resources among the configured pools of resources except the pool(s) in sl-BWP-PoolConfigA2X, sl-BWP-PoolConfigCommonA2X, sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured or Dedicated SL-PRS resource pool, if configured.

5> else:
6> select any pool of resources among the configured pools of resources except the pool(s) in \( s l \) -BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured or Dedicated SL-PRS resource pool, if configured.

NOTE 2C: The MAC entity identifies the logical channel(s) for BRID or DAA based on the QoS information associated to BRID or DAA, i.e. PQI(s), from upper layers.

4> else if sl-HARQ-FeedbackEnabled is set to enabled for the logical channel:
5> select any pool of resources configured with PSFCH resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWPPoolConfigA2X or sl-BWP-PoolConfigCommonA2X, if configured or Dedicated SL-PRS resource pool, if configured.

4> else if SL-PRS is pending for transmission:

ETSI


--- Page 147  ---


3GPP TS 38.321 version 18.2.0 Release 18
146
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) select any resource pool among the resource pool(s) allowing for SL-PRS transmission.
\( 4> \) else:
\( 5> \) select any pool of resources among the pools of resources except the pool(s) in \( s l-B W P \) -
DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWP-
PoolConfigCommonA2X, if configured or Dedicated SL-PRS resource pool, if configured.
\( 3> \) else (i.e. multiple carrier frequencies are configured):
\( 4> \) trigger the TX carrier (re-)selection procedure as specified in clause 5.22.1.11.
\( 2> \) if Sidelink consistent LBT failure is detected as specified in clause 5.31 .2 in all RB sets of the selected resource pool, if single carrier frequency is configured:
\( 3> \) if \( s \) /-HARQ-FeedbackEnabled is set to enabled for the logical channel:
4 select any pool of resources configured with PSFCH resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured and the pool(s) in which all RB sets had Sidelink consistent LBT failure detected and not cancelled.
\( 3> \) else:
\( 4> \) select any pool of resources among the pools of resources except the pool(s) in sl-BWPDiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured and the pool(s) in which all RB sets had Sidelink consistent LBT failure detected and not cancelled.
\( 2> \) perform the TX resource (re-)selection check on the selected pool of resources as specified in clause 5.22.1.2;
NOTE 2D: It is up to UE implementation how to select a resource pool that has at least one RB set in which Sidelink consistent LBT failure was either not detected or detected but cancelled.

NOTE 3: The MAC entity continuously performs the TX resource (re-)selection check until the corresponding pool of resources is released by RRC or the MAC entity decides to cancel creating a selected sidelink grant corresponding to transmissions of multiple MAC PDUs.
\( 2> \) if the TX resource (re-)selection is triggered as the result of the TX resource (re-)selection check:
\( 3> \) if \( s l- \) bt-FailureRecoveryConfig is configured in the SL BWP:
\( 4> \) indicate to the physical layer RB set information for which Sidelink consistent LBT failure was detected and not cancelled as specified in clause 5.31.2.
\( 3> \) if the TX carrier (re-)selection procedure was triggered in above and one or more carriers have been (re-)selected in the TX carrier (re-)selection according to clause 5.22.1.11:
\( 4> \) determine the order of the (re-)selected carriers, according to the decreasing order based on the highest priority of logical channels which are allowed on each (re-)selected carrier, and perform the resource selection procedure as specified in this clause for each Sidelink process on each (re-)selected carrier according to the order.
\( 3> \) if one or multiple SL DRX(s) is configured in the destination UE(s) receiving SL-SCH data:
\( 4> \) indicate to the physical layer SL DRX Active time in the destination UE(s) receiving SL-SCH data, as specified in clause 5.28.2.

NOTE 3A: The MAC entity selects a value for the resource reservation interval which is larger than the remaining PDB of SL data available in the logical channel or remaining SL-PRS delay budget. The value of the SL-PRS delay budget is provided by the UE's own upper layers by implementation.
\( 3> \) randomly select, with equal probability, an integer value in the interval [5,15] for the resource reservation interval higher than or equal to 100 ms or in the interval \( \left[5 \times\left\lceil\frac{100}{\max \left(20, P_{\text {rsvp_Tx }}\right)}\right\rceil, 15 \times\left\lceil\frac{100}{\max \left(20, P_{\text {rsvp_Tx }}\right)}\right\rceil\right] \) for the resource reservation interval lower than 100 ms and set SL_RESOURCE_RESELECTION_COUNTER to the selected value;
\( 3> \) if the selected resource pool is not Dedicated SL-PRS resource pool:

ETSI


--- Page 148  ---


3GPP TS 38.321 version 18.2.0 Release 18
147
ETSI TS 138321 V18.2.0 (2024-08)

\( 4> \) select one of the allowed values configured by RRC in sl-ResourceReservePeriodList and set the resource reservation interval, \( P_{\text {rsvp_tx }} \), with the selected value;

4> select the number of HARQ retransmissions from the allowed numbers, if configured by RRC, in \( s l \) MaxTxTransNumPSSCH included in sl-PSSCH-TxConfigList and, if configured by RRC, overlapped in sl-MaxTxTransNumPSSCH indicated in sl-CBR-PriorityTxConfigList for the highest priority of the logical channel(s) and pending SL-PRS transmission(s), if available, allowed on the carrier and the CBR measured by lower layers according to clause 5.1.27 of TS 38.215 [24] if CBR measurement results are available or the corresponding sl-DefaultTxConfigIndex configured by RRC if CBR measurement results are not available or the corresponding \( s \)-DefaultCBR-PartialSensing configured by RRC if partial sensing is selected and CBR measurement results are not available, or the corresponding \( s \)-DefaultCBR-RandomSelection configured by RRC if random selection is selected and CBR measurement results are not available in case the \( s \)-TxPoolExceptional is not used;

NOTE 3A0: The priority of SL-PRS is provided by the UE's own upper layers by implementation within the service layer requirement of the Ranging/Sidelink Positioning.

NOTE 3Aa: For Multi-consecutive slots transmission as specified in clause 8.1 .4 of TS 38.214 [7], during resource (re)selection, leave it to UE implementation, regarding whether to calculate the number of HARQ retransmissions from the allowed numbers based on the number of MCSt transmissions, or the number of slot(s) within Multi-consecutive slots transmission.

NOTE 3Aa0: When transmission is performed on Shared SL-PRS resource pool, the selected number of HARQ retransmissions also corresponds to the number of SL-PRS transmissions.

4> select an amount of frequency resources within the range, if configured by RRC, between \( s l \) MinSubChannelNumPSSCH and sl-MaxSubchannelNumPSSCH included in sl-PSSCH-TxConfigList and, if configured by RRC, overlapped between sl-MinSubChannelNumPSSCH and slMaxSubchannelNumPSSCH indicated in sl-CBR-PriorityTxConfigList for the highest priority of the logical channel(s) and pending SL-PRS transmission(s), if available, allowed on the carrier and the CBR measured by lower layers according to clause 5.1.27 of TS 38.215 [24] if CBR measurement results are available or the corresponding \( s \)-DefaultTxConfigIndex configured by RRC if CBR measurement results are not available or the corresponding \( s \)-DefaultCBR-PartialSensing configured by RRC if partial sensing is selected and CBR measurement results are not available, or the corresponding \( s \)-DefaultCBR-RandomSelection configured by RRC if random selection is selected and CBR measurement results are not available in case the \( s \)-TxPoolExceptional is not used;

3> else if the selected resource pool is Dedicated SL-PRS resource pool:
4> select one of the allowed values configured by RRC in \( s l \)-PRS-ResourceReservePeriodList and set the resource reservation interval, \( P_{\text {rsvp_TX }} \), with the selected value;

4> select the number of SL-PRS retransmissions from the allowed numbers, if configured by RRC, in \( s \) -PRS-MaxNum-Transmissions included in sl-CBR-SL-PRS-TxConfigList.
\( 3> \) if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and nonpreferred resource set is not configured by RRC:

4- if transmission based on random selection is configured by upper layers:
\( 5> \) if the selected resource pool is not Dedicated SL-PRS resource pool:
\( 6> \) randomly select the time and frequency resources for one transmission opportunity from the resource pool which occur within the SL DRX Active time, if configured, as specified in clause 5.28 .2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, and the pool(s) in which all RB sets had Sidelink consistent LBT failure detected and not cancelled and the resources of which the lowest sub-channel includes intra cell guard band PRBs if sl-transmissionStructureForPSCCHandPSSCH is set to 'contiguousRB' are excluded, if configured, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.

ETSI


--- Page 149  ---


3GPP TS 38.321 version 18.2.0 Release 18
148
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 3Ab: When there are both SL data available in the logical channel(s) and SL-PRS pending for transmission, the resources are selected based on the shorter one of the corresponding remaining PDB and the corresponding remaining SL-PRS delay budget.
\( 5> \) else if the selected resource pool is Dedicated SL-PRS resource pool:
\( 6> \) randomly select the time and frequency resources for one transmission opportunity from the resource pool as specified in clause 5.28.2, according to the remaining SL-PRS delay budget of the SL-PRS transmission(s).

4> else:
\( 5> \) if sl-NRPSSCH-EUTRA-ThresRSRP-List is configured by the RRC:
6> when SCS of NR SL is (pre-)configured as \( \mu=0 \) :
\( 7> \) randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7], according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier.
\( 6> \) when SCS of NR SL is (pre-)configured as \( \mu=1 \) :
7> randomly select the time and frequency resources in the first of NR SL slots overlapping with an LTE SL subframe for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier.

5> else if the selected resource pool is not Dedicated SL-PRS resource pool:
\( 6> \) randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] which occur within the SL DRX Active time, if configured, as specified in clause 5.28 .2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.
\( 5> \) else if the selected resource pool is Dedicated SL-PRS resource pool:
6> randomly select the time and frequency resources for one transmission opportunity from the resources indicated by physical layer as clasue 8.2 .4 of TS 38.214 [7] as specified in clause 5.28 .2 , according to the remaining SL-PRS delay budget of the SL-PRS transmission(s).

3> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and nonpreferred resource set is configured by RRC and preferred resource set is not received from a UE:
\( 4> \) if transmission based on random selection is configured by upper layers:
5> if the selected resource pool is not Dedicated SL-PRS resource pool:
6> randomly select the time and frequency resources for one transmission opportunity from the resources pool excluding all RB sets had Sidelink consistent LBT failure detected and not cancelled and the resources of which the lowest sub-channel includes intra cell guard band PRBs if sl-transmissionStructureForPSCCHandPSSCH is set to 'contiguousRB' are excluded, if configured, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SLPRS transmission(s), if available, allowed on the carrier.
\( 5> \) else if the selected resource pool is Dedicated SL-PRS resource pool:
6> randomly select the time and frequency resources for one transmission opportunity from the resource pool which as specified in clause 5.28 .2 , according to the remaining SL-PRS delay budget of the SL-PRS transmission(s).

ETSI


--- Page 150  ---


3GPP TS 38.321 version 18.2.0 Release 18
149
ETSI TS 138321 V18.2.0 (2024-08)

4> else:
\( 5> \) if the selected resource pool is not Dedicated SL-PRS resource pool:
\( 6> \) randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.
\( 5> \) else if the selected resource pool is Dedicated SL-PRS resource pool:
\( 6> \) randomly select the time and frequency resources for one transmission opportunity from the resources indicated by physical layer as clause 8.2 .4 of TS 38.214 [7], according to the remaining SL-PRS delay budget of the SL-PRS transmission.

3> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and nonpreferred resource set is configured by RRC and when the UE does not have its own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE and if the selected resource pool is not Dedicated SL-PRS resource pool:

4> randomly select the time and frequency resources for one transmission opportunity from the resources belonging to the received preferred resource set for SL-SCH data to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.

3> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and nonpreferred resource set is configured by RRC and when the UE has its own sensing result as specified in clause 8.14 of TS 38.214 [7] and if a preferred resource set is received from a UE and if the selected resource pool is not Dedicated SL-PRS resource pool:

4> randomly select the time and frequency resources for one transmission opportunity within the intersection of the received preferred resource set and the resources indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7] for an SL-SCH data to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SLPRS transmission(s), if available, allowed on the carrier.

4> if there are no resources within the intersection that can be selected as the time and frequency resources for the one transmission opportunity according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier.
\( 5> \) randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier.

3> use the randomly selected resource to select a set of periodic resources spaced by the resource reservation interval for transmissions of PSCCH, PSSCH and SL-PRS corresponding to the number of transmission opportunities of MAC PDUs or SL-PRSs determined in TS 38.214 [7].

3> if one or more SL-PRS retransmissions are selected and the selected resource pool is Dedicated SL-PRS resource pool:

4> randomly select the time and frequency resources for one or more transmission opportunities from the available resources, according to the selected number of retransmissions and the remaining SL-PRS delay budget and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9];

4> use the randomly selected resource to select a set of periodic resources spaced by the resource reservation interval for transmissions of PSCCH and SL-PRS corresponding to the number of retransmission opportunities of SL-PRS;

ETSI


--- Page 151  ---


3GPP TS 38.321 version 18.2.0 Release 18
150
ETSI TS 138321 V18.2.0 (2024-08)

4> consider the first set of transmission opportunities as the initial transmission opportunities and the other set(s) of transmission opportunities as the retransmission opportunities;
\( 4> \) consider the sets of initial transmission opportunities and retransmission opportunities as the selected sidelink grant.

3> else if one or more HARQ retransmissions are selected and the selected resource pool is not Dedicated SL-PRS resource pool:

4> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and non-preferred resource set is not configured by RRC:
\( 5> \) if transmission based on full sensing or partial sensing is configured by upper layers and there are available resources left in the resources indicated by the physical layer according to clause 8.14 of TS 38.214 [7] for more transmission opportunities; or
\( 5> \) if transmission based on random selection is configured by upper layers and there are available resources left in the resource pool for more transmission opportunities:
\( 6> \) if sl-NRPSSCH-EUTRA-ThresRSRP-List is configured by the RRC:
\( 7> \) when SCS of NR SL is (pre-)configured as \( \mu=0 \) :
\( 8> \) randomly select the time and frequency resources for one or more transmission opportunities from the available resources, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].
\( 7> \) when SCS of NR SL is (pre-)configured as \( \mu=1 \) :
\( 8> \) randomly select the time and frequency resources in the second of NR SL slots of NR SL slots overlapping with an LTE SL subframe to which the selected transmission resources belongs, or select the time and frequency resources in the first of NR SL slots overlapping with an LTE SL subframe for one or more transmission opportunities from the available resources, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].

6> else:
\( 7> \) randomly select the time and frequency resources for one or more transmission opportunities from the available resources which occur within the SL DRX Active time, if configured, as specified in clause 5.28 .2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, and the pool(s) in which all RB sets with Sidelink consistent LBT failure detected and not cancelled and the resources of which the lowest sub-channel includes intra cell guard band PRBs if \( s \) transmissionStructureForPSCCHandPSSCH is set to 'contiguousRB' are excluded, if configured, according to the amount of selected frequency resources, the selected number of HARQ retransmissions, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].

4> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and preferred resource set is not received from a UE:

ETSI


--- Page 152  ---


3GPP TS 38.321 version 18.2.0 Release 18
151
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) if transmission based on full sensing or partial sensing is configured by upper layers and there are available resources left in the resources indicated by the physical layer according to clause 8.14 of TS 38.214 [7] for more transmission opportunities; or
\( 5> \) if transmission based on random selection is configured by upper layers and there are available resources left in the resource pool for more transmission opportunities:
\( 6> \) randomly select the time and frequency resources for one or more transmission opportunities from the available resources excluding all RB sets had Sidelink consistent LBT failure detected and not cancelled and the resources of which the lowest sub-channel includes intra cell guard band PRBs if sl-transmissionStructureForPSCCHandPSSCH is set to 'contiguousRB' are excluded, if configured according to the amount of selected frequency resources, the selected number of HARQ retransmissions, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].

4> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE has own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE:
\( 5> \) if there are available resources left in the intersection of the received preferred resource set and the resources indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7] for more transmission opportunities:
\( 6> \) randomly select the time and frequency resources for one or more transmission opportunities from the available resources within the intersection for SL-SCH data to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the selected number of HARQ retransmissions, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].
\( 5> \) if the number of time and frequency resources that has been maximally selected for one or more transmission opportunities from the available resources within the intersection is smaller than the selected number of HARQ retransmissions and there are available resources left in the resources indicated by the physical layer for more transmission opportunities:
\( 6> \) randomly select the time and frequency resources for the remaining transmission opportunities except for the selected resources within the intersection from the available resources outside the intersection but left in the resources indicated by the physical layer according to clause 8.1 .4 of TS 38.214 [7], according to the amount of selected frequency resources, the selected number of HARQ retransmissions, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].

4> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE does not have own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE; and

4> if there are available resources left in the received preferred resource set for more transmission opportunities:

5> randomly select the time and frequency resources for one or more transmission opportunities from the available resources belonging to the received preferred resource set for SL-SCH data to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the selected number of HARQ retransmissions, the remaining PDB of SL

ETSI


--- Page 153  ---


3GPP TS 38.321 version 18.2.0 Release 18
152
ETSI TS 138321 V18.2.0 (2024-08)

data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].

4> use the randomly selected resource to select a set of periodic resources spaced by the resource reservation interval for transmissions of PSCCH, PSSCH, if available and SL-PRS, if available corresponding to the number of retransmission opportunities of the MAC PDUs determined in TS 38.214 [7] or SL-PRS(s);

4> consider the first set of transmission opportunities as the initial transmission opportunities and the other set(s) of transmission opportunities as the retransmission opportunities;
\( 4> \) consider the sets of initial transmission opportunities and retransmission opportunities as the selected sidelink grant.

3> else:
4> consider the set as the selected sidelink grant.
3> use the selected sidelink grant to determine the set of PSCCH durations and the set of PSSCH durations and the set of SL-PRS transmission occasion(s), if available, according to TS 38.214 [7] if the selected resource pool is not Dedicated SL-PRS resource pool or to determine the set of PSCCH durations and SLPRS transmission occasion(s) if the selected resource pool is Dedicated SL-PRS resource pool according to TS 38.214 [7].

2> else if SL_RESOURCE_RESELECTION_COUNTER \( =0 \) and when
SL_RESOURCE_RESELECTION_COUNTER was equal to 1 the MAC entity randomly selected, with equal probability, a value in the interval \( [0,1] \) which is less than or equal to the probability configured by RRC in sl-ProbResourceKeep:
\( 3> \) clear the selected sidelink grant, if available;
3> randomly select, with equal probability, an integer value in the interval [5,15] for the resource reservation interval higher than or equal to 100 ms or in the interval \( \left[5 \times\left\lceil\frac{100}{\max \left(20, P_{\text {rsvp_tx }}\right)}\right\rceil, 15 \times\left\lceil\frac{100}{\max \left(20, P_{\text {rsvp_Tx }}\right)}\right\rceil\right] \) for the resource reservation interval lower than 100 ms and set
SL_RESOURCE_RESELECTION_COUNTER to the selected value;
3> reuse the previously selected sidelink grant for the number of transmissions of the MAC PDUs or SLPRS(s) determined in TS 38.214 [7] with the resource reservation interval to determine the set of PSCCH durations, the set of PSSCH durations, and the pending SL-PRS transmission(s), if available, according to TS 38.214 [7].

1> if the MAC entity has selected to create a selected sidelink grant corresponding to transmission(s) of a single MAC PDU, and if SL data is available in a logical channel, or an SL-CSI reporting is triggered, or a Sidelink DRX Command indication is triggered or a Sidelink Inter-UE Coordination Information reporting is triggered, or a Sidelink Inter-UE Coordination Request is triggered; or

1> if the MAC entity has selected to create a selected sidelink grant corresponding to transmission of a single SLPRS, which has been triggered by the upper layer or by the reception of a SCI from a peer UE:
\( 2> \) if single carrier frequency is configured:
3> if SL data is available in the logical channel for NR sidelink discovery:
4> if sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon is configured according to TS 38.331 [5]:
\( 5> \) select the \( s l \)-DiscTxPoolSelected configured in sl-BWP-DiscPoolConfig or sl-BWPDiscPoolConfigCommon for the transmission of NR sidelink discovery message.

4> else:

ETSI


--- Page 154  ---


3GPP TS 38.321 version 18.2.0 Release 18
153
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) select any pool of resources among the configured pools of resources except for Dedicated SLPRS resource pool, if configured.
\( 3> \) else if SL data is available in the logical channel for BRID for A2X communication:
4> if sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X is configured according to TS 38.331 [5]:

5> if resource pool(s) is configured with sl-A2X-Service indicating brid or bridAndDAA:
\( 6> \) select any pool of resources among the resource pool(s) configured with \( s l \)-A2X-Service indicating brid or bridAndDAA in sl-TxPoolSelectedNormal configured in sl-BWPPoolConfigA2X or sl-BWP-PoolConfigCommonA2X for the transmission of SL data for A2X communication.

5> else:
6> select any pool of resources among the configured pools of resources except the pool(s) in sl-BWP-PoolConfigA2X, sl-BWP-PoolConfigCommonA2X, sl-BWP-DiscPoolConfig or sl-BWPDiscPoolConfigCommon, if configured or Dedicated SL-PRS resource pool, if configured.

4> else:
\( 5> \) select any pool of resources among the configured pools of resources except the pool(s) in \( s l \) -BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured or Dedicated SL-PRS resource pool, if configured.
\( 3> \) else if SL data is available in the logical channel for DAA for A2X communication:
4> if sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X is configured according to TS 38.331
[5]:
\( 5> \) if resource pool(s) is configured with \( s l-A 2 X \)-Service indicating daa or bridAndDAA:
\( 6> \) select any pool of resources among the resource pool(s) configured with \( s l-A 2 X \)-Service indicating daa or bridAndDAA in sl-TxPoolSelectedNormal configured in sl-BWP-
PoolConfigA2X or sl-BWP-PoolConfigCommonA2X for the transmission of SL data for A2X communication.

5> else:
6> select any pool of resources among the configured pools of resources except the pool(s) in sl-BWP-PoolConfigA2X, sl-BWP-PoolConfigCommonA2X, sl-BWP-DiscPoolConfig or sl-BWPDiscPoolConfigCommon, if configured or Dedicated SL-PRS resource pool, if configured.
\( 4> \) else:
\( 5> \) select any pool of resources among the configured pools of resources except the pool(s) in \( s / \) -BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured or Dedicated SL-PRS resource pool, if configured.

NOTE 3AC: The MAC entity identifies the logical channel(s) for BRID or DAA based on the QoS information associated to BRID or DAA, i.e. \( \mathrm{PQI}(\mathrm{s}) \), from upper layers.

3> else if SL data for NR sidelink communication is available in the logical channel:
4> if sl-HARQ-FeedbackEnabled is set to enabled for the logical channel:
5> select any pool of resources configured with PSFCH resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWPPoolConfigA2X or sl-BWP-PoolConfigCommonA2X, if configured or Dedicated SL-PRS resource pool, if configured.
\( 4> \) else:

ETSI


--- Page 155  ---


3GPP TS 38.321 version 18.2.0 Release 18
154
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) select any pool of resources among the pools of resources except the pool(s) in \( s l-B W P \) DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWPPoolConfigCommonA2X, if configured or Dedicated SL-PRS resource pool, if configured.
\( 3> \) else if SL-PRS is pending for transmission:
\( 4> \) select any resource pool among the resource pool(s) allowing for SL-PRS transmission.
\( 3> \) else if an SL-CSI reporting or a Sidelink DRX Command or a Sidelink Inter-UE Coordination Request or a Sidelink Inter-UE Coordination Information is triggered:
\( 4> \) select any pool of resources among the pools of resources except the pool(s) in \( s /-B W P \) DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWPPoolConfigCommonA2 \( X \), if configured or Dedicated SL-PRS resource pool, if configured.
\( 2> \) else (i.e. multiple carrier frequencies are configured):
\( 3> \) trigger the TX carrier (re-)selection procedure as specified in clause 5.22.1.11.
\( 2> \) if Sidelink consistent LBT Failure is detected as specified in clause 5.31 .2 in all RB sets of the selected resource pool for the logical channel, if single carrier frequency is configured:
\( 3> \) clear the selected sidelink grant on the selected pool of resources.
\( 3> \) if \( s \) /-HARQ-FeedbackEnabled is set to enabled for the logical channel:
\( 4> \) select any pool of resources configured with PSFCH resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured and the pool(s) including all RB sets for which Sidelink consistent LBT failures were detected and not cancelled.
\( 3> \) else:
\( 4> \) select any pool of resources among the pools of resources except the pool(s) in \( s /-B W P \) DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, if configured and the pool(s) including all RB sets for which Sidelink consistent LBT failures were detected and not cancelled.
\( 2> \) perform the TX resource (re-)selection check on the selected pool of resources as specified in clause 5.22.1.2;
\( 2> \) if the TX resource (re-)selection is triggered as the result of the TX resource (re-)selection check
\( 3> \) if \( s l- \) bt-FailureRecoveryConfig is configured in the SL BWP:
\( 4> \) indicate to the physical layer RB set information for which Sidelink consistent LBT failure was detected and not cancelled as specified in clause 5.31.2.
\( 3> \) if the TX carrier (re-)selection procedure was triggered in above and one or more carriers have been (re-
)selected in the Tx carrier (re-)selection according to clause 5.22.1.11:
\( 4> \) determine the order of the (re-)selected carriers, according to the decreasing order based on the highest priority of logical channels which are allowed on each (re-)selected carrier, and perform the resource selection procedure as specified in this clause for each Sidelink process on each (re-)selected carrier according to the order.
\( 3> \) if one or multiple SL DRX(s) is configured in the destination UE(s) receiving SL-SCH data:
4 - indicate to the physical layer SL DRX Active time in the destination UE(s) receiving SL-SCH data, as specified in clause 5.28.2.
\( 3> \) if the selected resource pool is not Dedicated SL-PRS resource pool:
\( 4> \) select the number of HARQ retransmissions from the allowed numbers, if configured by RRC, in \( s \) MaxTxTransNumPSSCH included in sl-PSSCH-TxConfigList and, if configured by RRC, overlapped in sl-MaxTxTransNumPSSCH indicated in sl-CBR-PriorityTxConfigList for the highest priority of the logical channel(s) and pending SL-PRS transmission(s), if available allowed on the carrier and the CBR measured by lower layers according to clause 5.1.27 of TS 38.215 [24] if CBR measurement

ETSI


--- Page 156  ---


3GPP TS 38.321 version 18.2.0 Release 18
155
ETSI TS 138321 V18.2.0 (2024-08)

results are available or the corresponding \( s \)-DefaultTxConfigIndex configured by RRC if CBR measurement results are not available or the corresponding \( s \)-DefaultCBR-PartialSensing configured by RRC if partial sensing is selected and CBR measurement results are not available, or the corresponding \( s \)-DefaultCBR-RandomSelection configured by RRC if random selection is selected and CBR measurement results are not available in case the \( s \)-TxPoolExceptional is not used;

NOTE 3Ad: For Multi-consecutive slots transmission as specified in clause 8.1 .4 of TS 38.214 [7], during resource (re)selection, leave it to UE implementation, regarding whether to calculate the number of HARQ retransmissions from the allowed numbers based on the number of MCSt transmissions, or the number of slot(s) within Multi-consecutive slots transmission.

4> select an amount of frequency resources within the range, if configured by RRC, between \( s l \) MinSubChannelNumPSSCH and sl-MaxSubChannelNumPSSCH included in sl-PSSCH-TxConfigList and, if configured by RRC, overlapped between sl-MinSubChannelNumPSSCH and slMaxSubChannelNumPSSCH indicated in sl-CBR-PriorityTxConfigList for the highest priority of the logical channel(s) and pending SL-PRS transmission(s), if available allowed on the carrier and the CBR measured by lower layers according to clause 5.1.27 of TS 38.215 [24] if CBR measurement results are available or the corresponding sl-DefaultTxConfigIndex configured by RRC if CBR measurement results are not available or the corresponding \( s \)-DefaultCBR-PartialSensing configured by RRC if partial sensing is selected and CBR measurement results are not available, or the corresponding \( s \)-DefaultCBR-RandomSelection configured by RRC if random selection is selected and CBR measurement results are not available in case the \( s \)-TxPoolExceptional is not used;

3> if the selected resource pool is Dedicated SL-PRS resource pool:
4> select the number of SL-PRS retransmissions from the allowed numbers, if configured by RRC, in \( s l \) -PRS-MaxNum-Transmissions included in sl-CBR-SL-PRS-TxConfigList.
\( 3> \) if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and nonpreferred resource set is not configured by RRC:

4> if transmission based on random selection is configured by upper layers:
\( 5> \) if the selected resource pool is not Dedicated SL-PRS resource pool:
\( 6> \) randomly select the time and frequency resources for one transmission opportunity from the resources pool which occur within the SL DRX Active time, if configured, as specified in clause 5.28.2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, and the pool(s) in which all RB sets had Sidelink consistent LBT failure detected and not cancelled and the resources of which the lowest sub-channel includes intra cell guard band PRBs if sl-transmissionStructureForPSCCHandPSSCH is set to 'contiguousRB' are excluded, if configured, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and the latency requirement of the triggered SL-CSI reporting.
\( 5> \) if the selected resource pool is Dedicated SL-PRS resource pool:
\( 6> \) randomly select the time and frequency resources for one transmission opportunity from the resource pool as specified in clause 5.28.2, according to the remaining SL-PRS delay budget of the SL-PRS transmission.

4> else:
\( 5> \) if sl-NRPSSCH-EUTRA-ThresRSRP-List is configured by the RRC:
6> when SCS of NR SL is (pre-)configured as \( \mu=0 \) :
\( 7> \) randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7], according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.

6> when SCS of NR SL is (pre-)configured as \( \mu=1 \) :

ETSI


--- Page 157  ---


3GPP TS 38.321 version 18.2.0 Release 18
156
ETSI TS 138321 V18.2.0 (2024-08)

7> randomly select the time and frequency resources in the first of NR SL slots overlapping with an LTE SL subframe for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.
\( 5> \) else if the selected resource pool is not Dedicated SL-PRS resource pool:
\( 6> \) randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7] which occur within the SL DRX Active time, if configured, as specified in clause 5.28 .2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.

5> if the selected resource pool is Dedicated SL-PRS resource pool:
\( 6> \) randomly select the time and frequency resources for one transmission opportunity from the resources indicated by physical layer as clasue 8.2 .4 of TS 38.214 [7] as specified in clause 5.28 .2 , according to the remaining SL-PRS delay budget of the SL-PRS transmission.

3> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and nonpreferred resource set is configured by RRC and preferred resource set is not received from a UE:

4- if transmission based on random selection is configured by upper layers:
\( 5> \) if the selected resource pool is not Dedicated SL-PRS resource pool:
\( 6> \) randomly select the time and frequency resources for one transmission opportunity from the resources pool excluding all RB sets had Sidelink consistent LBT failure detected and not cancelled and the resources of which the lowest sub-channel includes intra cell guard band PRBs if sl-transmissionStructureForPSCCHandPSSCH is set to 'contiguousRB' are excluded, if configured according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.

4> else:
\( 5> \) if the selected resource pool is not Dedicated SL-PRS resource pool:
\( 6> \) randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.

3> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and nonpreferred resource set is configured by RRC and when the UE does not have own sensing result as specified in clause 8.14 of TS 38.214 [7] and if a preferred resource set is received from a UE and if the selected resource pool is not Dedicated SL-PRS resource pool:

4> randomly select the time and frequency resources for one transmission opportunity from the resources belonging to the received preferred resource set for a MAC PDU to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.

3> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and nonpreferred resource set is configured by RRC and when the UE has own sensing result as specified in

ETSI


--- Page 158  ---


3GPP TS 38.321 version 18.2.0 Release 18
157
ETSI TS 138321 V18.2.0 (2024-08)

clause 8.1 . 4 of TS 38.214 [7] and if a preferred resource set is received from a UE and if the selected resource pool is not Dedicated SL-PRS resource pool:

4> randomly select the time and frequency resources for one transmission opportunity within the intersection of the received preferred resource set and the resources indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7] for a MAC PDU to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting;

4> if there are no resources within the intersection that can be selected as the time and frequency resources for the one transmission opportunity according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier.

5> randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s), and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting.

3> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and nonpreferred resource set is configured by RRC and when the UE determines the resources for Sidelink InterUE Coordination Information transmission upon explicit request from a UE:

4> randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting and the latency requirement of the Sidelink Inter-UE Coordination Information transmission, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available.

3> if one or more SL-PRS retransmissions are selected and the selected resource pool is Dedicated SL-PRS resource pool:

4> randomly select the time and frequency resources for one or more transmission opportunities from the available resources, according to the selected number of retransmissions and the remaining SL-PRS delay budget and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9];

4> consider the first set of transmission opportunities as the initial transmission opportunities and the other set(s) of transmission opportunities as the retransmission opportunities;
\( 4> \) consider the sets of initial transmission opportunities and retransmission opportunities as the selected sidelink grant.

3> else if one or more HARQ retransmissions are selected and the selected resource pool is not Dedicated SL-PRS resource pool:

4> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and non-preferred resource set is not configured by RRC:
\( 5> \) if transmission based on full sensing or partial sensing is configured by upper layers and there are available resources left in the resources indicated by the physical layer according to clause 8.14 of TS 38.214 [7] for more transmission opportunities; or
\( 5> \) if transmission based on random selection is configured by upper layers and there are available resources left in the resources pool for more transmission opportunities:

6> if sl-NRPSSCH-EUTRA-ThresRSRP-List is configured by the RRC:
\( 7> \) when SCS of NR SL is (pre-)configured as \( \mu=0 \) :
8> randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214

ETSI


--- Page 159  ---


3GPP TS 38.321 version 18.2.0 Release 18
158
ETSI TS 138321 V18.2.0 (2024-08)

[7], according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources, and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].
\( 7> \) when SCS of NR SL is (pre-)configured as \( \mu=1 \) :
\( 8> \) randomly select the time and frequency resources in the second of NR SL slots of NR SL slots overlapping with an LTE SL subframe to which the selected transmission resources belongs, or select the time and frequency resources in the first of NR SL slots overlapping with an LTE SL subframe for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1 - 4 of TS 38.214 [7], according to the amount of selected frequency resources and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources, and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].
\( 6> \) else:
\( 7> \) randomly select the time and frequency resources for one or more transmission opportunities from the available resources which occur within the SL DRX Active time, if configured, as specified in clause 5.28 .2 of the destination UE selected for indicating to the physical layer the SL DRX Active time above, and the pool(s) in which all RB sets with Sidelink consistent LBT failure detected and not cancelled and the resources of which the lowest sub-channel includes intra cell guard band PRBs if \( s l \) transmissionStructureForPSCCHandPSSCH is set to 'contiguousRB' are excluded, if configured, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources, and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9];
\( 4> \) if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and preferred resource set is not received from a UE:
\( 5> \) if transmission based on sensing is configured by upper layers and there are available resources left in the resources indicated by the physical layer according to clause 8.14 of TS 38.214 [7] for more transmission opportunities; or
\( 5> \) if transmission based on random selection is configured by upper layers and there are available resources left in the resource pool for more transmission opportunities:

6> randomly select the time and frequency resources for one or more transmission opportunities from the available resources excluding all RB sets had Sidelink consistent LBT failure detected and not cancelled and the resources of which the lowest sub-channel includes intra cell guard band PRBs if sl-transmissionStructureForPSCCHandPSSCH is set to 'contiguousRB' are excluded, if configured according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].
\( 4> \) if \( s \)-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE has own sensing result as specified in clause 8.14 of TS 38.214 [7] and if a preferred resource set is received from a UE:

ETSI


--- Page 160  ---


3GPP TS 38.321 version 18.2.0 Release 18
159
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) if there are available resources left in the intersection of the received preferred resource set and the resources indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7] for more transmission opportunities:
\( 6> \) randomly select the time and frequency resources for one or more transmission opportunities from the available resources within the intersection for a MAC PDU to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].
\( 5> \) if the number of time and frequency resources that has been maximally selected for one or more transmission opportunities from the available resources within the intersection is smaller than the selected number of HARQ retransmissions and there are available resources left in the resources indicated by the physical layer for more transmission opportunities:
\( 6> \) randomly select the time and frequency resources for the remaining transmission opportunities except for the selected resources within the intersection from the available resources outside the intersection but left in the resources indicated by the physical layer according to clause 8.1 .4 of TS 38.214 [7], according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].

4> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE does not have own sensing result as specified in clause 8.1.4 of TS 38.214 [7] and if a preferred resource set is received from a UE; and
\( 4> \) if there are available resources left in the received preferred resource set for more transmission opportunities:
\( 5> \) randomly select the time and frequency resources for one or more transmission opportunities from the available resources belonging to the received preferred resource set for a MAC PDU to be transmitted to the UE providing the preferred resource set, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available, by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources and that a retransmission resource can be indicated by the time resource assignment of a prior SCI according to clause 8.3.1.1 of TS 38.212 [9].

4> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and when the UE determines the resources for Sidelink Inter-UE Coordination Information transmission upon explicit request from a UE:
\( 5> \) randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.1 .4 of TS 38.214 [7], according to the amount of selected frequency resources, the remaining PDB of SL data available in the logical channel(s) allowed on the carrier, and/or the latency requirement of the triggered SL-CSI reporting and the latency requirement of the Sidelink Inter-UE Coordination Information transmission, and the remaining SL-PRS delay budget of the SL-PRS transmission(s), if available.

4> consider a transmission opportunity which comes first in time as the initial transmission opportunity and other transmission opportunities as the retransmission opportunities;
\( 4> \) consider all the transmission opportunities as the selected sidelink grant.

ETSI


--- Page 161  ---


3GPP TS 38.321 version 18.2.0 Release 18
160
ETSI TS 138321 V18.2.0 (2024-08)

3> else:
4> consider the set as the selected sidelink grant.
3> use the selected sidelink grant to determine PSCCH duration(s) and PSSCH duration(s) and the SL-PRS transmission occasion(s), if available, according to TS 38.214 [7] if the selected resource pool is not Dedicated SL-PRS resource pool or to determine the PSCCH duration(s) and SL-PRS transmission occasion(s) if the selected resource pool is Dedicated SL-PRS resource pool according to TS 38.214 [7].

NOTE 3Ae: MAC entity, based on UE implementation, decides whether to indicate the number of consecutive slots for Multi-consecutive slots transmission as specified in clause 8.14 of TS 38.214 [7] larger than 1.

NOTE 3Af: MAC entity, based on UE implementation, decides the value of the number of consecutive slots for Multi-consecutive slots transmission if it decides the number of consecutive slots for Multi-consecutive slots transmission larger than 1 , as long as it meets the CAPC maximum COT duration requirement as specified in TS 37.213 [18].

NOTE 3 Ag : When the MAC entity selects the time and frequency resources from the resources indicated by the physical layer as specified in clause 8.1.4 of TS 38.214 [7], it is up to the UE implementation whether to randomly select resources for transmission opportunities from the resources indicated by the physical layer or to select resources in consecutive slots by UE implementation from the resources indicated by the physical layer.

NOTE 3Ah: For a resource pool configured with PSFCH resource, UE cannot select consecutive slots for SL transmissions of a single TB for Multi-consecutive slots transmission.

NOTE 3Ai: UE may avoid selection of N consecutive resource(s) before a reserved resource of its own, where the selection of N is up to UE implementation from \( \{0,1,2\} \). UE may avoid selection of M consecutive resource(s) after a reserved resource of its own, where the selection of M is up to UE implementation (at least including 0 ).

NOTE 3Aj: If configured, UE may avoid selection of N consecutive resource(s) before a reserved resource of other UE when the L1 SL priority value for the transmission is higher than the L1 SL priority value of the reserved resource, where the selection of \( N \) is up to UE implementation from \( \{0,1,2\} \). UE may avoid selection of \( M \) consecutive resource(s) after a reserved resource of other UE when the transmitting symbols of the reserved resource overlap with LBT of its own selected resource, where the selection of M is up to UE implementation from \( \{0,1,2\} \). It is up to UE implementation how the physical layer reports detected reserved resources to MAC layer.

NOTE 3Ak: If configured, if transmission in slot(s) at least \( T_{p r o c, 0}^{S L} \) before a reserved resource of other UE is able to share its initiated COT to the reservation, UE may prioritize/select resource(s) in the slot(s) for transmission. It is up to UE implementation how the physical layer reports detected reserved resources to MAC layer.

NOTE 3AI: MAC entity, based on UE implementation, decides how to determine COT sharing cast type, COT sharing additional ID and remaining COT duration specified in TS 37.213 [18].

NOTE 3A1: If sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC and if multiple preferred resource sets are received from the same UE, it is up to UE implementation to use one or multiple of them in its resource (re)selection.

NOTE 3B1: If retransmission resource(s) cannot be selected by ensuring that the resource(s) can be indicated by the time resource assignment of a prior SCI, how to select the time and frequency resources for one or more transmission opportunities from the available resources is left for UE implementation by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources.

NOTE 3B2: When the UE receives both a single preferred resource set and a single non-preferred resource set from the same peer UE or different peer UEs, when the UE has own sensing results, it is up to the UE implementation to use the preferred resource set in its resource (re)selection for transmissions to the peer UE providing the preferred resource set.

ETSI


--- Page 162  ---


3GPP TS 38.321 version 18.2.0 Release 18
161
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 3B3: The UE is not required to use any resource from the preferred resource set in its resource (re-)selection if that resource is earlier than ( \( T_{\text {proc }, 0}^{S L}+T_{\text {proc }, 1}^{S L}+T_{\text {proc }, 2}^{S L} \) ) after the resource of Inter-UE Coordination Information transmission, where \( T_{\text {proc, } 2}^{S L} \) is equal to ( \( T_{\text {proc, } 0}^{S L}+T_{\text {proc, } 1}^{S L} \) ) when only MAC CE is used for inter-UE Coordination Information transmission, or \( T_{\text {proc }, 2}^{S L} \) is equal to \( T_{\text {proc }, 0}^{S L} \) when MAC CE and SCI format 2-C are both used for Inter-UE Coordination Information transmission. The case when \( T_{\text {proc }, 2}^{S L} \) is equal to \( T_{\text {proc }, 0}^{S L} \) is assuming that SCI format 2-C is received. \( T_{\text {proc }, 0}^{S L} \) and \( T_{\text {proc }, 1}^{S L} \) are specified in clause 8.1 .4 of TS 38.214 [7].

NOTE 3B4: For Inter-UE Coordination Information triggered by an explicit Inter-UE Coordination Request in Scheme 1, whether or not to transmit the Inter-UE Coordination Information upon the Inter-UE Coordination Request reception is determined by UE implementation subject to Release-16 procedure of UL/SL prioritization, LTE SL/NR SL prioritization, and congestion control.

NOTE 3B5: If configured by RRC, si-IUC-Explicit set to enabled and an SL-IUC request is received for the Source Layer-2 ID and Destination Layer-2 ID pair of a unicast, MAC layer indicates to physical layer the resource selection window, resource set type (i.e., preferred resource set), L1 priority, the number of sub-channels to be used for the PSSCH/PSCCH transmission and the resource reservation period for preferred resource set. If configured by RRC, sl-IUC-Explicit set to enabled and an SL-IUC request is received for the Source Layer-2 ID and Destination Layer-2 ID pair of a unicast, MAC layer indicates to physical layer resource set type (i.e., non-preferred resource set) and the resource selection window for non-preferred resource set.

NOTE 3B6: If either sl-IUC-Explicit or sl-IUC-Condition is configured as enabled, UE considers the reception of preferred and non-preferred resource is enabled.

NOTE 3B7: When sl-TriggerConditionCoordInfo is set to value 0 , for groupcast or broadcast of Inter-UE Coordination Information triggered by a condition in Scheme 1, which Destination Layer-2 ID (and the corresponding cast-type) a UE selects among Destination Layer-2 IDs that are already used or interested in NR sidelink transmission is up to the UE implementation.

1> if a selected sidelink grant is available for retransmission(s) of a MAC PDU which has been positively acknowledged as specified in clause 5.22.1.3.1a, except a positive acknowledgement to Multi-consecutive slots transmission (i.e., multiple TBs case) of the MAC PDU and there is remaining slot(s) for this MAC PDU:
\( 2> \) clear the PSCCH duration(s) and PSSCH duration(s) corresponding to retransmission(s) of the MAC PDU from the selected sidelink grant.

NOTE 3C: How the MAC entity determines the remaining PDB of SL data is left to UE implementation.
For a selected sidelink grant, the minimum time gap between any two selected resources comprises:
- For SL operation without shared spectrum channel access, a time gap between the end of the last symbol of a PSSCH transmission of the first resource and the start of the first symbol of the corresponding PSFCH reception determined by sl-MinTimeGapPSFCH and sl-PSFCH-Period for the pool of resources; and
- For SL operation with shared spectrum channel access, the time gap between the end of the last symbol of a PSSCH transmission of the first resource and the start of the first symbol of the last corresponding PSFCH reception occasion determined by sl-MinTimeGapPSFCH, sl-NumPSFCH-Occasions and sl-PSFCH-Period for the pool of resources; and
- a time required for PSFCH reception and processing plus sidelink retransmission preparation including multiplexing of necessary physical channels and any TX-RX/RX-TX switching time.

NOTE 4: How to determine the time required for PSFCH reception and processing plus sidelink retransmission preparation is left to UE implementation.

NOTE 4A: For the minimum time gap requirement on shared SL-PRS resource pool, the last symbol of a PSSCH transmission might be mapped to SL-PRS.

The MAC entity shall for each PSSCH duration not on Dedicated SL-PRS resource pool:
\( 1> \) for each sidelink grant occurring in this PSSCH duration:
\( 2> \) select a MCS table allowed in the pool of resource which is associated with the sidelink grant;

ETSI


--- Page 163  ---


3GPP TS 38.321 version 18.2.0 Release 18
162
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 4a: MCS table selection is up to UE implementation if more than one MCS table is configured.
2 if the MAC entity has been configured with Sidelink resource allocation mode 1 or Sidelink resource allocation Scheme 1 for SL-PRS transmission on Shared SL-PRS resource pool:
\( 3> \) select a MCS which is, if configured, within the range that is configured by RRC between sl-MinMCSPSSCH and \( s l \)-MaxMCS-PSSCH associated with the selected MCS table included in \( s l \) ConfigDedicatedNR;

3> set the resource reservation interval to 0 ms .
\( 2> \) else if the MAC entity has been configured with Sidelink resource allocation mode 2 or Sidelink resource allocation Scheme 2 for SL-PRS transmission on Shared SL-PRS resource pool:

3> select a MCS which is, if configured, within the range, if configured by RRC, between s/-MinMCSPSSCH and \( s l \)-MaxMCS-PSSCH associated with the selected MCS table included in \( s l \)-PSSCHTxConfigList and, if configured by RRC, overlapped between sl-MinMCS-PSSCH and sl-MaxMCSPSSCH associated with the selected MCS table indicated in sl-CBR-PriorityTx ConfigList for the highest priority of the sidelink logical channel(s) in the MAC PDU or pending SL-PRS transmission(s), if available, and the CBR measured by lower layers according to clause 5.1.27 of TS 38.215 [24] if CBR measurement results are available or the corresponding sl-DefaultTxConfigIndex configured by RRC if CBR measurement results are not available or the corresponding \( s \)-DefaultCBR-PartialSensing configured by RRC if partial sensing is selected and CBR measurement results are not available, or the corresponding sl-DefaultCBR-RandomSelection configured by RRC if random selection is selected and CBR measurement results are not available in case the \( s l \)-TxPoolExceptional is not used;

3> if the MAC entity decides not to use the selected sidelink grant for the next PSSCH duration corresponding to an initial transmission opportunity:

4> set the resource reservation interval to 0 ms .
\( 3> \) else:
4> set the resource reservation interval to the selected value.
NOTE 5: MCS selection is up to UE implementation if the MCS or the corresponding range is not configured by RRC.
\( 2> \) if the configured sidelink grant has been activated and this PSSCH duration corresponds to the first PSSCH transmission opportunity within this sl-PeriodCG of the configured sidelink grant:

3> set the HARQ Process ID to the HARQ Process ID associated with this PSSCH duration and, if available, all subsequent PSSCH duration(s) occuring in this sl-PeriodCG for the configured sidelink grant;
\( 3> \) determine that this PSSCH duration is used for initial transmission;
3> flush the HARQ buffer of Sidelink process associated with the HARQ Process ID.
\( 2> \) deliver the sidelink grant, the selected MCS, and the associated HARQ information to the Sidelink HARQ Entity for this PSSCH duration.

The MAC entity shall for each PSCCH duration on Dedicated SL-PRS resource pool:
1> if the MAC entity is not configured with multiple SL-PRS transmissions with Sidelink resource allocation scheme 2; or
\( 1> \) if the MAC entity is configured with Sidelink resource allocation scheme 1:
\( 2> \) set the resource reservation period to 0 .
\( 1> \) else if the MAC entity is configured with multiple SL-PRS transmission with Sidelink resource allocation scheme 2:
\( 2> \) set the resource reservation period to the selected value.

ETSI


--- Page 164  ---


3GPP TS 38.321 version 18.2.0 Release 18
163
ETSI TS 138321 V18.2.0 (2024-08)

1> if the configured sidelink grant has been activated and this PSSCH duration corresponds to the first PSSCH transmission opportunity within this sl-PeriodCG of the configured sidelink grant:
\( 2> \) set the SL-PRS Process ID to the SL-PRS Process ID associated with this PSSCH duration and, if available, all subsequent SL-PRS transmission occasion(s) occuring in this \( s l \)-PeriodCG for the configured sidelink grant;
\( 2> \) determine that this SL-PRS transmission occasion is used for initial transmission.
\( 1> \) process the sidelink grant according to clause 5.22.1.3.4 with the corresponding SL-PRS transmission information.

For configured sidelink grants not on Dedicated SL-PRS resource pool, the HARQ Process ID associated with the first slot of an SL transmission is derived from the following equation:
\[
\begin{array}{c}
\text { HARQ Process }[\mathrm{D}=[\text { floor }(\text { CURRENT slot } / \text { PeriodicityS } L)] \text { modulo } s l \text {-NrOfHARQ-Processes } \\
+s l \text {-HARQ-ProcID-offset }
\end{array}
\]

For configured sidelink grant on Dedicated SL-PRS resource pool, the SL-PRS Process ID associated with the first slot of an SL transmission is derived from the following equation:
\[
\text { SL-PRS Process }[D=[\text { floor(CURRENT_slot / PeriodicitySL) }] \text { modulo [nrOfSL-PRSProc] }
\]
where CURRENT_slot refers to current logical slot in the associated resource pool, and PeriodicitySL is defined in clause 5.8.3.
5.22.1.2 TX resource (re-)selection check

If the TX resource (re-)selection check procedure is triggered on the selected pool of resources for a Sidelink process according to clause 5.22.1.1, the MAC entity shall for the Sidelink process:
\( 1> \) if PSCCH duration(s) and \( 2{ }^{\text {nd }} \) stage SCI on PSSCH for all transmissions of a MAC PDU of any selected sidelink grant(s) are not in SL DRX Active time as specified in clause 5.28 .3 of the destination that has data to be sent; or

1> if SL_RESOURCE_RESELECTION_COUNTER \( =0 \) and when SL_RESOURCE_RESELECTION_COUNTER was equal to 1 the MAC entity randomly selected, with equal probability, a value in the interval \( [\overline{0}, 1] \) which is above the probability configured by RRC in sl-ProbResourceKeep; or
\( 1> \) if the pool of resources is configured or reconfigured by RRC; or
1> if there is no selected sidelink grant on the selected pool of resources; or
\( 1> \) if neither transmission nor retransmission has been performed by the MAC entity on any resource indicated in the selected sidelink grant during the last second; or
\( 1> \) if \( s \) /-ReselectAfter is configured and the number of consecutive unused transmission opportunities on resources indicated in the selected sidelink grant, which is incremented by 1 when none of the resources of the selected sidelink grant within a resource reservation interval is used, is equal to \( s / \)-ReselectAfter; or

1> if the selected sidelink grant cannot accommodate a RLC SDU by using the maximum allowed MCS configured by RRC in sl-MaxMCS-PSSCH associated with the selected MCS table and the UE selects not to segment the RLC SDU; or

NOTE 1: If the selected sidelink grant cannot accommodate the RLC SDU, it is left for UE implementation whether to perform segmentation or sidelink resource reselection.
\( 1> \) if transmission(s) with the selected sidelink grant cannot fulfil the remaining PDB of the data in a logical or the remaining SL-PRS delay budget for SL-PRS transmission, if available channel, and the MAC entity selects not to perform transmission(s) corresponding to a single MAC PDU or SL-PRS transmission; or

1> if Sidelink consistent LBT failure is detected as specified in clause 5.31.2 in some RB set(s) of the selected resource pool that spans multiple RB sets for the logical channel, if single carrier frequency is configured; or

ETSI


--- Page 165  ---


3GPP TS 38.321 version 18.2.0 Release 18
164
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) if a MAC PDU is not transmitted (ie initial transmission or retransmission) in any of the resources for this MAC PDU that are associated with the sidelink process for Multi-consecutive slots transmission due to the Sidelink LBT failure:

NOTE 2: If the remaining PDB is not met, it is left for UE implementation whether to perform transmission(s) corresponding to single MAC PDU or sidelink resource reselection.

NOTE 3: It is left for UE implementation whether to trigger the TX resource (re-)selection due to the latency requirement of the MAC CEs triggered according to clause 5.22.1.7 and clause 5.22.1.10.1.
\( 2> \) if multiple carrier frequencies are configured:
\( 3> \) trigger the TX carrier (re-)selection procedure as specified in clause 5.22.1.11.
NOTE 3a: It is up to UE implementation to avoid triggering the TX carrier (re-)selection procedure again if it has just performed TX carrier (re-)selection procedure.
\( 2> \) clear the selected sidelink grant associated to the Sidelink process, if available;
\( 2> \) trigger the TX resource (re-)selection.
NOTE 4: Void.
NOTE 5: Void.
5.22.1.2a Re-evaluation and Pre-emption

A resource(s) of the selected sidelink grant for a MAC PDU to transmit from multiplexing and assembly entity or for a SL-PRS transmission is re-evaluated by physical layer at \( T_{3} \) before the slot where the SCI indicating the resource(s) is signalled at first time as specified in clause 8.14 of TS 38.214 [7].

A resource(s) of the selected sidelink grant which has been indicated by a prior SCI for a MAC PDU to transmit from multiplexing and assembly entity or for a SL-PRS transmission could be checked for pre-emption by physical layer at \( T_{3} \) before the slot where the resource(s) is located as specified in clause 8.14 of TS 38.214 [7].

NOTE 1: It is up to UE implementation to re-evaluate or pre-empt before ' \( \mathrm{m}-T_{3} \) ' or after ' \( \mathrm{m}-T_{3} \) ' but before ' m '. For re-evaluation, \( m \) is the slot where the SCI indicating the resource(s) is signalled at first time as specified in clause 8.14 of TS 38.214. For pre-emption, \( m \) is the slot where the resource(s) is located as specified in clause 8.1.4 of TS 38.214.

If the MAC entity has been configured with Sidelink resource allocation mode 2 or Sidelink resource allocation scheme 2 to transmit using pool(s) of resources in a carrier as indicated in TS 38.331 [5] or TS 36.331 [21] based on sensing or random selection the MAC entity shall for each Sidelink process or for each SL-PRS transmission:
\( 1> \) if a resource( \( s \) ) of the selected sidelink grant which has not been identified by a prior SCI is indicated for reevaluation by the physical layer as specified in clause 8.1 . 4 of TS 38.214 [7];
\( 2> \) remove the resource(s) from the selected sidelink grant associated to the Sidelink process or SL-PRS transmission;
\( 2> \) if the selected resource pool is not Dedicated SL-PRS resource pool:
\( 3> \) randomly select the time and frequency resource from the resources indicated by the physical layer as specified in clause 8-1-4 of TS 38.214 [7] for either the removed resource or the dropped resource, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of either SL data available in the logical channel(s), and the remaining SL-PRS delay budget for SL-PRS transmission, if available, by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources, and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.1 of TS 38.212 [9];
\( 2> \) else if the selected resource pool is Dedicated SL-PRS resource pool:
\( 3> \) randomly select the time and frequency resource from the resources indicated by the physical layer as specified in clause 8.2.4 of TS 38.214 [7] for either the removed resource or the dropped resource,

ETSI


--- Page 166  ---


3GPP TS 38.321 version 18.2.0 Release 18
165
ETSI TS 138321 V18.2.0 (2024-08)

according to the selected number of SL-PRS retransmissions and the remaining SL-PRS delay budget for SL-PRS transmission and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.2 of TS 38.212 [9].
\( 2> \) replace the removed or dropped resource(s) by the selected resource(s) for the selected sidelink grant.
\( 1> \) if any resource(s) of the selected sidelink grant which has been indicated by a prior SCI is indicated for preemption by the physical layer as specified in clause 8.14 of TS 38.214 [7]:
\( 2> \) remove the resource(s) from the selected sidelink grant associated to the Sidelink process;
\( 2> \) if one or multiple SL DRX is configured:
\( 3> \) if the selected resource pool is not Dedicated SL-PRS resource pool:
\( 4> \) randomly select the time and frequency resource from the resources later than the resources for either the removed resource or the dropped resource indicated by a prior SCI, from the resource indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7] which occur within the SL DRX active time as specified in clause 5.28 .3 of the destination UE selected for indicating to the physical layer the SL DRX active time above, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of either SL data available in the logical channel(s) by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources, and the remaining SL-PRS delay budget for SL-PRS transmission, if available, and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.1 of TS 38.212 [9].
\( 2> \) else:
\( 3> \) if the selected resource pool is not Dedicated SL-PRS resource pool:
\( 4> \) randomly select the time and frequency resource from the resources indicated by the physical layer as specified in clause 8-1.4 of TS 38.214 [7] for either the removed resource or the dropped resource, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of either SL data available in the logical channel(s) by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources, and the remaining SL-PRS delay budget for SL-PRS transmission, if available, and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.1 of TS 38.212 [9].
\( 3> \) else if the selected resource pool is Dedicated SL-PRS resource pool:
4 randomly select the time and frequency resource from the resources indicated by the physical layer as specified in clause 8.2.4 of TS 38.214 [7] for either the removed resource or the dropped resource, according to the selected number of SL-PRS retransmissions and the remaining SL-PRS delay budget for SL-PRS transmission and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.1 of TS 38.212 [9].

NOTE 2: If retransmission resource(s) cannot be selected by ensuring that the resource(s) can be indicated by the time resource assignment of a prior SCI, how to select the time and frequency resources for one or more transmission opportunities from the available resources is left for UE implementation by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources.
\( 2> \) replace the removed or dropped resource(s) by the selected resource(s) for the selected sidelink grant.
NOTE 3: It is left for UE implementation to reselect any pre-selected but not reserved resource(s) other than the resource(s) indicated for pre-emption or re-evaluation by the physical layer during reselection triggered by re-evaluation or pre-emption indicated by the physical layer.

NOTE 4: It is up to UE implementation whether to set the resource reservation interval in the re-selected resource to replace pre-empted resource.

NOTE 5: It is up to UE implementation whether to trigger resource reselection due to de-prioritization as specified in clause 16.2.4 of TS 38.213 [6], clause 5.14.1.2.2 of TS 36.321 [22] and clause 5.22.1.3.1a.

ETSI


--- Page 167  ---


3GPP TS 38.321 version 18.2.0 Release 18
166
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 6: For the selected sidelink grant corresponds to transmissions of multiple MAC PDU, it is up to UE implementation whether to apply re-evaluation check to the resources in non-initial reservation period that have been signalled neither in the immediate last nor in the current period.
5.22.1.2b Re-selection for using a received resource conflict indication

If the MAC entity has been configured with Sidelink resource allocation mode 2 or Sidelink resource allocation scheme 2 to transmit using pool(s) of resources in a carrier as indicated in TS 38.331 [5] based on full sensing, or partial sensing or random selection or any combination(s), the MAC entity shall for each Sidelink process:
\( 1> \) if \( s \)-interUECoordinationScheme 2 enabling reception/transmission of a resource conflict indication is configured by RRC; and

1> if the next resource of the selected sidelink grant which has been indicated by a prior SCI is overlapped with conflict resource(s) indicated by the physical layer as specified in clause 16.3.1 of TS 38.213 [6]:
\( 2> \) remove the resource from the selected sidelink grant associated to the Sidelink process;
\( 2> \) randomly select the time and frequency resource from the resources indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7] excluding the conflict resource(s) for the removed resource, according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of either SL data available in the logical channel(s), and the remaining SL-PRS delay budget for SL-PRS transmission, if available, by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources, and that a resource can be indicated by the time resource assignment of an SCI for a retransmission according to clause 8.3.1.1 of TS 38.212 [9];

NOTE 1: If retransmission resource cannot be selected by ensuring that the resource can be indicated by the time resource assignment of a prior SCI, how to select the time and frequency resource for more transmission opportunities from the available resources is left for UE implementation by ensuring the minimum time gap between any two selected resources in case that PSFCH is configured for this pool of resources.
\( 2> \) replace the removed resource by the selected resource for the selected sidelink grant.
NOTE 2: It is left for UE implementation to reselect any pre-selected but not reserved resource(s) other than the resource overlapping with the conflict resource(s) indicated by the physical layer during reselection triggered by the conflict resource(s) indicated by the physical layer.

NOTE 3: It is up to UE implementation whether and how to set the resource reservation interval in the re-selected resource to replace the resource overlapping with the conflict resource(s) indicated by the physical layer.
5.22.1.2c Resource re-selection from SL LBT Failure indication

If the MAC entity has been configured with Sidelink resource allocation mode 2 to transmit using pool(s) of resources in a carrier as indicated in TS 38.331 [5] based on sensing or random selection the MAC entity shall for each Sidelink process:

1> if SL LBT failure indication is received from lower layers:
\( 2> \) for the resource(s) where SL LBT failure is detected from the selected sidelink grant associated to the Sidelink process:

3> if transmission based on random selection is configured by upper layers:
4> randomly select the time and frequency resources for one transmission opportunity from the resource pool excluding all RB sets for which Sidelink consistent LBT failures were detected and not cancelled, if configured according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources.

3> else:

ETSI


--- Page 168  ---


3GPP TS 38.321 version 18.2.0 Release 18
167
ETSI TS 138321 V18.2.0 (2024-08)

4 randomly select the time and frequency resources for one transmission opportunity from the resources indicated by the physical layer as specified in clause 8.14 of TS 38.214 [7], according to the amount of selected frequency resources, the selected number of HARQ retransmissions and the remaining PDB of SL data available in the logical channel(s) by ensuring the minimum time gap between any two selected resources of the selected sidelink grant in case that PSFCH is configured for this pool of resources.
5.22.1.3 Sidelink HARQ operation and SL-PRS transmission
5.22.1.3.1 Sidelink HARQ Entity

The MAC entity is configured by upper layers to transmit using pool(s) of resources on one or more carriers as indicated in clause 5.8 .8 of TS 38.331 [5]. For each carrier, the MAC entity includes at most one Sidelink HARQ entity for transmission on SL-SCH, which maintains a number of parallel Sidelink processes.

The maximum number of transmitting Sidelink processes associated with the Sidelink HARQ Entity is 16 . A sidelink process may be configured for transmissions of multiple MAC PDUs. For transmissions of multiple MAC PDUs with Sidelink resource allocation mode 2 , the maximum number of transmitting Sidelink processes associated with the Sidelink HARQ Entity is 4.

A delivered sidelink grant and its associated Sidelink transmission information are associated with a Sidelink process. Each Sidelink process supports one TB.

NOTE: For SL-PRS transmission on Dedicated SL-PRS resource pool, the maximum number of SL-PRS the UE should support is left to UE implementation.

For each sidelink grant, the Sidelink HARQ Entity shall:
\( 1> \) if the MAC entity determines that the sidelink grant is used for initial transmission as specified in clause 5.22.1.1; or
\( 1> \) if the sidelink grant is a configured sidelink grant and no MAC PDU has been obtained in an \( s / \)-PeriodCG of the configured sidelink grant; or
\( 1> \) if the sidelink grant is a dynamic sidelink grant or selected sidelink grant and no MAC PDU has been obtained in the previous sidelink grant when PSCCH duration(s) and \( 2^{\text {nd }} \) stage SCI on PSSCH of the previous sidelink grant is not in SL DRX Active time as specified in clause 5.28 .3 of any destination that has data to be sent:

NOTE 1: Void.
\( 2> \) (re-)associate a Sidelink process to this grant, and for the associated Sidelink process:
2 if all PSCCH duration(s) and PSSCH duration(s) for initial transmission of a MAC PDU of the dynamic sidelink grant or the configured sidelink grant is not in SL DRX Active time as specified in clause 5.28 .3 of the destination that has data to be sent:
\( 3> \) ignore the sidelink grant.
NOTE 1A: The Sidelink HARQ Entity will associate the selected sidelink grant to the Sidelink process determined by the MAC entity.
\( 2> \) else:
\( 3> \) obtain the MAC PDU and SL-PRS, if any, to transmit from the Multiplexing and assembly entity, if any;
3> if a MAC PDU to transmit has been obtained:
\( 4> \) if a HARQ Process ID has been set for the sidelink grant:
\( 5> \) (re-)associate the HARQ Process [D corresponding to the sidelink grant to the Sidelink process.
NOTE 1a: There is one-to-one mapping between a HARQ Process ID and a Sidelink process in the MAC entity configured with Sidelink resource allocation mode 1.

ETSI


--- Page 169  ---


3GPP TS 38.321 version 18.2.0 Release 18
168
ETSI TS 138321 V18.2.0 (2024-08)

4> determines Sidelink transmission information of the TB for the source and destination pair of the MAC PDU as follows:
\( 5> \) set the Source Layer-1 ID to the 8 LSB of the Source Layer-2 ID of the MAC PDU;
\( 5> \) set the Destination Layer-1 ID to the 16 LSB of the Destination Layer-2 ID of the MAC PDU;
\( 5> \) (re-)associate the Sidelink process to a Sidelink process ID;
NOTE 1b:How UE determine Sidelink process ID in SCI is left to UE implementation for NR sidelink.
\( 5> \) consider the NDI to have been toggled compared to the value of the previous transmission corresponding to the Sidelink identification information and the Sidelink process ID of the MAC PDU and set the NDI to the toggled value;

NOTE 2: The initial value of the NDI set to the very first transmission for the associated Sidelink process is left to UE implementation.

NOTE 3: Void.
\( 5> \) if the MAC PDU is for NR sidelink discovery:
6> set the cast type indicator to broadcast.
\( 5> \) else:
\( 6> \) if the MAC PDU includes only Sidelink MAC CE(s):
7> if the MAC PDU includes only Sidelink Inter-UE Coordination Information MAC CE indicating non-preferred resource set and triggered by a condition other than the explicit request:
\( 8> \) set the cast type indicator to one of broadcast, groupcast and unicast.
\( 7> \) else:
\( 8> \) set the cast type indicator to unicast.
6> else:
\( 7> \) set the cast type indicator to one of broadcast, groupcast and unicast as indicated by upper layers.
\( 5> \) if HARQ feedback has been enabled for the MAC PDU according to clause 5.22.1.4.2;
\( 6> \) set the HARQ feedback enabled/disabled indicator to enabled.
\( 5> \) else:
6> set the HARQ feedback enabled/disabled indicator to disabled.
\( 5> \) set the priority to the value of the highest priority of the logical channel(s), if any, and MAC CE(s), if included, in the MAC PDU and SL-PRS, if any;

ETSI


--- Page 170  ---


3GPP TS 38.321 version 18.2.0 Release 18
169
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 3A: When determining Sidelink transmission information, the priority of the Sidelink Inter-UE Coordination Information MAC CE is the value configured in RRC parameters \( s \) PriorityCoordInfoCondition when triggered by a condition, or sl-PriorityCoordInfoExplicit when triggered by an explicit request. When determining Sidelink transmission information, the priority of the Sidelink Inter-UE Coordination Request MAC CE is the value configured in RRC parameter \( s \) PriorityRequest. When determining Sidelink transmission information, the priority of the Sidelink InterUE Coordination Information MAC CE is the value indicated in Priority field in the Sidelink Inter-UE Coordination Request MAC CE provided by the UE when triggered by an explicit request, if \( s l \) -PriorityCoordInfoExplicit-r17 is not configured. When determining Sidelink transmission information for performing sensing and candidate resource selections in PHY, the priority value of the Sidelink Inter-UE Coordination Information MAC CE triggered under a condition is up to UE implementation, if \( s l \) -PriorityCoordInfoCondition-r 17 is not configured. When determining Sidelink transmission information for performing sensing and candidate resource selections in PHY, the priority value of Sidelink Inter-UE Coordination Request MAC CE is the same as that of a TB to be transmitted by the UE, if sl-PriorityRequest-r 17 is not configured.
\( 5> \) if HARQ feedback is enabled for groupcast:
\( 6> \) if both a group size and a member ID are provided by upper layers and the group size is not greater than the number of candidate PSFCH resources in a slot associated with this sidelink grant:
\( 7> \) select either positive-negative acknowledgement or negative-only acknowledgement.
NOTE 4: Selection of positive-negative acknowledgement or negative-only acknowledgement is up to UE implementation.
\( 6> \) else:
7> select negative-only acknowledgement.
NOTE 5: UE operating in SL unlicensed does not use negative-only acknowledgement for groupcast HARQ feedback.

6> if negative-only acknowledgement is selected, UE's location information is available, and \( s \) TransRange has been configured for a logical channel in the MAC PDU, and sl-ZoneConfig is configured as specified in TS 38.331 [5]:
\( 7> \) set the communication range requirement to the value of the longest communication range of the logical channel(s) in the MAC PDU;

7> determine the value of sl-ZoneLength corresponding to the communication range requirement and set Zone_id to the value of Zone_id calculated using the determined value of sl-ZoneLength as specified in TS 38.331 [5].
\( 5> \) set the Redundancy version to the selected value.
5> if the upper layers triggers the SL-PRS transmission of the peer UE identified by the Destination layer-2 ID:
\( 6> \) set the SL-PRS request to request.
\( 5> \) set the SL-PRS resource [D, if SL-PRS is available, within Sidelink transmission information.
NOTE 6: The SL-PRS resource ID(s) for initial transmission and retransmission(s) are determined by the UE's own upper layers by implementation.
\( 4> \) deliver the MAC PDU, the SL-PRS, if available, the sidelink grant and the Sidelink transmission information of the TB to the associated Sidelink process;

4> instruct the associated Sidelink process to trigger a new transmission.
3> else:
\( 4> \) flush the HARQ buffer of the associated Sidelink process.

ETSI


--- Page 171  ---


3GPP TS 38.321 version 18.2.0 Release 18
170
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) else (i.e retransmission):
\( 2> \) if the HARQ Process ID corresponding to the sidelink grant received on PDCCH, the configured sidelink grant or the selected sidelink grant is associated to a Sidelink process of which HARQ buffer is empty; or
\( 2> \) if the HARQ Process ID corresponding to the sidelink grant received on PDCCH is not associated to any Sidelink process; or
\( 2> \) if PSCCH duration(s) and PSSCH duration(s) for one or more retransmissions of a MAC PDU of the dynamic sidelink grant or the configured sidelink grant is not in SL DRX Active time as specified in clause 5.28 .3 of the destination that has data to be sent:
\( 3> \) ignore the sidelink grant.
\( 2> \) else:
\( 3> \) identify the Sidelink process associated with this grant, and for the associated Sidelink process:
\( 4> \) set the SL-PRS resource ID, if SL-PRS is available, within Sidelink transmission information;
\( 4> \) deliver the sidelink grant and the Sidelink transmission information of the MAC PDU and the SLPRS, if available, to the associated Sidelink process;
\( 4> \) instruct the associated Sidelink process to trigger a retransmission.
5.22.1.3.1a Sidelink process not associated with Dedicated SL-PRS resource pool

The Sidelink process is associated with a HARQ buffer.
New transmissions and retransmissions are performed on the resource indicated in the sidelink grant as specified in clause 5.22.1.1 and with the MCS selected as specified in clause 8.1.3.1 of TS 38.214 [7] and clause 5.22.1.1.

If the Sidelink process is configured to perform transmissions of multiple MAC PDUs with Sidelink resource allocation mode 2 , the process maintains a counter SL_RESOURCE_RESELECTION_COUNTER. For other configurations of the Sidelink process, this counter is not available.

Priority of a MAC PDU and SL-PRS, if available, is determined by the highest priority of the logical channel(s), MAC CE(s) in the MAC PDU or SL-PRS.

If the Sidelink HARQ Entity requests a new transmission, the Sidelink process shall:
\( 1> \) store the MAC PDU in the associated HARQ buffer;
\( 1> \) store the sidelink grant received from the Sidelink HARQ Entity;
\( 1> \) generate a transmission as described below.
If the Sidelink HARQ Entity requests a retransmission, the Sidelink process shall:
\( 1> \) store the sidelink grant received from the Sidelink HARQ Entity;
\( 1> \) generate a transmission as described below.
To generate a transmission, the Sidelink process shall:
\( 1> \) if there is no uplink transmission; or
\( 1> \) if the MAC entity is able to simultaneously perform uplink transmission(s) and sidelink transmission at the time of the transmission; or
\( 1> \) if the other MAC entity and the MAC entity are able to simultaneously perform uplink transmission(s) and sidelink transmission at the time of the transmission respectively; or
\( 1> \) if there is a MAC PDU to be transmitted for this duration in uplink, except a MAC PDU obtained from the Msg3 buffer, the MSGA buffer, or prioritized as specified in clause 5.4.2.2, and the sidelink transmission is prioritized over uplink transmission:

ETSI


--- Page 172  ---


3GPP TS 38.321 version 18.2.0 Release 18
171
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) instruct the physical layer to transmit SCI according to the stored sidelink grant with the associated Sidelink transmission information;
\( 2> \) instruct the physical layer to generate a transmission according to the stored sidelink grant;
\( 2> \) if HARQ feedback has been enabled for the MAC PDU according to clause 5.22.1.4.2:
\( 3> \) instruct the physical layer to monitor PSFCH for the transmission and perform PSFCH reception as specified in clause 5.22.1.3.2.
\( 2> \) if \( s \)-PUCCH-Config is configured by RRC for the stored sidelink grant:
\( 3> \) determine transmission of an acknowledgement on the PUCCH as specified in clause 5.22.1.3.2.
\( 1> \) if this transmission corresponds to the last transmission of the MAC PDU and SL-PRS, if available:
\( 2> \) decrement SL_RESOURCE_RESELECTION_COUNTER by 1, if available.
NOTE 1: If the number of \( H A R Q \) retransmissions selected by the MAC entity has been reached, or if a positive acknowledgement to a transmission of the MAC PDU has been received, or if a negative-only acknowledgement was enabled in the SCI and no negative acknowledgement was received for the transmission of the MAC PDU, the MAC entity determines this transmission corresponds to the last transmission of the MAC PDU for Sidelink resource allocation mode 2. How to determine the last transmission in other cases is up to UE implementation.
\( 1> \) if \( s \) /-MaxTransNum corresponding to the highest priority of the logical channel(s) in the MAC PDU has been configured in sl-CG-MaxTransNumList for the sidelink grant by RRC and the number of transmissions of the MAC PDU has been reached to sl-MaxTransNum; or
\( 1> \) if a positive acknowledgement to this transmission of the MAC PDU was received according to clause 5.22.1.3.2, except a positive acknowledgement to Multi-consecutive slots transmission (i.e., multiple TBs case) of the MAC PDU and there is remaining slot(s) for this MAC PDU; or
\( 1> \) if negative-only acknowledgement was enabled in the SCI and no negative acknowledgement was received for this transmission of the MAC PDU according to clause 5.22.1.3.2:
\( 2> \) flush the HARQ buffer of the associated Sidelink process.
The transmission of the MAC PDU or SL-PRS, if available, is prioritized over uplink transmission(s) of the MAC entity or the other MAC entity if the following conditions are met:
\( 1> \) if the MAC entity is not able to perform this sidelink transmission simultaneously with all uplink transmission(s) at the time of the transmission, and
\( 1> \) if none of the uplink transmission(s) is prioritized by upper layer according to TS 23.287 [19], and
\( 1> \) if none of the NR uplink MAC PDU(s) includes any MAC CE prioritized as described in clause 5.4.3.1.3, and
\( 1> \) if \( u \)-PrioritizationThres is configured and if the value of the highest priority of logical channel(s) of all the NR uplink transmission(s) is not lower than \( u \)-PrioritizationThres, and
\( 1> \) if \( s \) /-PrioritizationThres is configured and if the value of the highest priority of logical channel(s) or MAC CE(s) in the MAC PDU is lower than sl-PrioritizationThres.

NOTE 2: If the MAC entity is not able to perform this sidelink transmission simultaneously with all uplink transmissions as specified in clause 5.4.2.2 of TS 36.321 [22] at the time of the transmission, and prioritization-related information is not available prior to the time of this sidelink transmission due to processing time restriction, it is up to UE implementation whether this sidelink transmission is performed.
5.22.1.3.2 PSFCH reception

The MAC entity shall for each PSSCH transmission:
\( 1> \) if an acknowledgement corresponding to the PSSCH transmission in clause 5.22.1.3.1a is obtained from the physical layer:

ETSI


--- Page 173  ---


3GPP TS 38.321 version 18.2.0 Release 18
172
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) deliver the acknowledgement to the corresponding Sidelink HARQ entity for the Sidelink process;
\( 1> \) else:
\( 2> \) deliver a negative acknowledgement to the corresponding Sidelink HARQ entity for the Sidelink process;
1> if the PSSCH transmission occurs for a pair of Source Layer-2 [D and Destination Layer-2 [D corresponding to a PC5-RRC connection which has been established by upper layers:
\( 2> \) perform the HARQ-Based Sidelink RLF Detection procedure as specified in clause 5.22.1.3.3.
If sl-PUCCH-Config is configured by RRC, the MAC entity shall for a PUCCH transmission occasion:
1> if the timeAlignmentTimer, associated with the TAG containing the Serving Cell on which the HARQ feedback is to be transmitted, is stopped or expired, and the Serving Cell is not configured with two TAGs; or

1> if the Serving Cell on which the HARQ feedback is to be transmitted is configured with two TAGs and if the timeAlignmentTimer of the TAG, associated with the TCI state(s) used for transmitting the HARQ feedback, is stopped or expired:
\( 2> \) not instruct the physical layer to generate acknowledgement(s) of the data in this TB.
\( 1> \) else if all PSCCH duration(s) and PSSCH duration(s) for initial transmission of a MAC PDU of the dynamic sidelink grant or the configured sidelink grant is not in SL DRX Active time as specified in clause 5.28 .3 of the destination that has data to be sent and the sidelink grant is ignored according to clause 5.22.1.3.1:
\( 2> \) instruct the physical layer to signal a positive acknowledgement corresponding to the transmission on the PUCCH according to clause 16.5 of TS 38.213 [6].

1> else if a MAC PDU has been obtained for a sidelink grant associated to the PUCCH transmission occasion in clause 5.22.1.3.1, the MAC entity shall:
\( 2> \) if the most recent transmission of the MAC PDU was not prioritized as specified in clause 5.22.1.3.1a:
3> instruct the physical layer to signal a negative acknowledgement on the PUCCH according to clause 16.5 of TS 38.213 [6].

2 else if HARQ feedback has been disabled for the MAC PDU and next retransmission(s) of the MAC PDU is not required:

3> instruct the physical layer to signal a positive acknowledgement corresponding to the transmission on the PUCCH according to clause 16.5 of TS 38.213 [6].
\( 2> \) else if HARQ feedback has been disabled for the MAC PDU, and no sidelink grant is available for next retransmission(s) of the MAC PDU (including immediately after all PSSCH duration(s) in an sl-PeriodCG for the sidelink grant, the number of transmissions of the MAC PDU has not reached \( s \) /-MaxTransNum corresponding to the highest priority of the logical channel(s) in the MAC PDU, if configured in \( s /-C G \) MaxTransNumList for the sidelink grant by RRC), if any; or
\( 2> \) else if PSCCH duration(s) and PSSCH duration(s) for one or more retransmissions of a MAC PDU of the dynamic sidelink grant or the configured sidelink grant is not in SL DRX Active time as specified in clause 5.28 .3 of the destination that has data to be sent:

3> instruct the physical layer to signal a negative acknowledgement corresponding to the transmission on the PUCCH according to clause 16.5 of TS 38.213 [6].
\( 2> \) else:
3> instruct the physical layer to signal an acknowledgement corresponding to the transmission on the PUCCH according to clause 16.5 of TS 38.213 [6]

1> else:
\( 2> \) instruct the physical layer to signal a positive acknowledgement on the PUCCH according to clause 16.5 of TS 38.213 [6].

ETSI


--- Page 174  ---


3GPP TS 38.321 version 18.2.0 Release 18
173
ETSI TS 138321 V18.2.0 (2024-08)
5.22.1.3.3 HARQ-based Sidelink RLF detection

For each carrier associated with a PC5-RRC connection, the HARQ-based Sidelink RLF detection procedure is used to detect Sidelink RLF based on a number of consecutive DTX on PSFCH reception occasions for a PC5-RRC connection.

RRC configures the following parameter to control HARQ-based Sidelink RLF detection:
- sl-maxNumConsecutiveDTX.

The following UE variable is used for HARQ-based Sidelink RLF detection.
- numConsecutiveDTX, which is maintained per carrier per PC5-RRC connection.

For each carrier associated with a PC5-RRC connection, the Sidelink HARQ Entity shall (re-)initialize numConsecutiveDTX to zero for each PC5-RRC connection which has been established by upper layers, if any, upon establishment of the PC5-RRC connection or (re)configuration of \( s \)-maxNumConsecutiveDTX.

For each carrier associated with a PC5-RRC connection, the Sidelink HARQ Entity shall for each PSFCH reception occasion associated to the PSSCH transmission:

1> if PSFCH reception is absent on the PSFCH reception occasion:
\( 2> \) increment numConsecutiveDTX by 1;
NOTE 1: For SL operation with shared spectrum channel access, UE increases the numConsecutiveDTX by 1 when the UE fails to detect the HARQ feedback on all the associated PSFCH resources according to clause 16.3.0 of TS 38.213 [6].
\( 2> \) if more than one carrier selected as defined in clause 5.22.1.11 is considered as the carriers for HARQ-based Sidelink RLF detection:

3> if numConsecutiveDTX reaches \( s \)-maxNumConsecutiveDTX for all carriers applied for HARQ-based Sidelink RLF detection:
\( 4> \) indicate HARQ-based Sidelink RLF detection to upper layers (i.e., RRC layer and V2X layer).
\( 3> \) else if numConsecutiveDTX reaches \( s i \)-maxNumConsecutiveDTX for a carrier applied for HARQ-based Sidelink RLF detection:
\( 4> \) trigger the TX carrier (re-)selection procedure as specified in clause 5.22.1.11;
\( 4> \) indicate HARQ-based Sidelink carrier failure to upper layers (i.e., RRC layer and V2X layer).
\( 2> \) else:
3> if numConsecutiveDTX reaches sl-maxNumConsecutiveDTX:
4 - indicate HARQ-based Sidelink RLF detection to upper layers.
1> else:
\( 2> \) re-initialize numConsecutiveDTX to zero.
5.22.1.3.4 Processing of sidelink grant on Dedicated SL-PRS resource pool

For each sidelink grant, the MAC entity shall:
\( 1> \) if the MAC entity determines that the sidelink grant is used for initial transmission as specified in clause 5.22.1.1; or
\( 1> \) if the sidelink grant is a configured sidelink grant and no MAC PDU has been obtained in an \( s l \)-PeriodCG of the configured sidelink grant:
\( 2> \) associate a Sidelink process to this sidelink grant;
\( 2> \) set the Destination ID to the Destination layer-2 ID corresponding to the SL-PRS transmission;

ETSI


--- Page 175  ---


3GPP TS 38.321 version 18.2.0 Release 18
174
ETSITS 138321 V18.2.0 (2024-08)

\( 2> \) if the length of the Source ID is configured to as 12 bit:
\( 3> \) set the Source ID to the 12 LSB of the Source layer-2 ID corresponding to the SL-PRS transmission;
\( 2> \) else if length of the Source ID is configured to as 24 bit:
\( 3> \) set the Source [D to the Source layer-2 [D corresponding to the SL-PRS transmission;
\( 2> \) set the cast type indicator to one of broadcast, groupcast and unicast as indiated by the upper layer;
\( 2> \) set the SL-PRS priority as the value indicated by upper layer;
\( 2> \) set the SL-PRS resource ID;
NOTE 1: The SL-PRS resource ID(s) for initial transmission and retransmission(s) are determined by the UE's own upper layers by implementation.
\( 2> \) if the upper layer triggers SL-PRS transmission of the peer UE identified by the Destination layer-2 ID:
\( 3> \) set the SL-PRS request to request;
\( 2> \) deliver the SL-PRS transmission information to the Sidelink process;
\( 2> \) instruct the associated Sidelink process to trigger a new transmission as defined in 5.22.1.3.5.
\( 1> \) else (i.e., retransmission):
\( 2> \) identify the Sidelink process associated with this grant;
\( 2> \) if sl-PRS-MaxNumTransmissions is configured and the number of transmissions of the SL-PRS has not reached sl-PRS-MaxNumTransmissions:
\( 3> \) set the SL-PRS resource ID;
\( 3> \) deliver the SL-PRS transmission information to the Sidelink process;
3> instruct the associated Sidelink process to trigger a retransmission as defined in 5.22.1.3.5.
NOTE 2: For configured sidelink grant, the Sidelink process for retransmission is identified by the SL-PRS Process ID as specified in clause 5.22.1.3.1.
5.22.1.3.5 Sidelink process associated with Dedicated SL-PRS resource pool

If the Sidelink process is configured to perform transmissions of multiple SL-PRS with Sidelink resource allocation scheme 2 , the process maintains a counter SL_RESOURCE_RESELECTION_COUNTER. For other configurations of the Sidelink process, this counter is not available. For each SL-PRS new transmission or retransmission, the MAC entity shall:
\( 1> \) if there is no uplink transmission; or
\( 1> \) if there is uplink transmission and the sidelink transmission is prioritized over uplink transmission:
\( 2> \) instruct the physical layer to transmit SCI of the SL grant with the associated SL-PRS transmission information on Dedicated SL-PRS resource pool;
\( 2> \) instruct the physical layer to generate the SL-PRS on Dedicated SL-PRS resource pool.
\( 1> \) if this transmission corresponds to the last transmission of the SL-PRS transmission:
\( 2> \) decrement \( S L \) _RESOURCE_RESELECTION_COUNTER by 1 , if available.
The transmission of the SL-PRS is prioritized over uplink transmission(s) of the MAC entity or the other MAC entity if the following conditions are met:

1> if the MAC entity is not able to perform this sidelink transmission simultaneously with all uplink transmission(s) at the time of the transmission, and

ETSI


--- Page 176  ---


3GPP TS 38.321 version 18.2.0 Release 18
175
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) if \( u \)-PrioritizationThres is configured and if the value of the highest priority of logical channel(s) of all the NR uplink transmission(s) is not lower than \( u \)-PrioritizationThres, and
\( 1> \) if \( s \)-PrioritizationThres is configured and if the value of SL-PRS priority is lower than sl-PrioritizationThres.
5.22.1.4 Multiplexing and assembly
5.22.1.4.0 General

For PDU(s) associated with one SCI, MAC shall consider only logical channels with the same Source Layer-2 [DDestination Layer-2 [D pair for one of unicast, groupcast and broadcast which is associated with the pair. Multiple transmissions for different Sidelink processes are allowed to be independently performed in different PSSCH durations.

NOTE: Sidelink data for discovery and sidelink data for non-discovery transmitted by a UE cannot be multiplexed into the same TB because they are always associated with different destination L2 IDs (see TS 23.304 [26]).
5.22.1.4.1 Logical channel prioritization
5.22.1.4.1.1 General

The sidelink Logical Channel Prioritization procedure is applied whenever a new transmission is performed.
RRC controls the scheduling of sidelink data by signalling for each logical channel:
- sl-Priority where an increasing priority value indicates a lower priority level;
- sl-PrioritisedBitRate which sets the sidelink Prioritized Bit Rate (SPBR);
- sl-BucketSizeDuration which sets the sidelink Bucket Size Duration (sBSD).

RRC additionally controls the LCP procedure by configuring mapping restrictions for each logical channel:
- sl-configuredGrantTypelAllowed which sets whether a configured grant Type 1 can be used for sidelink transmission;
- sl-AllowedCG-List which sets the allowed configured grant(s) for sidelink transmission;
- sl-HARQ-FeedbackEnabled which sets whether the logical channel is allowed to be multiplexed with logical channel(s) with sl-HARQ-FeedbackEnabled set to enabled or disabled;
- sl-AllowedCarriers which sets the allowed sidelink carrier(s) for sidelink transmission.

The following UE variable is used for the Logical channel prioritization procedure:
- SBj which is maintained for each logical channel \( j \).

The MAC entity shall initialize SBj of the logical channel to zero when the logical channel is established.
For each logical channel \( j \), the MAC entity shall:
\( 1> \) increment \( S B j \) by the product sPBR \( \times T \) before every instance of the LCP procedure, where T is the time elapsed since SBJ was last incremented;
\( 1> \) if the value of \( S B j \) is greater than the sidelink bucket size (i.e. sPBR × sBSD):
\( 2> \) set \( S B j \) to the sidelink bucket size.
NOTE: The exact moment(s) when the UE updates SBj between LCP procedures is up to UE implementation, as long as SBj is up to date at the time when a grant is processed by LCP.
5.22.1.4.1.2 Selection of logical channels and SL-PRS

The MAC entity shall for each SCI corresponding to a new transmission:

ETSI


--- Page 177  ---


3GPP TS 38.321 version 18.2.0 Release 18
176
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) if sl-BWP-DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWPPoolConfigCommonA2X is configured according to TS 38.331 [5]; and
\( 1> \) if COT sharing information has not been received from lower layers as specified in TS 37.213[18]; and
\( 1> \) if the new transmission is not associated to a sidelink grant on Dedicated SL-PRS resource pool:
\( 2> \) if the new transmission is associated to a sidelink grant in sl-DiscTxPoolSelected or sl-DiscTxPoolScheduling configured in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon:

3> select a Destination associated with NR sidelink discovery as specified in TS 23.304 [26], that is in the SL Active time for the SL transmission occasion if SL DRX is applied for the destination, and among the logical channels that satisfy all the following conditions for the SL grant associated to the SCI:

4> SL data for NR sidelink discovery is available for transmission; and
\( 4>S B j>0 \), in case there is any logical channel having \( S B j>0 \); and
4> sl-configuredGrantTypelAllowed, if configured, is set to true in case the SL grant is a Configured Grant Type 1; and

4> sl-AllowedCG-List, if configured, includes the configured grant index associated to the SL grant.
\( 2> \) else if the new transmission is associated to a sidelink grant in \( s l \)-TxPoolSelectedNormal configured in \( s l \) -BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X:

3> select a Destination associated with BRID if sl-A2X-Service in sl-TxPoolSelectedNormal indicates brid or bridAndDAA or select a Destination associated with DAA if sl-A2X-Service in sl-TxPoolSelectedNormal indicates daa or bridAndDAA as specified in TS 23.256 [31], and the logical channel with the highest priority, among the logical channels that satisfy all the following conditions for the SL grant associated to the SCI:
\( 4> \) SL data for A2X communication is available for transmission; and
4> \( S B j>0 \), in case there is any logical channel having \( S B j>0 \).
\( 2> \) else:
3> select a Destination associated to one of unicast, groupcast and broadcast (excluding the Destination(s) associated with NR sidelink discovery as specified in TS 23.304 [26] or A2X communication), that is in the SL Active time for the SL transmission occasion if SL DRX is applied for the destination, and having at least one of the MAC CE and the logical channel and pending SL-PRS transmission(s) with the highest priority, among the logical channels that satisfy all the following conditions and MAC CE(s), if any, and SL-PRS(s), if any for the SL grant associated to the SCI:

4> SL data for NR sidelink communication is available for transmission; and
\( 4>S B j>0 \), in case there is any logical channel having \( S B j>0 \); and
4> sl-configuredGrantTypelAllowed, if configured, is set to true in case the SL grant is a Configured Grant Type 1; and

4> sl-AllowedCG-List, if configured, includes the configured grant index associated to the SL grant; and
4> sl-HARQ-FeedbackEnabled is set to disabled, if PSFCH is not configured for the SL grant associated to the SCI.

NOTE 0: A LCH is allowed in a carrier based on whether this selected carrier is within a subset of frequencies associated with all the PC5 QoS flows allowed to be mapped to this LCH based on RRC configuration.

1> else:
\( 2> \) if COT sharing information has been received from lower layers as specified in TS 37.213[18]:
3> if resources used for initial transmission for the SL grant associated to the SCI are within the COT duration and MAC entity decides to use shared COT with type-2 LBT:

ETSI


--- Page 178  ---


3GPP TS 38.321 version 18.2.0 Release 18
177
ETSI TS 138321 V18.2.0 (2024-08)

4> select a Destination associated to one of unicast, groupcast and broadcast that satisfy the following destination condition and CAPC condition, and having at least one of the MAC CE and the logical channel with the highest priority, among the logical channels that satisfy all the following conditions and the MAC CE(s) that satisfies CAPC and destination requirement, if any, for the SL grant associated to the SCI:
\( 5> \) if a Source Layer-1 [D and a Destination Layer-1 [D contained in the COT initiator's SCI or COT sharing information match to the 8 LSB of the corresponding Destination Layer-2 ID and the 16 LSB of a Source Layer-2 [Ds relating to the transmission from the responding UE and the cast type indicator in the SCI is set to unicast; or if a Destination Layer-1 ID contained in the COT initiator's SCI or COT sharing information matches to the 16 LSB of a Destination Layer-2 ID relating to the transmission from the responding UE and the cast type indicator in the SCI is set to groupcast or broadcast; and
\( 5> \) if a CAPC value of the SL data has an equal or smaller CAPC value than a CAPC value indicated in the COT sharing information; and

5> SL data is available for transmission; and
\( 5>S B j>0 \), in case there is any logical channel having \( S B j>0 \); and
\( 5>s \)-configuredGrantTypelAllowed, if configured, is set to true in case the SL grant is a Configured Grant Type 1; and

5> sl-AllowedCG-List, if configured, includes the configured grant index associated to the SL grant; and
\( 5> \) sl-HARQ-FeedbackEnabled is set to disabled, if PSFCH is not configured for the SL grant associated to the SCI.

2 else if sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon is not configured according to TS 38.331 [5]; and
\( 2> \) if the new transmission is not associated to a sidelink grant on Dedicated SL-PRS resource pool:
3> select a Destination associated to one of unicast, groupcast and broadcast, that is in the SL Active time for the SL transmission occasion if SL DRX is applied for the destination, and having at least one of the MAC CE and the logical channel and pending SL-PRS transmission(s) with the highest priority, among the logical channels that satisfy all the following conditions and MAC CE(s), if any, and SL-PRS(s), if any, for the SL grant associated to the SCI:

4> SL data is available for transmission; and
\( 4>S B j>0 \), in case there is any logical channel having \( S B j>0 \); and
4> sl-configuredGrantTypelAllowed, if configured, is set to true in case the SL grant is a Configured Grant Type 1; and

4> sl-AllowedCG-List, if configured, includes the configured grant index associated to the SL grant; and
4> sl-HARQ-FeedbackEnabled is set to disabled, if PSFCH is not configured for the SL grant associated to the SCI; and

4> allowed on the carrier where the SCI is transmitted, if the carrier is configured by upper layers according to TS 38.331 [5] and TS 23.287 [19], if multiple carrier frequencies are configured and if the MAC entity has been configured with Sidelink resource allocation mode 2; and
\( 4> \) having a priority whose associated \( s \)-threshCBR-FreqReselection is no lower than the CBR of the carrier when the carrier is (re-)selected in accordance with clause 5.22.1.11, if multiple carrier frequencies are configured and if the MAC entity has been configured with Sidelink resource allocation mode 2.

NOTE 1: If multiple Destinations have the logical channels satisfying all conditions above with the same highest priority or if multiple Destinations have either the MAC CE and/or the logical channels satisfying all conditions above with the same priority as the MAC CE, which Destination is selected among them is up to UE implementation.

ETSI


--- Page 179  ---


3GPP TS 38.321 version 18.2.0 Release 18
178
ETSI TS 138321 V18.2.0 (2024-08)

\( 1> \) else: (i.e., the sidelink grant is associated with Dedicated SL-PRS resource pool)
\( 2> \) select a Destination corresponding to the cast type of the SL grant and having pending SL-PRS transmission(s) with the highest priority for the SL grant associated to the SCI.
\( 1> \) select the logical channels satisfying all the following conditions among the logical channels belonging to the selected Destination when the new transmission is not associated to a sidelink grant on Dedicated SL-PRS resource pool:
\( 2> \) SL data is available for transmission; and
\( 2>s \)-configuredGrantTypelAllowed, if configured, is set to true in case the SL grant is a Configured Grant Type 1; and.
\( 2>s \)-AllowedCG-List, if configured, includes the configured grant index associated to the SL grant; and
\( 2> \) allowed on the carrier where the SCI is transmitted, if the carrier is configured by upper layers according to TS 38.331 [5] and TS 23.287 [19], if multiple carrier frequencies are configured and if the MAC entity has been configured with Sidelink resource allocation mode 2; and
\( 2> \) having a priority whose associated \( s l \)-threshCBR-FreqReselection is no lower than the CBR of the carrier when the carrier is (re-)selected in accordance with clause 5.22.1.11, if multiple carrier frequencies are configured if the MAC entity has been configured with Sidelink resource allocation mode 2; and
\( 2> \) CAPC value of the SL data has an equal or smaller CAPC value than a CAPC value indicated in the COT sharing information if MAC decides to use the shared COT; and
\( 2>s \) l-HARQ-FeedbackEnabled is set to the value that satisfies the following conditions:
3> if PSFCH is configured for the sidelink grant associated to the SCI and the UE is capable of PSFCH reception:
\( 4>s l \)-HARQ-FeedbackEnabled is set to enabled, if sl-HARQ-FeedbackEnabled is set to enabled for the highest priority logical channel satisfying the above conditions; or

4> sl-HARQ-FeedbackEnabled is set to disabled, if sl-HARQ-FeedbackEnabled is set to disabled for the highest priority logical channel satisfying the above conditions.

3> else:
4> sl-HARQ-FeedbackEnabled is set to disabled.
NOTE 2: HARQ feedback enabled/disabled indicator is set to disabled for the transmission of a MAC PDU only carrying CSI reporting MAC CE or Sidelink DRX Command MAC CE or Sidelink Inter-UE Coordination Request MAC CE or Sidelink Inter-UE Coordination Information MAC CE.
5.22.1.4.1.3 Allocation of sidelink resources

The MAC entity shall for each sidelink grant associated with Shared SL-PRS resource pool:
1> if there is SL-PRS pending for transmission for the selected destination:
\( 2> \) derive Transport Block Size for a new transmission for SL-SCH assuming SL-PRS can be transmitted in the sidelink grant according to clause 8.1.3.2 in TS 38.214 [7];

2 if all the SL-SCH data within logical channel with higher priority than that of the SL-PRS can be allocated with resources:
\( 3> \) determine that the pending SL-PRS can be transmitted in the sidelink grant.
\( 2> \) else:
\( 3> \) determine that the pending SL-PRRS cannot be transmitted in the sidelink grant;
3> derive the Transport Block Size for a new transmission for SL-SCH with no SL-PRS according to clause 8.1.3.2 in TS 38.214 [7].

ETSI


--- Page 180  ---


3GPP TS 38.321 version 18.2.0 Release 18
179
ETSI TS 138321 V18.2.0 (2024-08)

The MAC entity shall for each SCI corresponding to a new transmission for SL-SCH:
1> allocate resources to the logical channels as follows:
\( 2> \) logical channels selected in clause 5.22.1.4.1.2 for the SL grant with SBJ \( >0 \) are allocated resources in a decreasing priority order. If the sPBR of a logical channel is set to minity, the MAC entity shall allocate resources for all the data that is available for transmission on the logical channel before meeting the sPBR of the lower priority logical channel(s);
\( 2> \) decrement SBj by the total size of MAC SDUs served to logical channel \( j \) above;
\( 2> \) if any resources remain, all the logical channels selected in clause 5.22.1.4.1.2 are served in a strict decreasing priority order (regardless of the value of SBJ) until either the data for that logical channel or the SL grant is exhausted, whichever comes first. Logical channels configured with equal priority should be served equally.

NOTE 1: The value of SBJ can be negative.
The UE shall also follow the rules below during the SL scheduling procedures above:
- the UE should not segment an RLC SDU (or partially transmitted SDU or retransmitted RLC PDU) if the whole SDU (or partially transmitted SDU or retransmitted RLC PDU) fits into the remaining resources of the associated MAC entity;
- if the UE segments an RLC SDU from the logical channel, it shall maximize the size of the segment to fill the grant of the associated MAC entity as much as possible;
- the UE should maximise the transmission of data;
- if the MAC entity is given a sidelink grant size that is equal to or larger than 12 bytes while having data available and allowed (according to clause 5.22.1.4.1) for transmission, the MAC entity shall not transmit only padding;
- A logical channel configured with sl-HARQ-FeedbackEnabled set to enabled and a logical channel configured with sl-HARQ-FeedbackEnabled set to disabled cannot be multiplexed into the same MAC PDU.

The MAC entity shall not generate a MAC PDU for the HARQ entity if the following conditions are satisfied:
- there is no Sidelink CSI Reporting MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.7; and
- there is no Sidelink DRX Command MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.8; and
- there is no Sidelink Inter-UE Coordination Request MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.9; and
- there is no Sidelink Inter-UE Coordination Information MAC CE generated for this PSSCH transmission as specified in clause 5.22.1.10; and
- the MAC PDU includes zero MAC SDUs and the MAC PDU is not associated with SL-PRS transmission on Shared SL-PRS resource pool.

Logical channels shall be prioritised in accordance with the following order (highest priority listed first):
- data from SCCH;
- Sidelink CSI Reporting MAC CE;
- Sidelink Inter-UE Coordination Request MAC CE and Sidelink Inter-UE Coordination Information MAC CE;
- Sidelink DRX Command MAC CE;
- data from any STCH or SL-PRS.

NOTE 2: The priority order between Sidelink Inter-UE Coordination Request MAC CE and Sidelink Inter-UE Coordination Information MAC CE is up to UE implementation.

ETSI


--- Page 181  ---


3GPP TS 38.321 version 18.2.0 Release 18
180
ETSI TS 138321 V18.2.0 (2024-08)
5.22.1.4.2 Multiplexing of MAC Control Elements and MAC SDUs

The MAC entity shall multiplex MAC CEs and MAC SDUs in a MAC PDU according to clauses 5.22.1.4.1 and 6.1.6.
5.22.1.5 Scheduling Request

In addition to clause 5.4.4, the Scheduling Request (SR) is also used for requesting SL-SCH resources for new transmission when triggered by the Sidelink BSR (clause 5.22.1.6) or the SL-CSI reporting (clause 5.22.1.7) or SLDRX Command indication. The Scheduling Request (SR) is also used for requesting SL-PRS resources for new transmission when triggered by SL-PRS resource request (clause 6.1.3.74). If configured, the MAC entity performs the SR procedure as specified in this clause unless otherwise specified in clause 5.4.4. For a sidelink logical channel or for SL-CSI reporting or for SL-DRX Command indication or for Sidelink consistent LBT failure recovery or for SL-PRS Resource Request, at most one PUCCH resource for SR is configured per UL BWP.

The SR configuration of the logical channel that triggered the Sidelink BSR (clause 5.22.1.6) is also considered as corresponding SR configuration for the triggered SR (clause 5.4.4). The value of the priority of the triggered SR corresponds to the value of priority of the logical channel that triggered the SR.

Each sidelink logical channel and Sidelink consistent LBT failure recovery may be mapped to zero or one SR configuration, which is configured by RRC. If the SL-CSI reporting procedure is enabled by RRC, the SL-CSI reporting is mapped to one SR configuration for all PC5-RRC connections. The SR configuration of the SL-CSI reporting triggered according to 5.22.1.7 is considered as corresponding SR configuration for the triggered SR (clause 5.4.4). The value of the priority of the triggered SR triggered by SL-CSI reporting corresponds to the value of the priority of the Sidelink CSI Reporting MAC CE. The SR configuration of the SL-CSI reporting is considered as corresponding SR configuration for the triggered SR of SL-DRX Command indication triggered according to 5.28.3. The value of the priority of the triggered SR triggered by SL-DRX Command indication corresponds to the value of the priority of the Sidelink DRX Command MAC CE. The SR configuration of the Sidelink consistent LBT failure recovery triggered according to 5.31.2 is considered as corresponding SR configuration for the triggered SR (clause 5.4.4). The value of the priority of the triggered SR triggered by Sidelink consistent LBT failure recovery corresponds to the value of the priority of the SL LBT failure MAC CE. SL-PRS resource request may be mapped to zero or one SR configuration, which is configured by RRC. The value of the priority of the triggered SR triggered by SL-PRS resource request corresponds to the value of the priority of the SL-PRS triggering the SL-PRS Resource Request MAC CE.

All pending SR(s) triggered according to the Sidelink BSR procedure (clause 5.22.1.6) prior to the MAC PDU assembly shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the MAC PDU is transmitted and this PDU includes an SL-BSR MAC CE which contains buffer status up to (and including) the last event that triggered a Sidelink BSR (see clause 5.22.1.4) prior to the MAC PDU assembly.

All pending SR(s) triggered according to the Sidelink consistent LBT failure recovery (clause 5.31.2) shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the MAC PDU is transmitted and this PDU includes an SL LBT failure MAC CE that indicates Sidelink consistent LBT failure or when all the triggered Sidelink consistent LBT failure(s) for an SL BWP is cancelled.

All pending SR(s) triggered according to the Sidelink BSR procedure (clause 5.22.1.6) shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the SL grant(s) can accommodate all pending data available for transmission in sidelink.

If there is pending SR triggered by Sidelink consistent LBT failure recovery which has no corresponding SR configuration, MAC entity initiate a Random Access procedure (see clause 5.1) on the Serving Cell and cancel the pending SR.

The pending SR triggered according to the SL-CSI reporting for a destination shall be cancelled and each respective \( s r \) ProhibitTimer shall be stopped when the SL grant(s) can accommodate the Sidelink CSI Reporting MAC CE when the SL-CSI reporting that has been triggered but not cancelled or when the triggered SL-CSI reporting is cancelled due to latency non-fulfilment as specified in 5.22.1.7. The pending SR triggered according to the SL-DRX Command indication for a destination shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the SL grant(s) can accommodate the Sidelink DRX Command MAC CE when the SL-DRX Command indication that has been triggered but not cancelled. All pending SR(s) triggered by either Sidelink BSR or Sidelink CSI report or Sidelink DRX Command indication shall be cancelled, when RRC configures Sidelink resource allocation mode 2.

All pending SR(s) triggered according to the SL-PRS Resource Request procedure (clause 5.22.1.12) prior to the MAC PDU assembly shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the MAC PDU is transmitted and this PDU includes an SL-PRS Resource Request MAC CE which contains status of the pending SL-

ETSI


--- Page 182  ---


3GPP TS 38.321 version 18.2.0 Release 18
181
ETSI TS 138321 V18.2.0 (2024-08)

PRS transmission(s) up to (and including) the last event that triggered a SL-PRS Resource Request (see clause 5.22.1.12) prior to the MAC PDU assembly.

All pending SR(s) triggered according to the SL-PRS Resource Request procedure (clause 5.22.1.12) shall be cancelled and each respective sr-ProhibitTimer shall be stopped when the SL grant(s) can accommodate the all the pending SLPRS transmission(s).
5.22.1.6 Buffer Status Reporting

The Sidelink Buffer Status reporting (SL-BSR) procedure is used to provide the serving gNB with information about SL data volume in the MAC entity.

RRC configures the following parameters to control the SL-BSR:
- sl-periodicBSR-Timer, configured by periodicBSR-Timer in sl-BSR-Config;
- \( s l \)-retxBSR-Timer, configured by retxBSR-Timer in sl-BSR-Config;
- sl-logicalChannelSR-DelayTimerApplied;
- sl-logicalChannelSR-DelayTimer, configured by logicalChannelSR-DelayTimer in sl-BSR-Config;
- sl-logicalChannelGroup.

Each logical channel which belongs to a Destination is allocated to an LCG as specified in TS 38.331 [5]. The maximum number of LCGs is eight.

The MAC entity determines the amount of SL data available for a logical channel according to the data volume calculation procedure in TSs 38.322 [3] and 38.323 [4].

An SL-BSR shall be triggered if any of the following events occur:
\( 1> \) if the MAC entity has been configured with Sidelink resource allocation mode 1:
\( 2> \) SL data, for a logical channel which belongs to an LCG of a Destination, becomes available to the MAC entity; and either
\( 3> \) this SL data belongs to a logical channel with higher priority than the priorities of the logical channels containing available SL data which belong to any LCG belonging to the same Destination; or

3> none of the logical channels which belong to an LCG belonging to the same Destination contains any available SL data.
in which case the SL-BSR is referred below to as 'Regular SL-BSR';
\( 2> \) UL resources are allocated and number of padding bits remaining after a Padding BSR has been triggered is equal to or larger than the size of the SL-BSR MAC CE plus its subheader, in which case the SL-BSR is referred below to as 'Padding SL-BSR';
\( 2>s \) /-retxBSR-Timer expires, and at least one of the logical channels which belong to an LCG contains SL data, in which case the SL-BSR is referred below to as 'Regular SL-BSR';
\( 2>s \)-periodicBSR-Timer expires, in which case the SL-BSR is referred below to as 'Periodic SL-BSR'.
\( 1> \) else:
\( 2> \) Sidelink resource allocation mode 1 is configured by RRC and SL data is available for transmission in the RLC entity or in the PDCP entity, in which case the Sidelink BSR is referred below to as 'Regular SL-BSR'.

For Regular SL-BSR, the MAC entity shall:
\( 1> \) if the SL-BSR is triggered for a logical channel for which \( s \)-logicalChannelSR-DelayTimerApplied with value true is configured by RRC:
\( 2> \) start or restart the sl-logicalChannelSR-DelayTimer.
1> else:

ETSI


--- Page 183  ---


3GPP TS 38.321 version 18.2.0 Release 18
182
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if running, stop the sl-logicalChannelSR-DelayTimer.
For Regular and Periodic SL-BSR, the MAC entity shall:
\( 1> \) if \( s \)-PrioritizationThres is configured and the value of the highest priority of the logical channels that belong to any LCG and contain SL data for any Destination is lower than sl-PrioritizationThres; and
\( 1> \) if \( u \)-PrioritizationThres is configured and the value of the highest priority of the logical channels that belong to any LCG and contain UL data is equal to or higher than \( u \)-PrioritizationThres according to clause 5.4.5:

2> prioritize the LCG(s) for the Destination(s).
\( 1> \) if the Buffer Status reporting procedure determines that at least one BSR has been triggered and not cancelled according to clause 5.4.5 and the UL grant cannot accommodate an SL-BSR MAC CE containing buffer status only for all prioritized LCGs having data available for transmission plus the subheader of the SL-BSR according to clause 5.4.3.1.3, in case the SL-BSR is considered as not prioritized:
\( 2> \) prioritize the SL-BSR for logical channel prioritization specified in clause 5.4.3.1;
\( 2> \) report Truncated SL-BSR containing buffer status for as many prioritized LCGs having data available for transmission as possible, taking the number of bits in the UL grant into consideration.

1> else if the number of bits in the UL grant is expected to be equal to or larger than the size of an SL-BSR containing buffer status for all LCGs having data available for transmission plus the subheader of the SL-BSR according to clause 5.4.3.1.3:
\( 2> \) report SL-BSR containing buffer status for all LCGs having data available for transmission.
1> else:
\( 2> \) report Truncated SL-BSR containing buffer status for as many LCGs having data available for transmission as possible, taking the number of bits in the UL grant into consideration.

For Padding SL-BSR:
\( 1> \) if the number of padding bits remaining after a Padding BSR has been triggered is equal to or larger than the size of an SL-BSR containing buffer status for all LCGs having data available for transmission plus its subheader:
\( 2> \) report SL-BSR containing buffer status for all LCGs having data available for transmission;
1> else:
\( 2> \) report Truncated SL-BSR containing buffer status for as many LCGs having data available for transmission as possible, taking the number of bits in the UL grant into consideration.

For SL-BSR triggered by sl-retxBSR-Timer expiry, the MAC entity considers that the logical channel that triggered the SL-BSR is the highest priority logical channel that has data available for transmission at the time the SL-BSR is triggered.

The MAC entity shall:
1> if the sidelink Buffer Status reporting procedure determines that at least one SL-BSR has been triggered and not cancelled:
\( 2> \) if UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the SL-BSR MAC CE plus its subheader as a result of logical channel prioritization according to clause 5.4.3.1:
\( 3> \) instruct the Multiplexing and Assembly procedure in clause 5.4 .3 to generate the SL-BSR MAC CE(s);
\( 3> \) start or restart sl-periodicBSR-Timer except when all the generated SL-BSRs are Truncated SL-BSRs;
3> start or restart sl-retxBSR-Timer.
\( 2> \) if a Regular SL-BSR has been triggered and sl-logicalChannelSR-DelayTimer is not running:
\( 3> \) if there is no UL-SCH resource available for a new transmission; or

ETSI


--- Page 184  ---


3GPP TS 38.321 version 18.2.0 Release 18
183
ETSI TS 138321 V18.2.0 (2024-08)

\( 3> \) if UL-SCH resources are available for a new transmission and the UL-SCH resources cannot accommodate the SL-BSR MAC CE plus its subheader as a result of logical channel prioritization according to clause 5.4.3.1; or

3> if the set of Subcarrier Spacing index values in sl-AllowedSCS-List, if configured for the logical channel that triggered the SL-BSR, does not include the Subcarrier Spacing index associated to the UL-SCH resources available for a new transmission; or

3> if sl-MaxPUSCH-Duration, if configured for the logical channel that triggered the SL-BSR, is smaller than the PUSCH transmission duration associated to the UL-SCH resources available for a new transmission:

4> trigger a Scheduling Request.
NOTE 1: UL-SCH resources are considered available if the MAC entity has been configured with, receives, or determines an uplink grant. If the MAC entity has determined at a given point in time that UL-SCH resources are available, this need not imply that UL-SCH resources are available for use at that point in time.

A MAC PDU shall contain at most one SL-BSR MAC CE, even when multiple events have triggered an SL-BSR. The Regular SL-BSR and the Periodic SL-BSR shall have precedence over the padding SL-BSR.

The MAC entity shall restart sl-retxBSR-Timer upon reception of an SL grant for transmission of new data on any SLSCH.

All triggered SL-BSRs may be cancelled when the SL grant(s) can accommodate all pending data available for transmission. All BSRs triggered prior to MAC PDU assembly shall be cancelled when a MAC PDU is transmitted and this PDU includes an SL-BSR MAC CE which contains buffer status up to (and including) the last event that triggered an SL-BSR prior to the MAC PDU assembly. All triggered SL-BSRs shall be cancelled, and \( s l \)-retx-BSR-Timer and \( s l \) -periodic-BSR-Timer shall be stopped, when RRC configures Sidelink resource allocation mode 2.

NOTE 2: MAC PDU assembly can happen at any point in time between uplink grant reception and actual transmission of the corresponding MAC PDU. SL-BSR and SR can be triggered after the assembly of a MAC PDU which contains an SL-BSR MAC CE, but before the transmission of this MAC PDU. In addition, SL-BSR and SR can be triggered during MAC PDU assembly.
5.22.1.7 CSI Reporting

The Sidelink Channel State Information (SL-CSI) reporting procedure is used to provide a peer UE with sidelink channel state information per carrier as specified in clause 8.5 of TS 38.214 [7].

RRC configures the following parameters to control the SL-CSI reporting procedure:
- sl-LatencyBoundCSI-Report, which is maintained for each PC5-RRC connection.

The MAC entity maintains an sl-CSI-ReportTimer for each carrier of a pair of the Source Layer-2 ID and the Destination Layer-2 ID corresponding to a PC5-RRC connection. sl-CSI-ReportTimer is used for an SL-CSI reporting UE to follow the latency requirement signalled from a CSI triggering UE. The value of sl-CSI-ReportTimer is the same as the latency requirement of the SL-CSI reporting in sl-LatencyBoundCSI-Report configured by RRC.

The Sidelink CSI Reporting MAC CE can only be transmitted on the carrier where the SL-CSI request is received.
The MAC entity shall for each carrier of a pair of the Source Layer-2 ID and the Destination Layer-2 ID corresponding to a PC5-RRC connection which has been established by upper layers:

1> if the SL-CSI reporting has been triggered for a carrier by an SCI and not cancelled:
\( 2> \) if the \( s \) /-CSI-ReportTimer for the triggered SL-CSI reporting is not running:
\( 3> \) start the \( s \) l-CSI-ReportTimer for the carrier.
\( 2> \) if the \( s l \)-CSI-ReportTimer for the triggered SL-CSI reporting expires:
\( 3> \) cancel the triggered SL-CSI reporting for the carrier.

ETSI


--- Page 185  ---


3GPP TS 38.321 version 18.2.0 Release 18
184
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) else if the MAC entity has SL resources allocated for new transmission on the carrier where the corresponding SL-CSI request is received and the SL-SCH resources can accommodate the SL-CSI reporting MAC CE and its subheader as a result of logical channel prioritization:

3> instruct the Multiplexing and Assembly procedure to generate a Sidelink CSI Reporting MAC CE as defined in clause 6.1_3.35;
\( 3> \) stop the sl-CSI-ReportTimer for the triggered SL-CSI reporting of the carrier;
3> cancel the triggered SL-CSI reporting of the carrier.
\( 2> \) else if the MAC entity has been configured with Sidelink resource allocation mode 1:
3> trigger a Scheduling Request.
NOTE 1: The MAC entity configured with Sidelink resource allocation mode 1 may trigger a Scheduling Request if transmission of a pending SL-CSI reporting with the sidelink grant(s) cannot fulfil the latency requirement associated to the SL-CSI reporting.

NOTE 2: Void.
5.22.1.8 Void
5.22.1.9 IUC-Request transmission

The Sidelink Inter-UE Coordination Request transmission procedure is used to trigger a peer UE to transmit Sidelink Inter-UE Coordination Information.

RRC configures sl-TransmissionStructureForPSCCHandPSSCH parameter to control the inter-UE coordination request procedure. For a resource pool in a SL BWP where \( s l \)-TransmissionStructureForPSCCHandPSSCH is configured as interlaceRB, the Enhanced Inter-UE coordination Request MAC CE is used. Otherwise, the Inter-UE coordination Request MAC CE is used.
5.22.1.10 IUC-Information Reporting
5.22.1.10.1 General

The Sidelink Inter-UE Coordination Information reporting procedure is used to provide a peer UE with inter-UE coordination information as specified in clause 8.1 .4 of TS 38.214 [7]. The Sidelink [nter-UE Coordination Information reporting procedure can be triggered by Sidelink Inter-UE Coordination Request MAC CE or condition (See TS 38.331 [5] and TS 38.214 [7]). Unicast for preferred resource set and non-preferred resource set and Groupcast/Broadcast for non-preferred resource set are supported for inter-UE coordination information transmission triggered by a condition other than explicit request reception. Unicast for preferred resource set and non-preferred resource set is supported for inter-UE coordination information transmission triggered by an explicit request.

RRC also configures sl-TransmissionStructureForPSCCHandPSSCH parameter to control the inter-UE coordination Information reporting procedure. For a resource pool in a SL BWP where \( s \) -
TransmissionStructureForPSCCHandPSSCH is configured as interlaceRB, the Enhanced Inter-UE coordination Information MAC CE is used. Otherwise, the Inter-UE coordination Information MAC CE is used.

RRC configures the following parameter to control the SL-IUC Information reporting procedure:
- si-LatencyBoundIUC-Report, which is maintained for each PC5-RRC connection.

The MAC entity maintains an sl-IUC-ReportTimer for each pair of the Source Layer-2 ID and the Destination Layer-2 ID corresponding to a PC5-RRC connection. s/-IUC-ReportTimer is used for an SL-IUC Information reporting UE to follow the latency requirement signalled from an IUC-Information triggering UE. The value of sl-IUC-ReportTimer is the same as the latency requirement of the SL-IUC Information in sl-LatencyBoundIUC-Report configured by RRC.

The MAC entity shall for each pair of the Source Layer-2 ID and the Destination Layer-2 ID corresponding to a PC5RRC connection which has been established by upper layers:

ETSI


--- Page 186  ---


3GPP TS 38.321 version 18.2.0 Release 18
185
ETSI TS 138321 V18.2.0 (2024-08)

1> if the SL-IUC Information reporting has been triggered by an SL-IUC Request MAC CE (and/or an SCI) and not cancelled:
\( 2> \) if the sl-IUC-ReportTimer for the triggered SL-IUC Information reporting is not running:
\( 3> \) start the sl-IUC-ReportTimer.
\( 2> \) if the \( s \)-IUC-ReportTimer for the triggered SL-IUC Information reporting expires:
\( 3> \) cancel the triggered SL-IUC Information reporting.
\( 2> \) else if the MAC entity has SL resources allocated for new transmission and the SL-SCH resources can accommodate the SL-IUC Information MAC CE and its subheader as a result of logical channel prioritization:

3> instruct the Multiplexing and Assembly procedure to generate a Sidelink Inter-UE Coordination Information MAC CE as defined in clause 6.1.3.53;
\( 3> \) stop the sl-IUC-ReportTimer for the triggered SL-IUC Information reporting;
\( 3> \) cancel the triggered SL-IUC Information reporting.
5.22.1.10.2 Reception of IUC-Information Reporting

Upon the reception of SL-IUC Information MAC CE from another UE, the MAC entity shall:
1> if sl-InterUE-CoordinationSchemel enabling reception/transmission of preferred resource set and non-preferred resource set is configured by RRC:
\( 2> \) if the SL-IUC Information MAC CE contains a non-preferred resource set and if the UE is configured to use full sensing or partial sensing in the resource pool where the non-preferred resource set is located:
\( 3> \) indicate the received non-preferred resource set to physical layer.
5.22.1.11 TX carrier (re-)selection

The MAC entity shall consider a CBR of a carrier to be one measured by lower layers according to TS 38.215 [24] if CBR measurement results are available, or the corresponding si-DefaultTxConfigIndex configured by upper layers if CBR measurement results are not available.

If the TX carrier (re-)selection is triggered for a Sidelink process according to clause 5.22.1.1, 5.22.1.2 or 5.22.1.3.3, the MAC entity shall:

1> if there is no selected sidelink grant on any carrier allowed for the sidelink logical channel where data is available as indicated by upper layers (TS 38.331 [5] and TS 23.287 [19]):
\( 2> \) for each carrier configured by upper layers associated with the concerned sidelink logical channel:
\( 3> \) if the CBR of the carrier is below sl-threshCBR-FreqReselection associated with the priority of the sidelink logical channel:

NOTE 1: In the case of multiple resource pools configured on a carrier, which specific resource pool is used to determine the CBR of this carrier is up to UE implementation, taking into account of sl-HARQFeedbackEnabled for the sidelink logical channel.

4> consider the carrier as a candidate carrier for TX carrier (re-)selection for the concerned sidelink logical channel.

1> else:
\( 2> \) for each sidelink logical channel, if any, where data is available and that are allowed on the carrier for which Tx carrier (re-)selection is triggered according to clause 5.22.1.1, if the CBR of the carrier is below sl-threshCBR-FreqKeeping associated with priority of the sidelink logical channel, for each sidelink logical channel, if any, where data is available and that are allowed on the carrier for which Tx carrier (re-)selection is triggered according to clause 5.22.1.1:

ETSI


--- Page 187  ---


3GPP TS 38.321 version 18.2.0 Release 18
186
ETSI TS 138321 V18.2.0 (2024-08)

\( 3> \) select the carrier and the associated pool of resources.
\( 2> \) else:
\( 3> \) for each carrier configured by upper layers on which the sidelink logical channel is allowed, if the CBR of the carrier is below sl-threshCBR-FreqReselection associated with the priority of the sidelink logical channel:
\( 4> \) consider the carrier as a candidate carrier for TX carrier (re-)selection, for each carrier configured by upper layers on which the sidelink logical channel is allowed.

The MAC entity shall select a carrier on which the SL-CSI Request was received as a carrier for transmission of a Sidelink CSI Reporting MAC CE. The MAC entity shall for the Sidelink CSI Reporting MAC CE select any pool of resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig, sl-BWPDiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWP-PoolConfigCommonA2X, if configured or Dedicated SLPRS resource pool, if configured.

The MAC entity shall select a carrier on which a Sidelink Inter-UE Coordination Request was received as a carrier for transmission of a Sidelink Inter-UE Coordination Information MAC CE. The MAC entity shall for the Sidelink InterUE Coordination Information MAC CE select any pool of resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig, sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWPPoolConfigCommonA2 \( X \), if configured or Dedicated SL-PRS resource pool, if configured.

The MAC entity shall:
\( 1> \) if one or more carriers are considered as the candidate carriers for TX carrier (re-)selection:
\( 2> \) if Tx carrier (re-)selection is triggered, for each sidelink logical channel allowed on the carrier where data is available:
\( 3> \) select one or more carrier( \( s \) ) among the candidate carriers with increasing order of CBR from the lowest CBR, and select the associated pool(s) of resources:

4 if \( s \)-HARQ-FeedbackEnabled is set to enabled for the sidelink logical channel:
\( 5> \) select one pool of resources configured with PSFCH resources among the pools of resources except the pool(s) in sl-BWP-DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, sl-BWPPoolConfigA2X or sl-BWP-PoolConfigCommonA2X, if configured or Dedicated SL-PRS resource pool, if configured.

4> else:
\( 5> \) select any pool of resources among the pools of resources except the pool(s) in \( s l-B W P- \) DiscPoolConfig or sl-BWP-DiscPoolConfigCommon, sl-BWP-PoolConfigA2X or sl-BWPPoolConfigCommonA2X, if configured or Dedicated SL-PRS resource pool, if configured.

NOTE 2: It is left to UE implementation how many carriers to select based on UE capability.
NOTE 3: It is left to UE implementation to determine the sidelink logical channels among the sidelink logical channels where data is available and that are allowed on the carrier for which Tx carrier (re-) selection is triggered.

NOTE 4: It is left to UE implementation to determine whether the resource pool for CBR measurement is reused as the resource pool for SL grant creation.

NOTE 5: For the transmission of Sidelink Inter-UE Coordination Request MAC CE, the MAC entity selects the TX pool of resource where the IUC resource set is required. For the transmission of Sidelink Inter-UE Coordination Information MAC CE, the MAC entity selects the TX pool of resource where the IUC resource set is located.
5.22.1.12 SL-PRS Resource Request

SL-PRS transmission can be triggered either by lower layer signalling from the peer UE or the UE's own upper layers. The SL-PRS Resource Request procedure is used to provide gNB with information about the triggered SL-PRS transmission.

ETSI


--- Page 188  ---


3GPP TS 38.321 version 18.2.0 Release 18
187
ETSI TS 138321 V18.2.0 (2024-08)

The MAC entity shall, if Sidelink resource allocation scheme 1 for SL-PRS transmission is configured:
1> if aperiodic SL-PRS is triggered:
\( 2> \) trigger the SL-PRS Resource Request.
\( 1> \) else if periodic SL-PRS is triggered:
\( 2> \) notify RRC to send SL-PRS Resource Request.
The MAC entity shall:
1> if SL-PRS Resource Request is triggered and not cancelled:
2 if UL-SCH resources are available for a new transmission and these UL-SCH resources can accommodate the SL-PRS Resource Request MAC CE plus its subheader as a result of logical channel prioritization:

3> instruct the Multiplexing and Assembly entity to generate the SL-PRS Resource Request MAC CE.
\( 2> \) else:
3> trigger a Scheduling Request for the SL-PRS Resource Request MAC CE as specified in clause 5.4.4.
The SL-PRS Resource Request MAC CE may be cancelled when SL grant can accommodate all the pending SL-PRS transmissions. The SL-PRS Resource Request MAC CE shall be cancelled when a MAC PDU is transmitted and this PDU includes a SL-PRS Resource Request MAC CE that indicates request for all the pending SL-PRS transmission(s) since the last event the MAC CE is triggered.
5.22.2 SL-SCH Data and SL-PRS reception
5.22.2.1 SCI reception

SCI indicates if there is a transmission on SL-SCH and provide the relevant HARQ information. SCI can also indicate if there is a SL-PRS transmission. An SCI for SL-SCH transmission with or without corresponding SL-PRS on Shared SL-PRS resource pool consists of two parts: the \( 1^{\text {st }} \) stage SCI on PSCCH and the \( 2{ }^{\text {nd }} \) stage SCI on PSSCH as specified in clause 8.1 of TS 38.214 [7]. An SCI for SL-PRS transmission on Dedicated SL-PRS resource pool consists of a single part on PSCCH as specified in TS 38.212 [9].

The MAC entity shall:
1> for each PSCCH duration during which the MAC entity monitors PSCCH:
2 if a \( 1{ }^{\text {st }} \) stage SCI has been received on the PSCCH:
\( 3> \) determine the set of PSSCH durations in which reception of a \( 2^{\text {nd }} \) stage SCI and the transport block occur using the received part of the SCI;
\( 3> \) if the \( 2^{\text {nd }} \) stage SCI for this PSSCH duration has been received on the PSSCH:
4> store the SCI as a valid SCI for the PSSCH durations corresponding to transmission(s) of the transport block and SL-PRS, if available and the associated HARQ information and QoS information;
\( 2> \) else if an SCI has been received on the PSCCH reception on Dedicated SL-PRS resource pool for SL-PRS transmission:

3> determine the SL-PRS transmission occasion corresponding to the SCI;
3> store the SCI as a valid SCI for the SL-PRS transmission and the corresponding SL-PRS transmission information on Dedicated SL-PRS resource pool.

1> for each PSSCH duration for which the MAC entity has a valid SCI:
\( 2> \) deliver the SCI and the associated Sidelink transmission information to the Sidelink HARQ Entity.
\( 1> \) for each SL-PRS transmission occasion for which MAC entity has a valid SCI:

ETSI


--- Page 189  ---


3GPP TS 38.321 version 18.2.0 Release 18
188
ETSI TS 138321 V18.2.0 (2024-08)

2> perform SL-PRS reception according to the SL-PRS transmission information within the SCI as in clause 5.22.2.2.2 for SL-PRS received on Shared SL-PRS resource pool and as in clause 5.22.2.4 for SL-PRS received on Dedicated SL-PRS resource pool.
5.22.2.2 Sidelink HARQ operation and SL-PRS reception on Shared SL-PRS resource pool
5.22.2.2.1 Sidelink HARQ Entity

There is at most one Sidelink HARQ Entity at the MAC entity for reception of the SL-SCH, which maintains a number of parallel Sidelink processes.

Each Sidelink process is associated with SCI in which the MAC entity is interested. This interest is determined by the Sidelink identification information of the SCI. The Sidelink HARQ Entity directs Sidelink transmission information and associated TBs received on the SL-SCH to the corresponding Sidelink processes.

The number of Receiving Sidelink processes associated with the Sidelink HARQ Entity is defined in TS 38.306 [5].
For each PSSCH duration, the Sidelink HARQ Entity shall:
1> for each SCI valid for this PSSCH duration:
\( 2> \) if the NDI has been toggled compared to the value of the previous received transmission corresponding to the Sidelink identification information and the Sidelink process ID of the SCI or this is the very first received transmission for the pair of the Sidelink identification information and the Sidelink process ID of the SCI:

3> if there is a Sidelink process associated with the Sidelink identification information and the Sidelink process ID of the SCI:

4> consider the Sidelink process as unoccupied;
4> flush the soft buffer for the Sidelink process.
\( 3> \) allocate the TB received from the physical layer and the associated Sidelink identification information and Sidelink process ID to an unoccupied Sidelink process;

3> associate the Sidelink process with the Sidelink identification information and the Sidelink process ID of this SCI and consider this transmission to be a new transmission.

NOTE 1: When a new TB arrives, the Sidelink HARQ Entity allocates the TB to any unoccupied Sidelink process. If there is no unoccupied Sidelink process in the Sidelink HARQ entity, how to manage receiving Sidelink processes is up to UE implementation.

NOTE 1a: If the NDI has not been toggled compared to the value of the previous received transmission corresponding to the Sidelink identification information and the Sidelink process ID of the SCI, and if there is no Sidelink process associated with the Sidelink identification information and the Sidelink process ID of the SCI, it is up to UE implementation to handle the corresponding TB.

1> for each Sidelink process:
\( 2> \) if the NDI has not been toggled compared to the value of the previous received transmission corresponding to the Sidelink identification information and the Sidelink process ID of the SCI for the Sidelink process according to its associated SCI:

3> allocate the TB received from the physical layer to the Sidelink process and consider this transmission to be a retransmission.

NOTE 2: A single sidelink process can only be (re-)associated to a single combination of Sidelink identification information and Sidelink process ID at a time and a single combination of Sidelink identification information and Sidelink process ID can only be (re-)associated to a single sidelink process at a time.

ETSI


--- Page 190  ---


3GPP TS 38.321 version 18.2.0 Release 18
189
ETSI TS 138321 V18.2.0 (2024-08)
5.22.2.2.2 Sidelink process

For each PSSCH duration where a transmission takes place for the Sidelink process, one TB and the associated HARQ information is received from the Sidelink HARQ Entity.

For each received TB and SL-PRS, if available and associated Sidelink transmission information, the Sidelink process shall:

1> if this is a new transmission:
\( 2> \) attempt to decode the received data.
\( 1> \) else if this is a retransmission:
\( 2> \) if the data for this TB has not yet been successfully decoded:
3> instruct the physical layer to combine the received data with the data currently in the soft buffer for this TB and attempt to decode the combined data.
\( 1> \) if the sidelink transmission information in the SCI indicates SL-PRS transmission:
\( 2> \) if the SL-PRS transmission is associated to unicast:
3> if the DST field of the decoded MAC PDU subheader is equal to the 8 MSB of any of the Source Layer-2 ID(s) of the UE for which the 16 LSB are equal to the Destination ID in the corresponding SCI; and

3> if the SRC field of the decoded MAC PDU subheader is equal to the 16 MSB of any of the Destination Layer-2 ID(s) of the UE for which the 8 LSB are equal to the Source ID in the corresponding SCI:
\( 4> \) instruct the physical layer to perform SL-PRS reception.
\( 2> \) else if the SL-PRS tnramission is associated with groupcast or broadcast:
3> if the DST field of the decoded MAC PDU subheader is equal to the 8 MSB of any of the Destination Layer-2 ID(s) of the UE for which the 16 LSB are equal to the Destination ID in the corresponding SCI:
\( 4> \) instruct the physical layer to perform SL-PRS reception.
\( 1> \) if the data which the MAC entity attempted to decode was successfully decoded for this TB; or
\( 1> \) if the data for this TB was successfully decoded before:
\( 2> \) if this is the first successful decoding of the data for this TB:
3> if this TB is associated to unicast and the DST field of the decoded MAC PDU subheader is equal to the 8 MSB of any of the Source Layer-2 ID(s) of the UE for which the 16 LSB are equal to the Destination ID in the corresponding SCI:

4> if the SRC field of the decoded MAC PDU subheader is equal to the 16 MSB of any of the Destination Layer-2 ID(s) of the UE for which the 8 LSB are equal to the Source ID in the corresponding SCI; or

4> if this TB is corresponding to the logical channel with LCID equal to 0 or 1 and determined to be the first TB:
\( 5> \) deliver the decoded MAC PDU to the disassembly and demultiplexing entity.
3> if this TB is associated to groupcast or broadcast:
4> if the DST field of the decoded MAC PDU subheader is equal to the 8 MSB of any of the Destination Layer-2 ID(s) of the UE for which the 16 LSB are equal to the Destination ID in the corresponding SCI; or

4> if this TB is corresponding to the logical channel with LCID equal to 58 , and the DST field of the decoded MAC PDU subheader is equal to the 8 MSB of any of the Source Layer-2 ID(s) of the UE for which the 16 LSB are equal to the Destination ID in the corresponding SCI:

ETSI


--- Page 191  ---


3GPP TS 38.321 version 18.2.0 Release 18
190
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) deliver the decoded MAC PDU to the disassembly and demultiplexing entity.
NOTE: Whether the TB is the first TB can be determined based on the Source Layer-2 ID and Destination Layer2 ID pair.
\( 2> \) consider the Sidelink process as unoccupied.
\( 1> \) else:
\( 2> \) instruct the physical layer to replace the data in the soft buffer for this TB with the data which the MAC entity attempted to decode.
\( 1> \) if HARQ feedback is enabled by the SCI:
\( 2> \) if negative-only acknowledgement is indicated by the SCI according to clause 8.4.1 of TS 38.212 [9]:
\( 3> \) if UE's location information is available and distance beteween UE's location and the central location of the nearest zone that is calculated based on the Zone_id in the SCI and the value of sl-ZoneLength corresponding to the communication range requirement in the SCI as specified in TS 38.331 [5] is smaller or equal to the communication range requirement in the SCl; or
\( 3> \) if none of Zone_id and communication range requirement is indicated by the SCl; or
3> if UE's location information is not available:
\( 4> \) if the data which the MAC entity attempted to decode was not successfully decoded for this TB and the data for this TB was not successfully decoded before:
\( 5> \) instruct the physical layer to generate a negative acknowledgement of the data in this TB.
\( 2> \) if negative-positive acknowledgement or unicast is indicated by the SCI according to clause 8.4.1 of TS 38.212 [9]:

3> if the data which the MAC entity attempted to decode was successfully decoded for this TB or the data for this TB was successfully decoded before:
\( 4> \) instruct the physical layer to generate a positive acknowledgement of the data in this TB.
3> else:
4> instruct the physical layer to generate a negative acknowledgement of the data in this TB.
5.22.2.3 Disassembly and demultiplexing

The MAC entity shall disassemble and demultiplex a MAC PDU as defined in clause 6.1.6.
5.22.2.4 SL-PRS reception on Dedicated SL-PRS resource pool

For each SL-PRS transmission occasion on Dedicated SL-PRS resource pool, the MAC entity shall:
1> if this SL-PRS transmission is associated to unicast:
\( 2> \) if the destination ID in the corresponding SCI is equal to the UE's source ID; and if the field \( s / \)-SRC-ID-LenDedicatedSL-PRS-RP is configured with the value of 12bit:
\( 3> \) if source ID in the corresponding SCI is equal to the 12 LSB of the UE's destination layer-2 ID:
\( 4> \) instruct the physical layer to perform SL-PRS reception on the SL-PRS transmission occasion.
\( 2> \) else if the destination ID in the corresponding SCI is equal to the UE's source ID, and if the field \( s l-S R C-I D- \) LenDedicatedSL-PRS-RP is configured with the value of 24 bit:

3> if source ID in the corresponding SCI is equal to the UE's destination layer-2 ID:
\( 4> \) instruct the physical layer to perform SL-PRS reception on the SL-PRS transmission occasion.

ETSI


--- Page 192  ---


3GPP TS 38.321 version 18.2.0 Release 18
191
ETSI TS 138321 V18.2.0 (2024-08)

1> else if this SL-PRS transmission is associated to broadcast or groupcast:
\( 2> \) if the destination ID in the corresponding SCI is equal to the UE's destination layer-2 ID
3> instruct the physical layer to perform SL-PRS reception on the SL-PRS transmission occasion.
5.23 SL-BCH data transfer
5.23.1 SL-BCH data transmission

When instructed to send SL-BCH, the MAC entity shall:
\( 1> \) obtain the MAC PDU to transmit from SBCCH;
1> deliver the MAC PDU to the physical layer and instruct it to generate a transmission.
5.23.2 SL-BCH data reception

When the MAC entity needs to receive SL-BCH, the MAC entity shall:
\( 1> \) receive and attempt to decode the SL-BCH;
1> if a TB on the SL-BCH has been successfully decoded:
\( 2> \) deliver the decoded MAC PDU to upper layers.
5.24 Handling of PRS Processing Window

When PPW is activated and PRS has higher priority than DL channel and signals, for the affected symbols within the PPW according to clause 5.1.6.5 in TS 38.214 [7], the MAC entity shall:
\( 1> \) if the ra-ResponseWindow or the ra-ContentionResolutionTimer or the msgB-ResponseWindow is running:
\( 2> \) monitor the PDCCH as specified in clauses 5.1.4 and 5.1.5.
1> else:
\( 2> \) not receive DL-SCH;
\( 2> \) not receive PDCCH.
5.25 Positioning Measurement Gap Activation/Deactivation Request

If the UE is configured with pre-configured positioning measurement gap and the request of the activation/deactivation of the positioning measurement gap by UL MAC CE, the UE may request the network to activate or deactivate the Positioning measurement gap with UL MAC CE for Positioning Measurement Gap Activation/Deactivation Request in clause 6.1.3.40.

The MAC entity shall, when triggered by the upper layer to send Positioning Measurement Gap Activation/Deactivation Request, cancel the triggered Positioning Measurement Gap Activation/Deactivation Request, if any and trigger another Positioning Measurement Gap Activation/Deactivation Request according to the upper layer's request.

The MAC entity shall,
1>if Positioning Measurement Gap Activation/Deactivation Request MAC CE has been triggered, and not cancelled:
\( 2> \) if indication from upper layer has been received that the triggered Positioning Measurement Gap Activation/Deactivation Request MAC CE should be cancelled; or

ETSI


--- Page 193  ---


3GPP TS 38.321 version 18.2.0 Release 18
192
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) if the pre-configured measurement gap indicated in the Positioning Measurement Gap Activation/Deactivation Request MAC CE has already been activated/deactivated according to clause 5.18.20:

3> cancel the triggered Positioning Measurement Gap Activation/Deactivation Request MAC CE.
2 if UL-SCH resources are available for a new transmission and these UL-SCH resources can accommodate the Positioning Measurement Gap Activation/Deactivation Request MAC CE plus its subheader as a result of logical channel prioritization:

3> instruct the Multiplexing and Assembly procedure to generate the Positioning Measurement Gap Activation/Deactivation Request MAC CE according to the upper layer's request;
\( 3> \) cancel triggered Positioning Measurement Gap Activation/Deactivation Request MAC CE.
\( 2> \) else:
3> trigger a Scheduling Request for Positioning Measurement Gap Activation/Deactivation Request MAC CE as specified in clause 5.4.4.
5.26 Positioning SRS transmission in RRC_INACTIVE
5.26.1 General

Periodic and semi-persistent Positioning SRS with or without positioning SRS bandwidth aggregation can be configured for Positioning SRS transmission in RRC_INACTIVE.

SRS for positioning Tx frequency hopping as in clause 5.32 can also be configured for Positioning SRS transmission in RRC_INACTIVE.

The MAC entity shall,
\( 1> \) if the TA of the configured Positioning SRS is valid according to clause 5.26.2, and the conditions for positioning SRS transmission in clause 7.3.1 of TS 38.213 [6] and clause 6.2.1.4 of TS 38.214 [7] are satisfied:
\( 2> \) if the UE is configured with UTW and the UplinkTimeWindowTimer is running according to clause 5.32; or
\( 2> \) if the UE is not configured with UTW:
3> instruct to the lower layer according to TS 38.214 [7] to transmit Positioning Periodic SRS or SemiPersistent SRS that is activated according to clause 5.18.17.
5.26.2 TA validation for SRS transmission in RRC_INACTIVE

RRC configures the following parameters for validation for SRS transmission in RRC_INACTIVE:
- inactivePosSRS-RSRP-ChangeThreshold: RSRP threshold for the increase/decrease of RSRP for time alignment validation.

The MAC entity shall:
\( 1> \) if the UE receives configuration for SRS transmission in RRC_INACTIVE:
\( 2> \) store the RSRP of the downlink pathloss reference with the current RSRP value of the downlink pathloss reference as in TS 38.331 [5].

1> else if the UE is configured with SRS transmission in RRC_INACTIVE:
\( 2> \) if Timing Advance Command MAC CE is received as in clause 5.2, or;
\( 2> \) if Timing Advance Command or Absolute Timing Advance Command is received for Random Access procedure that is successfully completed:

ETSI


--- Page 194  ---


3GPP TS 38.321 version 18.2.0 Release 18
193
ETSI TS 138321 V18.2.0 (2024-08)

3> update the stored the RSRP of the downlink pathloss reference with the current RSRP value of the downlink pathloss reference.
\( 2> \) if the UE is configured with SRS with validity area and the upper layer indicates the MAC to update the stored RSRP:

3> update the RSRP of the downlink pathloss reference with the current RSRP value of the downlink pathloss reference of the camped cell as specified in TS 38.331 [5].

The MAC entity shall consider the TA to be valid when the following conditions are fulfilled:
\( 1> \) compared to the stored downlink pathloss reference RSRP value, the current RSRP value of the downlink pathloss reference of the camped cell as specified in TS 38.331 [5] has not increased/decreased by more than inactivePosSRS-RSRP-ChangeThreshold, if configured; and
\( 1> \) inactivePosSRS-TimeAlignmentTimer is running or inactivePosSRS-ValidityAreaTAT is running when positioning validity area is configured.
5.27 Small Data Transmission
5.27.1 General

The MAC entity may be configured by RRC with SDT and the SDT procedure may be initiated by RRC layer for MOSDT or MT-SDT. The SDT procedure initiated for MO-SDT can be performed either by Random Access procedure with 2-step RA type or 4-step RA type (i.e., RA-SDT) or by configured grant Type 1 (i.e., CG-SDT). The SDT procedure initiated for MT-SDT can be performed either by Random Access procedure with 2-step RA type or 4-step RA type (i.e., RA-SDT is not applicable as specified in clause 5.1 lb) or by configured grant Type 1 (i.e., CG-SDT).

RRC configures the following parameters for SDT procedure:
- sdt-DataVolumeThreshold: data volume threshold for the UE to determine whether to perform SDT procedure initiated for MO-SDT;
- sdt-RSRP-Threshold: RSRP threshold for UE to determine whether to perform SDT procedure initiated for MOSDT;
- mt-SDT-RSRP-Threshold: RSRP threshold for UE to determine whether to perform SDT procedure initiated for MT-SDT;
- cg-SDT-RSRP-ThresholdSSB: an RSRP threshold configured for SSB selection for CG-SDT;
- cg-MT-SDT-MaxDurationToNextCG-Occasion: time threshold which is used by the UE to determine whether to perform CG-SDT for MT-SDT;
- cg-SDT-MaxDurationToNextCG-Occasion: time threshold configured per logical channel which is used by the UE to determine whether to perform CG-SDT for MO-SDT;
- sdt-BeamFailureRecoveryProhibitTimer: prohibit timer to avoid frequent triggering of Random Access procedure due to beam failure recovery during RA-SDT procedure or during MT-SDT procedure initiated by Random Access procedure.

The following UE variable is used for the SDT procedure:
- MAX_DURATION_TO_NEXT_CG_OCCASION;
- RSRP_THRESHOLD.

The MAC entity shall, if initiated by the upper layers for SDT procedure:
1> if SDT procedure is initiated for MO-SDT as specified in TS 38.331 [5]:
2> set the MAX_DURATION_TO_NEXT_CG_OCCASION to the shortest value of cg-SDT-
MaxDurationToNextCG-Occasion, if configured, among all the logical channels configured with this parameter by upper layer and having data for transmission;

ETSI


--- Page 195  ---


3GPP TS 38.321 version 18.2.0 Release 18
194
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) set the RSRP_THRESHOLD to the value of sdt-RSRP-Threshold, if configured.
1> else if SDT procedure is initiated for MT-SDT as specified in TS 38.331 [5]:
\( 2> \) set the MAX_DURATION_TO_NEXT_CG_OCCASION to the value of cg-MT-SDT-MaxDurationToNextCGOccasion, if configured;
\( 2> \) if \( m t-S D T-R S R P \)-Threshold is configured:
\( 3> \) set the RSRP_THRESHOLD to the value of mt-SDT-RSRP-Threshold.
\( 2> \) else if sdt-RSRP-Threshold is configured:
\( 3> \) set the RSRP_THRESHOLD to the value of sdt-RSRP-Threshold.
1> if the SDT procedure is initiated for MO-SDT as specified in TS 38.331 [5], and the data volume of the pending UL data across all RBs configured for SDT is less than or equal to sdt-DataVolumeThreshold, or if the SDT procedure is initiated for MT-SDT as specified in TS 38.331 [5]; and

NOTE 1: For SDT procedure, the MAC entity also considers the suspended RBs configured with SDT for data volume calculation. It is up to the UE's implementation how the UE calculates the data volume for the suspended RBs. Size of the CCCH message is not considered for data volume calculation
\( 1> \) if the RSRP of the downlink pathloss reference is higher than RSRP_THRESHOLD or if RSRP_THRESHOLD is not set:
\( 2> \) if the Serving Cell is configured with supplementary uplink as specified in TS 38.331 [5]; and
\( 2> \) if the RSRP of the downlink pathloss reference is less than rsrp-ThresholdSSB-SUL:
3> select the SUL carrier.
\( 2> \) else:
\( 3> \) select the NUL carrier.
\( 2> \) if CG-SDT is configured on the selected UL carrier, and TA for CG-SDT is valid according to clause 5.27 .2 in the first available CG occasion for initial CG-SDT transmission with CCCH message according to clause 5.8.2; and

2 if the SDT procedure is initiated for MO-SDT as specified in TS 38.331 [5], and, for each RB having data available for transmission, configuredGrantTypelAllowed, if configured for CG-SDT, is configured with value true for the corresponding logical channel, or if the SDT procedure is initiated for MT-SDT as specified in TS 38.331 [5]; and
\( 2> \) if at least one SSB configured for CG-SDT with SS-RSRP above cg-SDT-RSRP-ThresholdSSB is available, and if either the time gap between the initiation of the SDT procedure and first available CG occasion for initial CG-SDT transmission with CCCH message according to clause 5.8.2 is less than MAX_DURATION_TO_NEXT_CG_OCCASION, or if the MAX_DURATION_TO_NEXT_CG_OCCASION is not set:
\( 3> \) indicate to the upper layers that the conditions for initiating SDT procedure are fulfilled;
3> perform CG-SDT procedure on the selected UL carrier according to clause 5.8.2.
\( 2> \) else if a set of Random Access resources for RA-SDT is configured and can be selected according to clause 5.1.1b on the selected UL carrier on the BWP configured by initialUplinkBWP-RedCap, if configured for an (e)RedCap UE; otherwise, on the BWP configured by initialUplinkBWP; or
\( 2> \) if the SDT procedure is initiated for MT-SDT as specified in TS 38.331 [5]:
3> if cg-SDT-TimeAlignmentTimer is running, consider cg-SDT-TimeAlignmentTimer as expired and perform the corresponding actions in clause 5.2;
\( 3> \) indicate to the upper layers that the conditions for initiating SDT procedure are fulfilled.
\( 2> \) else:

ETSI


--- Page 196  ---


3GPP TS 38.321 version 18.2.0 Release 18
195
ETSI TS 138321 V18.2.0 (2024-08)

\( 3> \) indicate to the upper layers that the conditions for initiating SDT procedure are not fulfilled.
1> else:
\( 2> \) indicate to the upper layers that the conditions for initiating SDT procedure are not fulfilled.
If Random Access procedure is selected above for SDT procedure initiated for MO-SDT or MT-SDT and after the Random Access procedure is successfully completed (see clause 5.1.6), the UE monitors PDCCH addressed to C-RNTI received in random access response until the SDT procedure is terminated. If CG-SDT is selected above and after the initial transmission for CG-SDT is performed, the UE monitors PDCCH addressed to C-RNTI as stored in UE Inactive AS context as specified in TS 38.331 [5] and CS-RNTI until the SDT procedure is terminated.

The MAC entity shall:
\( 1> \) if sdt-BeamFailureRecoveryProhibitTimer is configured and not running; and
1> if RA-SDT procedure for MO-SDT or MT-SDT procedure initiated by Random Access procedure is ongoing:
\( 2> \) if SS-RSRP of the SSB selected in the last successfully completed Random Access procedure during ongoing RA-SDT procedure or ongoing MT-SDT procedure initiated by Random Access procedure is less than rsrpThresholdSSB:
\( 3> \) start the sdt-BeamFailureRecoveryProhibitTimer;
\( 3> \) initiate a Random Access procedure (see clause 5.1).
NOTE 1a: It is up to UE implementation when to measure SSBs during ongoing RA-SDT procedure or ongoing MT-SDT procedure initiated by Random Access procedure. Based on implementation the UE need not initiate the Random Access procedure if there is no SSB with SS-RSRP above rsrp-ThresholdSSB. The UE uses rsrp-ThresholdSSB in Random Access configuration selected by the UE when RA-SDT or MTSDT procedure was initiated.

NOTE 2: When the UE determines if there is an SSB with SS-RSRP above cg-SDT-RSRP-ThresholdSSB or less than rsrp-ThresholdSSB, the UE uses the latest unfiltered L1-RSRP measurement.
5.27.2 TA Validation for CG-SDT

RRC configures the following parameters for TA validation for CG-SDT:
- cg-SDT-RSRP-ChangeThreshold: RSRP threshold for the increase/decrease of RSRP for time alignment validation.

The MAC entity shall, upon the reception of CG-SDT configuration:
\( 1> \) store the current RSRP of the downlink pathloss reference for TA validation as defined in TS 38.331 [5] clause 5.7.17.

The MAC entity shall consider the TA of the initial CG-SDT transmission with CCCH message to be valid when the following conditions are fulfilled:
\( 1> \) The RSRP values for the stored downlink pathloss reference and the current downlink pathloss reference are valid according to TS 38.133 [11]; and

1> Compared to the stored downlink pathloss reference RSRP value, the current RSRP value of the downlink pathloss reference calculated as specified in TS 38.133 [11] has not increased/decreased by more than cg-SDT-RSRP-ChangeThreshold, if configured; and
\( 1> \) cg-SDT-TimeAlignmentTimer is running-

ETSI


--- Page 197  ---


3GPP TS 38.321 version 18.2.0 Release 18
196
ETSI TS 138321 V18.2.0 (2024-08)
5.28 Sidelink Discontinuous Reception (DRX)
5.28.1 General

The MAC entity may be configured by RRC with an SL DRX functionality that controls the UE's SCI (i.e., \( 1{ }^{\text {st }} \) stage SCI and \( 2{ }^{\text {nd }} \) stage SCI) monitoring activity for unicast, groupcast and broadcast. When using SL DRX operation, the MAC entity shall also monitor SCI (ie., \( 1^{\text {st }} \) stage SCI and \( 2^{\text {nd }} \) stage SCI) according to requirements found in other clauses of this specification.

Sidelink DRX and UE procedure on Dedicated SL-PRS resource pool are not applied at the same time.
RRC controls Sidelink DRX operation by configuring the following parameters:
- sl-drx-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer: the duration at the beginning of an SL DRX cycle;
- sl-drx-SlotOffset: the delay before starting the sl-drx-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer;
- sl-drx-InactivityTimer/sl-DRX-GC-InactivityTimer (except for the SL broadcast communication): the duration after the first slot of SCI (i.e., \( 1^{\text {st }} \) stage SCI and \( 2^{\text {nd }} \) stage SCI) reception in which an SCI indicates a new SL transmission for the MAC entity;
- sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer (per Sidelink process except for the SL broadcast process): the maximum duration until an SL retransmission is received;
- sl-drx-StartOffset: the slot where the SL DRX cycle starts;
- sl-drx-Cycle/sl-DRX-GC-BC-Cycle: the Sidelink DRX cycle;
- sl-drx-HARQ-RTT-Timer/sl-DRX-GC-HARQ-RTT-Timer (per Sidelink process except for the SL broadcast process): the minimum duration before an SL HARQ retransmission is expected by the MAC entity.
5.28.2 Behaviour of UE receiving SL-SCH Data

When SL DRX is configured, the Active Time includes the time while:
- sl-drx-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer or sl-drx-InactivityTimer/sl-DRX-GCInactivityTimer is running; or
- sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer is running; or
- period of s/-LatencyBoundCSI-Report configured by RRC in case SL-CSI reporting MAC CE is not received; or
- the time between the transmission of the request of SL-CSI reporting and the reception of the SL-CSI reporting MAC CE in case SL-CSI reporting MAC CE is received; or
- Slot(s) associated with the announced periodic transmission(s) by the UE transmitting SL-SCH Data; or
- the time between transmission/reception of Direct Link Establishment Request message (TS 24.587 [28]) or ProSe Direct Link Establishment Request message (TS 24.554 [29]) and reception of RRCReconfigurationSidelink message including initial DRX configuration or the link establishment procedure being aborted by upper layer; or
- the time between transmission of RRCReconfigurationSidelink message including initial DRX configuration and reception of corresponding RRCReconfigurationCompleteSidelink or RRCReconfigurationFailureSidelink message.

When one or multiple SL DRX is configured, the MAC entity shall:
\( 1> \) if a single sl-DRX-GC-BC-Cycle that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or a single sl-DRX-GC-BC-Cycle that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List is associated to a Destination and the associated cast type is groupcast or broadcast:

ETSI


--- Page 198  ---


3GPP TS 38.321 version 18.2.0 Release 18
197
ETSI TS 138321 V18.2.0 (2024-08)

2> select the sl-DRX-GC-BC-Cycle that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or the sl-DRX-GC-BC-Cycle configured in sl-DefaultDRX-GC-BC associated with the Destination.
\( 1> \) else if multiple s/-DRX-GC-BC-Cycle that include one or multiple sl-DRX-GC-BC-Cycle that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and, if applicable, one sl-DRX-GC-BC-Cycle that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List are associated to a Destination Layer-2 ID and the associated cast type groupcast or broadcast:

2> select the sl-DRX-GC-BC-Cycle whose length is the shortest one among multiple sl-DRX-GC-BC-Cycle that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and sl-DRX-GC-BC-Cycle configured in sl-DefaultDRX-GC-BC associated with the Destination Layer-2 [D.
\( 1> \) if a single \( s \)-DRX-GC-BC-OnDuration Timer that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or a single sl-DRX-GC-BC-OnDurationTimer that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List is associated to a Destination and the associated cast type is groupcast or broadcast:
\( 2> \) select the sl-DRX-GC-BC-OnDurationTimer that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or the sl-DRX-GC-BC-OnDurationTimer configured in sl-DefaultDRX-GC-BC associated with the Destination.
\( 1> \) else if multiple sl-DRX-GC-BC-OnDurationTimer that include one or multiple sl-DRX-GC-BCOnDurationTimer that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and, if applicable, one sl-DRX-GC-BC-OnDurationTimer that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List are associated to a Destination Layer-2 ID and the associated cast type is groupcast or broadcast:
\( 2> \) select the sl-DRX-GC-BC-OnDurationTimer whose length is the longest one among multiple sl-DRX-GC-BC-OnDurationTimer that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and sl-DRX-GC-BC-Cycle configured in sl-DefaultDRX-GC-BC associated with the Destination Layer-2 ID.
\( 1> \) if a single sl-DRX-GC-InactivityTimer that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or a single sl-DRX-GC-InactivityTimer that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List is associated to a Destination and the associated cast type is groupcast:

2> select the sl-DRX-GC-InactivityTimer that is mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List or the sl-DRX-GC-InactivityTimer configured in sl-DefaultDRX-GC-BC associated with the Destination:
\( 1> \) else if multiple \( s / \)-DRX-GC-InactivityTimer that include one or multiple \( s / \)-DRX-GC-InactivityTimer that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and, if applicable, one sl-DRX-GCInactivityTimer that is configured in sl-DefaultDRX-GC-BC and cannot be mapped with any SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List of a Destination Layer-2 [D and the associated cast type is groupcast:
\( 2> \) select s/-DRX-GC-InactivityTimer whose length is the longest one among multiple sl-DRX-GCInactivityTimer that are mapped with one or multiple SL-QoS-Profile in sl-DRX-GC-BC-PerQoS-List and sl-DRX-GC-InactivityTimer configured in sl-DefaultDRX-GC-BC associated with the Destination Layer-2 ID.
\( 1> \) if an \( s l \)-dr \( x \)-HARQ-RTT-Timer expires:
\( 2> \) if the data of the corresponding Sidelink process was not successfully decoded or if the HARQ feedback (i.e., negative acknowledgement) is not transmitted for unicast due to UL/SL prioritization:
\( 3> \) start the sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer for the corresponding Sidelink process in the first slot after the expiry of \( s l \)-drx-HARQ-RTT-Timer.

When the cast type is groupcast or broadcast as indicated by upper layer, or the cast type is unicast for the reception of Direct Link Establishment Request message [28] or ProSe Direct Link Establishment Request message [29] as indicated by upper layer, or for the reception of discovery message [26], the \( s l \)-drx-StartOffset and \( s l \)-drx-SlotOffset are derived from the following equations:
sl-drx-StartOffset (ms) = Destination Layer-2 [D modulo sl-DRX-GC-BC-Cycle (ms).

ETSI


--- Page 199  ---


3GPP TS 38.321 version 18.2.0 Release 18
198
ETSI TS 138321 V18.2.0 (2024-08)

sl-drx-SlotOffset (ms) \( =( \) Destination Layer-2 [D modulo the number of slots in one subframe)
/the number of slots in one subframe) (ms).
\( 1> \) if the SL DRX cycle is used, and [(DFN \( \times 10 \) ) + subframe number] modulo (sl-drx-Cycle or sl-DRX-GC-BCCycle \( )=s \)-drx-StartOffset:
\( 2> \) start \( s l \)-drx-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer after sl-drx-SlotOffset from the beginning of the subframe.
\( 1> \) if an SL DRX is in Active Time:
\( 2> \) monitor the SCI (i.e., \( 1^{\text {st }} \) stage SCI and \( 2^{\text {nd }} \) stage SCI).
\( 2> \) if the SCI indicates a new SL transmission:
\( 3> \) if Source Layer-1 ID of the SCI is equal to the 8 LSB of the intended Destination Layer-2 ID and Destination Layer-1 ID of the SCI is equal to the 16 LSB of the intended Source Layer-2 ID and the cast type indicator in the SCI is set to unicast:

4> start or restart \( s \)-drx-InactivityTimer for the corresponding Source Layer-2 [D and Destination Layer2 [D pair in the first slot after SCI reception.
\( 3> \) if Destination Layer-1 ID of the SCI (i.e., \( 2^{\text {nd }} \) stage SCI) is equal to the 16 LSB of the intended Destination Layer-2 ID and the cast type indicator in the SCI is set to groupcast:
\( 4> \) start or restart \( s \)-DRX-GC-InactivityTimer for the corresponding Destination Layer-2 ID in the first slot after SCI reception.
\( 2> \) if the SCI indicates an SL transmission:
\( 3> \) if a next retransmission opportunity is indicated in the SCI:
\( 4> \) derive the \( s l \)-drx-HARQ-RTT-Timer from the retransmission resource timing of the next retransmission resource in the SCI.
\( 3> \) else if PSFCH resource is configured for the SL grant associated to the SCI:
\( 4> \) set the \( s l \)-drx-HARQ-RTT-Timer based on \( s l \)-drx-HARQ-RTT-Timer \( l \) configured by upper layer if the cast type associated with the SCI is unicast or sl-DRX-GC-HARQ-RTT-Timer \( I \) configured by upper layer if the cast type associated with the SCI is groupcast when HARQ feedback is enabled, or based on \( s l \)-drx-HARQ-RTT-Timer 2 configured by upper layer if the cast type associated with the SCI is unicast or sl-DRX-GC-HARQ-RTT-Timer 2 configured by upper layer if the cast type associated with the SCI is groupcast when HARQ feedback is disabled, for resource pool configured with PSFCH.
\( 3> \) else (i.e., if PSFCH resource is not configured for the SL grant associated to the SCI):
\( 4> \) set the sl-drx-HARQ-RTT-Timer as 0 slots.
\( 3> \) if PSFCH resource is not configured for the SL grant associated to the SCI:
\( 4> \) start the \( s l \)-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the slot following the end of PSSCH transmission (i.e., currently received PSSCH).
\( 3> \) if PSFCH resource is configured for the SL grant associated to the SCI:
4 - if HARQ feedback is enabled by the SCI and the cast type associated with the SCI is unicast:
\( 5> \) if \( s \)-NumPSFCH-Occasions is configured as specified in TS 38.331 [5]:
\( 6> \) start the \( s l \)-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of corresponding PSFCH transmission carrying the SL HARQ Feedback when the SL HARQ feedback is successfully transmitted in one of PSFCH occasions from s/-NumPSFCHOccasions; or
\( 6> \) start the \( s l \)-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the last PSFCH occasion for the SL HARQ Feedback when the SL HARQ feedback is not transmitted in all PSFCH occasions from sl-NumPSFCH-Occasions.

ETSI


--- Page 200  ---


3GPP TS 38.321 version 18.2.0 Release 18
199
ETSI TS 138321 V18.2.0 (2024-08)

\( 5> \) else:
6> start the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH transmission carrying the SL HARQ feedback; or

6> start the \( s l \)-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH resource for the SL HARQ feedback when the SL HARQ feedback is not transmitted due to UL/SL prioritization or SL LBT failure.

4 if HARQ feedback is enabled by the SCI and the cast type associated with the SCI is groupcast and positive-negative acknowledgement is selected:
\( 5> \) if \( s \)-NumPSFCH-Occasions is configured as specified in TS 38.331 [5]:
\( 6> \) start the \( s l \)-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the last PSFCH occasion for the SL HARQ Feedback.
\( 5> \) else:
6> start the \( s l \)-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH transmission carrying the SL HARQ feedback; or

6> start the \( s l \)-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH resource for the SL HARQ feedback when the SL HARQ feedback is not transmitted due to UL/SL prioritization.
\( 4- \) if HARQ feedback is enabled by the SCI and the cast type associated with the SCI is groupcast and negative-only acknowledgement is selected;
\( 5> \) start the \( s l \)-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH transmission carrying the SL HARQ feedback; or
\( 5> \) start the \( s / \)-dr \( x \)-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH resource for the SL HARQ feedback when the SL HARQ feedback is not transmitted due to UL/SL prioritization; or
\( 5> \) start the \( s l \)-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the corresponding PSFCH resource for the SL HARQ feedback when the SL HARQ feedback is a positive acknowledgement.
\( 4> \) if HARQ feedback is disabled by the SCI and the resource(s) for one or more retransmission opportunities is not scheduled in the SCI:
\( 5> \) if \( s \)-NumPSFCH-Occasions is configured as specified in TS 38.331 [5]:
\( 6> \) start the \( s l \)-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the first slot after the end of the last PSFCH occasion.
\( 5> \) else:
\( 6> \) start the sl-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the slot following the end of PSFCH resource.

4 if HARQ feedback is disabled by the SCI and the resource(s) for one or more retransmission opportunities is scheduled in the SCI:
\( 5> \) start the \( s l \)-drx-HARQ-RTT-Timer for the corresponding Sidelink process in the slot following the end of PSSCH transmission (i.e., currently received PSSCH).

NOTE: Void.
\( 3> \) stop the sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer for the corresponding Sidelink process.
\( 1> \) if an SL DRX Command MAC CE is received for the Source Layer-2 ID and Destination Layer-2 ID pair of a unicast:

ETSI


--- Page 201  ---


3GPP TS 38.321 version 18.2.0 Release 18
200
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) stop \( s \)-drx-onDurationTimer for the Source Layer-2 ID and Destination Layer-2 ID pair of a unicast;
\( 2> \) stop \( s \) /-drx-InactivityTimer for the Source Layer-2 ID and Destination Layer-2 ID pair of a unicast.
5.28.3 Behaviour of UE transmitting SL-SCH Data

The UE transmitting SL-SCH Data should keep aligned with its intended UE receiving the SL-SCH Data regarding the SL DRX Active time as specified in clause 5.28.2.

Furthermore, the UE transmitting SL-SCH Data determines the SL DRX Active time based on SL DRX timers that are running (e.g., sl-drx-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer, sl-drx-InactivityTimer/sl-DRX-GCInactivityTimer, sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer) or will be running in the future (e.g., sl-dræ-onDurationTimer/sl-DRX-GC-BC-OnDurationTimer, sl-drx-InactivityTimer/sl-DRX-GC-InactivityTimer, sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer) at the UE(s) receiving SL-SCH data. The UE may select resource for the initial transmission of groupcast within the time when sl-DRX-GC-BC-OnDurationTimer or sl-DRX-GC-InactivityTimer of the destination is running.

NOTE 1: A UE may assume that a resource for retransmission is in the Active time if an initial transmission causes the sl-drx-RetransmissionTimer/sl-DRX-GC-RetransmissionTimer to be started at the receiving UE.

NOTE 2: A UE may send SL DRX Command MAC CE to receiving UE for unicast and when to send SL DRX Command MAC CE is up to UE implementation.

The MAC entity shall for each Destination Layer-2 ID associated with groupcast that is interested in NR sidelink transmision:

1> if the SCI indicates a new transmission where the cast type is set to groupcast is transmitted:
\( 2> \) start or restart sl-DRX-GC-InactivityTimer for the corresponding Destination Layer-2 ID in the first slot after SCI transmission.

The MAC entity shall for each pair of the Source Layer-2 ID and the Destination Layer-2 ID corresponding to each PC5-RRC connection which has been established by upper layers:
\( 1> \) if the SL DRX Command indication has been triggered by the UE:
\( 2> \) if the MAC entity has SL resources allocated for new transmission and the SL-SCH resources can accommodate the SL DRX Command MAC CE and its subheader as a result of logical channel prioritization:
\( 3> \) instruct the Multiplexing and Assembly procedure to generate a Sidelink DRX Command MAC CE as defined in clause 6.1_3_52;
\( 3> \) cancel the triggered SL DRX Command indication.
\( 2> \) else if the MAC entity has been configured with Sidelink resource allocation mode 1:
3> trigger a Scheduling Request.
5.29 Activation/Deactivation of SCG

The network may activate and deactivate the configured SCG.
The MAC entity shall for the configured SCG:
1> if upper layers indicate that SCG is activated:
\( 2> \) if BFI_COUNTER>= beamFailurelnstanceMaxCount for the PSCell or the timeAlignmentTimer associated with PTAG is not running:

3> indicate to upper layers that a Random Access Procedure (as specified in clause 5.1.1) is needed for SCG activation.
\( 2> \) activate the SCG according to the timing defined in TS 38.133 [11].

ETSI


--- Page 202  ---


3GPP TS 38.321 version 18.2.0 Release 18
201
ETSI TS 138321 V18.2.0 (2024-08)

\( 2> \) (re-)initialize any suspended configured uplink grants of configured grant Type 1 associated with this PSCell according to the stored configuration, if any, and to start in the symbol according to rules in clause 5.8.2.2;
\( 2> \) apply normal SCG operation including:
\( 3> \) SRS transmissions on the PSCell;
3> CSI reporting for the PSCell;
\( 3>\mathrm{PDCCH} \) monitoring on the PSCell;
3> PUCCH transmissions on the PSCell;
3> transmit on RACH on the PSCell;
3> initialize \( B j \) for each logical channel to zero.
1> else if upper layers indicate that the SCG is deactivated:
\( 2> \) deactivate all the SCells of the SCG according to clause 5.9;
\( 2> \) deactivate SCG according to the timing defined in TS 38.133 [11];
\( 2> \) clear any configured downlink assignment and any configured uplink grant Type 2 associated with the PSCell respectively;
\( 2> \) suspend any configured uplink grant Type 1 associated with the PSCell;
\( 2> \) reset MAC according to clause 5.12;
\( 2> \) flush all HARQ buffers associated with the PSCell.
1> if the SCG is deactivated:
\( 2> \) not transmit SRS on the PSCell;
\( 2> \) not report CSI for the PSCell;
\( 2> \) not transmit on UL-SCH on the PSCell;
\( 2> \) not transmit PUCCH on the PSCell;
\( 2> \) not transmit on RACH on the PSCell;
\( 2> \) not monitor the PDCCH on the PSCell.
5.30 Handling of FR2 UL gap

During the FR2 UL gap configured by \( u \)-GapFR2-Config as specified in TS 38.331 [5], the MAC entity shall, on the Serving Cell(s) of FR2 single CC and intra-band CA, or on the Serving Cell(s) of FR2 inter-band CA where UE does not support tx-Support-UL-GapFR2:

1> only perform transmission of:
\( 2> \) PRACH preamble as specified in clause 5.1.2 and 5.1.2a;
2 UL-SCH for Msg3 or the MSGA payload as specified in clause 5.4.2.2;
\( 2> \) UL-SCH for configured grant;
\( 2> \) the valid CSI report during SCell activation procedure where the valid CSI report is valid CQI with non-zero CQI index defined in TS 38.214 [7], clause 5.2.2.1, when the time period between UL gap colliding with CSI report of non-zero CQI and the slot where the SCell activation MAC CE or CSI report activation command is received is no less than 10 ms ;
\( 2> \) the valid L1 RSRP report during SCell activation procedure, where the valid L1 RSRP report is non lowest L1 RSRP defined in TS 38.133 [11], clause 10.1.6, when the time period between UL gap colliding with L1

ETSI


--- Page 203  ---


3GPP TS 38.321 version 18.2.0 Release 18
202
ETSI TS 138321 V18.2.0 (2024-08)

RSRP reporting and the slot where the SCell activation MAC CE or CSI report activation command is received is no less than 10 ms ;
\( 2> \) the PUCCH transmission for SR, and link recovery request (LRR) defined in TS 38.133 [11], clause 8.5.
5.31 Sidelink LBT operation
5.31.1 General

The lower layer may perform an SL LBT procedure, see TS 37.213 [18], according to which a transmission is not performed by lower layers if the channel is identified as being occupied. When lower layer performs an SL LBT procedure before a transmission and the transmission is not performed, an SL LBT failure indication is sent to the MAC entity from lower layers. Unless otherwise specified, when SL LBT procedure is performed for a transmission, actions as specified in this specification are performed regardless of if an SL LBT failure indication is received from lower layers. When SL LBT is not performed by the lower layers, SL LBT failure indication is not received from lower layers.
5.31.2 Sidelink LBT failure detection and recovery procedure

The MAC entity may be configured by RRC with a Sidelink consistent LBT failure detection and recovery procedure. Sidelink consistent LBT failure is detected per RB set by counting SL LBT failure indications, for all SL transmissions, from the lower layers to the MAC entity.

RRC configures the following parameters in the \( s l \)-Ibt-FailureRecoveryConfig:
- sl-Ibt-FailureInstanceMaxCount for the Sidelink consistent LBT failure detection;
- sl-Ibt-FailureDetectionTimer for the Sidelink consistent LBT failure detection;
- sl-LBT-RecoveryTimer for recovery of the triggered Sidelink consistent LBT failure.

The following UE variable is used for the Sidelink consistent LBT failure detection procedure:
- SL_LBT_COUNTER (per RB set): counter for SL LBT failure indication which is initially set to 0 .

For activated SL BWP configured with sl-Ibt-FailureRecoveryConfig, the MAC entity shall:
\( 1> \) if SL LBT failure indication has been received from lower layers for an RB set of the configured pool(s) of resources in the SL BWP:
\( 2> \) start or restart the sl-ibt-FailureDetectionTimer for the RB set;
\( 2> \) increment SL_LBT_COUNTER for the RB set by 1 ;
\( 2> \) if SL_LBT_COUNTER \( >=s \) l-Ibt-FailureInstanceMaxCount:
3> trigger Sidelink consistent LBT failure for the RB set in the SL BWP;
3> if consistent LBT failure has been triggered in all the RB sets of the configured pool(s) of resources in the SL BWP:

4> indicate Sidelink consistent LBT failure based Sidelink RLF detection for all destination IDs associated to unicast service to upper layers.

1> if all triggered Sidelink consistent LBT failures are cancelled in a RB set; or
\( 1> \) if the \( s \)-Ibt-FailureDetectionTimer expires for a RB set:
\( 2> \) set SL_LBT_COUNTER to 0 for the RB set.
\( 1> \) if \( s l \)-lbt-FailureDetectionTimer or \( s l \)-Ibt-FailureInstanceMaxCount is reconfigured by upper layers:
\( 2> \) set \( S L \) LBT_COUNTER to 0 for all the RB sets.

ETSI


--- Page 204  ---


3GPP TS 38.321 version 18.2.0 Release 18
203
ETSI TS 138321 V18.2.0 (2024-08)

The sl-LBT-RecoveryTimer is used for recovery of the triggered Sidelink consistent LBT failure, when RRC configures Sidelink resource allocation mode 2.

The MAC entity shall:
\( 1> \) if Sidelink consistent LBT failure has been triggered, and not cancelled, in the RB set(s), and SL LBT failure MAC CE for the triggered Sidelink consistent LBT failure has not been generated;

2 if the sl-LBT-RecoveryTimer for the triggered Sidelink consistent LBT failure is not running:
\( 3> \) start the \( s /-L B T \)-RecoveryTimer.
\( 2> \) if UL-SCH resources are available for a new transmission and the UL-SCH resources can accommodate the SL LBT failure MAC CE plus its subheader as a result of logical channel prioritization according to clause 5.4.3.1:
\( 3> \) instruct the Multiplexing and Assembly procedure in clause 5.4 .3 to generate the SL LBT failure MAC CE(s).
\( 2> \) else:
\( 3> \) trigger a Scheduling Request for SL LBT failure MAC CE.
\( 1> \) if a MAC PDU is transmitted and this PDU includes the SL LBT failure MAC CE; or
\( 2> \) cancel the triggered Sidelink consistent LBT failure(s) in RB set(s) for which Sidelink consistent LBT failure was indicated in the transmitted SL LBT failure MAC CE if the MAC entity has been configured with Sidelink resource allocation mode 1.
\( 1> \) if the \( s l-L B T \)-RecoveryTimer for the triggered Sidelink consistent LBT failure(s) expires:
\( 2> \) cancel the triggered Sidelink consistent LBT failure(s) in RB set(s) for which Sidelink consistent LBT failure was detected.
\( 1> \) if \( s l- \) Ibt-FailureRecoveryConfig is reconfigured by upper layers for the BWP:
\( 2> \) cancel all the triggered Sidelink consistent LBT failure(s) in the SL BWP.
5.32 SRS for positioning Tx frequency hopping

SRS for positioning Tx frequency hopping can be supported for UE in RRC_CONNECTED and RRC_INACTIVE. The UE can be configured with UTW during which the UE is allowed to transmit SRS for positioning Tx frequency hopping.

RRC configures the following parameters for the UTW for SRS for positioning Tx frequency hopping:
- utw-SlotPeriodicity: Periodicity of the UTW in slot;
- utw-SlotOffset: Offset of the beginning of the UTW with respect to the beginning of the UTW periodicity in time domain in slot;
- uplinkTimeWindowTimer: Time duration when the UE performs SRS transmission for positioning Tx frequency hopping.

When UTW is configured, the MAC entity shall start the uplinkTimeWindowTimer in the first symbol of the slot for which the following condition is satisfied
\[
\text { CURRENT_slot modulo (utw-SlotPeriodicity) }=u t w \text {-SlotOffset }
\]
where CURRENT_slot \( =( \) SFN × numberOfSlotsPerFrame \( )+ \) slot number in the frame and numberOfSlotsPerFrame refers to the number of consecutive slots per frame as specified in TS 38.211 [8].

When UTW is configured and the UE is in RRC_CONNECTED, the MAC entity shall instruct the lower layer to transmit SRS for positioning Tx frequency hopping when the uplinkTime WindowTimer is running.

ETSI


--- Page 205  ---


3GPP TS 38.321 version 18.2.0 Release 18
204
ETSI TS 138321 V18.2.0 (2024-08)
5.33 RACH-less initial UL transmission

The initial uplink transmission of a RACH-less handover procedure can be performed either using a dynamic uplink grant or a configured uplink grant Type 1 preallocated by RRC, if configured.

When rach-LessHO is configured, the MAC entity shall:
\( 1> \) if \( c g-R R C \)-Configuration is configured:
\( 2> \) select a configured uplink grant for initial uplink transmission according to clause 5.8.2;
\( 2> \) perform initial uplink transmission in the first available CG occasion for RACH-less handover according to clause 5.8.2;
\( 2> \) monitor the PDCCH as specified in clause 5.7 and TS 38.213 [6].
1> else:
\( 2> \) if tci-StatelD is configured in rach-LessHO:
\( 3> \) indicate to lower layers the TCI state information included in tci-StateID.
\( 2> \) else if ssb-Index is configured in rach-LessHO:
\( 3> \) indicate to lower layers the SSB index included in \( s s b \)-Index.
2> monitor the PDCCH as specified in TS 38.213 [6].
5.34 Cell-Level Energy Saving
5.34.1 General

Each Serving Cell may be configured by RRC with a periodic cell DTX pattern (i.e., Active and Non-Active Periods). The cell DTX operation controls UE's monitoring activity of PDCCH and configured downlink assignments in RRC_CONNECTED. For all activated Serving Cells with cell DTX configured and activated, the MAC entity may monitor PDCCH and configured downlink assignments using the cell DTX operation specified in clause 5.34.2.

Each Serving Cell may be configured by RRC with a periodic cell DRX pattern (i.e., Active and Non-Active Periods). The cell DRX operation controls Scheduling Request and configured uplink grant transmission activity in RRC_CONNECTED. For all activated Serving Cells with cell DRX configured and activated, the MAC entity may transmit configured uplink grant transmissions and Scheduling Request using the cell DRX operation specified in clause 5.34.3.

RRC controls cell DTX and cell DRX operation by configuring the following parameters in cellDTX-DRX-Config per Serving Cell:
- cellDTX-DRX-ConfigType: defines whether only cell DTX is configured, only cell DRX is configured, or both are configured;
- cellDTX-DRX-onDurationTimer: the active duration at the beginning of a cell DTX/DRX cycle;
- cellDTX-DRX-StartOffset: defines the subframe where the cell DTX/DRX cycle starts;
- cellDTX-DRX-SlotOffset: the delay before starting the cellDTX-DRX-onDurationTimer;
- cellDTX-DRX-Cycle: the cell DTX/DRX cycle period.
- ActivationStatus: the initial activation status of cell DTX and cell DRX operation.
5.34.2 Cell Discontinuous Transmission

Cell DTX is configured if cellDTX-DRX-ConfigType is set to \( d t x \) or \( d t x d r x \). Cell DTX operation is activated and deactivated for each Serving Cell by:

ETSI


--- Page 206  ---


3GPP TS 38.321 version 18.2.0 Release 18
205
ETSI TS 138321 V18.2.0 (2024-08)
- receiving a cell DTX indication from lower layers indicating activation or deactivation of cell DTX operation, as specified in TS 38.213 [6];
- configuring cellDTX-DRX-Config by upper layers: if cell DTX is configured and cellDTX-DRX-ActivationStatus is set to activated, cell DTX operation is activated upon cell DTX configuration; if cell DTX is configured and cellDTX-DRX-ActivationStatus is set to deactivated, cell DTX operation is deactivated upon cell DTX configuration; if cellDTX-DRX-Config is released, cell DTX operation is deactivated and all the corresponding configurations are released.

When cell DTX is configured and activated for a Serving Cell, the cell DTX Active Period includes the time while:
- cellDTX-DRX-onDurationTimer is running for the associated Serving Cell.

For each Serving Cell configured with cell DTX, the MAC entity shall:
1> if cell DTX is activated for this Serving Cell:
\( 2> \) if \( [(\mathrm{SFN} \times 10)+ \) subframe number \( ] \) modulo \( ( \) cellDTX-DRX-Cycle \( )=( \) cellDTX-DRX-StartOffset \( ): \)
\( 3> \) start cellDTX-DRX-onDurationTimer for this serving cell after cellDTX-DRX-SlotOffset from the beginning of the subframe.

1> if cell DTX operation is deactivated for this Serving Cell; or
1> if the Serving Cell is in the cell DTX Active Period:
\( 2> \) monitor PDCCH on this Serving Cell, as specified in TS 38.213 [6] and other clauses of this specification.
\( 1> \) if any drx-RetransmissionTimerDL, drx-RetransmissionTimer \( U L \) or drx-RetransmissionTimerSL (as described in clause 5.7) is running on any Serving Cell in the DRX group of this Serving Cell; or
\( 1> \) if \( r a \)-ContentionResolutionTimer (as described in clause 5.1.5) or msgB-ResponseWindow (as described in clause 5.1.4a) is running; or
\( 1> \) if a Scheduling Request is sent on PUCCH and is pending (as described in clause 5.4 .4 or 5.22.1.5); or
1> if a PDCCH indicating a new transmission addressed to the C-RNTI of the MAC entity has not been received after successful reception of a Random Access Response for the Random Access Preamble not selected by the MAC entity among the contention-based Random Access Preamble (as described in clauses 5.1.4 and 5.1.4a):
\( 2> \) monitor PDCCH on the Serving Cells in the DRX group of this Serving Cell, as specified in TS 38.213 [6] and other clauses of this specification.
\( 1> \) if ra-ResponseWindow (as described in clause 5.1.4) is running and this Serving Cell is the SpCell:
\( 2> \) monitor PDCCH on this Serving Cell (as described in clause 5.1.4).
For each Serving Cell configured with cell DTX, the MAC entity need not:
\( 1> \) if cell DTX operation is activated and the Serving Cell is not in the cell DTX Active Period:
\( 2> \) monitor PDCCH for the MAC entity's RNTIs listed in clauses 5.7 and 5.7b, irrespective of the requirements of clauses 5.7 and 5.7b, unless stated otherwise in this clause;
\( 2> \) instruct the physical layer to receive transport block on the DL-SCH of this Serving Cell according to a configured downlink assignment for SPS;
\( 2> \) indicate the presence of a configured downlink assignment and deliver the stored HARQ information to the HARQ entity;
\( 2> \) set the HARQ Process ID to the HARQ Process ID associated with the PDSCH duration of a configured downlink assignment;
\( 2> \) consider the NDI bit for the HARQ process corresponding to the PDSCH duration of a configured downlink assignment to have been toggled for the configured downlink assignment.

ETSI


--- Page 207  ---


3GPP TS 38.321 version 18.2.0 Release 18
206
ETSITS 138321 V18.2.0 (2024-08)
5.34.3 Cell Discontinuous Reception

Cell DRX is configured if cellDTX-DRX-ConfigType is set to \( d r x \) or \( d t x d r x \). Cell DRX operation is activated and deactivated for each Serving Cell by:
- receiving a cell DRX indication from lower layers indicating activation or deactivation of cell DRX operation, as specified in TS 38.213 [6];
- configuring cellDTX-DRX-Config by upper layers: if cell DRX is configured and ActivationStatus is set to activated, cell DRX operation is activated upon cell DRX configuration; if cell DRX is configured and ActivationStatus is set to deactivated, cell DRX operation is deactivated upon cell DRX configuration; if cellDTX-DRX-Config is released, cell DRX operation is deactivated and all the corresponding configurations are released.

When cell DRX is configured and activated for a Serving Cell, the cell DRX Active Period includes the time while:
- cellDTX-DRX-onDurationTimer is running for the associated Serving Cell.

For each Serving Cell configured with cell DRX, the MAC entity shall:
1> if cell DRX is activated for this Serving Cell:
\( 2> \) if \( [(\mathrm{SFN} \times 10)+ \) subframe number \( ] \) modulo \( ( \) cellDTX-DRX-Cycle \( )=( \) cellDTX-DRX-StartOffset \( ): \)
3> start cellDTX-DRX-onDurationTimer for this serving cell after cellDTX-DRX-SlotOffset from the beginning of the subframe.
\( 1> \) if cell DRX is activated and the Serving Cell is not in the cell DRX Active Period:
\( 2> \) not instruct the physical layer to signal a SR on a PUCCH resource for SR;
\( 2> \) not increment the SR_COUNTER for a SR;
\( 2> \) not start the sr-ProhibitTimer for a SR;
\( 2> \) not deliver any configured uplink grant and the associated HARQ information to the HARQ entity;
\( 2> \) not instruct a HARQ process associated with a configured uplink grant to trigger a new transmission or a retransmission;

2> not report CSI on PUCCH and semi-persistent CSI configured on PUSCH;
2> if an emergency service is initiated by upper layers and this Serving Cell is the SpCell:
\( 3> \) initiate a Random Access procedure (as specified in clause 5.1.1).
NOTE: How the MAC layer in the UE is aware of an ongoing emergency service is up to UE implementation.
6 Protocol Data Units, formats and parameters
6.1 Protocol Data Units
6.1.1 General

A MAC PDU is a bit string that is byte aligned (i.e. multiple of 8 bits) in length. In the figures in clause 6 , bit strings are represented by tables in which the most significant bit is the leftmost bit of the first line of the table, the least significant bit is the rightmost bit on the last line of the table, and more generally the bit string is to be read from left to right and then in the reading order of the lines. The bit order of each parameter field within a MAC PDU is represented with the first and most significant bit in the leftmost bit and the last and least significant bit in the rightmost bit.

A MAC SDU is a bit string that is byte aligned (i.e. multiple of 8 bits) in length. A MAC SDU is included into a MAC PDU from the first bit onward.

ETSI


--- Page 208  ---


3GPP TS 38.321 version 18.2.0 Release 18
207
ETSI TS 138321 V18.2.0 (2024-08)

A MAC CE is a bit string that is byte aligned (i.e. multiple of 8 bits) in length.
A MAC subheader is a bit string that is byte aligned (i.e. multiple of 8 bits) in length. Each MAC subheader is placed immediately in front of the corresponding MAC SDU, MAC CE, or padding.

The MAC entity shall ignore the value of the Reserved bits in downlink MAC PDUs.
6.1.2 MAC PDU (DL-SCH and UL-SCH except transparent MAC and Random Access Response)

A MAC PDU consists of one or more MAC subPDUs. Each MAC subPDU consists of one of the following:
- AMAC subheader only (including padding);
- A MAC subheader and a MAC SDU;
- AMAC subheader and a MAC CE;
- AMAC subheader and padding.

The MAC SDUs are of variable sizes.
Each MAC subheader corresponds to either a MAC SDU, a MAC CE, or padding.
A MAC subheader except for fixed sized MAC CE, padding, and a MAC SDU containing UL CCCH consists of the header fields R/F/LCID/(eLCID)/L. A MAC subheader for fixed sized MAC CE and padding consists of the header fields R/LCID/(eLCID). A MAC subheader for a MAC SDU containing UL CCCH consists of the header fields (LX)/R/LCID.

Figure 6.1.2-1: R/F/LCID/(eLCID)/L MAC subheader with 8-bit L field

ETSI


--- Page 209  ---


3GPP TS 38.321 version 18.2.0 Release 18
208
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.2-2: R/F/LCID/(eLCID)/L MAC subheader with 16-bit L field

Figure 6.1.2-3: (LX)/R/LCID/(eLCID) MAC subheader

MAC CEs are placed together. DL MAC subPDU(s) with MAC CE(s) is placed before any MAC subPDU with MAC SDU and MAC subPDU with padding as depicted in Figure 6.1.2-4. UL MAC subPDU(s) with MAC CE(s) is placed after all the MAC subPDU(s) with MAC SDU and before the MAC subPDU with padding in the MAC PDU as depicted in Figure 6.1.2-5. The size of padding can be zero.

ETSI


--- Page 210  ---


3GPP TS 38.321 version 18.2.0 Release 18
209
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.2-4: Example of a DL MAC PDU

Figure 6.1.2-5: Example of a UL MAC PDU

A maximum of one MAC PDU can be transmitted per TB per MAC entity.
6.1.3 MAC Control Elements (CEs)
6.1.3.1 Buffer Status Report MAC CEs

Buffer Status Report (BSR) MAC CEs consist of either:
- Short BSR format (fixed size); or
- Extended Short BSR format (fixed size); or
- Long BSR format (variable size); or
- Refined Long BSR format (variable size); or
- Extended Long BSR format (variable size); or
- Short Truncated BSR format (fixed size); or
- Extended Short Truncated BSR format (fixed size); or
- Long Truncated BSR format (variable size); or
- Extended Long Truncated BSR format (variable size).

Pre-emptive BSR MAC CE consists of:
- Pre-emptive BSR format (variable size); or
- Extended Pre-emptive BSR format (variable size).

The BSR formats are identified by MAC subheaders with LCIDs as specified in Table 6.2.1-2.
The Refined Long BSR format, Extended BSR formats and Pre-emptive BSR format are identified by MAC subheaders with eLCIDs as specified in Table 6.2.1-2b.

ETSI


--- Page 211  ---


3GPP TS 38.321 version 18.2.0 Release 18
210
ETSI TS 138321 V18.2.0 (2024-08)

The fields in the BSR MAC CE are defined as follows:
- LCG ID: The Logical Channel Group ID field identifies the group of logical channel(s) whose buffer status is being reported. The length of the field is 3 bits for the case of Short BSR and Short Truncated BSR formats, and 8 bits for the case of Extended Short BSR and Extended Short Truncated BSR formats;
- LCG \( { }_{1} \). For the Long BSR format, Refined Long BSR format, Extended Long BSR format, Pre-emptive BSR format, and Extended Pre-emptive BSR format, this field indicates the presence of the Buffer Size field for the logical channel group i. The \( L C G_{1} \) field set to 1 indicates that the Buffer Size field for the logical channel group i is reported. The LCG, field set to 0 indicates that the Buffer Size field for the logical channel group i is not reported. For the Long Truncated BSR format and the Extended Long Truncated BSR format, this field indicates whether logical channel group \( i \) has data available. The \( \mathrm{LCG}_{1} \) field set to 1 indicates that logical channel group \( i \) has data available. The LCG, field set to 0 indicates that logical channel group i does not have data available;
- \( \mathrm{BT}_{1} \) : This field is included only in the Refined Long BSR format. This field is present only if the corresponding LCG \( { }_{1} \) is set to 1 ; otherwise, this field is reserved and set to 0 . If present, this field indicates which buffer size table is used to set the Buffer Size field for the logical channel group i. The BT, field set to 1 indicates that the buffer size table specified in Table 6.1.3.1-3 is used for the logical channel group i. The BT, field set to 0 indicates that the buffer size table specified in Table 6.1.3.1-2 is used for the logical channel group i;
- Buffer Size: The Buffer Size field identifies the total amount of data available according to the data volume calculation procedure in TSs 38.322 [3] and 38.323 [4] across all logical channels of a logical channel group after the MAC PDU has been built (i.e. after the logical channel prioritization procedure, which may result the value of the Buffer Size field to zero). The amount of data is indicated in number of bytes. The size of the RLC headers and MAC subheaders are not considered in the buffer size computation. The length of this field for the Short BSR format and the Short Truncated BSR format is 5 bits. The length of this field for the Extended Short BSR format and the Extended Short Truncated BSR format is 8 bits. The length of this field for the Long BSR format, the Refined Long BSR format, the Long Truncated BSR format, the Extended Long BSR format, and the Extended Long Truncated format is 8 bits. The values for the 5 -bit Buffer Size fields are shown in Table 6.1.3.11. The values for the 8-bit Buffer Size fields in the Long BSR format, the Long Truncated BSR format, the Extended Long BSR format, and the Extended Long Truncated format are shown in Table 6.1.3.1-2. For the Refined Long BSR format, if an LCG is configured with additionalBS-TableAllowed and the amount of data for the LCG is within the buffer sizes specified in Table 6.1.3.1-3, the MAC entity shall use the buffer sizes specified in Table 6.1.3.1-3 to set the value of this field; otherwise, the MAC entity shall use Table 6.1.3.1-2 instead. For the Long BSR format, the Refined Long BSR format, the Long Truncated BSR format, the Extended Long BSR format, and the Extended Long Truncated format, the Buffer Size fields are included in ascending order based on the LCG \( { }_{1} \). For the Long Truncated BSR format and the Extended Long Truncated format the number of Buffer Size fields included is maximised, while not exceeding the number of padding bits. For the Pre-emptive BSR format and the Extended Pre-emptive BSR format, the Buffer Size field identifies the total amount of the data expected to arrive at the IAB-MT of the node where the Pre-emptive BSR/Extended Preemptive BSR is triggered and does not include the volume of data currently available in the IAB-MT. Preemptive BSR format is identical to the Long BSR format. Extended Pre-emptive BSR format is identical to the Extended Long BSR format.

NOTE 1: For the Pre-emptive BSR, if configured, the LCGs to be reported, the expected data volume calculation, the exact time to report Pre-emptive BSR and the associated LCH are left to implementation.

NOTE 2: The mapping of LCGs between the ingress and egress links of an IAB node for purposes of determining expected change in occupancy of IAB-MT buffers (to be reported as Pre-emptive BSR) is left to implementation.

NOTE 3: The number of the Buffer Size fields in the Long BSR, Extended Long BSR, Long Truncated BSR, and Extended Long Truncated BSR format can be zero.

NOTE 4: The Extended versions of the BSR formats can only be used by IAB nodes.

Figure 6.1.3.1-1: Short BSR and Short Truncated BSR MAC CE

ETSI


--- Page 212  ---


3GPP TS 38.321 version 18.2.0 Release 18
211
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.1-2: Long BSR, Long Truncated BSR, and Pre-emptive BSR MAC CE

Figure 6.1.3.1-3: Extended Short BSR and Extended Short Truncated BSR MAC CE

Figure 6.1.3.1-4: Extended Long BSR, Extended Long Truncated BSR, and Extended Pre-emptive BSR MAC CE

ETSI


--- Page 213  ---


3GPP TS 38.321 version 18.2.0 Release 18
212
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.1-5: Refined Long BSR MAC CE

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.1.3.1-1: Buffer size levels (in bytes) for 5-bit Buffer Size field}
\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline Index & BS value & Index & BS value & Index & BS value & Index & BS value \\
\hline 0 & 0 & 8 & \( \leq 102 \) & 16 & \( \leq 1446 \) & 24 & \( \leq 20516 \) \\
\hline 1 & \( \leq 10 \) & 9 & \( \leq 142 \) & 17 & \( \leq 2014 \) & 25 & \( \leq 28581 \) \\
\hline 2 & \( \leq 14 \) & 10 & \( \leq 198 \) & 18 & \( \leq 2806 \) & 26 & \( \leq 39818 \) \\
\hline 3 & \( \leq 20 \) & 11 & \( \leq 276 \) & 19 & \( \leq 3909 \) & 27 & \( \leq 55474 \) \\
\hline 4 & \( \leq 28 \) & 12 & \( \leq 384 \) & 20 & \( \leq 5446 \) & 28 & \( \leq 77284 \) \\
\hline 5 & \( \leq 38 \) & 13 & \( \leq 535 \) & 21 & \( \leq 7587 \) & 29 & \( \leq 107669 \) \\
\hline 6 & \( \leq 53 \) & 14 & \( \leq 745 \) & 22 & \( \leq 10570 \) & 30 & \( \leq 150000 \) \\
\hline 7 & \( \leq 74 \) & 15 & \( \leq 1038 \) & 23 & \( \leq 14726 \) & 31 & > 150000 \\
\hline
\end{tabular}
\end{table}

ETSI


--- Page 214  ---


3GPP TS 38.321 version 18.2.0 Release 18
213
ETSI TS 138321 V18.2.0 (2024-08)

Table 6.1.3.1-2: Buffer size levels (in bytes) for 8-bit Buffer Size field

ETSI


--- Page 215  ---


3GPP TS 38.321 version 18.2.0 Release 18
214
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline Index & BS value & Index & BS value & Index & BS value & Index & BS value \\
\hline 0 & 0 & 64 & \( \leq 560 \) & 128 & \( \leq 31342 \) & 192 & \( \leq 1754595 \) \\
\hline 1 & \( \leq 10 \) & 65 & \( \leq 597 \) & 129 & \( \leq 33376 \) & 193 & \( \leq 1868488 \) \\
\hline 2 & \( \leq 11 \) & 66 & \( \leq 635 \) & 130 & \( \leq 35543 \) & 194 & \( \leq 1989774 \) \\
\hline 3 & \( \leq 12 \) & 67 & \( \leq 677 \) & 131 & \( \leq 37850 \) & 195 & \( \leq 2118933 \) \\
\hline 4 & \( \leq 13 \) & 68 & \( \leq 720 \) & 132 & \( \leq 40307 \) & 196 & \( \leq 2256475 \) \\
\hline 5 & \( \leq 14 \) & 69 & \( \leq 767 \) & 133 & \( \leq 42923 \) & 197 & \( \leq 2402946 \) \\
\hline 6 & \( \leq 15 \) & 70 & \( \leq 817 \) & 134 & \( \leq 45709 \) & 198 & \( \leq 2558924 \) \\
\hline 7 & \( \leq 16 \) & 71 & \( \leq 870 \) & 135 & \( \leq 48676 \) & 199 & \( \leq 2725027 \) \\
\hline 8 & \( \leq 17 \) & 72 & \( \leq 926 \) & 136 & \( \leq 51836 \) & 200 & \( \leq 2901912 \) \\
\hline 9 & \( \leq 18 \) & 73 & \( \leq 987 \) & 137 & \( \leq 55200 \) & 201 & \( \leq 3090279 \) \\
\hline 10 & \( \leq 19 \) & 74 & \( \leq 1051 \) & 138 & \( \leq 58784 \) & 202 & \( \leq 3290873 \) \\
\hline 11 & \( \leq 20 \) & 75 & \( \leq 1119 \) & 139 & \( \leq 62599 \) & 203 & \( \leq 3504487 \) \\
\hline 12 & \( \leq 22 \) & 76 & \( \leq 1191 \) & 140 & \( \leq 66663 \) & 204 & \( \leq 3731968 \) \\
\hline 13 & \( \leq 23 \) & 77 & \( \leq 1269 \) & 141 & \( \leq 70990 \) & 205 & \( \leq 3974215 \) \\
\hline 14 & \( \leq 25 \) & 78 & \( \leq 1351 \) & 142 & \( \leq 75598 \) & 206 & \( \leq 4232186 \) \\
\hline 15 & \( \leq 26 \) & 79 & \( \leq 1439 \) & 143 & \( \leq 80505 \) & 207 & \( \leq 4506902 \) \\
\hline 16 & \( \leq 28 \) & 80 & \( \leq 1532 \) & 144 & \( \leq 85730 \) & 208 & \( \leq 4799451 \) \\
\hline 17 & \( \leq 30 \) & 81 & \( \leq 1631 \) & 145 & \( \leq 91295 \) & 209 & \( \leq 5110989 \) \\
\hline 18 & \( \leq 32 \) & 82 & \( \leq 1737 \) & 146 & \( \leq 97221 \) & 210 & \( \leq 5442750 \) \\
\hline 19 & \( \leq 34 \) & 83 & \( \leq 1850 \) & 147 & \( \leq 103532 \) & 211 & \( \leq 5796046 \) \\
\hline 20 & \( \leq 36 \) & 84 & \( \leq 1970 \) & 148 & \( \leq 110252 \) & 212 & \( \leq 6172275 \) \\
\hline 21 & \( \leq 38 \) & 85 & \( \leq 2098 \) & 149 & \( \leq 117409 \) & 213 & \( \leq 6572925 \) \\
\hline 22 & \( \leq 40 \) & 86 & \( \leq 2234 \) & 150 & \( \leq 125030 \) & 214 & \( \leq 6999582 \) \\
\hline 23 & \( \leq 43 \) & 87 & \( \leq 2379 \) & 151 & \( \leq 133146 \) & 215 & \( \leq 7453933 \) \\
\hline 24 & \( \leq 46 \) & 88 & \( \leq 2533 \) & 152 & \( \leq 141789 \) & 216 & \( \leq 7937777 \) \\
\hline 25 & \( \leq 49 \) & 89 & \( \leq 2698 \) & 153 & \( \leq 150992 \) & 217 & \( \leq 8453028 \) \\
\hline 26 & \( \leq 52 \) & 90 & \( \leq 2873 \) & 154 & \( \leq 160793 \) & 218 & \( \leq 9001725 \) \\
\hline 27 & \( \leq 55 \) & 91 & \( \leq 3059 \) & 155 & \( \leq 171231 \) & 219 & \( \leq 9586039 \) \\
\hline 28 & \( \leq 59 \) & 92 & \( \leq 3258 \) & 156 & \( \leq 182345 \) & 220 & \( \leq 10208280 \) \\
\hline 29 & \( \leq 62 \) & 93 & \( \leq 3469 \) & 157 & \( \leq 194182 \) & 221 & \( \leq 10870913 \) \\
\hline 30 & \( \leq 66 \) & 94 & \( \leq 3694 \) & 158 & \( \leq 206786 \) & 222 & \( \leq 11576557 \) \\
\hline 31 & \( \leq 71 \) & 95 & \( \leq 3934 \) & 159 & \( \leq 220209 \) & 223 & \( \leq 12328006 \) \\
\hline 32 & \( \leq 75 \) & 96 & \( \leq 4189 \) & 160 & \( \leq 234503 \) & 224 & \( \leq 13128233 \) \\
\hline 33 & \( \leq 80 \) & 97 & \( \leq 4461 \) & 161 & \( \leq 249725 \) & 225 & \( \leq 13980403 \) \\
\hline 34 & \( \leq 85 \) & 98 & \( \leq 4751 \) & 162 & \( \leq 265935 \) & 226 & \( \leq 14887889 \) \\
\hline 35 & \( \leq 91 \) & 99 & \( \leq 5059 \) & 163 & \( \leq 283197 \) & 227 & \( \leq 15854280 \) \\
\hline 36 & \( \leq 97 \) & 100 & \( \leq 5387 \) & 164 & \( \leq 301579 \) & 228 & \( \leq 16883401 \) \\
\hline 37 & \( \leq 103 \) & 101 & \( \leq 5737 \) & 165 & \( \leq 321155 \) & 229 & \( \leq 17979324 \) \\
\hline 38 & \( \leq 110 \) & 102 & \( \leq 6109 \) & 166 & \( \leq 342002 \) & 230 & \( \leq 19146385 \) \\
\hline 39 & \( \leq 117 \) & 103 & \( \leq 6506 \) & 167 & \( \leq 364202 \) & 231 & \( \leq 20389201 \) \\
\hline 40 & \( \leq 124 \) & 104 & \( \leq 6928 \) & 168 & \( \leq 387842 \) & 232 & \( \leq 21712690 \) \\
\hline 41 & \( \leq 132 \) & 105 & \( \leq 7378 \) & 169 & \( \leq 413018 \) & 233 & \( \leq 23122088 \) \\
\hline 42 & \( \leq 141 \) & 106 & \( \leq 7857 \) & 170 & \( \leq 439827 \) & 234 & \( \leq 24622972 \) \\
\hline 43 & \( \leq 150 \) & 107 & \( \leq 8367 \) & 171 & \( \leq 468377 \) & 235 & \( \leq 26221280 \) \\
\hline 44 & \( \leq 160 \) & 108 & \( \leq 8910 \) & 172 & \( \leq 498780 \) & 236 & \( \leq 27923336 \) \\
\hline 45 & \( \leq 170 \) & 109 & \( \leq 9488 \) & 173 & \( \leq 531156 \) & 237 & \( \leq 29735875 \) \\
\hline 46 & \( \leq 181 \) & 110 & \( \leq 10104 \) & 174 & \( \leq 565634 \) & 238 & \( \leq 31666069 \) \\
\hline 47 & \( \leq 193 \) & 111 & \( \leq 10760 \) & 175 & \( \leq 602350 \) & 239 & \( \leq 33721553 \) \\
\hline 48 & \( \leq 205 \) & 112 & \( \leq 11458 \) & 176 & \( \leq 641449 \) & 240 & \( \leq 35910462 \) \\
\hline 49 & \( \leq 218 \) & 113 & \( \leq 12202 \) & 177 & \( \leq 683087 \) & 241 & \( \leq 38241455 \) \\
\hline 50 & \( \leq 233 \) & 114 & \( \leq 12994 \) & 178 & \( \leq 727427 \) & 242 & \( \leq 40723756 \) \\
\hline 51 & \( \leq 248 \) & 115 & \( \leq 13838 \) & 179 & \( \leq 774645 \) & 243 & \( \leq 43367187 \) \\
\hline 52 & \( \leq 264 \) & 116 & \( \leq 14736 \) & 180 & \( \leq 824928 \) & 244 & \( \leq 46182206 \) \\
\hline 53 & \( \leq 281 \) & 117 & \( \leq 15692 \) & 181 & \( \leq 878475 \) & 245 & \( \leq 49179951 \) \\
\hline 54 & \( \leq 299 \) & 118 & \( \leq 16711 \) & 182 & \( \leq 935498 \) & 246 & \( \leq 52372284 \) \\
\hline 55 & \( \leq 318 \) & 119 & \( \leq 17795 \) & 183 & \( \leq 996222 \) & 247 & \( \leq 55771835 \) \\
\hline 56 & \( \leq 339 \) & 120 & \( \leq 18951 \) & 184 & \( \leq 1060888 \) & 248 & \( \leq 59392055 \) \\
\hline 57 & \( \leq 361 \) & 121 & \( \leq 20181 \) & 185 & \( \leq 1129752 \) & 249 & \( \leq 63247269 \) \\
\hline 58 & \( \leq 384 \) & 122 & \( \leq 21491 \) & 186 & \( \leq 1203085 \) & 250 & \( \leq 67352729 \) \\
\hline 59 & \( \leq 409 \) & 123 & \( \leq 22885 \) & 187 & \( \leq 1281179 \) & 251 & \( \leq 71724679 \) \\
\hline 60 & \( \leq 436 \) & 124 & \( \leq 24371 \) & 188 & \( \leq 1364342 \) & 252 & \( \leq 76380419 \) \\
\hline 61 & \( \leq 464 \) & 125 & \( \leq 25953 \) & 189 & \( \leq 1452903 \) & 253 & \( \leq 81338368 \) \\
\hline 62 & \( \leq 494 \) & 126 & \( \leq 27638 \) & 190 & \( \leq 1547213 \) & 254 & > 81338368 \\
\hline 63 & \( \leq 526 \) & 127 & \( \leq 29431 \) & 191 & \( \leq 1647644 \) & 255 & Reserved \\
\hline
\end{tabular}

ETSI


--- Page 216  ---


3GPP TS 38.321 version 18.2.0 Release 18
215
ETSI TS 138321 V18.2.0 (2024-08)
ETSI


--- Page 217  ---


3GPP TS 38.321 version 18.2.0 Release 18
216
ETSI TS 138321 V18.2.0 (2024-08)

Table 6.1.3.1-3. Refined buffer size levels (in bytes) for 8-bit Buffer Size field

ETSI


--- Page 218  ---


3GPP TS 38.321 version 18.2.0 Release 18
217
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline Index & BS value & Index & BS value & Index & BS Value & Index & BS Value \\
\hline 0 & > 4751 and \( \leq 5000 \) & 64 & \( \leq 17584 \) & 128 & \( \leq 61841 \) & 192 & \( \leq 217489 \) \\
\hline 1 & \( \leq 5099 \) & 65 & \( \leq 17933 \) & 129 & \( \leq 63069 \) & 193 & \( \leq 221805 \) \\
\hline 2 & \( \leq 5200 \) & 66 & \( \leq 18289 \) & 130 & \( \leq 64320 \) & 194 & \( \leq 226207 \) \\
\hline 3 & \( \leq 5303 \) & 67 & \( \leq 18652 \) & 131 & \( \leq 65596 \) & 195 & \( \leq 230695 \) \\
\hline 4 & \( \leq 5408 \) & 68 & \( \leq 19022 \) & 132 & \( \leq 66898 \) & 196 & \( \leq 235273 \) \\
\hline 5 & \( \leq 5516 \) & 69 & \( \leq 19399 \) & 133 & \( \leq 68226 \) & 197 & \( \leq 239942 \) \\
\hline 6 & \( \leq 5625 \) & 70 & \( \leq 19784 \) & 134 & \( \leq 69580 \) & 198 & \( \leq 244703 \) \\
\hline 7 & \( \leq 5737 \) & 71 & \( \leq 20177 \) & 135 & \( \leq 70960 \) & 199 & \( \leq 249559 \) \\
\hline 8 & \( \leq 5851 \) & 72 & \( \leq 20577 \) & 136 & \( \leq 72368 \) & 200 & \( \leq 254511 \) \\
\hline 9 & \( \leq 5967 \) & 73 & \( \leq 20985 \) & 137 & \( \leq 73804 \) & 201 & \( \leq 259562 \) \\
\hline 10 & \( \leq 6085 \) & 74 & \( \leq 21402 \) & 138 & \( \leq 75269 \) & 202 & \( \leq 264713 \) \\
\hline 11 & \( \leq 6206 \) & 75 & \( \leq 21827 \) & 139 & \( \leq 76763 \) & 203 & \( \leq 269966 \) \\
\hline 12 & \( \leq 6329 \) & 76 & \( \leq 22260 \) & 140 & \( \leq 78286 \) & 204 & \( \leq 275323 \) \\
\hline 13 & \( \leq 6455 \) & 77 & \( \leq 22702 \) & 141 & \( \leq 79839 \) & 205 & \( \leq 280786 \) \\
\hline 14 & \( \leq 6583 \) & 78 & \( \leq 23152 \) & 142 & \( \leq 81424 \) & 206 & \( \leq 286358 \) \\
\hline 15 & \( \leq 6713 \) & 79 & \( \leq 23611 \) & 143 & \( \leq 83040 \) & 207 & \( \leq 292041 \) \\
\hline 16 & \( \leq 6847 \) & 80 & \( \leq 24080 \) & 144 & \( \leq 84687 \) & 208 & \( \leq 297836 \) \\
\hline 17 & \( \leq 6983 \) & 81 & \( \leq 24558 \) & 145 & \( \leq 86368 \) & 209 & \( \leq 303746 \) \\
\hline 18 & \( \leq 7121 \) & 82 & \( \leq 25045 \) & 146 & \( \leq 88082 \) & 210 & \( \leq 309774 \) \\
\hline 19 & \( \leq 7262 \) & 83 & \( \leq 25542 \) & 147 & \( \leq 89830 \) & 211 & \( \leq 315921 \) \\
\hline 20 & \( \leq 7407 \) & 84 & \( \leq 26049 \) & 148 & \( \leq 91612 \) & 212 & \( \leq 322190 \) \\
\hline 21 & \( \leq 7554 \) & 85 & \( \leq 26566 \) & 149 & \( \leq 93430 \) & 213 & \( \leq 328583 \) \\
\hline 22 & \( \leq 7703 \) & 86 & \( \leq 27093 \) & 150 & \( \leq 95284 \) & 214 & \( \leq 335104 \) \\
\hline 23 & \( \leq 7856 \) & 87 & \( \leq 27631 \) & 151 & \( \leq 97175 \) & 215 & \( \leq 341754 \) \\
\hline 24 & \( \leq 8012 \) & 88 & \( \leq 28179 \) & 152 & \( \leq 99103 \) & 216 & \( \leq 348535 \) \\
\hline 25 & \( \leq 8171 \) & 89 & \( \leq 28738 \) & 153 & \( \leq 101070 \) & 217 & \( \leq 355452 \) \\
\hline 26 & \( \leq 8333 \) & 90 & \( \leq 29309 \) & 154 & \( \leq 103076 \) & 218 & \( \leq 362505 \) \\
\hline 27 & \( \leq 8499 \) & 91 & \( \leq 29890 \) & 155 & \( \leq 105121 \) & 219 & \( \leq 369699 \) \\
\hline 28 & \( \leq 8667 \) & 92 & \( \leq 30483 \) & 156 & \( \leq 107207 \) & 220 & \( \leq 377035 \) \\
\hline 29 & \( \leq 8839 \) & 93 & \( \leq 31088 \) & 157 & \( \leq 109335 \) & 221 & \( \leq 384517 \) \\
\hline 30 & \( \leq 9015 \) & 94 & \( \leq 31705 \) & 158 & \( \leq 111504 \) & 222 & \( \leq 392147 \) \\
\hline 31 & \( \leq 9194 \) & 95 & \( \leq 32334 \) & 159 & \( \leq 113717 \) & 223 & \( \leq 399929 \) \\
\hline 32 & \( \leq 9376 \) & 96 & \( \leq 32976 \) & 160 & \( \leq 115973 \) & 224 & \( \leq 407865 \) \\
\hline 33 & \( \leq 9562 \) & 97 & \( \leq 33630 \) & 161 & \( \leq 118275 \) & 225 & \( \leq 415959 \) \\
\hline 34 & \( \leq 9752 \) & 98 & \( \leq 34298 \) & 162 & \( \leq 120622 \) & 226 & \( \leq 424213 \) \\
\hline 35 & \( \leq 9946 \) & 99 & \( \leq 34978 \) & 163 & \( \leq 123016 \) & 227 & \( \leq 432631 \) \\
\hline 36 & \( \leq 10143 \) & 100 & \( \leq 35672 \) & 164 & \( \leq 125457 \) & 228 & \( \leq 441216 \) \\
\hline 37 & \( \leq 10344 \) & 101 & \( \leq 36380 \) & 165 & \( \leq 127946 \) & 229 & \( \leq 449971 \) \\
\hline 38 & \( \leq 10549 \) & 102 & \( \leq 37102 \) & 166 & \( \leq 130485 \) & 230 & \( \leq 458900 \) \\
\hline 39 & \( \leq 10759 \) & 103 & \( \leq 37839 \) & 167 & \( \leq 133074 \) & 231 & \( \leq 468007 \) \\
\hline 40 & \( \leq 10972 \) & 104 & \( \leq 38589 \) & 168 & \( \leq 135715 \) & 232 & \( \leq 477294 \) \\
\hline 41 & \( \leq 11190 \) & 105 & \( \leq 39355 \) & 169 & \( \leq 138408 \) & 233 & \( \leq 486765 \) \\
\hline 42 & \( \leq 11412 \) & 106 & \( \leq 40136 \) & 170 & \( \leq 141155 \) & 234 & \( \leq 496425 \) \\
\hline 43 & \( \leq 11639 \) & 107 & \( \leq 40933 \) & 171 & \( \leq 143956 \) & 235 & \( \leq 506276 \) \\
\hline 44 & \( \leq 11870 \) & 108 & \( \leq 41745 \) & 172 & \( \leq 146813 \) & 236 & \( \leq 516322 \) \\
\hline 45 & \( \leq 12105 \) & 109 & \( \leq 42573 \) & 173 & \( \leq 149726 \) & 237 & \( \leq 526568 \) \\
\hline 46 & \( \leq 12345 \) & 110 & \( \leq 43418 \) & 174 & \( \leq 152697 \) & 238 & \( \leq 537017 \) \\
\hline 47 & \( \leq 12590 \) & 111 & \( \leq 44280 \) & 175 & \( \leq 155727 \) & 239 & \( \leq 547674 \) \\
\hline 48 & \( \leq 12840 \) & 112 & \( \leq 45158 \) & 176 & \( \leq 158817 \) & 240 & \( \leq 558542 \) \\
\hline 49 & \( \leq 13095 \) & 113 & \( \leq 46055 \) & 177 & \( \leq 161969 \) & 241 & \( \leq 569625 \) \\
\hline 50 & \( \leq 13355 \) & 114 & \( \leq 46968 \) & 178 & \( \leq 165183 \) & 242 & \( \leq 580929 \) \\
\hline 51 & \( \leq 13620 \) & 115 & \( \leq 47900 \) & 179 & \( \leq 168461 \) & 243 & \( \leq 592457 \) \\
\hline 52 & \( \leq 13890 \) & 116 & \( \leq 48851 \) & 180 & \( \leq 171804 \) & 244 & \( \leq 604213 \) \\
\hline 53 & \( \leq 14166 \) & 117 & \( \leq 49820 \) & 181 & \( \leq 175213 \) & 245 & \( \leq 616203 \) \\
\hline 54 & \( \leq 14447 \) & 118 & \( \leq 50809 \) & 182 & \( \leq 178690 \) & 246 & \( \leq 628431 \) \\
\hline 55 & \( \leq 14734 \) & 119 & \( \leq 51817 \) & 183 & \( \leq 182236 \) & 247 & \( \leq 640902 \) \\
\hline 56 & \( \leq 15026 \) & 120 & \( \leq 52846 \) & 184 & \( \leq 185852 \) & 248 & \( \leq 653620 \) \\
\hline 57 & \( \leq 15324 \) & 121 & \( \leq 53894 \) & 185 & \( \leq 189540 \) & 249 & \( \leq 666590 \) \\
\hline 58 & \( \leq 15628 \) & 122 & \( \leq 54964 \) & 186 & \( \leq 193302 \) & 250 & \( \leq 679818 \) \\
\hline 59 & \( \leq 15938 \) & 123 & \( \leq 56054 \) & 187 & \( \leq 197137 \) & 251 & \( \leq 693308 \) \\
\hline 60 & \( \leq 16255 \) & 124 & \( \leq 57167 \) & 188 & \( \leq 201049 \) & 252 & \( \leq 707066 \) \\
\hline 61 & \( \leq 16577 \) & 125 & \( \leq 58301 \) & 189 & \( \leq 205039 \) & 253 & \( \leq 721097 \) \\
\hline 62 & \( \leq 16906 \) & 126 & \( \leq 59458 \) & 190 & \( \leq 209108 \) & 254 & \( \leq 735406 \) \\
\hline 63 & \( \leq 17242 \) & 127 & \( \leq 60638 \) & 191 & \( \leq 213257 \) & 255 & \( \leq 750000 \) \\
\hline
\end{tabular}

ETSI


--- Page 219  ---


3GPP TS 38.321 version 18.2.0 Release 18
218
ETSI TS 138321 V18.2.0 (2024-08)
6.1.3.2 C-RNTI MAC CE

The C-RNTI MAC CE is identified by MAC subheader with LCID as specified in Table 6.2.1-2.
It has a fixed size and consists of a single field defined as follows (Figure 6.1 3.2-1):
- C-RNTI: This field contains the C-RNTI of the MAC entity. The length of the field is 16 bits.

Figure 6.1.3.2-1: C-RNTI MAC CE
6.1.3.3 UE Contention Resolution Identity MAC CE

The UE Contention Resolution Identity MAC CE is identified by MAC subheader with LCID as specified in Table 6.2.1-1.

It has a fixed 48-bit size and consists of a single field defined as follows (Figure 6.1 3.3-1):
- UE Contention Resolution Identity: This field contains the UL CCCH SDU. If the UL CCCH SDU is longer than 48 bits, this field contains the first 48 bits of the UL CCCH SDU.

Figure 6.1.3.3-1: UE Contention Resolution Identity MAC CE
6.1.3.4 Timing Advance Command MAC CE

The Timing Advance Command MAC CE is identified by MAC subheader with LCID as specified in Table 6.2.1-1.
It has a fixed size and consists of a single octet defined as follows (Figure 6.1.3.4-1):
- TAG Identity (TAG ID): This field indicates the TAG Identity of the addressed TAG. The TAG with the Identity 0 contains the SpCell. The length of the field is 2 bits;
- Timing Advance Command: This field indicates the index value \( T_{A}(0,1,2 \ldots 63) \) used to control the amount of timing adjustment that MAC entity has to apply (as specified in TS 38.213 [6]). The length of the field is 6 bits.

ETSI


--- Page 220  ---


3GPP TS 38.321 version 18.2.0 Release 18
219
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.4-1: Timing Advance Command MAC CE
6.1.3.4a Absolute Timing Advance Command MAC CE

The Absolute Timing Advance Command MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b.

It has a fixed size and consists of two octets defined as follows (Figure 6.1.3.4a-1):
- Timing Advance Command: This field indicates the index value TA used to control the amount of timing adjustment that the MAC entity has to apply in TS 38.213 [6]. The size of the field is 12 bits;
- TI: If two TAGs are configured for the SpCell, this field indicates one of the two TAGs to which the Timing Advance Command is applied. If tag2-flag is set to true by upper layers, the field set to 0 indicates the tag2-Id and the field set to 1 indicates the tag-Id of the SpCell, otherwise the field set to 0 indicates the tag-Id and the field set to 1 indicates the tag2-Id of the SpCell. If the SpCell is not configured with two TAGs, the R bit is present instead;
- R: Reserved bit, set to 0 .

Figure 6.1.3.4a-1: Absolute Timing Advance Command MAC CE
6.1.3.5 DRX Command MAC CE

The DRX Command MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1.
It has a fixed size of zero bits.
6.1.3.6 Long DRX Command MAC CE

The Long DRX Command MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1.
It has a fixed size of zero bits.
6.1.3.7 Configured Grant Confirmation MAC CE

The Configured Grant Confirmation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.12.

It has a fixed size of zero bits.
6.1.3.8 Single Entry PHR MAC CE

The Single Entry PHR MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-2.
It has a fixed size and consists of two octets defined as follows (figure 6.1.3.8-1):
- R: Reserved bit, set to 0 ;

ETSI


--- Page 221  ---


3GPP TS 38.321 version 18.2.0 Release 18
220
ETSI TS 138321 V18.2.0 (2024-08)
- Power Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 below (the corresponding measured values in dB are specified in TS 38.133 [11]);
- P: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than PMPR_00 as specified in TS 38.133 [11] and to 1 otherwise. [f mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by \( \mathrm{P}^{-} \mathrm{MPR}_{\mathrm{c}} \) as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}, \mathrm{C}} \) field would have had a different value if no power backoff due to power management had been applied;
- \( \mathrm{P}_{\text {CMAX, } 5, \mathrm{C}} \) : This field indicates the \( \mathrm{P}_{\text {CMAX, } 5, \mathrm{C}} \) (as specified in TS 38.213 [6]) used for calculation of the preceding PH field. The reported \( \mathrm{P}_{\text {CMAX, }, \mathrm{c}} \) and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm are specified in TS 38.133 [11]);
- MPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to 0, R bits or DPC is present instead;
- DPC: [f dpc-Reporting-FR] is configured, and the Serving Cell operates on FR1, this field indicates the \( \Delta \mathrm{P}_{\text {PowerClass, }} \) as specified in TS 38.101-1[14] and TS 38.101-3 [16]. This field indicates an index to Table 6.1.3.84 and the corresponding measured values of DPC levels in dB are specified in TS 38.133 [11], the DPC field is set to 0 if the criteria to report DPC is not met. The length of the field is 2 bits. If the Serving Cell operates on FR2, R bits or MPE is present instead.

Figure 6.1.3.8-1: Single Entry PHR MAC CE

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.1.3.8-1: Power Headroom levels for PHR}
\begin{tabular}{|c|c|}
\hline \( \mathbf{P H} \) & Power Headroom Level \\
\hline 0 & POWER_HEADROOM_0 \\
\hline 1 & POWER_HEADROOM_1 \\
\hline 2 & POWER_HEADROOM_2 \\
\hline 3 & POWER_HEADROOM_3 \\
\hline\( \ldots \) & \( \ldots \) \\
\hline 60 & POWER_HEADROOM_60 \\
\hline 61 & POWER_HEADROOM_61 \\
\hline 62 & POWER_HEADROOM_62 \\
\hline 63 & POWER_HEADROOM_63 \\
\hline
\end{tabular}
\end{table}

ETSI


--- Page 222  ---


3GPP TS 38.321 version 18.2.0 Release 18
221
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.1.3.8-2: Nominal UE transmit power level for PHR}
\begin{tabular}{|l|l|}
\hline Pcmax,t,c & Nominal UE transmit power level \\
\hline 0 & PCMAX_C_00 \\
\hline 1 & PCMAX_C_01 \\
\hline 2 & PCMAX_C_02 \\
\hline … & … \\
\hline 61 & PCMAX_C_61 \\
\hline 62 & PCMAX_C_62 \\
\hline 63 & PCMAX_C_63 \\
\hline
\end{tabular}
\end{table}

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.1.3.8-3: Effective power reduction for MPE P-MPR}
\begin{tabular}{|c|c|}
\hline MPE & Measured P-MPR value \\
\hline 0 & P-MPR 00 \\
\hline 1 & P-MPR_01 \\
\hline 2 & P-MPR_02 \\
\hline 3 & P-MPR_03 \\
\hline
\end{tabular}
\end{table}

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.1.3.8-4: Delta power class for DPC}
\begin{tabular}{|c|c|}
\hline DPC & Measured DPC value \\
\hline 0 & reserved \\
\hline 1 & DPC_00 \\
\hline 2 & DPC_03 \\
\hline 3 & DPC_06 \\
\hline
\end{tabular}
\end{table}
6.1.3.9 Multiple Entry PHR MAC CE

The Multiple Entry PHR MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-2.
It has a variable size, and includes the bitmap, a Type 2 PH field and an octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{IC}} \) field (if reported) for SpCell of the other MAC entity, a Type 1 PH field and an octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) field (if reported) for the PCell. It further includes, in ascending order based on the ServCellIndex, one or multiple of Type X PH fields and octets containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}, \mathrm{C}} \) fields (if reported) for Serving Cells other than PCell indicated in the bitmap. X is either 1 or 3 according to TS 38.213 [6] and TS 36.213 [17].

The presence of Type 2 PH field for SpCell of the other MAC entity is configured by phr-Type2OtherCell with value true.

A single octet bitmap is used for indicating the presence of PH per Serving Cell when the highest ServCellIndex of Serving Cell with configured uplink is less than 8, otherwise four octets are used.

The MAC entity determines whether PH value for an activated Serving Cell is based on real transmission or a reference format by considering the configured grant(s) and downlink control information which has been received until and including the PDCCH occasion in which the first UL grant for a new transmission that can accommodate the MAC CE for PHR as a result of LCP as defined in clause 5.4.3.1 is received since a PHR has been triggered if the PHR MAC CE is reported on an uplink grant received on the PDCCH or until the first uplink symbol of PUSCH transmission minus PUSCH preparation time as defined in clause 7.7 of TS 38.213 [6] if the PHR MAC CE is reported on a configured grant.

For a band combination in which the UE does not support dynamic power sharing, the UE may omit the octets containing Power Headroom field and \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) field for Serving Cells in the other MAC entity except for the PCell in the other MAC entity and the reported values of Power Headroom and \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) for the PCell are up to UE implementation.

The PHR MAC CEs are defined as follows:

ETSI


--- Page 223  ---


3GPP TS 38.321 version 18.2.0 Release 18
222
ETSI TS 138321 V18.2.0 (2024-08)
- \( \mathrm{C}_{1} \) : This field indicates the presence of a PH field for the Serving Cell with ServCellIndex i as specified in TS 38.331 [5]. The \( \mathrm{C}_{1} \) field set to 1 indicates that a PH field for the Serving Cell with ServCellIndex i is reported. The \( \mathrm{C}_{1} \) field set to 0 indicates that a PH field for the Serving Cell with ServCellIndex \( i \) is not reported;
- R: Reserved bit, set to 0 ;
- \( \mathrm{DPC}_{\mathrm{BC}} \) : If dpc-Reporting-FRI is configured and at least one DPC field is not set to 0 , this field indicates the \( \Delta \mathrm{P}_{\text {PowerClass, } \mathrm{CA}} / \Delta \mathrm{P}_{\text {PowerClass, } \mathrm{EN}-\mathrm{DC}} / \Delta \mathrm{P}_{\text {PowerClass, } \mathrm{NR} \text {-dC }} \), as specified in TS 38.101-1[14] and TS 38.101-3 [16], this field set to 0 indicates the delta power class for band combination is 0 dB , this field set to 1 indicates the delta power class for band combination is same or larger than 3 dB . Otherwise, R bit is present, set to 0 ;
- V: This field indicates if the PH value is based on a real transmission or a reference format. For Type 1 PH, the V field set to 0 indicates real transmission on PUSCH and the V field set to 1 indicates that a PUSCH reference format is used. For Type 2 PH, the V field set to 0 indicates real transmission on PUCCH and the V field set to 1 indicates that a PUCCH reference format is used. For Type 3 PH , the V field set to 0 indicates real transmission on SRS and the V field set to 1 indicates that an SRS reference format is used. Furthermore, for Type 1, Type 2, and Type 3 PH , the V field set to 0 indicates the presence of the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}} \) field and the MPE or DPC field, and the V field set to 1 indicates that the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, 5, \mathrm{C}} \) field and the MPE or DPC field is omitted;
- Power Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dB for the E-UTRA Serving Cell are specified in TS 36.133 [12]);
- P: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than PMPR_00 as specified in TS 38.133 [11] and to 1 otherwise. [f mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by \( \mathrm{P}_{-} \mathrm{MPR}_{\mathrm{c}} \) as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) field would have had a different value if no power backoff due to power management had been applied;
- \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{JC}} \) : If present, this field indicates the \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{JC}} \) (as specified in TS 38.213 [6]) for the NR Serving Cell and the \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}} \) or \( \tilde{\mathrm{P}}_{\mathrm{CMAX}, \mathrm{C}} \) (as specified in TS 36.213 [17]) for the E-UTRA Serving Cell used for calculation of the preceding PH field. The reported \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dBm for the E-UTRA Serving Cell are specified in TS 36.133 [12]);
- MPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. [f mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to 0, R bits or DPC is present instead.
- DPC: If dpc-Reporting-FRI is configured, and the Serving Cell operates on FR1, this field indicates the \( \Delta \mathrm{P}_{\text {PowerClass, }} \) as specified in TS 38.101-1[14] and TS 38.101-3 [16]. This field indicates an index to Table 6.1.3.84 and the corresponding measured values of DPC levels in dB are specified in TS 38.133 [11], the DPC field is set to 0 if the criteria to report DPC is not met. The length of the field is 2 bits. If the Serving Cell operates on FR2, R bits or MPE is present instead.

ETSI


--- Page 224  ---


3GPP TS 38.321 version 18.2.0 Release 18
223
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{5} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & \( \mathrm{DPC}_{\mathrm{BC}} \) or R \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type 2, SpCell of the other MAC entity)} \\
\hline \multicolumn{2}{|c|}{MPE or DPC or R} & \multicolumn{6}{|c|}{Pamax,f,c 1} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type 1, PCell)} \\
\hline \multicolumn{2}{|c|}{MPE or DPC or R} & \multicolumn{6}{|c|}{Pomax,f,c 2} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type X, Serving Cell 1)} \\
\hline \multicolumn{2}{|c|}{MPE or DPC or R} & \multicolumn{6}{|c|}{Pomax,f,c 3} \\
\hline
\end{tabular}

\begin{table}
\begin{tabular}{|c|c|c|}
\hline P & V & PH (Type X, Serving Cell \( n \) ) \\
\hline \multicolumn{2}{|c|}{\begin{tabular}{c} 
MPE or \\
DPC or R
\end{tabular}} & Pomax, \( f, \mathrm{~m} \) \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{Figure 6.1.3.9-1: Multiple Entry PHR MAC CE with the highest ServCellindex of Serving Cell with configured uplink is less than 8}
\end{table}

ETSI


--- Page 225  ---


3GPP TS 38.321 version 18.2.0 Release 18
224
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline \multicolumn{8}{|c|}{} \\
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & \( \mathrm{DPC}_{\mathrm{BC}} \) or R \\
\hline \( \mathrm{C}_{15} \) & \( \mathrm{C}_{14} \) & \( \mathrm{C}_{13} \) & \( \mathrm{C}_{12} \) & \( \mathrm{C}_{11} \) & \( \mathrm{C}_{10} \) & \( \mathrm{C}_{9} \) & \( \mathrm{C}_{8} \) \\
\hline \( \mathrm{C}_{23} \) & \( \mathrm{C}_{22} \) & \( \mathrm{C}_{21} \) & \( \mathrm{C}_{20} \) & \( \mathrm{C}_{19} \) & \( \mathrm{C}_{18} \) & \( \mathrm{C}_{17} \) & \( \mathrm{C}_{16} \) \\
\hline \( \mathrm{C}_{31} \) & \( \mathrm{C}_{30} \) & \( \mathrm{C}_{29} \) & \( \mathrm{C}_{28} \) & \( \mathrm{C}_{27} \) & \( \mathrm{C}_{26} \) & \( \mathrm{C}_{25} \) & \( \mathrm{C}_{24} \) \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type 2, SpCell of the other MAC entity)} \\
\hline \multicolumn{2}{|c|}{MPE or DPC or R} & \multicolumn{6}{|c|}{Pamax,f,c 1} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type 1, PCell)} \\
\hline \multicolumn{2}{|c|}{MPE or DPC or R} & \multicolumn{6}{|c|}{Pomax,f,c 2} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type X, Serving Cell 1)} \\
\hline \multicolumn{2}{|c|}{MPE or DPC or R} & \multicolumn{6}{|c|}{Pomax,f,c 3} \\
\hline
\end{tabular}

\begin{tabular}{|c|c|c|}
\hline P & V & PH (Type X, Serving Cell \( n) \) \\
\hline \multicolumn{2}{|c|}{ MPE or } \\
DPC or R & Pomax, \( \mathrm{f}, \mathrm{m} \) \\
\hline
\end{tabular}

Figure 6.1.3.9-2: Multiple Entry PHR MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is equal to or higher than 8
6.1.3.10 SCell Activation/Deactivation MAC CEs

The SCell Activation/Deactivation MAC CE of one octet is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size and consists of a single octet containing seven C-fields and one R-field. The SCell Activation/Deactivation MAC CE with one octet is defined as follows (Figure 6.1.3.10-1).

The SCell Activation/Deactivation MAC CE of four octets is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size and consists of four octets containing 31 C -fields and one R-field. The SCell Activation/Deactivation MAC CE of four octets is defined as follows (Figure 6.1.3.10-2).
- \( \mathrm{C}_{1} \) : If there is an SCell configured for the MAC entity with SCellIndex i as specified in TS 38.331 [5], this field indicates the activation/deactivation status of the SCell with SCellIndex \( \mathrm{i}_{\text {, else the MAC entity shall ignore the } \mathrm{C}_{1}} \) field. The \( \mathrm{C}_{1} \) field is set to 1 to indicate that the SCell with SCellIndex i shall be activated. The \( \mathrm{C}_{1} \) field is set to 0 to indicate that the SCell with SCellIndex i shall be deactivated;
- R: Reserved bit, set to 0 .

Figure 6.1.3.10-1: SCell Activation/Deactivation MAC CE of one octet

ETSI


--- Page 226  ---


3GPP TS 38.321 version 18.2.0 Release 18
225
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.10-2: SCell Activation/Deactivation MAC CE of four octets

NOTE: If UE receives the SCell Activation/Deactivation MAC CE for an SCell configured with TRS for fast activation of the SCell, such TRS is not used for the corresponding SCell.
6.1.3.11 Duplication Activation/Deactivation MAC CE

The Duplication Activation/Deactivation MAC CE of one octet is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size and consists of a single octet containing eight D-fields. The Duplication Activation/Deactivation MAC CE is defined, for a MAC entity, as follows (Figure 6.1.3.11-1).
- \( D_{1} \) : This field indicates the activation/deactivation status of the PDCP duplication of DRB \( i \) where \( i \) is the ascending order of the DRB ID among the DRBs configured with PDCP duplication and with RLC entity(ies) associated with this MAC entity. The \( \mathrm{D}_{1} \) field is set to 1 to indicate that the PDCP duplication of DRB i shall be activated. The \( \mathrm{D}_{1} \) field is set to 0 to indicate that the PDCP duplication of DRB i shall be deactivated.

Figure 6.1.3.11-1: Duplication Activation/Deactivation MAC CE

NOTE: The Duplication Activation/Deactivation MAC CE is not used if a DRB is configured with more than two RLC entities, i.e. with moreThanTwoRLC-DRB.
6.1.3.12 SP CSI-RS/CSI-IM Resource Set Activation/Deactivation MAC CE

The SP CSI-RS/CSI-IM Resource Set Activation/Deactivation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a variable size and consists of the following fields:
- A/D: This field indicates whether to activate or deactivate indicated SP CSI-RS and CSI-[M resource set(s). The field is set to 1 to indicate activation, otherwise it indicates deactivation;
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- SP CSI-RS resource set ID: This field contains an index of NZP-CSI-RS-ResourceSet containing Semi Persistent NZP CSI-RS resources, as specified in TS 38.331 [5], indicating the Semi Persistent NZP CSI-RS resource set, which shall be activated or deactivated. The length of the field is 6 bits;
- IM: This field indicates the presence of the octet containing SP CSI-IM resource set ID field. If the IM field is set to 1 , the octet containing SP CSI-IM resource set ID field is present. If IM field is set to 0 , the octet containing SP CSI-IM resource set ID field is not present;

ETSI


--- Page 227  ---


3GPP TS 38.321 version 18.2.0 Release 18
226
ETSI TS 138321 V18.2.0 (2024-08)
- SP CSI-IM resource set ID: This field contains an index of CSI-IM-ResourceSet containing Semi Persistent CSIIM resources, as specified in TS 38.331 [5], indicating the Semi Persistent CSI-[M resource set, which shall be activated or deactivated. The length of the field is 6 bits;
- TCI State [D1: This field contains TCI-Stateld, as specified in TS 38.331 [5], of a TCI State, which is used as QCL source for the resource within the Semi Persistent NZP CSI-RS resource set indicated by SP CSI-RS resource set ID field. TCI State [D0 indicates TCI State for the first resource within the set, TCI State [D1 for the second one and so on. The length of the field is 7 bits. If the \( A / D \) field is set to 0 , the octets containing TCI State ID field(s) are not present;
- R: Reserved bit, set to 0 .

Figure 6.1.3.12-1: SP CSI-RS/CSI-IM Resource Set Activation/Deactivation MAC CE
6.1.3.13 Aperiodic CSI Trigger State Subselection MAC CE

The Aperiodic CSI Trigger State Subselection MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a variable size consisting of following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- \( T_{1} \) : This field indicates the selection status of the Aperiodic Trigger States configured within aperiodicTriggerStateList, as specified in TS 38.331 [5]. \( \mathrm{T}_{0} \) refers to the first trigger state within the list, \( \mathrm{T}_{1} \) to the second one and so on. If the list does not contain entry with index i , MAC entity shall ignore the \( \mathrm{T}_{1} \) field. The T, field is set to 1 to indicate that the Aperiodic Trigger State i shall be mapped to the codepoint of the DCI CSI request field, as specified in TS 38.214 [7]. The codepoint to which the Aperiodic Trigger State is mapped is determined by its ordinal position among all the Aperiodic Trigger States with \( T_{1} \) field set to 1, i.e. the first Aperiodic Trigger State with \( \mathrm{T}_{1} \) field set to 1 shall be mapped to the codepoint value 1, second Aperiodic Trigger State with \( T_{1} \) field set to 1 shall be mapped to the codepoint value 2 and so on. The maximum number of mapped Aperiodic Trigger States is 63;
- R: Reserved bit, set to 0 .

ETSI


--- Page 228  ---


3GPP TS 38.321 version 18.2.0 Release 18
227
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.13-1: Aperiodic CSI Trigger State Subselection MAC CE
6.1.3.14 TCI States Activation/Deactivation for UE-specific PDSCH MAC CE

The TCI States Activation/Deactivation for UE-specific PDSCH MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a variable size consisting of following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneous TCI-UpdateListl or simultaneous TCI-UpdateList2 as specified in TS 38.331 [5], this MAC CE applies to all the Serving Cells configured in the set simultaneousTCI-UpdateListl or simultaneousTCI-UpdateList2, respectively;
- BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits. This field is ignored if this MAC CE applies to a set of Serving Cells;
- \( \mathrm{T}_{1} \) : If there is a TCI state with TCI-Stateld i as specified in TS 38.331 [5], this field indicates the activation/deactivation status of the TCI state with TCI-Stateld i , otherwise MAC entity shall ignore the \( \mathrm{T}_{1} \) field. The \( \mathrm{T}_{1} \) field is set to 1 to indicate that the TCI state with TCI-Stateld i shall be activated and mapped to the codepoint of the DCI Transmission Configuration Indication field, as specified in TS 38.214 [7]. The \( \mathrm{T}_{1} \) field is set to 0 to indicate that the TCI state with TCI-Stateld i shall be deactivated and is not mapped to the codepoint of the DCI Transmission Configuration Indication field. The codepoint to which the TCI State is mapped is determined by its ordinal position among all the TCI States with T , field set to 1 , i.e. the first TCI State with T , field set to 1 shall be mapped to the codepoint value 0 , second TCI State with \( T_{1} \) field set to 1 shall be mapped to the codepoint value 1 and so on. The maximum number of activated TCI states is 8 . The activated TCI states can be associated with at most one PCI different from the Serving Cell PCI at a time;
- CORESET Pool ID: This field indicates that mapping between the activated TCI states and the codepoint of the DCI Transmission Configuration Indication set by field \( \mathrm{T}_{1} \) is specific to the ControlResourceSetld configured with CORESET Pool ID as specified in TS 38.331 [5]. This field set to 1 indicates that this MAC CE shall be applied for the DL transmission scheduled by CORESET with the CORESET pool ID equal to 1 , otherwise, this MAC CE shall be applied for the DL transmission scheduled by CORESET pool ID equal to 0 . If the coresetPoollndex is not configured for any CORESET, MAC entity shall ignore the CORESET Pool ID field in this MAC CE when receiving the MAC CE. If the Serving Cell in the MAC CE is configured in a cell list that contains more than one Serving Cell, the CORSET Pool ID field shall be ignored when receiving the MAC CE.

ETSI


--- Page 229  ---


3GPP TS 38.321 version 18.2.0 Release 18
228
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.14-1: TCI States Activation/Deactivation for UE-specific PDSCH MAC CE
6.1.3.15 TCI State Indication for UE-specific PDCCH MAC CE

The TCI State Indication for UE-specific PDCCH MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size of 16 bits with following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneousTCI-UpdateListl or simultaneousTCI-UpdateList2 as specified in TS 38.331 [5], this MAC CE applies to all theServing Cells in the set simultaneousTCI-UpdateListl or simultaneousTCI-UpdateList2, respectively;
- CORESET ID: This field indicates a Control Resource Set identified with ControlResourceSetld as specified in TS 38.331 [5], for which the TCI State is being indicated. In case the value of the field is 0 , the field refers to the Control Resource Set configured by controlResourceSetZero as specified in TS 38.331 [5]. The length of the field is 4 bits;
- TCI State ID: This field indicates the TCI state identified by TCI-Stateld as specified in TS 38.331 [5] applicable to the Control Resource Set identified by CORESET ID field. If the field of CORESET ID is set to 0 , this field indicates a TCI-Stateld for a TCI state of the first 64 TCI-states configured by tci-StatesToAddModList and tciStatesToReleaseList in the PDSCH-Config in the active BWP or by dl-OrJoint-TCI-State-ToAddModList and dl-OrJoint-TCI-State-ToReleaseList in the PDSCH-Config in the active BWP or the reference BWP. If the field of CORESET ID is set to the other value than 0 , this field indicates a TCI-Stateld configured by tci-StatesPDCCHToAddList and tci-StatesPDCCH-ToReleaseList in the controlResourceSet identified by the indicated CORESET ID. The length of the field is 7 bits.

Figure 6.1.3.15-1: TCI State Indication for UE-specific PDCCH MAC CE
6.1.3.16 SP CSI reporting on PUCCH Activation/Deactivation MAC CE

The SP CSI reporting on PUCCH Activation/Deactivation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size of 16 bits with following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- BWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;

ETSI


--- Page 230  ---


3GPP TS 38.321 version 18.2.0 Release 18
229
ETSI TS 138321 V18.2.0 (2024-08)
- L: This field indciates whether the MAC CE applies to SP CSI reporting on PUCCH Activation/Deactivation for LTM or not. If Itm-CSI-ReportConfigToAddModList is not configured, R field is present instead (i.e. set to 0);
- \( \mathrm{S}_{1} \) : This field indicates the activation/deactivation status of the Semi-Persistent CSI report configuration within Itm-CSI-ReportConfigToAddModList if L field is set to 1 , or csi-ReportConfigToAddModList if L field is set to 0 , as specified in TS 38.331 [5]. \( \mathrm{S}_{0} \) refers to the report configuration which includes PUCCH resources for SP CSI reporting in the indicated BWP and has the lowest CSI-ReportConfigId or LTM-CSI-ReportConfigId within the list with type set to semiPersistentOnPUCCH, \( \mathrm{S}_{1} \) to the report configuration which includes PUCCH resources for SP CSI reporting in the indicated BWP and has the second lowest CSI-ReportConfigId or LTM-CSIReportConfigId and so on. If the number of report configurations within the list with type set to semiPersistentOnPUCCH in the indicated BWP is less than \( \mathrm{i}+1 \), MAC entity shall ignore the \( \mathrm{S}_{1} \) field. The \( \mathrm{S}_{1} \) field is set to 1 to indicate that the corresponding Semi-Persistent CSI report configuration shall be activated. The S , field is set to 0 to indicate that the corresponding Semi-Persistent CSI report configuration i shall be deactivated. If the Semi-Persistent CSI report configuration \( i \) is configured with csiReportSubConfigToAddModList, the \( \mathrm{S}_{1} \) field is set to 0 to additionally indicate that all sub-configurations within csi-ReportSubConfigToAddModList shall be deactivated;
- R: Reserved bit, set to 0 .

NOTE: If a Semi-Persistent CSI report configuration \( i \) is configured with csi-ReportSubConfigToAddModList, the corresponding \( S_{1} \) field is not set to 1 .

Figure 6.1.3.16-1: SP CSI reporting on PUCCH Activation/Deactivation MAC CE
6.1.3.17 SP SRS Activation/Deactivation MAC CE

The SP SRS Activation/Deactivation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a variable size with following fields:
- A/D: This field indicates whether to activate or deactivate indicated SP SRS resource set. The field is set to 1 to indicate activation, otherwise it indicates deactivation;
- SRS Resource Set's Cell ID: This field indicates the identity of the Serving Cell, which contains activated/deactivated SP SRS Resource Set. If the C field is set to 0 , this field also indicates the identity of the Serving Cell which contains all resources indicated by the Resource \( \left[D_{1}\right. \) fields. The length of the field is 5 bits;
- SRS Resource Set's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains activated/deactivated SP SRS Resource Set. If the C field is set to 0 , this field also indicates the identity of the BWP which contains all resources indicated by the Resource ID, fields. The length of the field is 2 bits;
- C: This field indicates whether the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present. If this field is set to 1 , the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present, otherwise they are not present;
- SUL: This field indicates whether the MAC CE applies to the NUL carrier or SUL carrier configuration. This field is set to 1 to indicate that it applies to the SUL carrier configuration, and it is set to 0 to indicate that it applies to the NUL carrier configuration;
- SP SRS Resource Set ID: This field indicates the SP SRS Resource Set ID identified by SRS-ResourceSetld as specified in TS 38.331 [5], which is to be activated or deactivated. The length of the field is 4 bits;
- \( F_{1} \) : This field indicates the type of a resource used as a spatial relationship for SRS resource within SP SRS Resource Set indicated with SP SRS Resource Set ID field. \( F_{0} \) refers to the first SRS resource within the resource set, \( F_{1} \) to the second one and so on. The field is set to 1 to indicate NZP CSI-RS resource index is used, and it is

ETSI


--- Page 231  ---


3GPP TS 38.321 version 18.2.0 Release 18
230
ETSI TS 138321 V18.2.0 (2024-08)

set to 0 to indicate either SSB index or SRS resource index is used. The length of the field is 1 bit. This field is only present if MAC CE is used for activation, i.e. the A/D field is set to 1 ;
- Resource ID: This field contains an identifier of the resource used for spatial relationship derivation for SRS resource i. Resource [D0 refers to the first SRS resource within the resource set, Resource [D1 to the second one and so on. If \( F_{1} \) is set to 0 , and the first bit of this field is set to 1 , the remainder of this field contains SSB-Index as specified in TS 38.331 [5]. If \( F_{1} \) is set to 0 , and the first bit of this field is set to 0 , the remainder of this field contains SRS-Resourceld as specified in TS 38.331 [5]. The length of the field is 7 bits. This field is only present if MAC CE is used for activation, i.e. the A/D field is set to 1;
- Resource Serving Cell [D]: This field indicates the identity of the Serving Cell on which the resource used for spatial relationship derivation for SRS resource \( i \) is located. The length of the field is 5 bits;
- Resource BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the resource used for spatial relationship derivation for SRS resource \( i \) is located. The length of the field is 2 bits;
- R: Reserved bit, set to 0 .

\begin{tabular}{|c|c|c|}
\hline\( F_{\mathrm{M}-1} \) & \multicolumn{2}{|c|}{ Resource \( \mathrm{ID}_{\mathrm{M}-1} \)} \\
\hline\( R \) & Resource Serving Cell ID & Oct N-M \\
\hline & \begin{tabular}{l} 
Resource \\
BWP ID
\end{tabular} & Oct N-M+1 \\
\hline
\end{tabular}

\begin{tabular}{|l|l|c|}
\hline\( R \) & Resource Serving Cell ID \( { }_{\mathrm{M}-1} \) & \begin{tabular}{c} 
Resource \\
BWP ID \( { }_{\mathrm{M}-1} \)
\end{tabular} \\
\hline
\end{tabular} Oct N

Figure 6.1.3.17-1: SP SRS Activation/Deactivation MAC CE
6.1.3.18 PUCCH spatial relation Activation/Deactivation MAC CE

The PUCCH spatial relation Activation/Deactivation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size of 24 bits with following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- BWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- PUCCH Resource ID: This field contains an identifier of the PUCCH resource ID identified by PUCCHResourceld as specified in TS 38.331 [5]. The length of the field is 7 bits;
- \( \mathrm{S}_{1} \) : If, in PUCCH-Config in which the PUCCH Resource ID is configured, there is a PUCCH Spatial Relation Info with PUCCH-SpatialRelationInfold as specified in TS 38.331 [5], configured for the uplink bandwidth part indicated by BWP ID field, \( \mathrm{S}_{1} \) indicates the activation status of PUCCH Spatial Relation [nfo with PUCCHSpatialRelationInfold equal to \( i+1 \), otherwise MAC entity shall ignore this field. The \( S_{1} \) field is set to 1 to indicate PUCCH Spatial Relation Info with PUCCH-SpatialRelationInfold equal to \( \mathrm{i}+1 \) shall be activated. The

ETSI


--- Page 232  ---


3GPP TS 38.321 version 18.2.0 Release 18
231
ETSI TS 138321 V18.2.0 (2024-08)

S, field is set to 0 to indicate PUCCH Spatial Relation Info with PUCCH-SpatialRelationInfold equal to \( i+1 \) shall be deactivated. Only a single PUCCH Spatial Relation Info can be active for a PUCCH Resource at a time;
- R: Reserved bit, set to 0 .

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|c|} 
& & & & & \\
\hline & & & & & \\
\hline R & \multicolumn{6}{|c|}{ Serving Cell ID } \\
\hline R & \multicolumn{7}{|c|}{ PUCCH Resource ID } \\
\hline \( \mathrm{S}_{7} \) & \( \mathrm{~S}_{6} \) & \( \mathrm{~S}_{5} \) & \( \mathrm{~S}_{4} \) & \( \mathrm{~S}_{3} \) & \( \mathrm{~S}_{2} \) & \( \mathrm{~S}_{1} \) \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{Figure 6.1.3.18-1: PUCCH spatial relation Activation/Deactivation MAC CE}
\end{table}
6.1.3.19 SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE

The SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.1-1. It has a fixed size of 16 bits with following fields:
- A/D: This field indicates whether to activate or deactivate indicated SP ZP CSI-RS resource set. The field is set to 1 to indicate activation, otherwise it indicates deactivation;
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint value of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- SP ZP CSI-RS resource set ID: This field contains an index of sp-ZP-CSI-RS-ResourceSetsToAddModList, as specified in TS 38.331 [5], indicating the Semi Persistent ZP CSI-RS resource set, which shall be activated or deactivated. The length of the field is 4 bits;
- R: Reserved bit, set to 0 .

Figure 6.1.3.19-1: SP ZP CSI-RS Resource Set Activation/Deactivation MAC CE
6.1.3.20 Recommended bit rate MAC CE

The Recommended bit rate MAC CE is identified by a MAC subheader with LCID as specified in Tables 6.2.1-1 and 6.2.1-2 for bit rate recommendation message from the gNB to the UE and bit rate recommendation query message from the UE to the gNB, respectively. It has a fixed size and consists of two octets defined as follows (Figure 6.1_3.20-1):
- LCID: This field indicates the identity of the logical channel for which the recommended bit rate or the recommended bit rate query is applicable. The length of the field is 6 bits;
- Uplink/Downlink (UL/DL): This field indicates whether the recommended bit rate or the recommended bit rate query applies to uplink or downlink. The length of the field is 1 bit. The UL/DL field set to 0 indicates downlink. The UL/DL field set to 1 indicates uplink;
- Bit Rate: This field indicates an index to Table 6.1.3.20-1. The length of the field is 6 bits. For bit rate recommendation the value indicates the recommended bit rate. For bit rate recommendation query the value indicates the desired bit rate;

ETSI


--- Page 233  ---


3GPP TS 38.321 version 18.2.0 Release 18
232
ETSI TS 138321 V18.2.0 (2024-08)
- X: Bit rate multiplier. For UEs supporting recommended bit rate multiplier, when bitRateMultiplier is configured for the logical channel indicated by LCID field, X field set to 1 indicates the actual value of bit rate is the value corresponding to the index indicated by the Bit Rate field multiplied by bitRateMultiplier as specified in TS 38.331 [5].
- R: reserved bit, set to 0 .

Figure 6.1.3.20-1: Recommended bit rate MAC CE

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.1.3.20-1: Values (kbit/s) for Bit Rate field}
\begin{tabular}{|l|l|l|l|}
\hline Index & NR Recommended Bit Rate value [kbit/s] & Index & NR Recommended Bit Rate value [kbit/s] \\
\hline 0 & Note 1 & 32 & 700 \\
\hline 1 & 0 & 33 & 800 \\
\hline 2 & 9 & 34 & 900 \\
\hline 3 & 11 & 35 & 1000 \\
\hline 4 & 13 & 36 & 1100 \\
\hline 5 & 17 & 37 & 1200 \\
\hline 6 & 21 & 38 & 1300 \\
\hline 7 & 25 & 39 & 1400 \\
\hline 8 & 29 & 40 & 1500 \\
\hline 9 & 32 & 41 & 1750 \\
\hline 10 & 36 & 42 & 2000 \\
\hline 11 & 40 & 43 & 2250 \\
\hline 12 & 48 & 44 & 2500 \\
\hline 13 & 56 & 45 & 2750 \\
\hline 14 & 72 & 46 & 3000 \\
\hline 15 & 88 & 47 & 3500 \\
\hline 16 & 104 & 48 & 4000 \\
\hline 17 & 120 & 49 & 4500 \\
\hline 18 & 140 & 50 & 5000 \\
\hline 19 & 160 & 51 & 5500 \\
\hline 20 & 180 & 52 & 6000 \\
\hline 21 & 200 & 53 & 6500 \\
\hline 22 & 220 & 54 & 7000 \\
\hline 23 & 240 & 55 & 7500 \\
\hline 24 & 260 & 56 & 8000 \\
\hline 25 & 280 & 57 & Reserved \\
\hline 26 & 300 & 58 & Reserved \\
\hline 27 & 350 & 59 & Reserved \\
\hline 28 & 400 & 60 & Reserved \\
\hline 29 & 450 & 61 & Reserved \\
\hline 30 & 500 & 62 & Reserved \\
\hline 31 & 600 & 63 & Reserved \\
\hline \multicolumn{4}{|l|}{Note 1: For bit rate recommendation message this index is used for indicating that no new recommendation on bit rate is given.} \\
\hline
\end{tabular}
\end{table}
6.1.3.21 Timing Delta MAC CE

The Timing Delta MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b.

ETSI


--- Page 234  ---


3GPP TS 38.321 version 18.2.0 Release 18
233
ETSI TS 138321 V18.2.0 (2024-08)

It has a fixed size and consists of two octets defined as follows (Figure 6.1 3.21-1):
- R: Reserved bit, set to 0 ;
- Tedia: This field indicates the value \( (0,1, \ldots, 2047) \) used to control the amount of timing adjustment that MAC entity indicates (as specified in TS 38.213 [6]). The length of the field is 11 bits.

Oct 1

Oct 2

Figure 6.1.3.21-1: Timing Delta MAC CE
6.1.3.22 Guard Symbols MAC CEs

The Guard Symbols MAC CEs (i.e. Provided Guard Symbols MAC CE and Desired Guard Symbols MAC CE) for Case-1 timing mode are identified by the MAC subheader with eLCID as specified in Table 6.2.1-1b for DL-SCH and in Table 6.2.1-2b for UL-SCH.

It has fixed size and consists of four octets defined as follows (Figure 6.1.3.22-1):
- R: Reserved bit, set to 0 ;
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- Sub-carrier spacing (SCS): This field indicates the subcarrier spacing used as reference for the guard spacing. The length of this field is 2bits. The values for the SCS field are shown in Table 6.1.3.22-2;
- Number of Guard Symbols ( \( \mathrm{NmbGS}_{1} \) ): This field indicates the number of guard symbols for the switching scenarios shown in Table 5.18.19-1. The number of guard symbols can take values within the range of 0 to 4 . Higher values 5 to 7 are reserved.

Figure 6.1.3.22-1: Guard Symbols MAC CEs

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.1.3.22-2: Subcarrier spacing for Guard Symbols MAC CEs}
\begin{tabular}{|c|c|}
\hline Subcarrier spacing & SCS value \\
\hline 15 kHz & 00 \\
\hline 30 kHz & 01 \\
\hline 60 kHz & 10 \\
\hline 120 kHz & 11 \\
\hline
\end{tabular}
\end{table}

ETSI


--- Page 235  ---


3GPP TS 38.321 version 18.2.0 Release 18
234
ETSI TS 138321 V18.2.0 (2024-08)
6.1.3.23 BFR MAC CEs

The MAC CEs for BFR consists of either:
- BFR MAC CE; or
- Truncated BFR MAC CE.

The BFR MAC CE and Truncated BFR MAC CE are identified by a MAC subheader with LCID/eLCID as specified in Table 6.2.1-2 and Table 6.2.1-2b.

The BFR MAC CE and Truncated BFR MAC CE have a variable size. They include a bitmap and in ascending order based on the ServCellIndex, beam failure recovery information i.e. octets containing candidate beam availability indication (AC) for SCells indicated in the bitmap. For BFR MAC CE, a single octet bitmap is used when the highest ServCellIndex of this MAC entity's SCell for which beam failure is detected and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed is less than 8, otherwise four octets are used. A MAC PDU shall contain at most one BFR MAC CE.

For Truncated BFR MAC CE, a single octet bitmap is used for the following cases, otherwise four octets are used:
- the highest ServCellIndex of this MAC entity's SCell for which beam failure is detected and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed is less than 8; or
- beam failure is detected for SpCell (as specified in Clause 5.17) and the SpCell is to be indicated in a Truncated BFR MAC CE and the UL-SCH resources available for transmission cannot accommodate the Truncated BFR MAC CE with the four octets bitmap plus its subheader as a result of LCP.

The fields in the BFR MAC CEs are defined as follows:
- SP: This field indicates beam failure detection (as specified in clause 5.17) for the SpCell of this MAC entity. The SP field is set to 1 to indicate that beam failure is detected for SpCell only when BFR MAC CE or Truncated BFR MAC CE is to be included into a MAC PDU as part of Random Access Procedure (as specified in 5.1.3a and 5.1.4), otherwise, it is set to 0;
- \( \mathrm{C}_{1} \) (BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17) and the presence of an octet containing the AC field for the SCell with ServCellIndex 1 as specified in TS 38.331 [5]. The \( \mathrm{C}_{1} \) field set to 1 indicates that beam failure is detected, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet containing the AC field is present for the SCell with ServCellIndex i. The \( \mathrm{C}_{1} \) field set to 0 indicates that the beam failure is either not detected or the beam failure is detected but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed, and the octet containing the AC field is not present for the SCell with ServCellIndexi. The octets containing the AC field are present in ascending order based on the ServCellIndex;
- \( \mathrm{C}_{1} \) (Truncated BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17) for the SCell with ServCellIndex i as specified in TS 38.331 [5]. The \( \mathrm{C}_{1} \) field set to 1 indicates that beam failure is detected, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet containing the AC field for the SCell with ServCellIndex i may be present. The \( \mathrm{C}_{1} \) field set to 0 indicates that the beam failure is either not detected or the beam failure is detected but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed, and the octet containing the AC field is not present for the SCell with ServCellIndex i. The octets containing the AC field, if present, are included in ascending order based on the ServCellIndex. The number of octets containing the AC field included is maximised, while not exceeding the available grant size;

NOTE: The number of the octets containing the AC field in the Truncated BFR MAC CE can be zero.
- AC: This field indicates the presence of the Candidate RS ID field in this octet. If at least one of the SSBs with SS-RSRP above rsrp-ThresholdBFR amongst the SSBs in candidateBeamRSSCellList or the CSI-RSs with CSIRSRP above rsrp-ThresholdBFR amongst the CSI-RSs in candidateBeamRSSCellList is available, the AC field is set to 1 ; otherwise, it is set to 0 . If the AC field set to 1 , the Candidate RS ID field is present. If the AC field set to \( 0, \mathrm{R} \) bits are present instead;
- Candidate RS ID: This field is set to the index of an SSB with SS-RSRP above rsrp-ThresholdBFR amongst the SSBs in candidateBeamRSSCellList or to the index of a CSI-RS with CSI-RSRP above rsrp-ThresholdBFR amongst the CSI-RSs in candidateBeamRSSCellList. Index of an SSB or CSI-RS is the index of an entry in

ETSI


--- Page 236  ---


3GPP TS 38.321 version 18.2.0 Release 18
235
ETSI TS 138321 V18.2.0 (2024-08)

candidateBeamRSSCellList corresponding to the SSB or CSI-RS. Index 0 corresponds to the first entry in the candidateBeamRSSCellList, index 1 corresponds to the second entry in the list and so on. The length of this field is 6 bits.
- R: Reserved bit, set to 0 .

\begin{tabular}{|l|l|l|l|l|l|l|l|} 
& & & & & & \\
\hline & \multicolumn{8}{|c|}{} \\
\( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{5} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & SP \\
\hline AC & R & \multicolumn{7}{|c|}{ Candidate RS ID or R bits } \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|}
\multicolumn{3}{l}{\( \cdots \)} \\
\hline\( A C \) & \( R \) & Candidate RS ID or R bits \\
\hline
\end{tabular}

Figure 6.1.3.23-1: BFR and Truncated BFR MAC CE with one octet \( \mathrm{C}_{\mathrm{i}} \) field

\begin{table}
\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{5} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & SP \\
\hline \( \mathrm{C}_{15} \) & \( \mathrm{C}_{14} \) & \( \mathrm{C}_{13} \) & \( \mathrm{C}_{12} \) & \( \mathrm{C}_{11} \) & \( \mathrm{C}_{10} \) & \( \mathrm{C}_{9} \) & \( \mathrm{C}_{8} \) \\
\hline \( \mathrm{C}_{23} \) & \( \mathrm{C}_{22} \) & \( \mathrm{C}_{21} \) & \( \mathrm{C}_{20} \) & \( \mathrm{C}_{19} \) & \( \mathrm{C}_{18} \) & \( \mathrm{C}_{17} \) & \( \mathrm{C}_{16} \) \\
\hline \( \mathrm{C}_{31} \) & \( \mathrm{C}_{30} \) & \( \mathrm{C}_{29} \) & \( \mathrm{C}_{28} \) & \( \mathrm{C}_{27} \) & \( \mathrm{C}_{26} \) & \( \mathrm{C}_{25} \) & \( \mathrm{C}_{24} \) \\
\hline AC & R & \multicolumn{6}{|c|}{Candidate RS ID or R bits} \\
\hline \multicolumn{8}{|c|}{⋯} \\
\hline AC & R & \multicolumn{6}{|c|}{Candidate RS ID or R bits} \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{Figure 6.1.3.23-2: BFR and Truncated BFR MAC CE with four octets \( \mathrm{C}_{\mathrm{i}} \) field}
\end{table}
6.1.3.24 Enhanced TCI States Activation/Deactivation for UE-specific PDSCH MAC CE

The Enhanced TCI States Activation/Deactivation for UE-specific PDSCH MAC CE is identified by a MAC PDU subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size consisting of following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneousTCI-UpdateListl or simultaneous TCI-UpdateList2 as specified in TS 38.331 [5], this MAC CE applies to all the Serving Cells configured in the set simultaneousTCI-UpdateListl or simultaneousTCI-UpdateList2, respectively;
- BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- \( \mathrm{C}_{1} \) : This field indicates whether the octet containing TCI state \( \mathrm{ID}_{1,2} \) is present. If this field is set to 1 , the octet containing TCI state ID \( _{1,2} \) is present. If this field is set to 0 , the octet containing TCI state ID \( _{1,2} \) is not present;
- TCI state ID, This field indicates the TCI state identified by TCI-Stateld as specified in TS 38.331 [5], where i is the index of the codepoint of the DCI Transmission configuration indication field as specified in TS 38.212

ETSI


--- Page 237  ---


3GPP TS 38.321 version 18.2.0 Release 18
236
ETSI TS 138321 V18.2.0 (2024-08)

[9] and TCI state [ \( \mathrm{D}_{1} \), denotes the \( \mathrm{j}^{\text {th }} \) TCI state indicated for the \( \mathrm{i}^{\text {th }} \) codepoint in the DCI Transmission Configuration Indication field. The TCI codepoint to which the TCI States are mapped is determined by its ordinal position among all the TCI codepoints with sets of TCI state \( \mathrm{ID}_{1,1} \) fields, i.e the first TCI codepoint with TCI state \( \left[\mathrm{D}_{0,1}\right. \) and TCI state \( \left[\mathrm{D}_{0,2}\right. \) shall be mapped to the codepoint value 0 , the second TCI codepoint with TCI state \( \left[\mathrm{D}_{1,1}\right. \) and TCI state \( \left[\mathrm{D}_{1,2}\right. \) shall be mapped to the codepoint value 1 and so on. The TCI state \( \left[\mathrm{D}_{1,2}\right. \) is optional based on the indication of the \( \mathrm{C}_{1} \) field. The maximum number of activated TCI codepoint is 8 and the maximum number of TCI states mapped to a TCI codepoint is 2 .
- R: Reserved bit, set to 0 .

Figure 6.1.3.24-1: Enhanced TCI States Activation/Deactivation for UE-specific PDSCH MAC CE
6.1.3.25 Enhanced PUCCH Spatial Relation Activation/Deactivation MAC CE

The Enhanced PUCCH Spatial Relation Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- BWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- PUCCH Resource ID: This field contains an identifier of the PUCCH resource ID identified by PUCCHResourceld as specified in TS 38.331 [5], which is to be activated with a spatial relation indicated by Spatial Relation Info ID field in the subsequent octet. The length of the field is 7 bits. If the indicated PUCCH Resource ID is included in a PUCCH Resource Group (configured via resourceGroupToAddModList as specified in TS 38.331 [5]) of the indicated UL BWP, no other PUCCH Resources within the same PUCCH Resource group are indicated in the MAC CE, and this MAC CE applies to all the PUCCH Resources in the PUCCH Resource group;
- Spatial Relation Info ID: This field contains PUCCH-SpatialRelationInfold -1 where PUCCHSpatialRelationInfold is the identifier of the PUCCH Spatial Relation [nfo in PUCCH-Config in which the PUCCH Resource ID is configured, as specified in TS 38.331 [5]. The length of the field is 6 bits;
- R: Reserved bit, set to 0 .

ETSI


--- Page 238  ---


3GPP TS 38.321 version 18.2.0 Release 18
237
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.25-1: Enhanced PUCCH spatial relation Activation/Deactivation MAC CE
6.1.3.26 Enhanced SP/AP SRS Spatial Relation Indication MAC CE

The Enhanced SP/AP SRS Spatial Relation Indication MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:
- A/D: This field indicates whether to activate or deactivate indicated SP SRS resource set. The field is set to 1 to indicate activation, otherwise it indicates deactivation. If the indicated SRS resource set ID is for the AP SRS resource set, MAC entity shall ignore this field;
- SRS Resource Set's Cell ID: This field indicates the identity of the Serving Cell, which contains the indicated SP/AP SRS Resource Set. If the C field is set to 0 , this field also indicates the identity of the Serving Cell which contains all resources indicated by the Resource ID, fields. The length of the field is 5 bits;
- SRS Resource Set's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains the indicated SP/AP SRS Resource Set. If the C field is set to 0 , this field also indicates the identity of the BWP which contains all resources indicated by the Resource ID, fields. The length of the field is 2 bits;
- C: This field indicates whether the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present. If this field is set to 1, Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present, otherwise they are not present so MAC entity shall ignore Resource Serving Cell ID field(s) and Resource BWP ID field(s);
- SUL: This field indicates whether the MAC CE applies to the NUL carrier or SUL carrier configuration. This field is set to 1 to indicate that it applies to the SUL carrier configuration, and it is set to 0 to indicate that it applies to the NUL carrier configuration;
- SRS Resource Set ID: This field indicates the SP/AP SRS Resource Set ID identified by SRS-ResourceSetld as specified in TS 38.331 [5]. The length of the field is 4 bits;
- \( F_{1} \) : This field indicates the type of a resource used as a spatial relationship for SRS resource within SP/AP SRS Resource Set indicated with SP/AP SRS Resource Set ID field. Fo refers to the first SRS resource within the resource set, \( F_{1} \) to the second one and so on. The field is set to 1 to indicate NZP CSI-RS resource index is used, and it is set to 0 to indicate either SSB index or SRS resource index is used. The length of the field is 1 bit. This field is only present if MAC CE is used for activation of SP SRS resource set, i.e. the A/D field is set to 1 , or for AP SRS resource set;
- Resource Serving Cell ID: This field indicates the identity of the Serving Cell on which the resource used for spatial relationship derivation for SRS resource \( i \) is located. The length of the field is 5 bits;
- Resource BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the resource used for spatial relationship derivation for SRS resource \( i \) is located. The length of the field is 2 bits;

ETSI


--- Page 239  ---


3GPP TS 38.321 version 18.2.0 Release 18
238
ETSITS 138321 V18.2.0 (2024-08)
- Resource ID: This field contains an identifier of the resource used for spatial relationship derivation for SRS resource i. Resource [D0 refers to the first SRS resource within the resource set, Resource [D1 to the second one and so on. If \( F_{1} \) is set to 0 , the first bit of this field is always set to 0 . If \( F_{1} \) is set to 0 , and the second bit of this field is set to 1 , the remainder of this field contains SSB-Index as specified in TS 38.331 [5]. If \( F_{1} \) is set to 0 , and the second bit of this field is set to 0 , the remainder of this field contains SRS-Resourceld as specified in TS 38.331 [5]. The length of the field is 8 bits. This field is only present if MAC CE is used for activation of SP SRS resource set, i.e. the A/D field is set to 1 , or for AP SRS resource set;
- R: Reserved bit, set to 0 .

Figure 6.1.3.26-1: Enhanced SP/AP SRS spatial relation Indication MAC CE
6.1.3.27 SRS Pathloss Reference RS Update MAC CE

The SRS Pathloss Reference RS Update MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size of 24 bits:
- Serving Cell ID: This field indicates the identity of the Serving Cell, which contains activated SRS Resource Set. The length of the field is 5 bits;
- BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains activated SRS Resource Set. The length of the field is 2 bits;
- SRS Resource Set ID: This field indicates the SRS Resource Set ID identified by SRS-ResourceSetld as specified in TS 38.331 [5]. The length of the field is 4 bits;
- Pathloss Reference RS ID: This field indicates the Pathloss Reference RS ID identified by srs-PathlossReferenceRS-Id as specified in TS 38.331 [5]. It updates the pathloss reference RS for an SRS-resource set indicated by SRS Resource Set ID field. The length of the field is 6 bits;
- R: Reserved bit, set to 0 .

ETSI


--- Page 240  ---


3GPP TS 38.321 version 18.2.0 Release 18
239
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.27-1: SRS Pathloss Reference RS Update MAC CE
6.1.3.28 PUSCH Pathloss Reference RS Update MAC CE

The PUSCH Pathloss Reference RS Update MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of the following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell, which contains activated PUSCH Pathloss Reference RS. The length of the field is 5 bits;
- BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains activated PUSCH Pathloss Reference RS. The length of the field is 2 bits;
- T: If the UE is configured with two SRS resources sets for codebook or non-codebook, as specified in TS 38.331 [5], in the indicated bandwidth part of the indicated Serving Cell, if this field is set to 0, SRI ID(s) to be updated are the ones associated with the first SRS resource set, and if is set to 1 the SRI [D(s) to be updated are the ones associated with the second SRS resource set. Otherwise, this field is a reserved bit set to 0 ;
- PUSCH Pathloss Reference RS ID: This field indicates the PUSCH Pathloss Reference RS ID identified by PUSCH-PathlossReferenceRS-Id as specified in TS 38.331 [5], which is to be updated in the SRI PUSCH power control mappings indicated by SRI ID fields indicated in the same MAC CE. The length of the field is 6 bits;
- C: This field indicates the presence of the additional SRI ID in the last octet of this MAC CE. If this field is set to 1 , two SRI ID(s) are present in the last octet. Otherwise only one SRI ID (i.e. the first SRI ID) is present in the last octet;
- SRI ID: This field indicates the SRI PUSCH power control ID identified by sri-PUSCH-PowerControlld as specified in TS 38.331 [5]. The length of the field is 4 bits;
- R: Reserved bit, set to 0 .

Figure 6.1.3.28-1: PUSCH Pathloss Reference RS Update MAC CE
6.1.3.29 Serving Cell Set based SRS Spatial Relation Indication MAC CE

The Serving Cell Set based SRS Spatial Relation indication MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of the following fields:

ETSI


--- Page 241  ---


3GPP TS 38.321 version 18.2.0 Release 18
240
ETSI TS 138321 V18.2.0 (2024-08)
- SRS Resource's Cell ID: This field indicates the identity of the Serving Cell, which contains the indicated SP/AP SRS Resource. If the C field is set to 0 , this field also indicates the identity of the Serving Cell which contains all resources indicated by the Resource \( [\mathrm{Di} \) fields. The length of the field is 5 bits. The indicated Serving Cell is configured as part of a simultaneousSpatial-UpdatedListl or simultaneousSpatial-UpdatedList2 as specified in TS 38.331 [5], and this MAC CE applies to all the Serving Cells configured in the set simultaneousSpatialUpdatedListl or simultaneousSpatial-UpdatedList2, respectively;
- SRS Resource's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains the indicated AP/SP SRS Resource. If the C field is set to 0 , this field also indicates the identity of the BWP which contains all resources indicated by the Resource \( \mathrm{ID}_{1} \) fields. The length of the field is 2 bits;
- C: This field indicates whether the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present. If this field is set to 1 , the Resource Serving Cell ID field(s) and Resource BWP ID field(s) are present, otherwise they are not present so MAC entity shall ignore Resource Serving Cell ID field(s) and Resource BWP ID field(s);
- SRS Resource ID: This field indicates the SP/AP SRS Resource ID identified by SRS-Resourceld as specified in TS 38.331 [5]. The length of the field is 6 bits;
- \( F_{1} \) : This field indicates the type of a resource used as a spatial relationship for SRS resource indicated with SRS Resource \( \mathrm{ID}_{1} \) field. \( \mathrm{F}_{0} \) refers to the first SRS resource which is indicated SRS Resource \( \mathrm{ID}_{1}, \mathrm{~F}_{1} \) to the second one and so on. The field is set to 1 to indicate NZP CSI-RS resource index is used, and it is set to 0 to indicate either SSB index or SRS resource index is used. The length of the field is 1 bit;
- Resource Serving Cell ID1: This field indicates the identity of the Serving Cell on which the resource used for spatial relationship derivation for SRS Resource [ \( \mathrm{D}_{1} \) is located. The length of the field is 5 bits;
- Resource BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the resource used for spatial relationship derivation for SRS Resource [D, is located. The length of the field is 2 bits;
- Resource ID: This field contains an identifier of the resource used for spatial relationship derivation for SRS resource i. Resource \( I D_{0} \) refers to the first SRS resource which is indicated SRS Resource \( I D_{0} \), Resource \( I D_{1} \) to the second one and so on. If \( F_{1} \) is set to 0 , the first bit of this field is always set to 0 . If \( F_{1} \) is set to 0 , and the second bit of this field is set to 1, the remainder of this field contains SSB-Index as specified in TS 38.331 [5]. If \( F_{1} \) is set to 0 , and the second bit of this field is set to 0 , the remainder of this field contains SRS-Resourceld as specified in TS 38.331 [5]. The length of the field is 8 bits.
- R: Reserved bit, set to 0 .

ETSI


--- Page 242  ---


3GPP TS 38.321 version 18.2.0 Release 18
241
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.29-1: Serving Cell set based SRS Spatial Relation Indication MAC CE
6.1.3.30 LBT failure MAC CEs

The LBT failure MAC CE of one octet is identified by a MAC subheader with LCID as specified in Table 6.2.1-2. It has a fixed size and consists of a single octet containing 8 C -fields as follows (Figure 6.1.3.30-1).

The LBT failure MAC CE of four octets is identified by a MAC subheader with LCID as specified in Table 6.2.1-2. It has a fixed size and consists of four octets containing 32 C -fields as follows (Figure 6.1.3.30-2).

A single octet format is used when the highest ServCellIndex of this MAC entity's Serving Cell for which consistent LBT failure is detected is less than 8 , otherwise four octets format is used.
- \( \mathrm{C}_{1} \) : If there is a Serving Cell configured for the MAC entity with ServCellIndex i as specified in TS 38.331 [5] and if consistent LBT failure have been triggered and not cancelled in this Serving Cell, the field is set to 1 , otherwise the field is set to 0 .

Figure 6.1.3.30-1: LBT failure MAC CE of one octet

Figure 6.1.3.30-2: LBT failure MAC CE of four octets

ETSI


--- Page 243  ---


3GPP TS 38.321 version 18.2.0 Release 18
242
ETSI TS 138321 V18.2.0 (2024-08)
6.1.3.31 Multiple Entry Configured Grant Confirmation MAC CE

The Multiple Entry Configured Grant Confirmation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b. It has a fixed size and consists of a four octets containing 32 CG-fields. The Multiple Entry Configured Grant Confirmation MAC CE is defined as follows (Figure 6.1.3.31-1).
- \( \mathrm{CG}_{1} \) : This field indicates whether PDCCH indicating activation or deactivation of configured uplink grant with ConfiguredGrantConfigIndexMAC i has been received. The \( \mathrm{CG}_{1} \) field is set to 1 to indicate that PDCCH indicating activation or deactivation of type 2 configured uplink grant with ConfiguredGrantConfigIndexMAC i has been received. The \( \mathrm{CG}_{1} \) field is set to 0 to indicate that PDCCH indicating activation or deactivation of type 2 configured uplink grant with ConfiguredGrantConfigIndexMAC i has not been received.

\begin{table}
\begin{tabular}{|l|l|l|l|l|l|l|l|l|}
\hline & & & & & & & & \\
\hline \( \mathrm{CG}_{7} \) & \( \mathrm{CG}_{6} \) & \( \mathrm{CG}_{5} \) & \( \mathrm{CG}_{4} \) & \( \mathrm{CG}_{3} \) & \( \mathrm{CG}_{2} \) & \( \mathrm{CG}_{1} \) & \( \mathrm{CG}_{0} \) & Oct 1 \\
\hline \( \mathrm{CG}_{15} \) & \( \mathrm{CG}_{14} \) & \( \mathrm{CG}_{13} \) & \( \mathrm{CG}_{12} \) & \( \mathrm{CG}_{11} \) & \( \mathrm{CG}_{10} \) & \( \mathrm{CG}_{9} \) & \( \mathrm{CG}_{8} \) & Oct 2 \\
\hline \( \mathrm{CG}_{23} \) & \( \mathrm{CG}_{22} \) & \( \mathrm{CG}_{21} \) & \( \mathrm{CG}_{20} \) & \( \mathrm{CG}_{19} \) & \( \mathrm{CG}_{18} \) & \( \mathrm{CG}_{17} \) & \( \mathrm{CG}_{16} \) & Oct 3 \\
\hline \( \mathrm{CG}_{31} \) & \( \mathrm{CG}_{30} \) & \( \mathrm{CG}_{29} \) & \( \mathrm{CG}_{28} \) & \( \mathrm{CG}_{27} \) & \( \mathrm{CG}_{26} \) & \( \mathrm{CG}_{25} \) & \( \mathrm{CG}_{24} \) & Oct 4 \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{Figure 6.1.3.31-1: Multiple Entry Configured Grant Confirmation MAC CE}
\end{table}
6.1.3.32 Duplication RLC Activation/Deactivation MAC CE

The Duplication RLC Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size and consists of a single octet defined as follows (Figure 6.1.3.32-1).
- DRB ID: This field indicates the identity of DRB for which the MAC CE applies. The length of the field is 5 bits;
- RLC; This field indicates the activation/deactivation status of PDCP duplication for the RLC entity \( i \) where \( i \) is ascending order of logical channel ID of secondary RLC entities in the order of MCG and SCG, for the DRB. For Multi-path, RLC entity \( i \) is counted for secondary RLC entities in order of direct path (where \( i \) is ascending order of logical channel [D of secondary RLC entities) and indirect path. The RLC, field is set to 1 to indicate that the PDCP duplication for the RLC entity \( i \) shall be activated. The RLC \( { }_{1} \) field is set to 0 to indicate that the PDCP duplication for the RLC entity i shall be deactivated.

Figure 6.1.3.32-1: Duplication RLC Activation/Deactivation MAC CE
6.1.3.33 Sidelink Buffer Status Report MAC CEs

Sidelink Buffer Status Report (SL-BSR) MAC CEs consist of either:
- SL-BSR format (variable size); or
- Truncated SL-BSR format (variable size).

SL-BSR and Truncated SL-BSR MAC control elements consist of one Destination Index field, one LCG ID field and one corresponding Buffer Size field per reported target group.

The SL-BSR formats are identified by MAC subheaders with LCIDs as specified in in Table 6.2.1-2.

ETSI


--- Page 244  ---


3GPP TS 38.321 version 18.2.0 Release 18
243
ETSI TS 138321 V18.2.0 (2024-08)

The fields in the SL-BSR MAC CE are defined as follows:
- Destination Index: The Destination Index field identifies the destination. The length of this field is 5 bits. The value is set to one index corresponding to SL destination identity associated to same destination reported in \( s / \) TxResourceReqList, sl-TxResourceReqListDisc, sl-TxResourceReqListCommRelay and sl-TxResourceReqListL2\( U 2 U \), if present. The value is indexed sequentially from 0 in the same ascending order of SL destination identity in sl-TxResourceReqList, sl-TxResourceReqListDisc, sl-TxResourceReqListCommRelay and sl-TxResourceReqListL2-U2U as specified in TS 38.331 [5]. When multiple lists are reported, the value is indexed sequentially across all the lists in the same order as presented in SidelinkUEInformationNR message;
- LCG ID: The Logical Channel Group ID field identifies the group of logical channel(s) whose SL buffer status is being reported. The length of the field is 3 bits;
- Buffer Size: The Buffer Size field identifies the total amount of data available according to the data volume calculation procedure in TSs 38.322 [3] and 38.323 [4] across all logical channels of a logical channel group of a destination after the MAC PDU has been built (i.e after the logical channel prioritization procedure, which may result the value of the Buffer Size field to zero). The amount of data is indicated in number of bytes. The size of the RLC headers and MAC subheaders are not considered in the buffer size computation. The length of this field is 8 bits. The values for the Buffer Size field are shown in Table 6.1.3.1-2, respectively. For the Truncated SLBSR format the number of Buffer Size fields included is maximised, while not exceeding the number of padding bits.

Buffer Sizes of LCGs are included in decreasing order of the highest priority of the sidelink logical channel having data available for transmission in each of the LCGs irrespective of the value of the Destination Index field.

NOTE: Void.

Figure 6.1.3.33-1: SL-BSR and Truncated SL-BSR MAC control element
6.1.3.34 Sidelink Configured Grant Confirmation MAC CE

The Sidelink Configured Grant Confirmation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b. The Sidelink Configured Grant Confirmation MAC CE is defined as follows (Figure 6.1.3.34-1):
- \( \mathrm{C}_{1} \) : If there is a configured grant Type 2 with sl-ConfigIndexCG i configured for the MAC entity as specified in TS 38.331 [5], this field indicates the confirmation to activation/deactivation of the configured grant with slConfigIndex \( C G \mathrm{i} \), else the MAC entity shall ignore the \( \mathrm{C}_{1} \) field. The \( \mathrm{C}_{1} \) field is set to 1 to confirm that the configured grant with \( s l \)-ConfigIndexCG i shall be activated. The \( \mathrm{C}_{1} \) field is set to 0 to indicate that the configured grant with \( s l \)-ConfigIndexCG i shall be deactivated.

ETSI


--- Page 245  ---


3GPP TS 38.321 version 18.2.0 Release 18
244
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.34-1: Sidelink Configured Grant Confirmation MAC CE
6.1.3.35 Sidelink CSI Reporting MAC CE

The Sidelink CSI Reporting MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.4-1. The priority of the Sidelink CSI Reporting MAC CE is fixed to '1'. The Sidelink CSI Reporting MAC CE is defined as follows (Figure 6.1.3.35-1):
- RI: This field indicates the derived value of the Rank Indicator for sidelink CSI reporting as specified in clause 8.5 of TS 38.214 [7]. The length of the field is 1 bit, the values of the rank indicator field are mapped to allowed rank indicator values with increasing order, where ' 0 ' is mapped to the smallest allowed rank indicator value;
- CQI: This field indicates the derived value of the Channel Quality Indicator for sidelink CSI reporting as specified in clause 8.5 of TS 38.214 [7]. The length of the field is 4 bit;
- R: Reserved bit, set to 0 .

Figure 6.1.3.35-1: Sidelink CSI Reporting MAC CE
6.1.3.36 SP Positioning SRS Activation/Deactivation MAC CE

The SP Positioning SRS Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:
- A/D: This field indicates whether to activate or deactivate indicated SP Positioning SRS resource set. The field is set to 1 to indicate activation, otherwise it indicates deactivation;
- Positioning SRS Resource Set's Cell ID: This field indicates the identity of the Serving Cell, which contains activated/deactivated SP Positioning SRS Resource Set. If the C field is set to 0 , this field also indicates the identity of the Serving Cell which contains all resources indicated by the Spatial Relation for Resource ID, fields, if present. The length of the field is 5 bits;
- Positioning SRS Resource Set's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains activated/deactivated SP Positioning SRS Resource Set. If the C field is set to 0 , this field also indicates the identity of the BWP which contains all resources indicated by the Spatial Relation for Resource [D, fields, if present. The length of the field is 2 bits;
- C: This field indicates whether the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) within the field Spatial Relation for Resource ID, are present, except for Spatial Relation Resource ID, with DL-PRS or SSB. When A/D is set to 1 , if this field is set to 1 , the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) in the field Spatial Relation for Resource ID, are present, otherwise if this field is set to 0 , they are not present. When \( A / D \) is set to 0 , this field is always set to 0 that they are not present;
- SUL: This field indicates whether the MAC CE applies to the NUL carrier or SUL carrier configuration. This field is set to 1 to indicate that it applies to the SUL carrier configuration, and it is set to 0 to indicate that it applies to the NUL carrier configuration;
- Positoining SRS Resource Set ID: This field indicates the SP Positioning SRS Resource Set identified by SRSPosResourceSetld as specified in TS 38.331 [5], which is to be activated or deactivated. The length of the field is 4 bits;

ETSI


--- Page 246  ---


3GPP TS 38.321 version 18.2.0 Release 18
245
ETSI TS 138321 V18.2.0 (2024-08)
- Spatial Relation for Resource [D: The field Spatial Relation for Resource [D, is only present if MAC CE is used for activation, i.e. the A/D field is set to \( 1 . M \) is the total number of Positioning SRS resource(s) configured under the SP Positioning SRS resource set indicated by the field Positioning SRS Resource Set ID. There are 4 types of Spatial Relation for Resource \( \mathrm{ID}_{1} \), which is indicated by the \( \mathrm{F}\left(\mathrm{F}_{0}\right. \) and \( \left.\mathrm{F}_{1}\right) \) field within. The fields within Spatial Relation for Resource \( \mathrm{ID}_{1} \) are shown in Figures 6.1.3.36-2 to 6.1.3.36-5 for the 4 types of Spatial Relations for Resource [ \( \mathrm{D}_{1} \);
- S: This field indicates whether the fields Spatial Relation for Resource ID, for the positioning SRS resource i within the positioning SRS resource set are present. If the field is set to 1 , the fields Spatial Relation for Resource IDi are present; otherwise, they are absent;
- R: Reserved bit, set to 0 .

Figure 6.1.3.36-1: SP Positioning SRS Activation/Deactivation MAC CE

\begin{table}
\begin{tabular}{|c|c|c|c|c|c|c|c|}
\hline & & & & & & & \\
\hline\( F_{0} \) & \( R \) & \( R \) & \( R \) & \( R \) & \( R \) & \( R \) \\
\hline \multicolumn{7}{|c|}{ NZP CSI-RS resource ID } \\
\hline\( R \) & \multicolumn{5}{|c|}{ Resource Serving Cell ID \( { }_{i} \)} & \begin{tabular}{c} 
Resource \\
BWP ID \( { }_{i} \)
\end{tabular} \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{Figure 6.1.3.36-2: Spatial Relation for Resource IDi with NZP CSI-RS}
\end{table}

ETSI


--- Page 247  ---


3GPP TS 38.321 version 18.2.0 Release 18
246
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.36-3: Spatial Relation for Resource ID i with SSB

Figure 6.1.3.36-4: Spatial Relation for Resource IDi with SRS

Figure 6.1.3.36-5: Spatial Relation for Resource IDi with DL-PRS

The field Spatial Relation for Resource [D, consists of the following fields:
- \( F_{0} \) : This field indicates the type of a resource used as a spatial relation for the \( i^{\text {th }} \) Positioning SRS resource within the Positioning SRS Resource Set indicated with the field Positioning SRS Resource Set ID. The field is set to 00 to indicate NZP CSI-RS resource index is used; it is set to 01 to indicate SSB index is used; it is set to 10 to indicate SRS resource index is used; it is set to 11 to indicate DL-PRS index is used. The length of the field is 2 bits;
- \( F_{1} \) : This field indicates the type of SRS resource used as spatial relation for the \( i^{\text {th }} \) Positioning SRS resource within the SP Positioning SRS Resource Set indicated with the field Positioning SRS Resource Set ID when \( \mathrm{F}_{0} \) is set to 10 . The field is set to 0 to indicate SRS resource index SRS-Resourceld as defined in TS 38.331 [5] is used; the field is set to 1 to indicate Positioning SRS resource index SRS-PosResourceld as defined in TS 38.331 [5] is used;
- NZP CSI-RS Resource ID: This field contains an index of NZP-CSI-RS-ResourceID, as specified in TS 38.331 [5], indicating the NZP CSI-RS resource, which is used to derive the spatial relation for the positioning SRS. The length of the field is 8 bits;
- SSB index: This field contains an index of SSB SSB-Index as specified in TS 38.331 [5] and/or TS 37.355 [23]. The length of the field is 6 bits;
- PCI: This field contains physical cell identity PhysCellld as specified in TS 38.331 [5] and/or TS 37.355 [23]. The length of the field is 10 bits;
- SRS resource ID: When \( F_{1} \) is set to 0 , the field indicates an index for SRS resource SRS-Resourceld as defined in TS 38.331 [5]; When \( F_{1} \) is set to 1 , the field indicates an index for Positioning SRS resource SRS-PosResourceld as defined in TS 38.331 [5]. The length of the field is 5 bits representing the index from 0 to 31;

ETSI


--- Page 248  ---


3GPP TS 38.321 version 18.2.0 Release 18
247
ETSI TS 138321 V18.2.0 (2024-08)
- E: This field indicates the extension of SRS resource ID as the MSB of SRS resource ID. The total length of the extended SRS resource ID is 6 bits. If \( E \) bit is set to 1 , the SRS resource ID value is 5 -bit SRS resource ID field +32 ;
- DL-PRS Resource Set ID: This field contains an index for DL-PRS Resource Set nr-DL-PRS-ResourceSetld as defined in TS 37.355 [23]. The length of the field is 3 bits;
- DL-PRS Resource ID: This field contains an index for DL-PRS resource \( n r-D L-P R S \)-Resource-Id as defined in TS 37.355 [23]. The length of the field is 6 bits;
- DL-PRS ID: This field contains an identity for DL-PRS resource dl-PRS-ID as defined in TS 37.355 [23]. The length of the field is 8 bits;
- PI: This field indicates whether the field DL-PRS resource ID is present within the Spatial Relation for Resource ID, with DL-PRS. If the field is set to 1 , the octet containing the field DL-PRS resource ID is present; otherwise, the octet is omitted;
- SI: This field indicates whether the field SSB index is present within the Spatial Relation for Resource ID, with SSB. If the field is set to 1 , the octet containing the field SSB index is present; otherwise, the octet is omitted;
- Resource Serving Cell [D]: This field indicates the identity of the Serving Cell on which the resource used for spatial relationship derivation for the \( i^{\text {th }} \) Positioning SRS resource is located. The length of the field is 5 bits;
- Resource BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the resource used for spatial relationship derivation for the \( i^{\text {th }} \) Positioning SRS resource is located. The length of the field is 2 bits.
6.1.3.37 Guard Symbols MAC CEs for Case-6 and Case-7 timing modes

The Guard Symbols MAC CEs (i.e. Provided Guard Symbols MAC CE and Desired Guard Symbols MAC CE) for Case-6 and Case-7 timing modes are identified by the MAC subheader with eLCIDs as specified in Table 6.2.1-1b for DL-SCH and in Table 6.2.1-2b for UL-SCH.

The MAC CEs have fixed size and consist of three octets each, defined as follows (Figure 6.1.3.37-1 and Figure 6.1.3.37-2):
- R: Reserved bit, set to 0 ;
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- Sub-carrier spacing (SCS): This field indicates the subcarrier spacing used as reference for the guard spacing. The length of this field is 2bits. The values for the SCS field are shown in Table 6.1.3.22-2;
- Number of Guard Symbols ( \( \mathrm{NmbGS}_{1} \) ): This field indicates the number of guard symbols for the switching scenarios shown in Table 5.18.19-2.

Figure 6.1.3.37-1: Case-6 timing Guard Symbols MAC CEs

ETSI


--- Page 249  ---


3GPP TS 38.321 version 18.2.0 Release 18
248
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.37-2: Case-7 timing Guard Symbols MAC CEs
6.1.3.38 Case-7 Timing advance offset MAC CE

The Case-7 Timing advance offset MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.11b.

The Case-7 Timing advance offset MAC CE is related to the Case-7 timing mode, has a fixed size and consists of two octets defined as follows (Figure 6.1.3.21-2):
- R: Reserved bit, set to 0 ;
- \( T_{o \text { ISset, } 2} \) : This field indicates the value \( (-3072,-3071, \ldots, 1023) \) used to control the amount of timing adjustment that MAC entity indicates (as specified in TS 38.213 [6]). The length of the field is 12 bits.

Figure 6.1.3.38-1: Case-7 Timing advance offset MAC CE
6.1.3.39 Case-6 Timing Request MAC CE

The Case-6 Timing Request MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-2b. This MAC CE is used by the IAB-MT node to inform its parent node whether Case-6 timing is required for simultaneous operation.

It has a fixed size of zero bits.
6.1.3.40 Positioning Measurement Gap Activation/Deactivation Request MAC CE

The Positioning Measurement Gap Activation/deactivation request MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-2b.

It has a fixed 8-bit size defined as follows (Figure 6.1.3.40-1):
- Positioning MG ID: This field indicates the identifier for the pre-configured positioning measurement gap. The length of the field is 4 bits;
- A/D: This field indicates the activation or deactivation of the Positioning Measurement Gap. The field is set to 1 to indicate activation, otherwise it indicates deactivation. The length of the field is 1 bit;
- R: Reserved bit, set to 0 .

ETSI


--- Page 250  ---


3GPP TS 38.321 version 18.2.0 Release 18
249
ETSI TS 138321 V18.2.0 (2024-08)

Oct 1

Figure 6.1.3.40-1: Positioning Measurement Gap Activation/Deactivation Request MAC CE
6.1.3.41 Positioning Measurement Gap Activation/Deactivation Command MAC CE

The Positioning Measurement Gap Activation/Deactivation Command MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b.

It has a fixed 8-bit size defined as follows (Figure 6.1.3.41-1):
- Positioning MG ID: This field indicates the identifier for the preconfigured positioning measurement gap. The length of the field is 4 bits;
- A/D: This field indicates the activation or deactivation of the Positioning Measurement Gap. The field is set to 1 to indicate activation, otherwise it indicates deactivation. The length of the field is 1 bit;
- R: Reserved bit, set to 0 .

Figure 6.1.3.41-1: Positioning Measurement Gap Activation/Deactivation Command MAC CE
6.1.3.42 PPW Activation/Deactivation Command MAC CE

The PPW Activation/Deactivation Command MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b.

It has variable size defined as follows (Figure 6.1.3.42-1):
- numEntry: This field indicates the number of entries \( \mathrm{N}-1 \) in the MAC CE. 00 indicates that N equals to \( 2 ; 01 \) indicates that N equals to 3 and so on. The length of the field is 2 bits;
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- PPW ID: This field indicates the index of the PPW configured on active DL BWP of the Serving Cell identified by the above Serving Cell ID. Index 0 corresponds to the first entry within the list of the PPW configuration by the increasing order of dl-PPW-ID in TS 38.331 [5] in this BWP, index 1 corresponds to the second entry in the list and so on. The length of the field is 2 bits;
- A/D: This field indicates the activation or deactivation of the PPW. The field is set to 1 to indicate activation, otherwise it indicates deactivation. The length of the field is 1 bit;
- R: Reserved bit, set to 0 .

ETSI


--- Page 251  ---


3GPP TS 38.321 version 18.2.0 Release 18
250
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.42-1: PPW Activation/Deactivation Command MAC CE
6.1.3.43 Enhanced BFR MAC CEs

The Enhanced MAC CEs for BFR consists of either:
- Enhanced BFR MAC CE; or
- Truncated Enhanced BFR MAC CE.

The Enhanced BFR MAC CE and Truncated Enhanced BFR MAC CE are identified by a MAC subheader with eLCID/LCID as specified in Table 6.2.1-2 and Table 6.2.1-2b.

The Enhanced BFR MAC CE and Truncated Enhanced BFR MAC CE have a variable size. They include an SP field, \( C_{1} \) bitmap (single octet or four octets), \( \mathrm{S}_{\mathrm{k}} \) bitmap ( 0 to 4 octets), beam failure recovery information i.e octets containing candidate beam availability indication (AC) for BFD-RS set(s) of SpCell configured with two BFD-RS sets, and in ascending order based on ServCellIndex, beam failure recovery information i.e. octets containing candidate beam availability indication (AC) for SCells or BFD-RS set(s) of SCells configured with two BFD-RS sets indicated in the C, bitmap. For Enhanced BFR MAC CE, a single octet \( \mathrm{C}_{1} \) bitmap is used when the highest ServCellIndex of this MAC entity's SCell for which beam failure is detected for SCell or for at least one BFD-RS set of SCell and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed is less than 8, otherwise four octets \( \mathrm{C}_{1} \) bitmap is used. A MAC PDU shall contain at most one MAC CE for BFR.

For Truncated Enhanced BFR MAC CE, a single octet \( \mathrm{C}_{1} \) bitmap is used for the following cases, otherwise four octets \( \mathrm{C}_{1} \) bitmap is used:
- the highest ServCellIndex of this MAC entity's SCell for which beam failure is detected for SCell or for at least one BFD-RS set of SCell and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed is less than 8 ; or
- beam failure is detected for SpCell (as specified in Clause 5.17) not configured with two BFD-RS sets, and the SpCell is to be indicated in a Truncated Enhanced BFR MAC CE and the UL-SCH resources available for transmission cannot accommodate the Truncated Enhanced BFR MAC CE with the four octets \( \mathrm{C}_{1} \) bitmap plus its subheader as a result of LCP; or
- Random Access procedure is initiated for beam failure recovery of both BFD-RS sets of SpCell (as specified in Clause 5.17) configured with two BFD-RS sets and the SpCell is to be indicated in a Truncated Enhanced BFR MAC CE and the UL-SCH resources available for transmission cannot accommodate the Truncated Enhanced BFR MAC CE with the four octets Ci bitmap plus its subheader as a result of LCP.

For Enhanced BFR MAC CE and Truncated Enhanced BFR MAC CE, a single octet \( S_{k} \) bitmap is included if the total number of Serving Cells configured with two BFD-RS sets for which SP/C, field set to 1 is greater than 0 and less than 9; a two octets \( \mathrm{S}_{\mathrm{k}} \) bitmap is included if the total number of Serving Cells configured with two BFD-RS sets for which \( \mathrm{SP} / \mathrm{C}_{1} \) field set to 1 is greater than 8 and less than 17; a three octets \( \mathrm{S}_{\mathrm{k}} \) bitmap is included if the total number of Serving Cells configured with two BFD-RS sets for which SP/ \( \mathrm{C}_{1} \) field is set to 1 is greater than 16 and less than 25; a four octets \( \mathrm{S}_{\mathrm{k}} \) bitmap is included if the total number of Serving Cells configured with two BFD-RS sets for which SP/C 1 is greater than \( 24 ; \mathrm{S}_{\mathrm{k}} \) bitmap is not included if the total number of Serving Cells configured with two BFD-RS sets for which SP/C, field is set to 1 is zero.

For Truncated Enhanced BFR MAC CE, octet(s) containing the AC field, if any, are included for SpCell first, then one octet containing the AC field is included for SCell(s) (in ascending order of the ServCellIndex) and then the second

ETSI


--- Page 252  ---


3GPP TS 38.321 version 18.2.0 Release 18
251
ETSI TS 138321 V18.2.0 (2024-08)

octet containing the AC field, if any, is included for SCell(s) (in ascending order of the ServCellIndex), while not exceeding the available grant size. The number of the octets containing the AC field in the Truncated Enhanced BFR MAC CE can be zero.

The fields in the Enhanced BFR MAC CEs are defined as follows:
- SP (Enhanced BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17 ) for the SpCell of this MAC entity and the presence of octet(s) containing the AC field if the SpCell is configured with multiple BFD-RS sets. For the SpCell configured with two BFD-RS sets, this field set to 1 indicates that beam failure is detected for at least one BFD-RS set, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet(s) containing the AC field is present for the SpCell; otherwise, it is set to 0 . The octet(s) containing the AC field for SpCell are included before those of SCell(s). For the SpCell not configured with multiple BFD-RS sets, the SP field is set to 1 to indicate that beam failure is detected for SpCell when Enhanced BFR MAC CE is to be included into a MAC PDU as part of Random Access Procedure (as specified in 5.1.3a and 5.1.4); otherwise, it is set to 0;
- SP (Truncated Enhanced BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17) for the SpCell of this MAC entity. For the SpCell configured with two BFD-RS sets, this field set to 1 indicates that beam failure is detected for at least one BFD-RS set, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet(s) containing the AC field may be present for the SpCell; otherwise, it is set to 0 . For the SpCell not configured with multiple BFD-RS sets, the SP field is set to 1 to indicate that beam failure is detected for SpCell when Truncated Enhanced BFR MAC CE is to be included into a MAC PDU as part of Random Access Procedure (as specified in 5.1.3a and 5.1.4); otherwise, it is set to 0 ;
- \( \mathrm{C}_{1} \) (Enhanced BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17) and the presence of octet(s) containing the AC field for the SCell with ServCellIndex i as specified in TS 38.331 [5]. The \( \mathrm{C}_{1} \) field set to 1 indicates that beam failure is detected for the SCell or at least one BFD-RS set of the SCell, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet(s) containing the AC field is present for the SCell with ServCellIndex i. The \( \mathrm{C}_{1} \) field set to 0 indicates either that the beam failure is not detected for the SCell or any BFD-RS set of the SCell, and the octet(s) containing the AC field is not present for the SCell with ServCellIndex \( i \); or that the beam failure is detected for the SCell or at least one BFD-RS set of the SCell but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed, and the octets containing the AC field is not present for the SCell with ServCelllndex i . The octets containing the AC field are present in ascending order based on the ServCellIndex and are included after the octet(s) containing the AC field for SpCell, if any;
- \( \mathrm{C}_{1} \) (Truncated Enhanced BFR MAC CE): This field indicates beam failure detection (as specified in clause 5.17) for the SCell with ServCellIndex i as specified in TS 38.331 [5]. The \( \mathrm{C}_{1} \) field set to 1 indicates that beam failure is detected for the SCell or at least one BFD-RS set of the SCell, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed, and the octet(s) containing the AC field for the SCell with ServCelllndex i may be present. The \( \mathrm{C}_{1} \) field set to 0 indicates either that the beam failure is not detected for the SCell or any BFD-RS set of the SCell, and the octet(s) containing the AC field is not present for the SCell with ServCellIndex \( i \); or that the beam failure is detected for the SCell or at least one BFD-RS set of the SCell but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed, and the octet(s) containing the AC field is not present for the SCell with ServCellIndex i;
- \( \mathrm{S}_{\mathrm{k}} \) (Enhanced BFR MAC CE): This field corresponds to the \( \mathrm{k}^{\text {th }} \) Serving Cell for which SP/C field is set to 1 and is configured with two BFD-RS sets. The Serving Cells for which SP/C1 field is set to 1 and are configured with two BFD-RS sets, are indexed sequentially starting with SpCell and followed by SCells in ascending order of ServCellIndex i. This field indicates whether beam failure is detected for one or both BFD-RS sets and presence of one or two octets containing the AC field of the Serving Cell. The \( \mathrm{S}_{\mathrm{k}} \) field set to 1 indicates that beam failure is detected for both the BFD-RS sets, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed for both the BFD-RS sets, and the octets containing the AC field are present for both the BFD-RS sets, of the Serving Cell. The \( \mathrm{S}_{\mathrm{k}} \) field set to 0 indicates that beam failure is either detected for one of the BFD-RS sets and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed or beam failure is detected for both the BFD-RS sets but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed for both the BFD-RS sets, and the octet containing the AC field is present for only one BFDRS set of the Serving Cell. The \( \mathrm{S}_{\mathrm{k}} \) field not mapped to any Serving Cell is set to 0 ;

ETSI


--- Page 253  ---


3GPP TS 38.321 version 18.2.0 Release 18
252
ETSI TS 138321 V18.2.0 (2024-08)
- \( \mathrm{S}_{\mathrm{k}} \) (Truncated Enhanced BFR MAC CE): This field corresponds to the \( \mathrm{k}^{\text {th }} \) Serving Cell for which SP/C, field is set to 1 and is configured with two BFD-RS sets. The Serving Cells for which SP/C, field is set to 1 and are configured with two BFD-RS sets, are indexed sequentially starting with SpCell and followed by SCells in ascending order of ServCellIndex i. This field indicates whether beam failure is detected for one or both BFD-RS sets of the Serving Cell. The \( \mathrm{S}_{\mathrm{k}} \) field set to 1 indicates that beam failure is detected for both the BFD-RS sets, the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed for both the BFD-RS sets, and the octet containing the AC field is present for zero, one or two BFDRS sets of the Serving Cell. The \( S_{k} \) field set to 0 indicates that beam failure is either detected for one of the BFDRS sets and the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has been completed or beam failure is detected for both the BFD-RS sets but the evaluation of the candidate beams according to the requirements as specified in TS 38.133 [11] has not been completed for both the BFD-RS sets, and the octet containing the AC field is present for zero or one BFD-RS set of the Serving Cell. The \( \mathrm{S}_{\mathrm{k}} \) field not mapped to any Serving Cell is set to 0 ;
- AC: This field indicates the presence of the Candidate RS ID field in this octet. If at least one of the SSBs with SS-RSRP above rsrp-ThresholdBFR amongst the SSBs in list of candidate beams (i.e. candidateBeamRS-List\( r 16 \) for the SCell not configured with two BFD-RS sets, candidateBeamRS-List-r16 or candidateBeamRS-List2\( r l 7 \) for Serving Cell configured with two BFD-RS sets) or the CSI-RSs with CSI-RSRP above rsrpThresholdBFR amongst the CSI-RSs in list of candidate beams is available, the AC field is set to 1 ; otherwise, it is set to 0 . If the \( A C \) field set to 1 , the Candidate RS ID field is present. If the \( A C \) field set to \( 0, R \) bits are present instead;
- ID: This field indicates the identity of the BFD-RS set. It is set to 0 if this octet corresponds to BFD-RS set one, failureDetectionSet1-r17. It is set to 1 if this octet corresponds to BFD-RS set two, failureDetectionSet2-r17. For the Serving cell not configured with two BFD-RS sets, this field is set to 0 ;
- Candidate RS ID: This field is set to the index of an SSB with SS-RSRP above rsrp-ThresholdBFR amongst the SSBs in list of candidate beams (i.e candidateBeamRS-List-r 16 for the SCell not configured with two BFD-RS sets, candidateBeamRS-List-r 16 or candidateBeamRS-List2-r 17 for Serving Cell configured with two BFD-RS sets) or to the index of a CSI-RS with CSI-RSRP above rsrp-ThresholdBFR amongst the CSI-RSs in the list of candidate beams. Index of an SSB or CSI-RS is the index of an entry in the list of candidate beams corresponding to the SSB or CSI-RS. Index 0 corresponds to the first entry in the list of candidate beams, index 1 corresponds to the second entry in the list and so on. The length of this field is 6 bits;
- R: Reserved bit, set to 0 .

\begin{table}
\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline \multicolumn{8}{|c|}{} \\
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{5} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & SP \\
\hline \( \mathrm{S}_{7} \) & \( \mathrm{S}_{6} \) & \( \mathrm{S}_{5} \) & \( \mathrm{S}_{4} \) & \( \mathrm{S}_{3} \) & \( \mathrm{S}_{2} \) & \( \mathrm{S}_{1} \) & \( \mathrm{S}_{0} \) \\
\hline AC & ID & \multicolumn{6}{|c|}{Candidate RS ID or R bits} \\
\hline \multicolumn{8}{|c|}{⋯} \\
\hline AC & ID & \multicolumn{6}{|c|}{Candidate RS ID or R bits} \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{Figure 6.1.3.43-1: Enhanced BFR and Truncated Enhanced BFR MAC CE with one octet \( \mathrm{C}_{\mathrm{i}} \) field}
\end{table}

ETSI


--- Page 254  ---


3GPP TS 38.321 version 18.2.0 Release 18
253
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & SP \\
\hline \( \mathrm{C}_{15} \) & \( \mathrm{C}_{14} \) & \( \mathrm{C}_{13} \) & \( \mathrm{C}_{12} \) & \( \mathrm{C}_{11} \) & \( \mathrm{C}_{10} \) & \( \mathrm{C}_{9} \) & \( \mathrm{C}_{8} \) \\
\hline \( \mathrm{C}_{23} \) & \( \mathrm{C}_{22} \) & \( \mathrm{C}_{21} \) & \( \mathrm{C}_{20} \) & \( \mathrm{C}_{19} \) & \( \mathrm{C}_{18} \) & \( \mathrm{C}_{17} \) & \( \mathrm{C}_{16} \) \\
\hline \( \mathrm{C}_{31} \) & \( \mathrm{C}_{30} \) & \( \mathrm{C}_{29} \) & \( \mathrm{C}_{28} \) & \( \mathrm{C}_{27} \) & \( \mathrm{C}_{26} \) & \( \mathrm{C}_{25} \) & \( \mathrm{C}_{24} \) \\
\hline \( \mathrm{S}_{7} \) & \( \mathrm{S}_{6} \) & \( \mathrm{S}_{5} \) & \( \mathrm{S}_{4} \) & \( \mathrm{S}_{3} \) & \( \mathrm{S}_{2} \) & \( \mathrm{S}_{1} \) & \( \mathrm{S}_{0} \) \\
\hline \( \mathrm{S}_{15} \) & \( \mathrm{S}_{14} \) & \( S_{13} \) & \( \mathrm{S}_{12} \) & \( \mathrm{S}_{11} \) & \( \mathrm{S}_{10} \) & \( \mathrm{S}_{9} \) & \( \mathrm{S}_{8} \) \\
\hline \( \mathrm{S}_{23} \) & \( \mathrm{S}_{22} \) & \( S_{21} \) & \( S_{20} \) & \( \mathrm{S}_{19} \) & \( \mathrm{S}_{18} \) & \( \mathrm{S}_{17} \) & \( \mathrm{S}_{16} \) \\
\hline \( \mathrm{S}_{31} \) & \( \mathrm{S}_{30} \) & \( \mathrm{S}_{29} \) & \( \mathrm{S}_{28} \) & \( \mathrm{S}_{27} \) & \( \mathrm{S}_{26} \) & \( \mathrm{S}_{25} \) & \( \mathrm{S}_{24} \) \\
\hline AC & ID & \multicolumn{6}{|c|}{Candidate RS ID or R bits} \\
\hline AC & ID & \multicolumn{6}{|c|}{Candidate RS ID or R bits} \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{Figure 6.1.3.43-2: Enhanced BFR and Truncated Enhanced BFR MAC CE with four octets \( \mathrm{C}_{i} \) field}
\end{table}
6.1.3.44 Enhanced TCI States Indication for UE-specific PDCCH MAC CE

The Enhanced TCI States Indication for UE-specific PDCCH MAC CE is identified by a MAC PDU subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size of 24 bits with following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneous TCI-UpdateListl or simultaneous TCI-UpdateList2 as specified in TS 38.331 [5], this MAC CE applies to all theServing Cells in the set simultaneousTCI-UpdateList1 or simultaneousTCI-UpdateList2, respectively;
- CORESET ID: This field indicates a Control Resource Set identified with ControlResourceSetld as specified in TS 38.331 [5], for which the TCI State is being indicated. In case the value of the field is 0 , the field refers to the Control Resource Set configured by controlResourceSetZero as specified in TS 38.331 [5]. The length of the field is 4 bits;
- TCI state IDi: This field indicates the TCI state identified by TCI-Stateld as specified in TS 38.331 [5] applicable to the Control Resource Set identified by CORESET ID field. If the field of CORESET ID is set to the other value than 0 , this field indicates a TCI-Stateld configured by tci-StatesPDCCH-ToAddList and tci-StatesPDCCH-ToReleaseList in the controlResourceSet identified by the indicated CORESET ID. The length of the field is 7 bits.

NOTE 1: The Enhanced TCI State Indication for UE specific PDCCH MAC CE is not applicable to any of the configured CORESETs in a BWP if the CORESETs are configured with different CORESETPoolindex values in the BWP.

NOTE 2: The Enhanced TCI State Indication for UE specific PDCCH MAC CE is applied only if sfnSchemePdcch is configured.

ETSI


--- Page 255  ---


3GPP TS 38.321 version 18.2.0 Release 18
254
ETSI TS 138321 V18.2.0 (2024-08)

NOTE 3: The Enhanced TCI State Indication for UE specific PDCCH MAC CE is not applicable to the CORESET configured by controlResourceSetZero if the CORESET is associated with the search space configured by pdcch-ConfigSIB1 in MIB, or searchSpaceSIB1, searchSpaceZero, searchSpaceOtherSystemInformation, or pagingSearchSpace in PDCCH-ConfigCommon.

Figure 6.1.3.44-1: Enhanced TCI States Indication for UE-specific PDCCH MAC CE
6.1.3.45 PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE

The PUCCH Spatial Relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- BWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- C: This field indicates whether single or two spatial relation info(s) is activated for the indicated PUCCH Resource ID. If this field is set to 1 , octet containing the second spatial relation info for the indicated PUCCH Resource is present. If this field is set to 0 , octet containing the second spatial relation info for the indicated PUCCH Resource is not present;
- PUCCH Resource ID: This field contains an identifier of the PUCCH resource ID identified by PUCCHResourceld as specified in TS 38.331 [5], which is to be activated with a spatial relations indicated by Spatial Relation Info IDi fields in the subsequent octet(s). The length of the field is 7 bits. If the indicated PUCCH Resource ID is included in a PUCCH Resource Group (configured via resourceGroupToAddModList as specified in TS 38.331 [5]) of the indicated UL BWP, no other PUCCH Resources within the same PUCCH Resource group are indicated in the MAC CE, and this MAC CE applies to all the PUCCH Resources in the PUCCH Resource group;
- Spatial Relation [nfo [Di: This field contains PUCCH-SpatialRelationInfold-r16 where PUCCHSpatialRelationInfold is the identifier of the PUCCH Spatial Relation [nfo in PUCCH-Config in which the PUCCH Resource ID is configured, as specified in TS 38.331 [5], where \( i \) is the index of the activated spatial relation info ID. The length of the field is 6 bits;
- R: Reserved bit, set to 0 .

ETSI


--- Page 256  ---


3GPP TS 38.321 version 18.2.0 Release 18
255
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.45-1: PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE
6.1.3.46 PUCCH Power Control Set Update for multiple TRP PUCCH repetition MAC CE

The PUCCH Power Control Set Update for multiple TRP PUCCH repetition MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- BWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- C: This field indicates whether single or two power control set(s) is activated for the indicated PUCCH Resource ID. If this field is set to 1 , the second power control set index (i.e. Power Control Set ID1) for the indicated PUCCH Resource is present. If this field is set to 0 , the second power control set index (i.e. Power Control Set ID1) for the indicated PUCCH Resource is not present;
- PUCCH Resource ID: This field contains an identifier of the PUCCH resource ID identified by PUCCHResourceld as specified in TS 38.331 [5], which is to be activated with a power control set(s) indicated by Power Control Set IDi fields in the subsequent octet. The length of the field is 7 bits. If the indicated PUCCH Resource ID is included in a PUCCH Resource Group (configured via resourceGroupToAddModList as specified in TS 38.331 [5]) of the indicated UL BWP, no other PUCCH Resources within the same PUCCH Resource group are indicated in the MAC CE, and this MAC CE applies to all the PUCCH Resources in the PUCCH Resource group;
- Power Control Set [D1: This field contains PUCCH-PowerControlSetInfold where PUCCHPowerControlSetInfold is the identifier of the PUCCH Power Control Set in PUCCH-Config in which the PUCCH Resource ID is configured, as specified in TS 38.331 [5], where \( i \) is the index of the power control set ID. The length of the field is 3 bits;
- R: Reserved bit, set to 0 .

ETSI


--- Page 257  ---


3GPP TS 38.321 version 18.2.0 Release 18
256
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.46-1: PUCCH power control set update for multiple TRP PUCCH repetition MAC CE
6.1.3.47 Unified TCI States Activation/Deactivation MAC CE

The Unified TCI States Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size consisting of following fields:
- CORESET Pool ID: This field indicates that the mapping between the activated TCI states and the codepoint of the DCI Transmission Configuration Indication set by field TCI state ID is specific to the ControlResourceSetld configured with CORESET Pool ID as specified in TS 38.331 [5]. This field set to 1 indicates that the TCI states are specified to CORESET pool ID equal to 1 , otherwise the TCI states are specified to CORESET pool ID equal to 0 . If no more than one value for the coresetPoollndex is configured for any CORESET in the BWP, the R bit is present instead;
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneous U-TCI-UpdateList I, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4 as specified in TS 38.331 [5], this MAC CE applies to all theServing Cells in the set simultaneous U-TCIUpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCIUpdateList4, respectively;
- DL BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- UL BWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. If value of unifiedTCI-StateType in the Serving Cell indicated by Serving Cell ID is joint, this field is considered as the reserved bits. The length of the BWP ID field is 2 bits;
- \( \mathrm{P}_{1} \) : This field indicates whether each TCI codepoint has multiple TCI states or single TCI state. If \( \mathrm{P}_{1} \) field is set to 1 , it indicates that \( i^{\text {th }} \) TCI codepoint includes the DL TCI state and the UL TCI state. If \( \mathrm{P}_{1} \) field is set to 0 , it indicates that \( i^{\text {th }} \) TCI codepoint includes only the DL/joint TCI state or the UL TCI state. The codepoint to which a TCI state is mapped is determined by its ordinal position among all the TCI state ID fields;
- D/U: This field indicate whether the TCI state ID in the same octet is for joint/downlink or uplink TCI state. If this field is set to 1 , the TCI state ID in the same octet is for joint/downlink. If this field is set to 0 , the TCI state ID in the same octet is for uplink;
- TCI state ID: This field indicates the TCI state identified by TCI-Stateld as specified in TS 38.331 [5]. If D/U is set to 1,7-bits length TCI state ID i.e TCI-Stateld as specified in TS 38.331 [5] is used. If D/U is set to 0, the most significant bit of TCI state ID is considered as the reserved bit and remainder 6 bits indicate the TCI-UL-State-Id as specified in TS 38.331 [5]. The maximum number of activated TCI states is 16;
- R: Reserved bit, set to 0 .

ETSI


--- Page 258  ---


3GPP TS 38.321 version 18.2.0 Release 18
257
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.47-1: Unified TCI state activation/deactivation MAC CE
6.1.3.48 Enhanced Single Entry PHR MAC CE

The Enhanced Single Entry PHR MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.12b. It has a variable size with following fields:
- R: Reserved bit, set to 0 ;
- Power Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 below (the corresponding measured values in dB are specified in TS 38.133 [11]);
- P: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than PMPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by \( \mathrm{P}_{-} \mathrm{MPR}_{\mathrm{c}} \) as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) field would have had a different value if no power backoff due to power management had been applied;
- P \( _{\text {CMAX, } 5, \mathrm{C}} \) : This field indicates the P \( _{\text {CMAX, } 5, \mathrm{C}} \) (as specified in TS 38.213 [6]) used for calculation of the preceding PH field. The reported \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{JC}} \) and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm are specified in TS 38.133 [11]);
- MPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to \( 0, \mathrm{R} \) bits are present instead;
- \( B_{1} \) : This field indicates whether the candidate beam information identified by Resource, is present or not. If the \( B_{1} \) field is set to 1 , the first octet containing Resource is present and if the \( B_{2} \) field is set to 1 , the second octet containing Resource \( { }_{2} \) is present, and so on;
- \( \mathrm{P}_{1} \) : If mpe-Reporting-FR2-r17 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise;
- MPE \( \mathrm{E}_{1} \) : If mpe-Reporting-FR2-r17 is configured, and the Serving Cell operates on FR2, and if the corresponding \( P_{1} \) field is set to 1 , this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR

ETSI


--- Page 259  ---


3GPP TS 38.321 version 18.2.0 Release 18
258
ETSI TS 138321 V18.2.0 (2024-08)

levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2-r17 is not configured, or if the Serving Cell operates on FR1, or if the \( \mathrm{P}_{1} \) field is set to \( 0, \mathrm{R} \) bits are present instead;
- Resource; This field indicates the candidate beam identified by the number of entries in the corresponding mpeResourcePoolToAddModList as specified in TS 38.331 [5]. The length of this field 6 bits;
- R: Reserved bit, set to 0 .

Figure 6.1.3.48-1: Enhanced Single Entry PHR MAC CE
6.1.3.49 Enhanced Multiple Entry PHR MAC CE

The Enhanced Multiple Entry PHR MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.12b. It has a variable size with following fields:
- \( \mathrm{C}_{1} \) : This field indicates the presence of PH field(s) for the Serving Cell with ServCellIndex i as specified in TS 38.331 [5]. The \( \mathrm{C}_{1} \) field set to 1 indicates that PH field(s) for the Serving Cell with ServCellIndex i is reported. The \( \mathrm{C}_{1} \) field set to 0 indicates that a PH field for the Serving Cell with ServCellIndex i is not reported;
- R: Reserved bit, set to 0 ;
- V: This field indicates if the PH value is based on a real transmission or a reference format. For Type 1 PH , the V field set to 0 indicates real transmission on PUSCH and the V field set to 1 indicates that a PUSCH reference format is used. For Type 2 PH, the V field set to 0 indicates real transmission on PUCCH and the V field set to 1 indicates that a PUCCH reference format is used. For Type 3 PH , the V field set to 0 indicates real transmission on SRS and the V field set to 1 indicates that an SRS reference format is used. Furthermore, for Type 1, Type 2, and Type 3 PH , the V field set to 0 indicates the presence of the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}} \) field and the MPE field, and the V field set to 1 indicates that the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) field and the MPE field is omitted;
- Power Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dB for the E-UTRA Serving Cell are specified in TS 36.133 [12]);
- P: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than PMPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by \( \mathrm{P}^{-} \mathrm{MPR}_{\mathrm{c}} \) as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC

ETSI


--- Page 260  ---


3GPP TS 38.321 version 18.2.0 Release 18
259
ETSI TS 138321 V18.2.0 (2024-08)

entity shall set the \( P \) field to 1 if the corresponding \( P_{C M A X, N, C} \) field would have had a different value if no power backoff due to power management had been applied;
- \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) : If present, this field indicates the \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) (as specified in TS 38.213 [6]) for the NR Serving Cell and the \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}} \) or \( \tilde{\mathrm{P}}_{\mathrm{CMAX}, \mathrm{C}} \) (as specified in TS 36.213 [17]) for the E-UTRA Serving Cell used for calculation of the preceding PH field. The reported \( \mathrm{P}_{\mathrm{CMAX,N,C}} \) and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dBm for the E-UTRA Serving Cell are specified in TS 36.133 [12]);
- MPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1 , this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the \( P \) field is set to \( 0, R \) bits are present instead;
- \( B_{1} \) : This field indicates whether the candidate beam information identified by either Resource, is present or not. If the \( B_{1} \) field is set to 1 , the first octet containing Resource is present and if the \( B_{2} \) field is set to 1 , the second octet containing Resource \( _{2} \) is present, and so on.
- \( \quad \mathrm{P}_{1} \) : If mpe-Reporting-FR2-r17 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise;
- MPE \( \mathrm{E}_{1} \) : If mpe-Reporting-FR2-r17 is configured, and the Serving Cell operates on FR2, and if the corresponding \( \mathrm{P}_{\mathrm{i}} \) field is set to 1 , this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. [f mpe-Reporting-FR2-r17 is not configured, or if the Serving Cell operates on FR1, or if the P, field is set to O, R bits are present instead;
- Resource, This field indicates the candidate beam identified by by the number of entries in the corresponding mpe-ResourcePoolToAddModList as specified in TS 38.331 [5]. The length of this field 6 bits.
- R: Reserved bit, set to 0 .

ETSI


--- Page 261  ---


3GPP TS 38.321 version 18.2.0 Release 18
260
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & & & & & & & \\
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{5} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & R \\
\hline P & V & \multicolumn{6}{|r|}{PH (Type 2, SpCell of the other MAC entity)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{\( \mathrm{P}_{\text {CMAX,f,c }} 1 \)} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type 1, PCell)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{\( \mathrm{P}_{\text {CMAX, }, \mathrm{C}} 2 \)} \\
\hline \( \mathbf{B}_{\mathbf{1}} \) & \( \mathrm{B}_{2} \) & \( \mathrm{B}_{3} \) & \( \mathrm{B}_{4} \) & \( \mathrm{P}_{1} \) & \( \mathrm{P}_{2} \) & \( \mathrm{P}_{3} \) & \( \mathbf{P}_{\mathbf{4}} \) \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{1} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{2} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{3} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{4} \) or R} \\
\hline R & R & \multicolumn{6}{|c|}{Resource 1} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( { }_{2} \)} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( { }_{3} \)} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( { }_{4} \)} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type X, Serving Cell 1)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{\( \mathrm{P}_{\text {CMAX, }, \mathrm{c}, \mathrm{c}} 3 \)} \\
\hline \( \mathrm{B}_{1} \) & \( \mathrm{B}_{2} \) & \( \mathrm{B}_{3} \) & \( \mathrm{B}_{4} \) & \( \mathbf{P}_{\mathbf{1}} \) & \( \mathrm{P}_{2} \) & \( \mathrm{P}_{3} \) & \( \mathrm{P}_{4} \) \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{1} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{2} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{3} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{4} \) or R} \\
\hline R & R & \multicolumn{6}{|c|}{Resource 1} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( { }_{2} \)} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( { }_{3} \)} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( { }_{4} \)} \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|l|l|}
\hline P & V & \multicolumn{4}{|c|}{PH (Type X, Serving Cell n)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{4}{|c|}{\( \mathrm{P}_{\text {CMAX, fic }} \mathrm{m} \)} \\
\hline \( \mathrm{B}_{1} \) & \( \mathrm{B}_{2} \) & \( \mathrm{B}_{3} \) & \( \mathbf{P}_{\mathbf{1}} \) & \( \mathrm{P}_{3} \) & \( \mathrm{P}_{4} \) \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{1} \) or R} & \( \mathrm{MPE}_{2} \) or R & \( \mathrm{MPE}_{3} \) or R & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{4} \) or R} \\
\hline R & R & \multicolumn{4}{|c|}{Resource \( { }_{1} \)} \\
\hline R & R & \multicolumn{4}{|c|}{Resource \( { }_{2} \)} \\
\hline R & R & \multicolumn{4}{|c|}{Resource \( { }_{3} \)} \\
\hline R & R & \multicolumn{4}{|c|}{Resource \( { }_{4} \)} \\
\hline
\end{tabular}

ETSI


--- Page 262  ---


3GPP TS 38.321 version 18.2.0 Release 18
261
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.49-1: Enhanced Multiple Entry PHR MAC CE with the highest ServCelllndex of Serving Cell with configured uplink is less than 8

ETSI


--- Page 263  ---


3GPP TS 38.321 version 18.2.0 Release 18
262
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & & & & & & & \\
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{5} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & R \\
\hline \( \mathrm{C}_{15} \) & \( \mathrm{C}_{14} \) & \( \mathrm{C}_{13} \) & \( \mathrm{C}_{12} \) & \( \mathrm{C}_{11} \) & \( \mathrm{C}_{10} \) & \( \mathrm{C}_{9} \) & \( \mathrm{C}_{8} \) \\
\hline \( \mathrm{C}_{23} \) & \( \mathrm{C}_{22} \) & \( \mathrm{C}_{21} \) & \( \mathrm{C}_{20} \) & \( \mathrm{C}_{19} \) & \( \mathrm{C}_{18} \) & \( \mathrm{C}_{17} \) & \( \mathrm{C}_{16} \) \\
\hline \( \mathrm{C}_{31} \) & \( \mathrm{C}_{30} \) & \( \mathrm{C}_{29} \) & \( \mathrm{C}_{28} \) & \( \mathrm{C}_{27} \) & \( \mathrm{C}_{26} \) & \( \mathrm{C}_{25} \) & \( \mathrm{C}_{24} \) \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type 2, SpCell of the other MAC entity)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{\( \mathrm{P}_{\text {CMAX, f.c }} 1 \)} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type 1, PCell)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{\( \mathrm{P}_{\text {CMAX, f.c }} 2 \)} \\
\hline B \( _{1} \) & \( \mathbf{B}_{\mathbf{2}} \) & \( \mathrm{B}_{3} \) & B \( _{4} \) & \( \mathrm{P}_{1} \) & \( \mathrm{P}_{2} \) & \( \mathrm{P}_{3} \) & \( \mathrm{P}_{4} \) \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{1} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{2} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{3} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{4} \) or R} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( { }_{1} \)} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( { }_{2} \)} \\
\hline R & R & \multicolumn{6}{|c|}{Resource 3} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( _{4} \)} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type X, Serving Cell 1)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{\( \mathrm{P}_{\text {CMAX, f.c }} 3 \)} \\
\hline \( \mathbf{B}_{1} \) & \( \mathbf{B}_{\mathbf{2}} \) & \( \mathrm{B}_{3} \) & B \( _{4} \) & \( \mathrm{P}_{1} \) & \( \mathrm{P}_{2} \) & \( \mathrm{P}_{3} \) & \( \mathrm{P}_{4} \) \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{1} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{2} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{3} \) or R} & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{4} \) or R} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( { }_{1} \)} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( { }_{2} \)} \\
\hline R & R & \multicolumn{6}{|c|}{Resource 3} \\
\hline R & R & \multicolumn{6}{|c|}{Resource \( _{4} \)} \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|l|l|}
\hline P & V & \multicolumn{4}{|c|}{PH (Type X, Serving Cell n)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{4}{|c|}{\( \mathrm{P}_{\text {CMAX, fc }} \mathrm{m} \)} \\
\hline \( \mathrm{B}_{1} \) & \( \mathrm{B}_{2} \) & \( \mathrm{B}_{3} \) & \( \mathrm{P}_{1} \) & \( \mathrm{P}_{3} \) & \( \mathbf{P}_{\mathbf{4}} \) \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{1} \) or R} & \( \mathrm{MPE}_{2} \) or R & \( \mathrm{MPE}_{3} \) or R & \multicolumn{2}{|c|}{\( \mathrm{MPE}_{4} \) or R} \\
\hline R & R & \multicolumn{4}{|c|}{Resource \( { }_{1} \)} \\
\hline R & R & \multicolumn{4}{|c|}{Resource \( { }_{2} \)} \\
\hline R & R & \multicolumn{4}{|c|}{Resource \( { }_{3} \)} \\
\hline R & R & \multicolumn{4}{|c|}{Resource 4} \\
\hline
\end{tabular}

ETSI


--- Page 264  ---


3GPP TS 38.321 version 18.2.0 Release 18
263
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.49-2: Enhanced Multiple Entry PHR MAC CE with the highest ServCellindex of Serving Cell with configured uplink is equal to or higher than 8
6.1.3.50 Enhanced Single Entry PHR for multiple TRP MAC CE

The Enhanced Single Entry PHR for multiple TRP MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b.

The two PHs together with one \( \mathrm{P}_{\text {CMAX, }, \mathrm{C}} \) for the Serving Cell are reported if UE is configured with twoPHRMode with the multiple TRP PUSCH repetition feature is configured.

It has a fixed size and consists of three octets defined as follows (Figure 6.1.3.50-1):
- R: Reserved bit, set to 0 ;
- Power Headroom i (PH i): This field indicates the power headroom level, where PH 1 is associated with the SRSResourceSet with a lower srs-ResourceSetld and PH 2 is associated with the SRS-ResourceSet with a higher srsResourceSetld. PH fields for a Serving Cell are included in ascending order based on i . The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB are specified in TS 38.133 [11]);
- P: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than PMPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}, \mathrm{C}} \) field would have had a different value if no power backoff due to power management had been applied;
- V: This field indicates if the PH value for the corresponding TRP is based on a real transmission or a reference format. For Type 1 PH, the V field set to 0 indicates real transmission on PUSCH and the V field set to 1 indicates that a PUSCH reference format is used;
- \( \mathrm{P}_{\text {CMAX, } \sqrt{\mathrm{c}} \text { : }} \) This field indicates the \( \mathrm{P}_{\text {CMAX, } 5 \mathrm{C}} \) (as specified in TS 38.213 [6]) used for calculation of the preceding PH fields. The reported \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm are specified in TS 38.133 [11]);
- MPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to \( 0, \mathrm{R} \) bits are present instead.

Figure 6.1.3.50-1: Enhanced Single Entry PHR for multiple TRP MAC CE
6.1.3.51 Enhanced Multiple Entry PHR for multiple TRP MAC CE

The Enhanced Multiple Entry PHR for multiple TRP MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b.

It has a variable size, and includes the bitmaps, a Type 2 PH field and an octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) field (if reported) for SpCell of the other MAC entity, a Type 1 PH field and an octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) field

ETSI


--- Page 265  ---


3GPP TS 38.321 version 18.2.0 Release 18
264
ETSI TS 138321 V18.2.0 (2024-08)

(if reported) for the PCell. It further includes, in ascending order based on the ServCellIndex, one or multiple of Type X PH fields and octets containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}, \mathrm{C}} \) fields (if reported) for Serving Cells other than PCell indicated in the bitmap for indicating the presence of \( \mathrm{PH}(\mathrm{s}) \). X is either 1 or 3 according to TS 38.213 [6] and TS 36.213 [17].

The presence of Type 2 PH field for SpCell of the other MAC entity is configured by phr-Type2OtherCell with value true

A single octet bitmap is used for indicating the presence of \( \mathrm{PH}(\mathrm{s}) \) per Serving Cell when the highest ServCellIndex of Serving Cell with configured uplink is less than 8 , otherwise four octets are used.

The MAC entity determines whether PH value for an activated Serving Cell is based on real transmission or a reference format by considering the configured grant(s) and downlink control information which has been received until and including the PDCCH occasion in which the first UL grant for a new transmission that can accommodate the MAC CE for PHR as a result of LCP as defined in clause 5.4.3.1 is received since a PHR has been triggered if the PHR MAC CE is reported on an uplink grant received on the PDCCH or until the first uplink symbol of PUSCH transmission minus PUSCH preparation time as defined in clause 7.7 of TS 38.213 [6] if the PHR MAC CE is reported on a configured grant.

For a band combination in which the UE does not support dynamic power sharing, the UE may omit the octets containing Power Headroom field and \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) field for Serving Cells in the other MAC entity except for the PCell in the other MAC entity and the reported values of Power Headroom and \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) for the PCell are up to UE implementation.

The two PHs together with one \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) for the Serving Cell configured with the multiple TRP PUSCH repetition feature is configured are reported if the MAC entity is configured with twoPHRMode.

The Enhanced Multiple Entry PHR for multiple TRP MAC CEs are defined as follows:
- \( \mathrm{C}_{1} \) : This field indicates the presence of PH field(s) for the Serving Cell with ServCellIndex i as specified in TS 38.331 [5]. The \( \mathrm{C}_{1} \) field set to 1 indicates that PH field(s) for the Serving Cell with ServCellIndex 1 is reported. The \( \mathrm{C}_{1} \) field set to 0 indicates that a PH field for the Serving Cell with ServCellIndex \( i \) is not reported;
- R: Reserved bit, set to 0 ;
- V: This field indicates if the PH value is based on a real transmission or a reference format. For Type 1 PH, the V field set to 0 indicates real transmission on PUSCH and the V field set to 1 indicates that a PUSCH reference format is used. For Type 2 PH, the V field set to 0 indicates real transmission on PUCCH and the V field set to 1 indicates that a PUCCH reference format is used. For Type 3 PH , the V field set to 0 indicates real transmission on SRS and the V field set to 1 indicates that an SRS reference format is used. Furthermore, for Type 1, Type 2, and Type 3 PH , the V field set to 0 indicates the presence of the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}} \) field and the MPE field, and all of the V field(s) for the Serving Cell set to 1 indicates that the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) field and the MPE field is omitted;
- Power Headroom i (PH i): This field indicates the power headroom level, where PH 1 is associated with the SRSResourceSet with a lower srs-ResourceSetld and PH 2 is associated with the SRS-ResourceSet with a higher srsResourceSetld. PH fields for a Serving Cell are included in ascending order based on \( i \). The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dB for the E-UTRA Serving Cell are specified in TS 36.133 [12]);
- P: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than PMPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) field would have had a different value if no power backoff due to power management had been applied;
- P \( _{\text {CMAX, } \sqrt{c} \text { : If present, this field indicates the } \text { P }_{\text {CMAX, } \sqrt{c} \text { ( } \text { as } \text { specified }} \text { in TS } 38.213 \text { [6]) for the NR Serving Cell and }} \) the \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{c}} \) or \( \tilde{\mathrm{P}}_{\mathrm{CMAX}, \mathrm{c}} \) (as specified in TS 36.213 [17]) for the E-UTRA Serving Cell used for calculation of the preceding PH field. The reported \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dBm for the E-UTRA Serving Cell are specified in TS 36.133 [12]);

ETSI


--- Page 266  ---


3GPP TS 38.321 version 18.2.0 Release 18
265
ETSI TS 138321 V18.2.0 (2024-08)
- MPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to \( 0, \mathrm{R} \) bits are present instead.

\begin{tabular}{|c|c|c|}
\hline\( P \) & \( V \) & \( P H 1 \) (Type X, Serving Cell \( n \) ) \\
\hline\( R \) & \( V \) & \( P H 2 \) (Type X, Serving Cell \( n \) ) \\
\hline \multicolumn{2}{|c|}{ MPE or R } & (Optional) \\
\hline
\end{tabular}

Figure 6.1.3.51-1: Enhanced Multiple Entry PHR for multiple TRP MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is less than 8

ETSI


--- Page 267  ---


3GPP TS 38.321 version 18.2.0 Release 18
266
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.51-2: Enhanced Multiple Entry PHR for multiple TRP MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is equal to or higher than 8
6.1.3.52 Sidelink DRX Command MAC CE

The Sidelink DRX Command MAC CE is identified by a MAC subheader with LCID as specified in Table 6.2.4-1. The priority of the Sidelink DRX Command MAC CE is fixed to ' 1 '.

It has a fixed size of zero bits.
SL DRX Command MAC CE is only supported in sidelink unicast.
6.1.3.53 Inter-UE Coordination Information MAC CE

The Inter-UE Coordination Information MAC CE or Enhanced Inter-UE Coordination Information MAC CE is identified by a MAC subheader with corresponding LCID as specified in Table 6.2.4-1. The priority of the Inter-UE

ETSI


--- Page 268  ---


3GPP TS 38.321 version 18.2.0 Release 18
267
ETSI TS 138321 V18.2.0 (2024-08)

Coordination Information MAC CE or Enhanced Inter-UE Coordination Information MAC CE is fixed to '1' for Logical Channel Prioritization (LCP) procedure. The Inter-UE Coordination Information MAC CE (as shown in Figure 6.1.3.53-1) or the Enhanced Inter-UE Coordination Information MAC CE (as shown in Figure 6.1.3.53-2) has a variable size with following fields:
- RT: This field indicates the resource set type, i.e., preferred resource set or non-preferred resource set, as the codepoint value of the SCI format 2-C Resource set type field as specified in TS 38.212 [9].
- RSL: This field indicates the location of reference slot, as the codepoint value of the SCI format 2-C Reference slot location field as specified in TS 38.212 [9]. The length of the field is 17 bits. If the length of Reference slot location field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 17 bit, this field contains Reference slot location field using the LSB bits;
- \( \mathrm{LSI}_{1} \) : This field indicates the lowest subchannel indices for the first resource location of each TRIV, as the codepoint value of the SCI format 2-C Lowest subChannel indices field as specified in TS 38.212 [9]. LSI indicates the lowest subchannel indices for the first resource location of TRIV within the first resource combination, \( \mathrm{LSI}_{1} \) indicates the lowest subchannel indices for the first resource location of TRIV within the second resource combination and so on. For Inter-UE Coordination Information MAC CE, the length of the field is 5 bits. If the length of Lowest subChannel indices field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 5 bit, this field contains Lowest subChannel indices field using the LSB bits; For Enhanced Inter-UE Coordination Information MAC CE, the length of the field is 4 bits. If the length of Lowest subChannel indices field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 4 bit, this field contains Lowest subChannel indices field using the LSB bits;
- LRI: This field is only included in the Enhanced Inter-UE Coordination Information MAC CE. It indicates the lowest RB set indices for the first resource location of each TRIV, as the codepoint value of the SCI format 2-C Lowest RB set indices field as specified in TS 38.212 [9]. LRI indicates the lowest RB set indices for the first resource location of TRIV within the first resource combination, \( \mathrm{LRI}_{1} \) indicates the lowest RB set indices for the first resource location of TRIV within the second resource combination and so on. The length of the field is 3 bits. If the length of Lowest RB set indices field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 3 bits, this field contains Lowest RB set indices field using the LSB bits;
- \( \mathrm{RC}_{\mathrm{i}} \) : This field indicates resource combination, as the codepoint value of the SCI format 2-C Resource combinations field as specified in TS 38.212 [9]. The number of RC is based on upper bound of the L field in the MAC subheader as indicated in clause 6.2.1. \( \mathrm{RC}_{0} \) indicates the first resource combination, \( \mathrm{RC}_{1} \) indicates the second resource combination and so on. For Inter-UE Coordination Information MAC CE, the length of the field is 26 bits. If the length of Resource combinations field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 26 bit, this field contains Resource combinations field using the LSB bits; For Enhanced Inter-UE Coordination Information MAC CE, the length of the field is 28 bis. If the length of Resource combination field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 28 bits, this field contains Resource combination field using the LSB bits;
- First resource location \( 1_{1} \) : This field indicates the first resource location, as the codepoint value of the SCI format 2-C 0 field as specified in TS 38.212 [9]. First Resource Location indicates the first resource location for the second resource combination, First Resource Location \( { }_{1} \) indicates the first resource location for the third resource combination and so on. The length of the field is 13 bits. If the length of First resource location field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 13 bit, this field contains First resource location field using the LSB bits;
- R: Reserved bit, set to 0 .

NOTE: It is up to UE implementation to determine whether and how to select a subset of RCs to be included in the Inter-UE Coordination Information MAC CE.

ETSI


--- Page 269  ---


3GPP TS 38.321 version 18.2.0 Release 18
268
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.53-1: Inter-UE Coordination Information MAC CE

ETSI


--- Page 270  ---


3GPP TS 38.321 version 18.2.0 Release 18
269
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.53-2: Enhanced Inter-UE Coordination Information MAC CE
6.1.3.54 Inter-UE Coordination Request MAC CE

The Inter-UE Coordination request MAC CE or Enhanced Inter-UE Coordination Request MAC CE is identified by a MAC subheader with corresponding LCID as specified in Table 6.2.4-1. The priority of the Inter-UE Coordination Request MAC CE or Enhanced Inter-UE Coordination Request MAC CE is fixed to ' 1 ' for Logical Channel Prioritization (LCP) procedure. The Inter-UE Coordination MAC CE has a fixed size of 48 bits (as shown in Figure 6.1.3.54-1), and the Enhanced Inter-UE Coordination Request MAC CE has a fixed size of 56 bits (as shown in Figure 6.1.3.54-2). The fields are defined as follows:
- RT: If the value of sl-DetermineResourceType (as specified in TS 38.331 [5] clause 6.3.5) is set to ueb, this field indicates the resource set type, i.e., preferred resource set or non-preferred resource set, as the codepoint value of the SCI format 2-C Resource set type field as specified in TS 38.212 [9]. This field is ignored if the value of slDetermineResourceType is set to uea;
- RP: This field indicates the resource reservation period, as the codepoint value of the SCI format 2-C Resource reservation period field as specified in TS 38.212 [9]. The length of the field is 4 bits. If the length of Resource reservation period field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 4 bit, this field contains Resource reservation period field using the LSB bits;
- Priority: This field indicates the priority, as the codepoint value of the SCI format 2-C Priority field as specified in TS 38.212 [9]. The length of the field is 3 bits;

ETSI


--- Page 271  ---


3GPP TS 38.321 version 18.2.0 Release 18
270
ETSITS 138321 V18.2.0 (2024-08)
- RSWL: This field indicates resource selection window location, as the codepoint value of the SCI format 2-C Resource selection window location field as specified in TS 38.212 [9]. The length of the field is 34 bits. If the length of Resource selection window location field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 34 bit, this field contains Resource selection window location field using the LSB bits;
- Number of Subchannel: This field indicates the number of subchannels, as the codepoint value of the SCI format 2-C Number of subchannels field as specified in TS 38.212 [9]. For Inter-UE Coordination Request MAC CE, the length of the field is 5 bits. If the length of Number of subchannels field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 5 bit, this field contains Number of subchannels field using the LSB bits; for Enhanced Inter-UE Coordination Request MAC CE, the length of the field is 4 bits. If the length of Number of subchannel field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 4 bits, this field contains Number of subchannel field using the LSB bits;
- Number of RB Set: This field is only included in the enhanced format. It indicates the number of RB sets, as the codepoint value of the SCI format 2-C Number of RB set field as specified in TS 38.212 [9]. The length of the field is 3 bits. If the length of Number of RB set field in SCI format 2-C as specified in TS 38.212 [9] is shorter than 3 bits, this field contains Number of RB set field using the LSB bits;
- R: Reserved bit, set to 0 .

Figure 6.1.3.54-1: Inter-UE Coordination Request MAC CE

Figure 6.1.3.54-2: Enhanced Inter-UE Coordination Request MAC CE

ETSI


--- Page 272  ---


3GPP TS 38.321 version 18.2.0 Release 18
271
ETSI TS 138321 V18.2.0 (2024-08)
6.1.3.55 Enhanced SCell Activation/Deactivation MAC CEs

The Enhanced SCell Activation/Deactivation MAC CE with one octet \( \mathrm{C}_{1} \) field is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of seven C-fields, one R-field and zero or more TRS ID, fields in ascending order based on the ScellIndex for SCells indicated by the \( \mathrm{C}_{1} \) field(s) to be activated. The Enhanced SCell Activation/Deactivation MAC CE of with one octet \( \mathrm{C}_{1} \) field is defined as follows (Figure 6.1.3.55-1).

The Enhanced SCell Activation/Deactivation MAC CE with four octet \( \mathrm{C}_{1} \) field is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of 31 C -fields, one R -field and zero or more TRS ID, fields in ascending order based on the ScellIndex for SCells indicated by the \( \mathrm{C}_{1} \) field(s) to be activated. The Enhanced SCell Activation/Deactivation MAC CE with four octet \( \mathrm{C}_{1} \) field is defined as follows (Figure 6.1.3.55-2).
- \( \mathrm{C}_{1} \) : If there is an SCell configured for the MAC entity with SCellIndex i as specified in TS 38.331 [5], this field indicates the activation/deactivation status of the SCell with SCellIndex \( \mathrm{i}_{\text {, else the MAC entity shall ignore the } \mathrm{C}_{1}} \) field. The \( \mathrm{C}_{1} \) field is set to 1 to indicate that the SCell with SCellIndex i shall be activated and that a TRS ID, field is included for the SCell. The Ca field is set to 0 to indicate that the SCell with SCellindex i shall be deactivated and that no TRS ID field is included for this SCell;
- TRS [D]: If TRS ID, is set to a non-zero value, it indicates the corresponding TRS address by scellActivationRSId as specified in TS 38.331 [5] is activated. If TRS [D, is set to zero, it indicates that no TRS is used for the corresponding SCell;
- R: Reserved bit, set to 0 .

Figure 6.1.3.55-1: Enhanced SCell Activation/Deactivation MAC CE with one octet \( \mathbf{C}_{\mathbf{i}} \) field

\begin{table}
\begin{tabular}{|l|l|l|l|l|l|l|l|l|}
\hline \multicolumn{8}{|c|}{} & \multirow[b]{2}{*}{Oct 1} \\
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{5} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & R & \\
\hline \( \mathrm{C}_{15} \) & \( \mathrm{C}_{14} \) & \( \mathrm{C}_{13} \) & \( \mathrm{C}_{12} \) & \( \mathrm{C}_{11} \) & \( \mathrm{C}_{10} \) & \( \mathrm{C}_{9} \) & \( \mathrm{C}_{8} \) & Oct 2 \\
\hline \( \mathrm{C}_{23} \) & \( \mathrm{C}_{22} \) & \( \mathrm{C}_{21} \) & \( \mathrm{C}_{20} \) & \( \mathrm{C}_{19} \) & \( \mathrm{C}_{18} \) & \( \mathrm{C}_{17} \) & \( \mathrm{C}_{16} \) & Oct 3 \\
\hline \( \mathrm{C}_{31} \) & \( \mathrm{C}_{30} \) & \( \mathrm{C}_{29} \) & \( \mathrm{C}_{28} \) & \( \mathrm{C}_{27} \) & \( \mathrm{C}_{26} \) & \( \mathrm{C}_{25} \) & \( \mathrm{C}_{24} \) & \multirow{2}{*}{\begin{tabular}{l}
Oct 4 \\
Oct 5
\end{tabular}} \\
\hline \multicolumn{8}{|c|}{TRS ID \( { }_{1} \)} & \\
\hline \multicolumn{8}{|c|}{TRS ID \( { }_{\text {N }} \)} & Oct N+4 \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{Figure 6.1.3.55-2: Enhanced SCell Activation/Deactivation MAC CE with four octet \( \mathbf{C}_{\mathbf{i}} \) field}
\end{table}

ETSI


--- Page 273  ---


3GPP TS 38.321 version 18.2.0 Release 18
272
ETSI TS 138321 V18.2.0 (2024-08)
6.1.3.56 Timing Advance Report MAC CE

The Timing Advance Report MAC CE is identified by MAC subheader with LCID as specified in Table 6.2.1-2. It has a fixed size and consists of two octets defined as follows (Figure 6.1.3.56-1):
- R: Reserved bit, set to 0 ;
- Timing Advance: Except for ATG in FR1, the Timing Advance field indicates the least integer number of slots, using subcarrier spacing of 15 kHz , greater than or equal to the Timing Advance value (see TS 38.211 [8], clause 4.3.1).

For ATG in FR1, the Timing Advance field indicates the least integer number of symbols greater than or equal to the Timing Advance value (see TS 38.211 [8], clause 4.3.1). The symbol duration is based on the subcarriers spacing the UE is currently configured with. In this release of the specification, only 15 kHz and 30 kHz SCS are applicable and only values 1 ... 56 are used.

The length of the field is 14 bits.

Figure 6.1.3.56-1: Timing Advance Report MAC CE
6.1.3.57 Differential Koffset MAC CE

The Differential Koffset MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size and consists of a single octet defined as follows (Figure 6.1.3.57-1):
- R: Reserved bit, set to 0 ;
- Differential Koffset: This field indicates the differential Koffset in the number of slots (see clause 4.2 in TS \( 38.213[6]) \), using subcarrier spacing of 15 kHz . The length of the field is 6 bits.

Figure 6.1.3.57-1: Differential Koffset MAC CE
6.1.3.58 BFD-RS Indication MAC CE

The BFD-RS Indication MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size, and includes a BFD-RS-ID \( { }_{0} \) field and a BFD-RS-ID \( { }_{1} \) field (optional) of failureDetectionSet 1, and a BFD-RS-ID \( { }_{0} \) field and a BFD-RS-ID 1 field (optional) of failureDetectionSet2.

It has a variable size consisting of following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.213 [6]. The length of the BWP ID field is 2 bits;
- S: This field indicates the presence of the octet containing the BFD-RS ID1 of the same BFD-RS set. The S field set to 1 indicates that the octet containing BFD-RS ID \( { }_{1} \) is included. The \( S \) field set to 0 indicates that the octet containing the BFD-RS ID1 of the same BFD-RS set is not included;

ETSI


--- Page 274  ---


3GPP TS 38.321 version 18.2.0 Release 18
273
ETSI TS 138321 V18.2.0 (2024-08)
- BFD-RS ID: This field indicates the BFD-RS resource from failureDetectionSet I or failureDetectionSet 2 as specified in TS 38.331 [5];
- R: Reserved bit, set to 0 .

Figure 6.1.3.58-1: BFD-RS Indication MAC CE
6.1.3.59 SP/AP SRS TCI State Indication MAC CE

The SP/AP SRS TCI State Indication MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:
- A/D: This field indicates whether to activate or deactivate indicated SP SRS resource set. The field is set to 1 to indicate activation, otherwise it indicates deactivation. If the indicated SRS resource set ID is for the AP SRS resource set, MAC entity shall ignore this field;
- SRS Resource Set's Cell ID: This field indicates the identity of the Serving Cell, which contains the indicated SP/AP SRS Resource Set. If the C field is set to 0 , this field also indicates the identity of the Serving Cell associated with all TCI states indicated by the TCI State ID, fields. The length of the field is 5 bits;
- SRS Resource Set's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains the indicated SP/AP SRS Resource Set. If the C field is set to 0 , this field also indicates the identity of the BWP associated with all TCI states indicated by the TCI State [D, fields. The length of the field is 2 bits;
- C: This field indicates whether the octets containing TCI State Serving Cell ID field(s) and TCI State BWP ID field(s) are present. If this field is set to 1, TCI State Serving Cell ID field(s) and TCI State BWP ID field(s) are present, otherwise they are not present so MAC entity shall ignore TCI State Serving Cell ID field(s) and TCI State BWP ID field(s);
- SUL: This field indicates whether the MAC CE applies to the NUL carrier or SUL carrier configuration. This field is set to 1 to indicate that it applies to the SUL carrier configuration, and it is set to 0 to indicate that it applies to the NUL carrier configuration;
- SRS Resource Set ID: This field indicates the SP/AP SRS Resource Set ID identified by SRS-ResourceSetld as specified in TS 38.331 [5]. The length of the field is 4 bits;
- TCI State Serving Cell [D: This field indicates the identity of the Serving Cell on which the TCI State used for SRS resource \( i \) is located. The length of the field is 5 bits;
- TCI State BWP ID: This field indicates a BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the TCI State used for SRS resource \( i \) is located. If value of unifiedTCIStateType in the Serving Cell indicated by TCI State Serving Cell ID, is joint, this field indicates a DL BWP. If value of unified TCI-StateType in the Serving Cell indicated by TCI State Serving Cell ID, is separate, this field indicates a UL BWP. The length of the field is 2 bits;
- TCI State ID1: This field contains an identifier of the TCI state used for SRS resource i. TCI State ID0 refers to the first SRS resource within the resource set, TCI State [D1 refers to the second one and so on. If joint/downlink

ETSI


--- Page 275  ---


3GPP TS 38.321 version 18.2.0 Release 18
274
ETSI TS 138321 V18.2.0 (2024-08)

TCI State is used, 7 -bits length TCI state [D i.e. TCI-Stateld as specified in TS 38.331 [5] is used. If separate downlink and uplink TCI State is used, the most significant bit of TCI state ID is considered as a reserved bit and the remaining 6 bits indicate the TCI-UL-State-Id as specified in TS 38.331 [5]. The length of the field is 7 bits. This field is only present if MAC CE is used for activation of SP SRS resource set, i.e. the A/D field is set to 1 , or for AP SRS resource set;
- R: Reserved bit, set to 0 .

Figure 6.1.3.59-1: SP/AP SRS TCI State Indication MAC CE
6.1.3.60 Serving Cell Set based SRS TCI State Indication MAC CE

The Serving Cell Set based SRS TCI State Indication MAC CE is identified by a MAC subheader with eLCID as specified. It has a variable size with following fields:
- SRS Resource's Cell ID: This field indicates the identity of the Serving Cell, which contains the indicated SP/AP SRS Resource. If the C field is set to 0 , this field also indicates the identity of the Serving Cell associated with all TCI States indicated by the TCI State IDi fields. The length of the field is 5 bits. The indicated Serving Cell is configured as part of simultaneousSpatial-UpdatedListl or simultaneousSpatial-UpdatedList2 in TS 38.331 [5], and this MAC CE applies to all the Serving Cells configured in the set simultaneousSpatial-UpdatedListl or simultaneousSpatial-UpdatedList2, respectively;
- SRS Resource's BWP ID: This field indicates a UL BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], which contains the indicated AP/SP SRS Resource. If the C field is set to 0, this field also indicates the identity of the BWP associated with all TCI States indicated by the TCI State IDi fields. The length of the field is 2 bits;
- C: This field indicates whether the octets containing TCI State Serving Cell ID field(s) and TCI State BWP ID field(s) are present. If this field is set to 1 , the TCI State Serving Cell ID field(s) and TCI State BWP ID field(s) are present, otherwise they are not present so MAC entity shall ignore TCI State Serving Cell ID field(s) and TCI State BWP ID field(s);
- SRS Resource ID: This field indicates the SP/AP SRS Resource ID identified by SRS-Resourceld as specified in TS 38.331 [5]. The length of the field is 6 bits;
- TCI State Serving Cell ID: This field indicates the identity of the Serving Cell on which the TCI State used for SRS Resource ID \( { }_{1} \) is located. The length of the field is 5 bits;
- TCI State BWP ID: This field indicates a BWP as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9], on which the TCI State used for SRS Resource ID, is located. If value of unifiedTCIStateType in the Serving Cell indicated by TCI State Serving Cell ID1 is joint, this field indicates a DL BWP. If

ETSI


--- Page 276  ---


3GPP TS 38.321 version 18.2.0 Release 18
275
ETSI TS 138321 V18.2.0 (2024-08)

value of unifiedTCI-StateType in the Serving Cell indicated by TCI State Serving Cell ID, is separate, this field indicates a UL BWP. The length of the field is 2 bits;
- TCI State [D: This field contains an identifier of the TCI state used for SRS resource i. TCI State ID0 refers to the first SRS resource which is indicated SRS Resource [D0, TCI State [D1 refers to the second one and so on. If joint/downlink TCI State is used, 7-bits length TCI state ID i.e. TCI-Stateld as specified in TS 38.331 [5] is used. If separate downlink and uplink TCI State is used, the most significant bit of TCI state ID is considered as a reserved bit and the remaining 6 bits indicate the TCI-UL-State-Id as specified in TS 38.331 [5]. The length of the field is 7 bits;
- R: Reserved bit, set to 0 .

Figure 6.1.3.60-1: Serving Cell Set based SRS TCI State Indication MAC CE
6.1.3.61 Child IAB-DU Restricted Beam Indication MAC CE

The Child IAB-DU Restricted Beam Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields (Figure 6.1.3.61-1):
- Resource Configuration ID: This fields indicates the RRC configuration which applies to this MAC CE and corresponds to iab-ResourceConfigID parameter in IAB-ResourceConfig as specified in TS 38.331 [5]. The length of the field is 16 bits;
- Number of child IAB-DU beams: This field indicates the number of restricted child IAB-DU beams included in the MAC CE. The length of the field is 8 bits. The number of restricted child IAB-DU beams is contained in the 3 rightmost bits of the field while the remaining 5 bits are considered as reserved bits;
- [AB-DU restricted beams type ID: This field determines the type of information used as an indication of a set of child IAB-DU's restricted beams, indicated with the Child IAB-DU Resource set [D, field. IAB-DU restricted beams type ID \( _{0} \) refers to the first restricted beam within the resource set, [AB-DU restricted beams type [ \( \mathrm{D}_{1} \) to the second one and so on. If the value of the field is 00 , SSB index is used (contained in the 6 rightmost bits of the Child IAB-DU Resource set ID, field, with the two leftmost bits being set to zero). If the value of the field is 01, SSB index (contained in the 6 rightmost bits of the Child IAB-DU Resource set ID, field) and STC index (contained in the two leftmost bits of the Child IAB-DU Resource set ID, field) are both used. If the value of the field is set to 11, CSI-RS index, which is the NZP-CSI-RS-Resourceld as specified in TS 38.331 [5], is used (comprising all 8 bits of the Child IAB-DU Resource set ID, field). The length of the field is 2 bits;
- \( \mathrm{C}_{1} \) : This field indicates whether the octet containing the Number of cell configurations \( \mathrm{ID}_{1} \) field is included or not. \( \mathrm{C}_{01} \) refers to the first restricted beam within the resource set, \( \mathrm{C}_{11} \) to the second one and so on. The field is set to 0 to indicate the octet is not included (and subsequently, that no cell information is included for the relevant

ETSI


--- Page 277  ---


3GPP TS 38.321 version 18.2.0 Release 18
276
ETSI TS 138321 V18.2.0 (2024-08)

restricted beam). The field is set to 1 to indicate that Number of cell configurations [D, field is included. The length of the field is 1 bits;
- \( \mathrm{C}_{12} \) : This field indicates whether the child IAB-DU beam indicated with the Child IAB-DU Resource set ID, field is associated with one or more uplink or downlink [AB-MT beams, indicated with the [AB-MT Resource set [D] fields. \( \mathrm{C}_{02} \) refers to the first restricted beam within the resource set, \( \mathrm{C}_{12} \) to the second one and so on. The field is set to 1 to indicate that at least one [AB-MT Resource set [ \( D_{1} \) field is included (and that Number of associated [AB-MT beams ID, is included), and it is set to 0 to indicate that no [AB-MT Resource set ID \( { }_{11} \) field is present (and that the Number of associated IAB-MT beams [ \( D_{1} \) is absent). The length of the field is 1 bit;
- R: Reserved bit, set to 0 ;
- Child IAB-DU Resource set ID: an indication of the child IAB-DU's beam in the direction of which simultaneous operation is restricted. The length of the field is 8 bits;
- Number of cell configurations ID. This field indicates the number of cell configurations associated with the beam restriction indicated in Child IAB-DU Resource set [D1. Number of cell configurations [D0 refers to the first restricted beam within the resource set, Number of cell configurations ID \( _{1} \) to the second one and so on. The length of the field is 8 bits;
- Cell info type \( \left[D_{1}\right. \) : indicates the type of information included in the Cell info \( \left[D_{13}\right. \) field. If the value of the field is set to zero, the combination of \{MT CC, DU cell\} is included in the Cell info \( \left[\mathrm{D}_{1}\right. \) field, by including the IABDU cell in the first nine bits of the field, and the IAB-MT Serving Cell index into the next 5 bits of the field,. If the value of the field is set to one, only DU cell is included in the Cell info \( \mathrm{ID}_{1} \) field, by including the IAB-DU cell in the first nine bits of the field, and by setting the remaining five bits to zero. The length of the field is 1 bit;
- \( \mathrm{M}_{\mathrm{y}} \) : This field indicates whether the octet containing multiplexing mode info (containing the Multiplexing mode info \( \mathrm{ID}_{1} \) field) is included or not. \( \mathrm{M}_{10} \) refers to the first combination of \{MT CC, DU cell\} associated with Child [AB-DU Resource set [ \( \mathrm{D}_{1}, \mathrm{M}_{1} \) to the second one and so on. The field is set to 1 to indicate that multiplexing mode info is included, and it is set to 0 to indicate that multiplexing mode info is not present. The length of the field is 1 bit;
- Cell info IDy: indicates the cell configuration associated with beam restriction indicated in Child IAB-DU Resource set \( I D_{1} \). Cell info \( I D_{10} \) field refers to the first cell configuration associated with the beam restriction indicated in Child IAB-DU Resource set I \( \mathrm{D}_{1} \), Cell info \( \left[\mathrm{D}_{11}\right. \) field refers to the second cell configuration associated with the beam restriction indicated in Child IAB-DU Resource set ID, and so on. The length of the field is 15 bits;
- Multiplexing mode info \( \mathrm{ID}_{\mathrm{y}} \) : The two rightmost bits indicate which of the four multiplexing modes defined in TS 38.473 [27] is applicable. The third rightmost bit of this field indicates whether multiplexing restrictions mode information contained in the two rightmost bits of the field are applicable to non-overlapping frequency resources. This bit is set to 1 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info \( \mathrm{ID}_{\mathrm{y}} \) field is applicable to non-overlapping frequency resources. This field is set to 0 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info \( \mathrm{ID}_{\mathrm{y}} \) field is not applicable to non-overlapping frequency resources. The remaining 5 bits of this field are set to zero. The length of the field is 8 bits;
- Number of associated IAB-MT beams IDi: This field indicates the number of IAB-MT beams associated with the beam indicated in Child IAB-DU Resource set [D]. Number of associated IAB-MT beams [D0 refers to the first restricted beam within the resource set, Number of associated IAB-MT beams [D1 to the second one and so on. The length of the field is 8 bits. The number of IAB-MT beams associated with the beam indicated in Child IABDU Resource set \( \mathrm{ID}_{1} \) is contained in the 3 rightmost bits of the field while the remaining 5 bits are considered as reserved bits;
- Associated IAB-MT's beams type ID \( _{\text {1) }} \) : This field determines the type of information used as an indication of an uplink or downlink [AB-MT beam associated with the child [AB-DU's restricted beams, indicated with the [ABMT Resource set \( \left[\mathrm{D}_{1}\right. \) - If the value of the field is 00 , the information included in the [AB-MT Resource set [D \( { }_{1} \) field is the TCI state ID (contained in the 7 rightmost bits of the field). If the value of the field is 01 , the information included in the IAB-MT Resource set ID, field is the SSB ID (contained in the 6 rightmost bits of the field). If the value of the field is 10 , the information included in the IAB-MT Resource set IDy field is the CSI-RS index (comprising all 8 bits), which is the NZP-CSI-RS-Resourceld as specified in TS 38.331 [5]. If the value of the field is 11 , the information included in the 6 rightmost bits in the [AB-MT Resource set [ \( D_{1} \) field is the SRS-ResourcelD. The length of the field is 2 bits;

ETSI


--- Page 278  ---


3GPP TS 38.321 version 18.2.0 Release 18
277
ETSI TS 138321 V18.2.0 (2024-08)
- [AB-MT Resource set [ \( \mathrm{D}_{\mathrm{y}} \) : an indication of the [AB-MTs downlink or uplink beams which are associated with the child IAB-DU restricted beam indicated in Child IAB-DU Resource set ID, field. IAB-MT Resource set IDro field refers to the first IAB-MT's beam associated with the child IAB-DU's restricted beam indicated in Child [AB-DU Resource set [D, field, [AB-MT Resource set [D1] field refers to the second [AB-MT's beam associated with the child IAB-DU's restricted beam indicated in Child IAB-DU Resource set ID, field, and so on. The length of the field is 8 bits.

ETSI


--- Page 279  ---


3GPP TS 38.321 version 18.2.0 Release 18
278
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline Cel infla bype \( \mathrm{L}_{\mathrm{D}_{\mathrm{i}}}-\mathrm{r}_{\mathrm{i}} \) & \( \mathrm{M}_{0, \mathrm{nO}} \) & \multicolumn{6}{|c|}{Cell info \( \mathrm{ID}_{0,00} \)} \\
\hline \multicolumn{8}{|c|}{Cell info \( \mathrm{ID}_{\text {Q, no }} \)} \\
\hline \multicolumn{8}{|c|}{Multiplexing mode info \( \mathrm{ID}_{\mathrm{QnO}} \)} \\
\hline \multicolumn{8}{|c|}{Number of associated IAB-MT beams ID \( { }_{0} \)} \\
\hline Associated MT beams type \( \mathrm{ID}_{\infty} \) & & R & R & R & R & R & R \\
\hline \multicolumn{8}{|c|}{IAB-MT Resource set ID \( _{\infty} \)} \\
\hline
\end{tabular}

\begin{tabular}{|c|c|c|c|c|c|c|}
\hline \begin{tabular}{c} 
Associated MT \\
beams type \\
\( \mathrm{ID}_{\mathrm{mol}} \)
\end{tabular} & R & R & R & R & R & R \\
\hline \multicolumn{7}{|c|}{ IAB-MT Resource set \( \mathrm{ID}_{0, \mathrm{mo}} \)} \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline IAE-DU mestricted beams type IDN & & R & \( \mathrm{C}_{\mathrm{N} 1} \) & \( \mathrm{C}_{\mathrm{N} 2} \) & R & R & R \\
\hline \multicolumn{8}{|c|}{Child IAB-DU Resource set ID \( { }_{\mathrm{N}} \)} \\
\hline \multicolumn{8}{|c|}{Number of cell configurations ID \( _{\text {N }} \)} \\
\hline Cel Irris Lype ID .0 & \( \mathrm{M}_{\mathrm{N}, \mathrm{O}} \) & \multicolumn{6}{|c|}{Cell info ID \( _{\mathrm{N}, \mathrm{O}} \)} \\
\hline \multicolumn{8}{|c|}{Cell info ID \( _{\text {N,O }} \)} \\
\hline \multicolumn{8}{|c|}{Multiplexing mode info \( \mathrm{ID}_{\mathrm{N}, \mathrm{O}} \)} \\
\hline
\end{tabular}

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline CCD infa bype \( \mathrm{ID}_{\mathrm{H}_{4}+1} \) & \( \mathrm{M}_{\mathrm{N}, \mathrm{nN}} \) & \multicolumn{6}{|c|}{Cell info ID \( _{\text {N,nN }} \)} \\
\hline \multicolumn{8}{|c|}{Cell info ID \( _{\mathrm{N}, \mathrm{nN}} \)} \\
\hline \multicolumn{8}{|c|}{Multiplexing mode info \( \mathrm{ID}_{\mathrm{N}, \mathrm{nN}} \)} \\
\hline \multicolumn{8}{|c|}{Number of associated IAB-MT beams ID \( _{\text {N }} \)} \\
\hline Associated MT beams type \( \mathrm{ID}_{\text {NO }} \) & & R & R & R & R & R & R \\
\hline \multicolumn{8}{|c|}{IAB-MT Resource set ID \( _{\mathrm{N}, \mathrm{O}} \)} \\
\hline
\end{tabular}

⋯

\begin{tabular}{|c|c|c|c|c|c|c|}
\hline \begin{tabular}{c} 
Associated MT \\
beams type \\
\( \mathrm{ID}_{\mathrm{NmN}} \)
\end{tabular} & R & R & R & R & R & R \\
\hline \multicolumn{7}{|c|}{ IAB-MT Resource set ID \( { }_{\mathrm{N}, \mathrm{mN}} \)} \\
\hline
\end{tabular}

ETSI


--- Page 280  ---


3GPP TS 38.321 version 18.2.0 Release 18
279
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.61-1: Child IAB-DU Restricted Beam Indication MAC CE
6.1.3.62 IAB-MT Recommended Beam Indication MAC CE

The IAB-MT Recommended Beam Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-2b. It has a variable size with following fields (Figure 6.1.3.62-1):
- Resource Configuration ID: This field indicates the RRC configuration which applies to this MAC CE and corresponds to iab-ResourceConfigID parameter in IAB-ResourceConfig as specified in TS 38.331 [5]. The length of the field is 16 bits;
- Number of [AB-MT beams: This field indicates the number of recommended [AB-MT beams included in the MAC CE. The length of the field is 8 bits. The number of recommended [AB-MT beams is contained in the 3 rightmost bits of the field while the remaining 5 bits are considered as reserved bits;
- [AB-MT beam type [D]: This field determines the type of information used as an indication of an uplink or downlink [AB-MT beam, indicated with the [AB-MT Resource set [Dr. If the value of the field is 00 , the information included in the [AB-MT Resource set [D, field is the TCI state ID (contained in the 7 rightmost bits of the field). If the value of the field is 01, the information included in the [AB-MT Resource set[D, field is the SSB ID (contained in the 6 rightmost bits of the field). If the value of the field is 10 , the information included in the [AB-MT Resource set [D, field is the CSI-RS index (comprising all 8 bits), which is the NZP-CSI-RSResourceld as specified in TS 38.331 [5]. If the value of the field is 11, the information included in the 6 rightmost bits in the [AB-MT Resource set [D, field is the SRS-ResourceID. The length of the field is 2 bits;
- [AB-MT Resource set [D]: an indication of the [AB-MTs recommended downlink or uplink beams. [AB-MT Resource set [ \( D_{0} \) field refers to the first [AB-MT's beam, [AB-MT Resource set [D \( { }_{1} \) field refers to the second [AB-MT's beam, and so on. The length of the field is 8 bits;
- \( C_{11} \) : This field indicates whether the octet containing the Number of cell configurations \( D_{1} \) field is included or not. \( C_{01} \) refers to the first recommended beam within the resource set, \( C_{11} \) to the second one and so on. The field is set to 0 to indicate the octet is not included (and subsequently, that no cell information is included for the relevant recommended beam). The field is set to 1 to indicate that Number of cell configurations \( \left[D_{1}\right. \) field is included. The length of the field is 1 bits;
- R: Reserved bit, set to 0 ;
- Number of cell configurations ID1: This field indicates the number of cell configurations associated with the beam indicated in [AB-MT Resource set [D \( { }_{1} \). Number of cell configurations [ \( D_{0} \) refers to the first recommended beam within the resource set, Number of cell configurations ID1 to the second one and so on. The length of the field is 8 bits;
- Cell info type \( \left[D_{1}\right. \) : indicates the type of information included in the Cell info \( \left[D_{1}\right] \) field. If the value of the field is set to zero, the combination of \{MT CC, DU cell\} is included in the Cell info \( \left[D_{1}\right. \), field, by including the \( [A B- \) DU cell in the first nine bits of the field, and the [AB-MT Serving Cell index into the next 5 bits of the field. If the value of the field is set to one, only MT CC information is included in the Cell info [ \( D_{1} \) field, by including the [AB-MT Serving Cell index in the first 5 bits of the field, and by setting the remaining nine bits to zero. The length of the field is 1 bit;
- \( \mathrm{M}_{\mathrm{y}} \) : This field indicates whether the octet containing multiplexing mode info (containing the Multiplexing mode info \( \left[D_{1,}\right. \) field) is included or not. \( M_{10} \) refers to the first combination of \( \{M T C C, D U \) cell \( \} \) associated with \( [A B- \) MT Resource set \( \left[D_{1}, M_{1}\right. \) to the second one and so on. The field is set to 1 to indicate that multiplexing mode info is included, and it is set to 0 to indicate that multiplexing mode info is not present. The length of the field is 1 bit;
- Cell info \( \left[D_{1}\right. \) : indicates the cell configuration associated with beam recommendation indicated in \( [A B-M T \) Resource set \( \left[D_{1}\right. \). Cell info \( \left[D_{10}\right. \) field refers to the first cell configuration associated with the beam recommendation indicated in [AB-MT Resource set [ \( \mathrm{D}_{1} \), Cell info [ \( \mathrm{D}_{1} \) field refers to the second cell configuration associated with the beam recommendation indicated in [AB-MT Resource set [ \( \mathrm{D}_{1} \), and so on. The length of the field is 14 bits.
- Multiplexing mode info \( \mathrm{ID}_{1} \) : The two rightmost bits indicate which of the four multiplexing modes defined in TS \( 38.473[27] \) is applicable. The third rightmost bit of this field indicates whether multiplexing restrictions mode information contained in the two rightmost bits of the field are applicable to non-overlapping frequency

ETSI


--- Page 281  ---


3GPP TS 38.321 version 18.2.0 Release 18
280
ETSI TS 138321 V18.2.0 (2024-08)

resources. This bit is set to 1 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info \( \left[D_{11}\right. \) field is applicable to non-overlapping frequency resources. This field is set to 0 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info ID, field is not applicable to non-overlapping frequency resources. The remaining 5 bits of this field are set to zero. The length of the field is 8 bits.

ETSI


--- Page 282  ---


3GPP TS 38.321 version 18.2.0 Release 18
281
ETSI TS 138321 V18.2.0 (2024-08)

ETSI


--- Page 283  ---


3GPP TS 38.321 version 18.2.0 Release 18
282
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.62-1: IAB-MT Recommended Beam Indication MAC CE
6.1.3.63 DL TX Power Adjustment and Desired DL TX Power Adjustment MAC CEs

The DL TX Power Adjustment MAC CE and Desired DL TX Power Adjustment MAC CEs are identified by MAC subheaders with eLCIDs as specified in Table 6.2.1-1b and Table 6.2.1-1b, respectively. Otherwise the format of the two MAC CEs is identical. Each has a variable size with following fields (Figure 6.1.3.63-1):
- Resource Configuration ID: This field indicates the RRC configuration which applies to this MAC CE and corresponds to iab-ResourceConfigID parameter in IAB-ResourceConfig as specified in TS 38.331 [5]. The length of the field is 16 bits;
- DL Tx Power adjustment: For the case of the Desired DL TX Power Adjustment MAC CE, this field contains desired DL TX power adjustment sent by an IAB-MT to assist with the parent node's DL TX power allocation. For the case of the DL TX Power Adjustment MAC CE, this fields contains adjustment to a node's DL TX power sent by its parent node. The value of the power adjustment is in both cases contained in the 5 right-most bits of the field with codepoints \( (00000,00001, \ldots, 11101,11110) \) indicating the corresponding value \( (-15 \mathrm{~dB},- 14 \mathrm{~dB}, \ldots, 14 \mathrm{~dB}, 15 \mathrm{~dB} \) ) and the codepoint 11111 not being used, while the remaining 3 bits are set to zero. The length of the field is 8 bits;
- Reference CSI-RS ID: This field indicates the CSI-RS used as reference for power adjustment, which is identified by NZP-CSI-RS-Resourceld as specified in TS 38.331 [5]. The indicated DL TX power adjustment is in terms of a relative offset to the CSI-RS TX power of the indicated CSI-RS. The length of this field is 8bits;
- \( \mathrm{C}_{0} \) : This field indicates whether the octet containing multiplexing mode info (containing the Multiplexing mode info field) is included or not. The field is set to 1 to indicate that multiplexing mode info is included, and it is set to 0 to indicate that multiplexing mode info is not present. The length of the field is 1 bit;
- \( \quad \mathrm{C}_{1} \) : This field indicates whether the two octets containing the Cell info are included or not. The field is set to 0 to indicate the two octets are not included (and subsequently, that no cell information is included). The field is set to 1 to indicate that the two octets are included. The length of the field is 1 bits;
- \( \quad \mathrm{C}_{2} \) : This field indicates whether any information on IAB-MT DL beams is included or not. The field is set to 1 to indicate that at least one IAB-MT Resource set ID, field is included, and it is set to 0 to indicate that no IAB-MT Resource set \( I D_{1} \) field is present. The length of the field is 1 bit;
- R: Reserved bit, set to 0 .
- Multiplexing mode info: The two rightmost bits indicate which of the four multiplexing modes defined in TS 38.473 [27] is applicable. The third rightmost bit of this field indicates whether multiplexing restrictions mode information contained in the two rightmost bits of the field are applicable to non-overlapping frequency resources. This bit is set to 1 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info field is applicable to non-overlapping frequency resources. This field is set to 0 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info field is not applicable to non-overlapping frequency resources. The remaining 5 bits of this field are set to zero. The length of the field is 8 bits;
- Number of IAB-MT DL beams: This field indicates the number of IAB-MT beams included in the MAC CE The length of the field is 8 bits;
- [AB-MT beam type ID: This field determines the type of information used as an indication of a downlink [ABMT beam, indicated with the IAB-MT Resource set [ \( \mathrm{D}_{1} \). If the value of the field is 00 , the information included in the IAB-MT Resource set ID, field is the TCI state ID (contained in the 7 rightmost bits of the field). If the value of the field is 01 , the information included in the IAB-MT Resource set ID, field is the SSB ID (contained in the 6 rightmost bits of the field). If the value of the field is 10 , the information included in the [AB-MT Resource set [D, field is the CSI-RS index (comprising all 8 bits), which is the NZP-CSI-RS-Resourceld as specified in TS 38.331 [5]. The length of the field is 2 bits;
- [AB-MT Resource set [D: an indication of the [AB-MTs downlink beams. [AB-MT Resource set [D0 field refers to the first IAB-MT downlink beam, IAB-MT Resource set [D1 field refers to the second IAB-MT downlink beam, and so on. The length of the field is 8 bits;
- DU resource configuration: when this field is set to 00 , the provided power adjustment is applied on FDM resources where the simultaneous MT and DU signals are non-overlapping in the frequency-domain; when this

ETSI


--- Page 284  ---


3GPP TS 38.321 version 18.2.0 Release 18
283
ETSI TS 138321 V18.2.0 (2024-08)

field is set to 01 , the provided power adjustment is applied on non-FDM resources where the simultaneous MT and DU signals may overlap in the frequency-domain for a given (MT CC, DU cell); when this field is set to 10, the provided power adjustment is applied on FDM resources where the simultaneous MT and DU signals are non-overlapping in the frequency-domain, and on non-FDM resources where the simultaneous MT and DU signals may overlap in the frequency-domain for a given (MT CC, DU cell). The length of the field is 2 bits;
- Cell info: indicates the cell configuration associated with the information contained in the MAC CE. The length of the field is 14 bits. IAB-DU cell is contained in the first nine bits of the field, while the Child IAB-MT Serving Cell index into the next 5 bits of the field. The length of the field is 14 bits.

\begin{tabular}{|c|c|c|c|c|c|c|}
\hline \begin{tabular}{c} 
IAB-MT beam \\
type ID
\end{tabular} & \( R \) & \( R \) & \( R \) & \( R \) & \( R \) & \( R \) \\
\hline \multicolumn{7}{|c|}{ IAB-MT Resource set ID } \\
\hline \begin{tabular}{c} 
DU resource \\
configuration
\end{tabular} & \multicolumn{6}{|c|}{ Cell info } \\
\hline \multicolumn{7}{|c|}{ Cell info } \\
\hline
\end{tabular}

Figure 6.1.3.63-1: DL TX Power Adjustment and Desired DL TX Power Adjustment MAC CEs
6.1.3.64 Desired IAB-MT PSD range MAC CE

The Desired IAB-MT PSD range MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-2b. It has a variable size with following fields (Figure 6.1.3.64-1):
- Resource Configuration ID: This field indicates the RRC configuration which applies to this MAC CE and corresponds to iab-ResourceConfigID parameter in IAB-ResourceConfig as specified in TS 38.331 [5]. The length of the field is 16 bits;
- PSD range: This field contains the desired PSD range a node sends to its parent node to help with the sending node's MT UL TX power control. The desired PSD range is indicated by a maximum value (i.e. Pmax), and an offset relative to the maximum value, i.e the desired PSD range is from Pmax - offset to Pmax. The 4 left-most

ETSI


--- Page 285  ---


3GPP TS 38.321 version 18.2.0 Release 18
284
ETSI TS 138321 V18.2.0 (2024-08)

bits of the field indicate the offset, the offset range is from 0 dB to 10 dB , the value 0000 corresponds to 0 dB , the value 0001 corresponds to 1 dB and so on, the values from 1011 onwards are reserved. The next 7 left-most bits indicate the Pmax range, the Pmax range is from -60 dBm to 50 dBm , the value 0000000 corresponds to -60 dBm , the value 0000001 corresponds to -59 dBm and so on, the values from 1101111 onwards are reserved. The remaining 5 bits are set to zero. The length of the field is 16 bits;
- \( \mathrm{C}_{0} \) : This field indicates whether the octet containing multiplexing mode info (containing the Multiplexing mode info field) is included or not. The field is set to 1 to indicate that multiplexing mode info is included, and it is set to 0 to indicate that multiplexing mode info is not present. The length of the field is 1 bit;
- \( \mathrm{C}_{1} \) : This field indicates whether the two octets containing the Cell info are included or not. The field is set to 0 to indicate the two octets are not included (and subsequently, that no cell information is included). The field is set to 1 to indicate that the two octets are included. The length of the field is 1 bits;
- \( \mathrm{C}_{2} \) : This field indicates whether any information on [AB-MT UL beams is included or not. The field is set to 1 to indicate that at least one [AB-MT Resource set [D, field is included, and it is set to 0 to indicate that no [AB-MT Resource set \( \left[D_{1}\right. \) field is present. The length of the field is 1 bit;
- R: Reserved bit, set to 0 ;
- Multiplexing mode info: The two rightmost bits indicate which of the four multiplexing modes defined in TS 38.473 [27] is applicable. The third rightmost bit of this field indicates whether multiplexing restrictions mode information contained in the two rightmost bits of the field are applicable to non-overlapping frequency resources. This bit is set to 1 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info field is applicable to non-overlapping frequency resources. This field is set to 0 when multiplexing mode information contained in the two rightmost bits of the Multiplexing mode info field is not applicable to non-overlapping frequency resources. The remaining 5 bits of this field are set to zero. The length of the field is 8 bits;
- Number of [AB-MT UL beams: This field indicates the number N of [AB-MT UL beams included in the MAC CE. The length of the field is 8 bits;
- [AB-MT Resource set [D: an indication of the [AB-MTs uplink beams. [AB-MT Resource set [D0 field refers to the first [AB-MT uplink beam, [AB-MT Resource set [D] field refers to the second [AB-MT uplink beam, and so on. If the total number N of beams included in the MAC CE is odd, the 4 right-most bits in the final octet of the [AB-MT Resource set are disregarded by the UE. The length of the field is 4 bits;
- DU resource configuration: when this field is set to 00 , the provided power adjustment is applied on FDM resources where the simultaneous MT and DU signals are non-overlapping in the frequency-domain; when this field is set to 01, the provided power adjustment is applied on non-FDM resources where the simultaneous MT and DU signals may overlap in the frequency-domain for a given (MT CC, DU cell); when this field is set to 10 , the provided power adjustment is applied on FDM resources where the simultaneous MT and DU signals are non-overlapping in the frequency-domain, and on non-FDM resources where the simultaneous MT and DU signals may overlap in the frequency-domain for a given (MT CC, DU cell). The length of the field is 2 bits;
- Cell info: indicates the cell configuration associated with the information contained in the MAC CE. [AB-DU cell is contained in the first nine bits of the field, while the Child IAB-MT Serving Cell index into the next 5 bits of the field. The length of the field is 14 bits.

ETSI


--- Page 286  ---


3GPP TS 38.321 version 18.2.0 Release 18
285
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.64-1: Desired IAB-MT PSD range MAC CE
6.1.3.65 Timing Case Indication MAC CE

The Timing Case Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields (Figure 6.1.3.65-1):
- Resource Configuration ID: This field indicates the RRC configuration which applies to this MAC CE and corresponds to iab-ResourceConfigID parameter in IAB-ResourceConfig as specified in TS 38.331 [5]. The length of the field is 16 bits;
- Timing mode \( \mathrm{ID}_{1} \) : when this field is set to 00 , the timing mode applied to the \( \mathrm{i}^{\text {th }} \) slot in the list of slots slotList provided via RRC in IAB-ResourceConfig is Case-1; when this field is set to 01, the timing mode applied to the \( i^{\text {th }} \) slot in the list of slots slotList provided via RRC in IAB-ResourceConfig is Case-6; when this field is set to 10, the timing mode applied to the \( 1^{\text {th }} \) slot in the list of slots slotList provided via RRC in IAB-ResourceConfig is Case-7. The total number N of Timing mode \( \mathrm{ID}_{1} \) fields corresponds to the size of slotList provided via RRC in IAB-ResourceConfig. If number N is not divisible by \( 4,(4-\mathrm{N} \bmod 4) \) of the final Timing mode \( \mathrm{ID}_{1} \) fields are disregarded by the receiving \( [\mathrm{AB} \) node. The length of the field is 2 bits.

ETSI


--- Page 287  ---


3GPP TS 38.321 version 18.2.0 Release 18
286
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.65-1: Timing Case Indication MAC CE
6.1.3.66 NCR Downlink Backhaul Link Beam Indication MAC CE

The NCR Downlink Backhaul Link Beam Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size and consists of a single octet defined as follows (Figure 6.1.3.66-1):
- Downlink TCI state ID: This field is used to indicate the downlink beam to be used for backhaul link transmission. It contains TCI-Stateld (comprising all 7 bits), as specified in TS 38.331 [5], of a TCI State in the active DL BWP. The length of the field is 7 bits;
- R: Reserved bit, set to 0 .

Oct 1

Figure 6.1.3.66-1: NCR Downlink Backhaul Link Beam Indication MAC CE
6.1.3.67 NCR Uplink Backhaul Link Beam Indication MAC CE

The NCR Uplink Backhaul Link Beam Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a fixed size and consists of a single octet defined as follows (Figure 6.1.3.67-1):
- Uplink TCI state ID or SRS Resource ID: This field is used to indicate the uplink beam to be used for backhaul link transmission. If the dl-OrJointTCI-StateList is configured as specified in TS 38.331 [5] and unifiedTCIStateType is configured with a value joint, this field contains TCI-Stateld (comprising all 7 bits) of a Joint TCI State configured in the active DL BWP, which is used as the uplink beam indication for backhaul link transmission. If the ul-TCI-StateList is configured as specified in TS 38.331 [5], this field contains TCI-UL-State-Id (contained in the 6 rightmost bits) of an UL TCI State configured in the active UL BWP, which is used as the uplink beam indication for backhaul link transmission, with the 1 remaining bit set to zero. Otherwise, 6 rightmost bits of this field contain SRS-ResourceID configured in the active UL BWP which is used as the uplink beam indication for backhaul link transmission, with the 1 remaining bit set to zero;
- R: Reserved bit, set to 0 .

Oct 1

Figure 6.1.3.67-1: NCR Uplink Backhaul Link Beam Indication MAC CE

ETSI


--- Page 288  ---


3GPP TS 38.321 version 18.2.0 Release 18
287
ETSI TS 138321 V18.2.0 (2024-08)
6.1.3.68 NCR Access Link Beam Indication MAC CE

The NCR Access Link Beam Indication MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of the following fields (Figure 6.1.3.68-1):
- Resource set ID: This field is used to indicate one of forwarding semi-persistent resource lists signalled in NCRSemiPersistentFwdResourceSet (as specified in TS 38.331 [5]). The field contains a list ID (comprising all 5 bits);
- A/D: If the value of this field is set to 1 , the forwarding resource list indicated in Resource set ID field is being activated. If the value of this field is set to 0 , the forwarding resource list indicated in Resource set ID field is being deactivated;
- C: If the value of this field is set to 1 , the Beam index ID, field is present. If the value of this field is set to 0 , the Beam index \( I D_{1} \) field is absent. This field can be set to 1 only if MAC CE is used for activation, i.e., when the A/D field is set to 1 . If MAC CE is used for deactivation, this field is set to 0 ;
- Beam index \( \left[D_{1}\right. \) : This field indicates the updated beam index for forwarding resources within the list indicated by the Resource set ID field. Beam index ID0 indicates the beam index for the first forwarding resource within the list; Beam index \( \left[D_{1}\right. \) indicates the beam index for the second forwarding resource within the list and so on. The length of the field is 6 bits; the number of updated beams, \( N \), is equal to the number of the beam indications in the semi-persistent resource set with ID Resource set ID;- R: Reserved bit, set to 0 .

Figure 6.1.3.68-1: NCR Access Link Beam Indication MAC CE
6.1.3.69 SL LBT failure MAC CEs

The SL LBT failure MAC CE of one octet is identified by a MAC subheader with LCID as specified in Table 6.2.1-2. It has a fixed size of 8bits. The priority of the Sidelink LBT failure MAC CE is fixed to ' 1 ':
- \( \quad R_{1} \) : If there is a RB set configured for the MAC entity with RB set index \( i \) as specified in TS 38.214 [7] and if Sidelink consistent LBT failure have been triggered and not cancelled in this RB set, the field is set to 1 , otherwise the field is set to 0 ;
- R: Reserved bit, set to 0 .

Figure 6.1.3.69-1: SL LBT failure MAC CE
6.1.3.70 Enhanced Unified TCI States Activation/Deactivation MAC CE for Joint TCI States

The Enhanced Unified TCI States Activation/Deactivation MAC CE for Joint TCI States is identified by a MAC subheader with eLCID as specified in Table 6.2.1-lb. It has a variable size consisting of following fields:

ETSI


--- Page 289  ---


3GPP TS 38.321 version 18.2.0 Release 18
288
ETSI TS 138321 V18.2.0 (2024-08)
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneous U-TCI-UpdateList I, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4 as specified in TS 38.331 [5], this MAC CE applies to all theServing Cells in the set simultaneous U-TCIUpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCIUpdateList4, respectively;
- DL BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- \( F_{1,1} \) : This field indicates for the TCI state ID fields associated with the codepoint \( i \) of the DCI Transmission Configuration Indication field whether the j -th joint TCI state is present or not, where \( \mathrm{j}=1,2 \). If \( \mathrm{F}_{1, \mathrm{j}} \) field is set to 1 , it indicates the \( j \)-th joint TCI state for codepoint \( i \) is present. If \( F_{1, j} \) field is set to 0 , it indicates the \( j \)-th joint TCI state for codepoint \( i \) is absent. The codepoint to which a TCI state is mapped is determined by its ordinal position among all the TCI state ID fields;
- TCI state ID: This field indicates the 7-bits length TCI state ID identified by TCI-Stateld as specified in TS 38.331 [5]. The maximum number of activated TCI states is 16 ;
- R: Reserved bit, set to 0 .

Figure 6.1.3.70-1: Enhanced TCI state activation/deactivation MAC CE for Joint TCI States
6.1.3.71 Enhanced Unified TCI States Activation/Deactivation MAC CE for Separate TCI States

The Enhanced Unified TCI States Activation/Deactivation MAC CE CE for Separate TCI States is identified by a MAC subheader with eLCID as specified in Table 6.2.1-lb. It has a variable size consisting of following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneous U-TCI-UpdateList I, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCI-UpdateList4 as specified in TS 38.331 [5], this MAC CE applies to all theServing Cells in the set simultaneous U-TCIUpdateList1, simultaneousU-TCI-UpdateList2, simultaneousU-TCI-UpdateList3 or simultaneousU-TCIUpdateList4, respectively;
- DL BWP ID: This field indicates a DL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- UL BWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;

ETSI


--- Page 290  ---


3GPP TS 38.321 version 18.2.0 Release 18
289
ETSI TS 138321 V18.2.0 (2024-08)
- \( F_{1,1} \) : This field indicates for the TCI state ID fields associated with the codepoint \( i \) of the DCI Transmission Configuration Indication field whether the j -th DL TCI state is present or not, where \( \mathrm{j}=1,2 \). If \( \mathrm{F}_{1,3} \) field is set to 1 , it indicates the j -th DL TCI state for codepoint i is present. If \( \mathrm{F}_{1, \mathrm{j}} \) field is set to 0 , it indicates the j -th DL TCI state for codepoint \( i \) is absent;
- \( \mathrm{S}_{1,1} \) : This field indicates for the TCI state ID fields associated with the codepoint i of the DCI Transmission Configuration Indication field whether the j -th UL TCI state is present or not, where \( \mathrm{j}=1,2 \). If \( \mathrm{S}_{1, \mathrm{j}} \) field is set to 1 , it indicates the j -th UL TCI state for codepoint i is present. If \( \mathrm{S}_{1, \mathrm{j}} \) field is set to 0 , it indicates the j -th UL TCI state for codepoint \( i \) is absent;
- TCI state ID: This field indicates the TCI state identified by TCI-Stateld as specified in TS 38.331 [5]. If the indicated TCI state ID is DL TCI state, 7-bits length TCI state ID, i.e. TCI-Stateld, as specified in TS 38.331 [5] is used. If the indicated TCI state ID is UL TCI state, the most significant bit of TCI state ID is considered as the reserved bit and remainder 6 bits indicate the TCI-UL-State-Id as specified in TS 38.331 [5]. TCI state IDs are in the order of indication of \( \mathrm{F}_{1,1} \) and \( \mathrm{S}_{1,1} \) fields. The codepoint to which a TCI state is mapped is determined by its ordinal position among all the TCI state ID fields. The maximum number of activated TCI states is 32 ;
- R: Reserved bit, set to 0 .

\begin{table}
\begin{tabular}{|l|l|l|l|l|l|l|l|l|}
\hline R & \multicolumn{5}{|c|}{Serving Cell ID} & \multicolumn{2}{|c|}{DL BWP ID} & Oct 1 \\
\hline R & R & R & R & R & R & \multicolumn{2}{|c|}{UL BWP ID} & Oct 2 \\
\hline \( F_{1,1} \) & \( \mathrm{F}_{1,2} \) & \( \mathrm{S}_{1,1} \) & \( \mathrm{S}_{1,2} \) & \( F_{2,1} \) & \( F_{2,2} \) & \( \mathrm{S}_{2,1} \) & \( S_{2,2} \) & Oct 3 \\
\hline \( F_{3,1} \) & \( \mathrm{F}_{3,2} \) & \( S_{3,1} \) & \( S_{3,2} \) & \( F_{4,1} \) & \( \mathrm{F}_{4,2} \) & \( S_{4,1} \) & \( \mathrm{S}_{4,2} \) & Oct 4 \\
\hline \( F_{5,1} \) & \( \mathrm{F}_{5,2} \) & \( \mathrm{S}_{5,1} \) & \( S_{5,2} \) & \( \mathrm{F}_{6,1} \) & \( \mathrm{F}_{6,2} \) & \( \mathrm{S}_{6,1} \) & \( S_{6,2} \) & Oct 5 \\
\hline \( F_{7,1} \) & \( \mathrm{F}_{7,2} \) & \( \mathrm{S}_{7,1} \) & \( \mathrm{S}_{7,2} \) & \( \mathrm{F}_{8,1} \) & \( \mathrm{F}_{8,2} \) & \( \mathrm{S}_{8,1} \) & \( \mathrm{S}_{8,2} \) & Oct 6 \\
\hline R & \multicolumn{7}{|c|}{TCI state ID 1} & Oct 7 \\
\hline R & \multicolumn{7}{|c|}{TCI state ID 2} & Oct 8 \\
\hline R & \multicolumn{7}{|c|}{TCI state ID N} & Oct N+6 \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{Figure 6.1.3.71-1: Enhanced TCI state activation/deactivation MAC CE for Separate TCI States}
\end{table}
6.1.3.72 Delay Status Report MAC CE

The Delay Status Report (DSR) MAC CE is identified by MAC subheader with an eLCID as specified in Table 6.2.12b.

The fields in the DSR MAC CE are defined as follows:
- LCG \( { }_{1} \) : This field indicates the presence of delay information (i.e. the Remaining Time and Buffer Size fields) for the LCG i. The LCG, field set to 1 indicates that the delay information for the LCG \( i \) is reported. The LCG, field set to 0 indicates that the delay information for the LCG i is not reported;
- Remaining Time: This field indicates the shortest remaining value of running PDCP discardTimer (described in clause 7.3 in TS 38.323 [4]) among all PDCP SDUs that are buffered for an LCG but have not been transmitted

ETSI


--- Page 291  ---


3GPP TS 38.321 version 18.2.0 Release 18
290
ETSI TS 138321 V18.2.0 (2024-08)

in any MAC PDU, at the time of the first symbol of the first PUSCH transmission that includes this DSR MAC CE. The length of this field is 6 bits. This field is present only if the buffer size indicated by the corresponding Buffer Size field is not zero; otherwise, this field is reserved and set to 0 . If present, the value \( r \) in this field indicates a remaining time within the range of ( \( r, r+1] \mathrm{msec} \);
- BT: This field is present only if the corresponding LCG is configured with additionalBS-TableAllowed and the buffer size indicated by the corresponding Buffer Size field is not zero; otherwise, this field is reserved and set to 0. If present, the BT field set to 1 indicates that the buffer sizes specified in Table 6.1.3.1-3 are used to set the value of the Buffer Size field, while the BT field set to 0 indicates that the buffer sizes specified in Table 6.1.3.12 are used instead;
- Buffer Size: The Buffer Size field indicates the total amount of delay-critical UL data for an LCG according to the data volume calculation procedure specified in clause 5.5 in TS 38.322 [3] and clause 5.15 in TS 38.323 [4] for the associated RLC and PDCP entities, respectively, after the MAC PDU has been built. If the corresponding LCG is configured with additionalBS-TableAllowed and the amount of delay-critical UL data for an LCG is within the buffer sizes specified in Table 6.1-3.1-3, the MAC entity shall use the buffer sizes specified in Table 6.1.3.1-3 to set the value of this field; otherwise, the MAC entity shall use Table 6.1.3.1-2 instead. This field is indicated in number of bytes. The length of this field is 8 bits.

The DSR MAC CE shall include delay information of all LCGs which have pending DSRs when the MAC PDU containing this DSR MAC CE is to be built. The Remaining Time, the BT, and the Buffer Size fields for an LCG shall be reported in two consecutive octets. These three fields for different LCGs shall be included in a DSR MAC CE in ascending order based on the \( \mathrm{LCG}_{1} \).

Figure 6.1.3.72-1: DSR MAC CE
6.1.3.73 PSI-Based SDU Discard Activation/Deactivation MAC CE

The PSI-Based SDU Discard Activation/Deactivation MAC CE is identified by MAC subheader with an one-octet eLCID as specified in Table 6.2.1-1b.

It has a fixed size and consists of one octet defined as follows (Figure 6.1.3.73-1):
- \( D_{1} \) : This field indicates the activation/deactivation status of the PSI-based SDU discard of DRB \( i \), where \( i \) is the ascending order of the DRB ID among the DRBs configured with discardTimerForLowImportance and with RLC entity(ies) associated with this MAC entity. The Di field set to 1 indicates that the PSI-based SDU discard shall be activated for DRB i. The Di field set to 0 indicates that the PSI-based SDU discard shall be deactivated for DRB i.

ETSI


--- Page 292  ---


3GPP TS 38.321 version 18.2.0 Release 18
291
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.73-1: PSI-Based SDU Discard Activation/Deactivation MAC CE
6.1.3.74 SL-PRS Resource Request MAC CE

The SL-PRS Resource Request MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has the following fields:
- Destination index: The Destination Index field identifies the destination. The length of this field is 5 bits. The value is set to one index corresponding to SL destination identity associated to same destination reported in slPosTxResourceReqList if present. The value is indexed sequentially from 0 in the same ascending order of SL destination identity in sl-PosTxResourceReqList as specified in TS 38.331 [5]. When multiple lists are reported, the value is indexed sequentially across all the lists in the same order as presented in SidelinkUEInformaitonNR message;
- SL-PRS priority: Priority of pending SL-PRS transmission. The length of this field is 3 bits;
- SL-PRS Bandwidth: Requested minimum bandwidth of pending SL-PRS transmission. The length of this field is 5 bits. Encoding of this field is the same as sl-PRS-Bandwidth in IE SL-PRS-QoS-Info as specified in TS 38.331 [5] that codepoint value 0 corresponds to the value "mhz5" of the field \( s l \)-PRS-Bandwidth, codepoint value 1 corresponds to the value "mhz10" of the field sl-PRS-Bandwidth, and so on;
- R: Reserved bit, set to 0 .

Figure 6.1.3.74-1: SL-PRS Resource Request MAC control element
6.1.3.75 LTM Cell Switch Command MAC CE

The LTM Cell Switch Command MAC CE is identified by MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields (Figure 6.1.3.75-1):
- R: Reserved bit, set to 0 ;
- Target Configuration ID: This field indicates the index of candidate target configuration to apply for LTM cell switch, corresponding to \( l t m \)-Candidateld minus 1 as specified in TS 38.331 [5]. The length of the field is 3 bits;

ETSI


--- Page 293  ---


3GPP TS 38.321 version 18.2.0 Release 18
292
ETSI TS 138321 V18.2.0 (2024-08)
- Timing Advance Command: This field indicates whether the TA is valid for the LTM target cell (i.e. the SpCell corresponding to the target configuration indicated by Target Configuration ID field). If the value of this field is set to FFF, this field indicates that no valid timing adjustment is available for the PTAG of the LTM target cell; otherwise, this field indicates the index value \( T_{A} \) used to control the amount of timing adjustment that the MAC entity has to apply in TS 38.213 [6], and that the UE can skip the Random Access procedure for this LTM cell switch. If tag-Id-ptr is configured for the TCI state indicated by the TCI state ID field in the LTM target cell and tag-Id-ptr is set to value \( n l \), this field indicates the TA for the TAG indicated by the tag2-Id of the LTM target cell; otherwise, this field indicates the TA for the TAG indicated by the tag-id of the LTM target cell. The length of the field is 12 bits;
- TCI state ID: This field indicates and activates the TCI state for the LTM target cell (i.e. the SpCell of the target configuration indicated by the Target Configuration ID field). The TCI state is identified by TCI-Stateld in Itm-DL-OrJointTCI-StateToAddModList as specified in TS 38.331 [5]. If the value of unifiedTCI-StateType in the Itm-TCI-Info of the configuration indicated by Target Configuration ID field is joint, this field is for joint TCI state, otherwise, this field is for downlink TCI state. The length of the field is 7 bits;
- UL TCI state ID: This field indicates and activates the uplink TCI state for the LTM target cell (i.e. the SpCell of the target configuration indicated by the Target Configuration ID field). The UL TCI state is identified by TCI-UL-Stateld in Itm-UL-TCI-StatesToAddModList as specified in TS 38.331 [5]. The octet containing this field (i.e. this field and the two reserved bits in the same octet) is included if the value of unifiedTCI-StateType in the Itm-TCI-Info of the configuration indicated by Target Configuration ID field is separate. The length of the field is 6 bits;
- C: This field indicates the presence of the contention-free Random Access Resources fields. If the value of this field is set to 1, the following fields are present: Random Access Preamble index field, S/U field, SS/PBCH index field, PRACH Mask index field, Repetition number field and the reserved bits in the same octet. If the value of this field is set to 0 , these fields are absent.
- S/U: This field indicates which UL carrier to transmit the PRACH of the contention-free Random Access Resources. If the value of this field is set to 1 , SUL is used; otherwise, NUL is used. The length of the field is 1 bit;
- Random Access Preamble index: This field indicates the Random Access Preamble index of the contention-free Random Access Resources. This field should not be set to 0 b 000000 . The length of the field is 6 bits;
- SS/PBCH index: This field indicates the SS/PBCH that shall be used to determine the RACH occasion for the PRACH transmission of the contention-free Random Access Resources. The length of the field is 6 bits;
- PRACH Mask index: This field indicates the RACH occasion(s) associated with the SS/PBCH indicated by 'SS/PBCH index' for the PRACH transmission of the contention-free Random Access Resources. It indicates a subset of RACH occasion(s) from the rach-ConfigDedicated for the UL carrier (indicated by S/U field), (if provided, otherwise it indicates a subset of RACH occasion(s) from the rach-ConfigCommon for the UL carrier (indicated by S/U field) in the UL BWP configuration of firstActiveUplinkBWP-Id as specified in TS 38.331 [5]. When the repetition number field is not set to 0 , the UE ignores this field. The length of the field is 4 bits;
- Repetition number: This field indicates the Msgl repetition number to be applied to the contention-free Random Access. If this field is set to 0 , Msgl repetition number does not apply. If this field is set to 1 , the Msg1 repetition number is 2 . If this field is set to 2 , the Msgl repetition number is 4 . If this field is set to 3 , the Msgl repetition number is 8 . The length of the field is 2 bits.

NOTE 1: A non-zero Msgl repetition number value may only be included in the LTM Cell Switch Command MAC CE when the LTM target cell configuration has contention-based Random Access Resources with a FeatureCombinationPreambles with the same Msg1 repetition number value and featureCombination indicating only msg 1 -Repetitions.

ETSI


--- Page 294  ---


3GPP TS 38.321 version 18.2.0 Release 18
293
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.75-1: LTM Cell Switch Command MAC CE

NOTE 2: If UE receives the LTM Cell Switch Command MAC CE with Target Configuration ID as invalid, as specified in TS 38.331 [5], the procedue of handling LTM Cell Switch Command MAC CE in clause 5.18 .35 does not apply.
6.1.3.76 Candidate Cell TCI States Activation/Deactivation MAC CE

The Candidate Cell TCI States Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size consisting of following fields:
- Candidate Cell ID: This field indicates the identity of an LTM candidate cell for which the MAC CE applies, corresponding to the ltm-Candidateld minus 1 as specified in TS 38.331 [5]. The length of the field is 3 bits;
- \( \mathrm{P}_{1} \) : This field indicates whether each TCI codepoint has multiple TCI states or single TCI state. If the \( \mathrm{P}_{1} \) field is set to 1 , the \( i^{\text {th }} \) TCI codepoint includes the DL TCI state and the UL TCI state. If the \( \mathrm{P}_{1} \) field is set to 0 , the \( i^{\text {th }} \) TCI codepoint includes only the DL/joint TCI state or the UL TCI state. The codepoint to which a TCI state is mapped is determined by its ordinal position among all the TCI state ID fields;
- D/U: This field indicates whether the TCI state ID in the same octet is for a joint/downlink or an uplink TCI state. If this field is set to 1 , the TCI state ID in the same octet is for joint/downlink TCI state. If this field is set to 0 , the TCI state ID in the same octet is for uplink TCI state;
- TCI state ID: This field indicates the TCI state identified by TCI-Stateld in Itm-DL-OrJointTCIStateToAddModList or TCI-UL-Stateld in Itm-UL-TCI-StatesToAddModList as specified in TS 38.331 [5]. If \( \mathrm{D} / \mathrm{U} \) is set to 1, 7-bits length TCI state ID i.e. TCI-Stateld as specified in TS 38.331 [5] is used. If \( \mathrm{D} / \mathrm{U} \) is set to 0 , the most significant bit of TCI state ID is considered as the reserved bit and remaining 6 bits indicate the TCI-UL-Stateld as specified in TS 38.331 [5]. The maximum number of activated TCI states is 16 ;
- R: Reserved bit, set to 0 .

ETSI


--- Page 295  ---


3GPP TS 38.321 version 18.2.0 Release 18
294
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.76-1: Candidate Cell TCI state activation/deactivation MAC CE
6.1.3.77 Cross-RRH TCI State Indication for UE-specific PDCCH MAC CE

The Cross-RRH TCI State Indication for UE-specific PDCCH MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2-1-1b. It has a fixed size of 24 bits with following fields:
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits. If the indicated Serving Cell is configured as part of a simultaneousTCI-UpdateListl or simultaneousTCI-UpdateList2 as specified in TS 38.331 [5], this MAC CE applies to all the Serving Cells in the set simultaneous TCI-UpdateList I or simultaneous TCI-UpdateList2, respectively;
- CORESET ID: This field indicates a Control Resource Set identified with ControlResourceSetld as specified in TS 38.331 [5], for which the TCI State is being indicated. In case the value of the field is 0 , the field refers to the Control Resource Set configured by controlResourceSetZero as specified in TS 38.331 [5]. The length of the field is 4 bits;
- TCI State ID: This field indicates the TCI state identified by TCI-Stateld as specified in TS 38.331 [5] applicable to the Control Resource Set identified by CORESET ID field. If the field of CORESET ID is set to 0 , this field indicates a TCI-Stateld for a TCI state of the first 64 TCI-states configured by tci-StatesToAddModList and tciStatesToReleaseList in the PDSCH-Config in the active BWP. If the field of CORESET ID is set to the other value than 0 , this field indicates a TCI-Stateld configured by tci-StatesPDCCH-ToAddList and tci-StatesPDCCH-ToReleaseList in the controlResourceSet identified by the indicated CORESET ID. The length of the field is 7 bits;
- Cross RRH Indicator: This field indicates whether the lower layers follow TCI state switching delay requirements in high speed train FR2 scenarios and apply the one shot large UL timing adjustment after switching to a TCI state identified by TCI-Stateld as specified in TS 38.331 [5]. The field is set to 1 to indicate that the lower layers apply the TCI state switching delay requirements specified in Clause 8.10.3A of TS 38.133 [11] and apply the one shot large timing adjustment requirements specified in Clause 7.1.2.3 of TS 38.133 [11] immediately to the first UL transmission after TCI state switch without checking the DL timing difference threshold. The field is set to 0 to indicate that the lower layers apply the TCI state switching delay requirements specified in clause 8.10.3 of TS 38.133 [11] and apply the gradual timing adjustment requirements specified in Clause 7.1.2.1 of TS 38.133 [11] to the first UL transmission after TCI state switch without checking the DL timing difference threshold. The length of the field is 1 bit;
- R: Reserved bit, set to 0 .

ETSI


--- Page 296  ---


3GPP TS 38.321 version 18.2.0 Release 18
295
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.3.77-1: Cross-RRH TCI State Indication for UE-specific PDCCH MAC CE
6.1.3.78 Single Entry PHR with assumed PUSCH MAC CE

The Single Entry PHR with assumed PUSCH MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2.

It has a variable size and consists of two or three octets defined as follows (Figure 6.1.3.8-1):
- R: Reserved bit, set to 0 ;
- Power Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 below (the corresponding measured values in dB are specified in TS 38.133 [11]);
- E: This field indicates the presence of a \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) for assumed PUSCH field for PCell. The E field set to 1 indicates that a \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) for assumed PUSCH field for PCell is reported. The E field set to 0 indicates that a \( \mathrm{P}_{\text {CMAX, I, }} \mathrm{C} \) for assumed PUSCH field for PCell is not reported;
- P: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than PMPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by \( \mathrm{P}^{-} \mathrm{MPR}_{\mathrm{c}} \) as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) field would have had a different value if no power backoff due to power management had been applied;
- P \( _{\text {CMAX, } \sqrt{c} \text { : }} \) This field indicates the P \( _{\text {CMAX, } 5 \text {, }} \) (as specified in TS 38.213 [6]) used for calculation of the preceding PH field. The reported \( \mathrm{P}_{\text {CMAX, } 5, \mathrm{C}} \) and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm are specified in TS 38.133 [11]);
- \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) for assumed PUSCH: This field indicates the \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) for assumed PUSCH(as specified in TS 38.213 [6]). The reported \( \mathrm{P}_{\text {CMAX, }, \mathrm{c}} \) and the corresponding nominal UE transmit power levels are shown in [Table 6.1.3.8-2] (the corresponding measured values in dBm are specified in TS 38.133 [11]);
- MPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. [f mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to \( 0, \mathrm{R} \) bits are present instead.

Figure 6.1.3.78-1: Single Entry PHR with assumed PUSCH MAC CE

ETSI


--- Page 297  ---


3GPP TS 38.321 version 18.2.0 Release 18
296
ETSI TS 138321 V18.2.0 (2024-08)
6.1.3.79 Multiple Entry PHR with assumed PUSCH MAC CE

The Multiple Entry PHR with assumed PUSCH MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2.

It has a variable size, and includes the bitmap, a Type 2 PH field, an octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{IC}} \) field (if reported) and an octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{F}, \mathrm{c}} \) field for assumed PUSCH (if reported) for SpCell of the other MAC entity; a Type 1 PH field, an octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) field (if reported) and an octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) field for assumed PUSCH (if reported) for the PCell. It further includes, in ascending order based on the ServCellIndex, one or multiple of Type X PH fields, octets containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}, \mathrm{c}} \) fields (if reported) and octets containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) fields for assumed PUSCH (if reported) for Serving Cells other than PCell indicated in the bitmap. X is either 1 or 3 according to TS 38.213 [6] and TS 36.213 [17].

The presence of Type 2 PH field for SpCell of the other MAC entity is configured by phr-Type2OtherCell with value true.

A single octet \( \mathrm{C}_{1} \) bitmap is used for indicating the presence of PH per Serving Cell when the highest ServCellIndex of Serving Cell with configured uplink is less than 8, otherwise four octets are used.

The length of the \( E_{k} \) bitmap is based on the total number of Serving Cells, i.e. Serving Cells for which \( C_{1} \) field set to 1 and PCell. A single octet \( E_{k} \) bitmap is included if the total number of Serving Cells is greater than 0 and less than 9 ; a two octets \( \mathrm{E}_{\mathrm{k}} \) bitmap is included if the total number of Serving Cells is greater than 8 and less than 17; a three octets \( \mathrm{E}_{\mathrm{k}} \) bitmap is included if the total number of Serving Cells is greater than 16 and less than 25 ; a four octets \( \mathrm{E}_{\mathrm{k}} \) bitmap is included if the total number of Serving Cells is greater than 24; \( E_{k} \) bitmap is not included if the total number of Serving Cells is zero.

The MAC entity determines whether PH value for an activated Serving Cell is based on real transmission or a reference format by considering the configured grant(s) and downlink control information which has been received until and including the PDCCH occasion in which the first UL grant for a new transmission that can accommodate the MAC CE for PHR as a result of LCP as defined in clause 5.4.3.1 is received since a PHR has been triggered if the PHR MAC CE is reported on an uplink grant received on the PDCCH or until the first uplink symbol of PUSCH transmission minus PUSCH preparation time as defined in clause 7.7 of TS 38.213 [6] if the PHR MAC CE is reported on a configured grant.

For a band combination in which the UE does not support dynamic power sharing, the UE may omit the octets containing Power Headroom field and \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) field for Serving Cells in the other MAC entity except for the PCell in the other MAC entity and the reported values of Power Headroom and \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) for the PCell are up to UE implementation.

The PHR MAC CEs are defined as follows:
- \( \mathrm{C}_{1} \) : This field indicates the presence of a PH field for the Serving Cell with ServCellIndex i as specified in TS 38.331 [5]. The \( \mathrm{C}_{1} \) field set to 1 indicates that a PH field for the Serving Cell with ServCellIndex i is reported. The \( \mathrm{C}_{1} \) field set to 0 indicates that a PH field for the Serving Cell with ServCellIndex i is not reported;
- \( E_{k} \) : This field indicates the presence of a \( \mathrm{P}_{\text {CMAX, } 5, c} \) for assumed PUSCH field of the \( \mathrm{k}^{\text {th }} \) Serving Cell. The Serving Cells for which \( \mathrm{C}_{1} \) field is set to 1 and PCell are indexed sequentially starting with PCell and followed by other Serving cells in ascending order of ServCellIndex i as specified in TS 38.331 [5]. The \( \mathrm{E}_{\mathrm{k}} \) field set to 1 indicates that a \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) for assumed PUSCH field for the \( \mathrm{k}^{\text {th }} \) Serving Cell is reported. The \( \mathrm{E}_{\mathrm{k}} \) field set to 0 indicates that a PCMAX, \( 5, \mathrm{c} \) for assumed PUSCH field for the \( k^{\text {th }} \) Serving Cell is not reported. For the E-UTRA Serving Cell, the corresponding \( \mathrm{E}_{\mathrm{k}} \) field is set to 0 ;
- R: Reserved bit, set to 0 ;
- V: This field indicates if the PH value is based on a real transmission or a reference format. For Type 1 PH, the V field set to 0 indicates real transmission on PUSCH and the V field set to 1 indicates that a PUSCH reference format is used. For Type 2 PH, the V field set to 0 indicates real transmission on PUCCH and the V field set to 1 indicates that a PUCCH reference format is used. For Type 3 PH , the V field set to 0 indicates real transmission on SRS and the V field set to 1 indicates that an SRS reference format is used. Furthermore, for Type 1, Type 2, and Type 3 PH , the V field set to 0 indicates the presence of the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) field and the MPE field, and the V field set to 1 indicates that the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) field and the MPE field is omitted;

ETSI


--- Page 298  ---


3GPP TS 38.321 version 18.2.0 Release 18
297
ETSI TS 138321 V18.2.0 (2024-08)
- Power Headroom (PH): This field indicates the power headroom level. The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dB for the E-UTRA Serving Cell are specified in TS 36.133 [12]);
- P: If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value, to meet MPE requirements, as specified in TS 38.101-2 [15], is less than PMPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by \( \mathrm{P}^{-} \mathrm{MPR}_{\mathrm{c}} \) as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the P field to 1 if the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}, \mathrm{C}} \) field would have had a different value if no power backoff due to power management had been applied; the \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}} \) or \( \tilde{\mathrm{P}}_{\mathrm{CMAX}, \mathrm{C}} \) (as specified in TS 36.213 [17]) for the E-UTRA Serving Cell used for calculation of the preceding PH field. The reported \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dBm for the E-UTRA Serving Cell are specified in TS 36.133 [12]);
- \( \mathrm{P}_{\text {CMAX, } \sqrt{c} \text { for assumed PUSCH: If present, this field indicates the } \mathrm{P}_{\text {CMAX, } \sqrt{c} \text {, for assumed }} \mathrm{PUSCH} \text { (as specified in TS }} 38.213[6]) \) for the NR Serving Cell. The reported \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) and the corresponding nominal UE transmit power levels are shown in [Table 6.1.3.8-2] (the corresponding measured values in dBm for the NR Serving Cell are specified in TS 38.133 [11];
- MPE: If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the P field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the P field is set to \( 0, \mathrm{R} \) bits are present instead.

ETSI


--- Page 299  ---


3GPP TS 38.321 version 18.2.0 Release 18
298
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & & & & & & & \\
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & R \\
\hline \( \mathrm{E}_{7} \) & \( \mathrm{E}_{6} \) & \( \mathrm{E}_{5} \) & \( \mathrm{E}_{4} \) & \( \mathrm{E}_{3} \) & \( \mathrm{E}_{2} \) & \( \mathrm{E}_{1} \) & \( \mathrm{E}_{0} \) \\
\hline P & V & \multicolumn{6}{|r|}{PH (Type 2, SpCell of the other MAC entity)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{Pomax,f,c 1} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type 1, PCell)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{Pomax,f,c 2} \\
\hline R & R & \multicolumn{6}{|c|}{\( P_{\text {CMAX,f,c }} 2 \) (assumed PUSCH)} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type X, Serving Cell 1)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{Pomax,f,c 3} \\
\hline R & R & \multicolumn{6}{|c|}{\( P_{\text {CMAX,f,c }} 3 \) (assumed PUSCH)} \\
\hline
\end{tabular}

\begin{table}
\begin{tabular}{|c|c|c|}
\hline\( P \) & \( V \) & \( P H \) (Type X, Serving Cell n) \\
\hline \multicolumn{2}{|c|}{\( M P E \) or R } & \( P_{\text {CMAX, }, \mathrm{c}} m \) \\
\hline\( R \) & \( R \) & \( P_{\text {CMAX, }, \mathrm{c}} m \) (assumed PUSCH) \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{Figure 6.1.3.79-1: Multiple Entry PHR with assumed PUSCH MAC CE with the highest ServCellindex of Serving Cell with configured uplink is less than 8}
\end{table}

ETSI


--- Page 300  ---


3GPP TS 38.321 version 18.2.0 Release 18
299
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & & & & & & & \\
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{5} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & R \\
\hline \( \mathrm{C}_{15} \) & \( \mathrm{C}_{14} \) & \( \mathrm{C}_{13} \) & \( \mathrm{C}_{12} \) & \( \mathrm{C}_{11} \) & \( \mathrm{C}_{10} \) & \( \mathrm{C}_{9} \) & \( \mathrm{C}_{8} \) \\
\hline \( \mathrm{C}_{23} \) & \( \mathrm{C}_{22} \) & \( \mathrm{C}_{21} \) & \( \mathrm{C}_{20} \) & \( \mathrm{C}_{19} \) & \( \mathrm{C}_{18} \) & \( \mathrm{C}_{17} \) & \( \mathrm{C}_{16} \) \\
\hline \( \mathrm{C}_{31} \) & \( \mathrm{C}_{30} \) & \( \mathrm{C}_{29} \) & \( \mathrm{C}_{28} \) & \( \mathrm{C}_{27} \) & \( \mathrm{C}_{26} \) & \( \mathrm{C}_{25} \) & \( \mathrm{C}_{24} \) \\
\hline \( \mathrm{E}_{7} \) & \( \mathrm{E}_{6} \) & \( \mathrm{E}_{5} \) & \( \mathrm{E}_{4} \) & \( \mathrm{E}_{3} \) & \( \mathrm{E}_{2} \) & \( \mathrm{E}_{1} \) & \( \mathrm{E}_{0} \) \\
\hline \( \mathrm{E}_{15} \) & \( \mathrm{E}_{14} \) & \( \mathrm{E}_{13} \) & \( \mathrm{E}_{12} \) & \( \mathrm{E}_{11} \) & \( \mathrm{E}_{10} \) & \( \mathrm{E}_{9} \) & \( \mathrm{E}_{8} \) \\
\hline \( \mathrm{E}_{23} \) & \( \mathrm{E}_{22} \) & \( \mathrm{E}_{21} \) & \( \mathrm{E}_{20} \) & \( \mathrm{E}_{19} \) & \( \mathrm{E}_{18} \) & \( \mathrm{E}_{17} \) & \( \mathrm{E}_{16} \) \\
\hline \( \mathrm{E}_{31} \) & \( \mathrm{E}_{30} \) & \( \mathrm{E}_{29} \) & \( \mathrm{E}_{28} \) & \( \mathrm{E}_{27} \) & \( \mathrm{E}_{26} \) & \( \mathrm{E}_{25} \) & \( \mathrm{E}_{24} \) \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type 2, SpCell of the other MAC entity)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{Pomax,f,c 1} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type 1, PCell)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{Pomax,f,c 2} \\
\hline R & R & \multicolumn{6}{|c|}{\( P_{\text {CMAX,f,c }} 2 \) (assumed PUSCH)} \\
\hline P & V & \multicolumn{6}{|c|}{PH (Type X, Serving Cell 1)} \\
\hline \multicolumn{2}{|c|}{MPE or R} & \multicolumn{6}{|c|}{Pomax,f,c 3} \\
\hline R & R & \multicolumn{6}{|c|}{\( P_{\text {CMAX,f,c }} 3 \) (assumed PUSCH)} \\
\hline
\end{tabular}

\begin{tabular}{|c|c|c|}
\hline\( P \) & \( V \) & \( P H \) (Type X, Serving Cell n) \\
\hline \multicolumn{2}{|c|}{ MPE or R } & Pomax, f, \( ^{\text {m }} \) \\
\hline\( R \) & \( R \) & P \( _{\text {CMAX, }, \mathrm{c}} \) m (assumed PUSCH) \\
\hline
\end{tabular}

Figure 6.1.3.79-2: Multiple Entry PHR with assumed PUSCH MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is equal to or higher than 8
6.1.3.80 Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE

The enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size and consists of the following fields:

ETSI


--- Page 301  ---


3GPP TS 38.321 version 18.2.0 Release 18
300
ETSI TS 138321 V18.2.0 (2024-08)
- Serving Cell ID: This field indicates the identity of the Serving Cell for which the MAC CE applies. The length of the field is 5 bits;
- BWP ID: This field indicates a UL BWP for which the MAC CE applies as the codepoint of the DCI bandwidth part indicator field as specified in TS 38.212 [9]. The length of the BWP ID field is 2 bits;
- \( \mathrm{S}_{1} \) : This field indicates the activation/deactivation status of the Semi-Persistent CSI report configuration within csi-ReportConfigToAddModList, as specified in TS 38.331 [5]. So refers to the report configuration which includes PUCCH resources for SP CSI reporting in the indicated BWP and has the lowest CSI-ReportConfigId within the list with type set to semiPersistentOnPUCCH, \( \mathrm{S}_{1} \) to the report configuration which includes PUCCH resources for SP CSI reporting in the indicated BWP and has the second lowest CSI-ReportConfigId and so on. If the number of report configurations within the list with type set to semiPersistentOnPUCCH in the indicated BWP is less than \( i+1 \), MAC entity shall ignore the \( S_{1} \) field. The \( S_{1} \) field is set to 1 to indicate that the corresponding Semi-Persistent CSI report configuration shall be activated. The \( \mathrm{S}_{1} \) field is set to 0 to indicate that the corresponding Semi-Persistent CSI report configuration i shall be deactivated;
- \( \mathrm{N}_{\mathrm{i}, \mathrm{x}} \) : this field indicates the activation/deactivation status of the Semi-Persistent CSI report sub-configuration x within csi-ReportSubConfigToAddModList of CSI-ReportConfigId i , as specified in TS 38.331 [5]. If \( \mathrm{S}_{1} \) set to 1, the octet corresponding to \( \mathrm{N}_{1,0} \) to \( \mathrm{N}_{1,7} \) is present. If \( \mathrm{S}_{1} \) set to 0 , the octet corresponding to \( \mathrm{N}_{1,0} \) to \( \mathrm{N}_{1,7} \) is not present. \( \mathrm{N}_{0,0} \) refers to the report sub-configuration which has the lowest csi-ReportSubConfigID within the list, \( \mathrm{N}_{0,1} \) to the report sub-configuration which has the second lowest csi-ReportSubConfigID and so on. If the number of report sub-configurations within the list with type set to csi-ReportSubConfigToAddModList in the indicated BWP is less than \( \mathrm{x}+1 \), the MAC entity shall ignore the \( \mathrm{N}_{1, \mathrm{x}} \) field. The \( \mathrm{N}_{1, \mathrm{x}} \) field is set to 1 to indicate that the corresponding Semi-Persistent CSI report sub-configuration x shall be activated. The \( \mathrm{N}_{1, \mathrm{x}} \) field is set to 0 to indicate that the corresponding Semi-Persistent CSI report sub-configuration x shall be deactivated;
- R: Reserved bit, set to 0 .

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline \multicolumn{8}{|c|}{} \\
\hline R & \multicolumn{5}{|c|}{Serving Cell ID} & \multicolumn{2}{|c|}{BWP ID} \\
\hline R & R & R & R & \( \mathrm{S}_{3} \) & \( \mathrm{S}_{2} \) & \( \mathrm{S}_{1} \) & \( \mathrm{S}_{0} \) \\
\hline \( \mathrm{N}_{0,7} \) & \( \mathrm{N}_{0,6} \) & \( \mathrm{N}_{0,5} \) & \( \mathrm{N}_{0,4} \) & \( \mathrm{N}_{0,3} \) & \( \mathrm{N}_{0,2} \) & \( \mathrm{N}_{0,1} \) & \( \mathrm{N}_{0,0} \) \\
\hline \( \mathrm{N}_{1,7} \) & \( \mathrm{N}_{1,6} \) & \( \mathrm{N}_{1,5} \) & \( \mathrm{N}_{1,4} \) & \( \mathrm{N}_{1,3} \) & \( \mathrm{N}_{1,2} \) & \( \mathrm{N}_{1,1} \) & \( \mathrm{N}_{1,0} \) \\
\hline \( \mathrm{N}_{2,7} \) & \( \mathrm{N}_{2,6} \) & \( \mathrm{N}_{2,5} \) & \( \mathrm{N}_{2,4} \) & \( \mathrm{N}_{2,3} \) & \( \mathrm{N}_{2,2} \) & \( \mathrm{N}_{2,1} \) & \( \mathrm{N}_{2,0} \) \\
\hline \( \mathrm{N}_{3,7} \) & \( \mathrm{N}_{3,6} \) & \( \mathrm{N}_{3,5} \) & \( \mathrm{N}_{3,4} \) & \( \mathrm{N}_{3,3} \) & \( \mathrm{N}_{3,2} \) & \( \mathrm{N}_{3,1} \) & \( \mathrm{N}_{3,0} \) \\
\hline
\end{tabular}
Oct 1
Oct 2
Oct 3
(Optional)
Oct 4
(Optional)
Oct 5
(Optional)
Oct 6
(Optional)

Figure 6.1.3.80-1: Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE
6.1.3.81 Enhanced Single Entry PHR for multiple TRP STx2P MAC CE

The Enhanced Single Entry PHR for multiple TRP STx2P MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b.

The two PHs together with two \( \mathrm{P}_{\text {CMAX, } 5, \mathrm{c}, \mathrm{k}} \) for the Serving Cell are reported if UE is configured with twoPHRMode and multipanelSchemeSDM or multipanelSchemeSFN, as specified in clause 5.4.6.

It has a fixed size and consists of four octets defined as follows (Figure 6.1.3.81-1):
- R: Reserved bit, set to 0 ;
- Power Headroom \( \mathrm{k}(\mathrm{PH} \mathrm{k}) \) : This field indicates the power headroom level for \( \mathrm{k}=1,2 \), where PH 1 is associated with the first TCI-State or TCI-UL-State for a real or reference PUSCH transmission and PH 2 is associated with the second TCI-State or TCI-UL-State for a real or reference PUSCH transmission, as specified in TS 38.213

ETSI


--- Page 302  ---


3GPP TS 38.321 version 18.2.0 Release 18
301
ETSI TS 138321 V18.2.0 (2024-08)

clause 7.7.1 [6]. PH fields for a Serving Cell are included in ascending order based on k . The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB are specified in TS 38.133 [11]);
- \( \mathrm{P}_{\mathrm{k}} \) : If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value associated with \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{r}, \mathrm{k}, \mathrm{k}} \) to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the \( P_{k} \) field to 1 if the corresponding \( P_{C M A X, J, c, k} \) field would have had a different value if no power backoff due to power management had been applied;
- \( V_{k} \) : This field indicates if the PH value for the corresponding TRP is based on a real transmission or a reference format for PH k. For Type 1 PH, the \( \mathrm{V}_{\mathrm{k}} \) field set to 0 indicates real transmission on PUSCH and the \( \mathrm{V}_{\mathrm{k}} \) field set to 1 indicates that a PUSCH reference format is used;
- P \( _{\text {CMAX, } \sqrt{c}, \mathrm{k}} \) : This field indicates the configured transmitted power \( \mathrm{P}_{\text {CMAX, } \sqrt{c}, \mathrm{k}} \) (as specified in TS 38.213 [6]) used for calculation of the preceding PH k field. The reported \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}, \mathrm{k}} \) and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm are specified in TS 38.133 [11]);
- \( \mathrm{MPE}_{\mathrm{k}} \) : If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the \( \mathrm{P}_{\mathrm{k}} \) field is set to 1 , this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the \( \mathrm{P}_{\mathrm{k}} \) field is set to \( 0, \mathrm{R} \) bits are present instead.

\begin{table}
\begin{tabular}{|l|l|l|l|}
\hline \multicolumn{2}{|c|}{} & & \multirow[b]{2}{*}{Oct 1} \\
\hline \( \mathrm{P}_{1} \) & \( \mathrm{V}_{1} \) & PH 1 (Type 1, PCell) & \\
\hline \( \mathrm{P}_{2} \) & \( \mathrm{V}_{2} \) & PH 2 (Type 1, PCell) & Oct 2 \\
\hline \multicolumn{2}{|c|}{MPE \( { }_{1} \) or R} & \( P_{\text {CMAX,f,c,1 }} \) & Oct 3 \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{2} \) or R} & \( P_{\text {CMAX,f,c,2 }} \) & Oct 4 \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{Figure 6.1.3.81-1: Enhanced Single Entry PHR for multiple TRP STx2P MAC CE}
\end{table}
6.1.3.82 Enhanced Multiple Entry PHR for multiple TRP STx2P MAC CE

The Enhanced Multiple Entry PHR for multiple TRP STx2P MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-2b.

It has a variable size, and includes the bitmaps, a Type 2 PH field and an octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}} \) field (if reported) for SpCell of the other MAC entity, one or multiple Type 1 PH fields and one or multiple octets containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}, \mathrm{k}} \) fields (if reported) for the PCell. It further includes, in ascending order based on the ServCellIndex, one or multiple of Type 1 PH fields and one or multiple octets containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}, \mathrm{k}} \) fields (if reported) or one Type 3 PH field with one octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{C}} \) field (if reported) for Serving Cells other than PCell indicated in the bitmap for indicating the presence of \( \mathrm{PH}(\mathrm{s}) \).

The presence of Type 2 PH field for SpCell of the other MAC entity is configured by phr-Type2OtherCell with value true.

A single octet bitmap is used for indicating the presence of \( \mathrm{PH}(\mathrm{s}) \) per Serving Cell when the highest ServCellIndex of Serving Cell with configured uplink is less than 8, otherwise four octets are used.

The MAC entity determines whether PH value for an activated Serving Cell is based on real transmission or a reference format by considering the configured grant(s) and downlink control information which has been received until and including the PDCCH occasion in which the first UL grant for a new transmission that can accommodate the MAC CE

ETSI


--- Page 303  ---


3GPP TS 38.321 version 18.2.0 Release 18
302
ETSITS 138321 V18.2.0 (2024-08)

for PHR as a result of LCP as defined in clause 5.4.3.1 is received since a PHR has been triggered if the PHR MAC CE is reported on an uplink grant received on the PDCCH or until the first uplink symbol of PUSCH transmission minus PUSCH preparation time as defined in clause 7.7 of TS 38.213 [6] if the PHR MAC CE is reported on a configured grant.

For a band combination in which the UE does not support dynamic power sharing, the UE may omit the octets containing Power Headroom field and \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{F}, \mathrm{k}} \) field for Serving Cells in the other MAC entity except for the PCell in the other MAC entity and the reported values of Power Headroom and \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{F}, \mathrm{k}} \) for the PCell are up to UE implementation.

The two PHs together with two \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{rc}, \mathrm{k}} \) for the Serving Cell configured with multipanelSchemeSDM or multipanelSchemeSFN are reported if the MAC entity is configured with twoPHRMode, as specified in clause 5.4.6.

The Enhanced Multiple Entry PHR for multiple TRP STx2P MAC CEs are defined as follows:
- \( \mathrm{C}_{1} \) : This field indicates the presence of PH field(s) for the Serving Cell with ServCellIndex i as specified in TS 38.331 [5]. The \( \mathrm{C}_{1} \) field set to 1 indicates that PH field(s) for the Serving Cell with ServCellIndex i is reported. The \( \mathrm{C}_{1} \) field set to 0 indicates that a PH field for the Serving Cell with ServCellIndex \( i \) is not reported;
- R: Reserved bit, set to 0 ;
- \( \quad V_{k} \) : This field indicates if the PH \( k \) value is based on a real transmission or a reference format for \( k=1,2 \). For Type 1 PH, the \( \mathrm{V}_{\mathrm{k}} \) field set to 0 indicates real transmission on PUSCH and the \( \mathrm{V}_{\mathrm{k}} \) field set to 1 indicates that a PUSCH reference format is used. For Type 2 PH , the \( \mathrm{V}_{\mathrm{k}} \) field set to 0 indicates real transmission on PUCCH and the \( \mathrm{V}_{\mathrm{k}} \) field set to 1 indicates that a PUCCH reference format is used. For Type 3 PH , the \( \mathrm{V}_{\mathrm{k}} \) field set to 0 indicates real transmission on SRS and the \( \mathrm{V}_{\mathrm{k}} \) field set to 1 indicates that an SRS reference format is used. Furthermore, for type 1 PH of a reported Serving Cell not configured with multipanelSchemeSDM or multipanelSchemeSFN, the \( \mathrm{V}_{\mathrm{k}} \) field set to 0 indicates the presence of the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}, \mathrm{k}} \) field and the \( \mathrm{MPE}_{\mathrm{k}} \) field, and the \( \mathrm{V}_{\mathrm{k}} \) field set to 1 indicates that the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}, \mathrm{k}} \) field and \( \mathrm{MPE}_{\mathrm{k}} \) field is omitted; for Type 2, and Type 3 PH , the \( \mathrm{V}_{\mathrm{k}} \) field set to 0 indicates the presence of the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}, \mathrm{k}} \) field and the \( \mathrm{MPE}_{\mathrm{k}} \) field, and the \( \mathrm{V}_{\mathrm{k}} \) field for the Serving Cell set to 1 indicates that the octet containing the associated \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}, \mathrm{k}} \) field and the \( \mathrm{MPE}_{\mathrm{k}} \) field is omitted;
- Power Headroom \( \mathrm{k}(\mathrm{PH} \mathrm{k}) \) : This field indicates the power headroom level. For PHR with twoPHRmode, if the Serving cell is configured with multipanelSchemeSFN or multipanelSchemeSDM, PH 1 is associated with the first TCI-State or TCI-UL-State for a real or reference PUSCH transmission and PH 2 is associated with the second TCI-State or TCI-UL-State for a real or reference PUSCH transmission, as specified in TS 38.213 clause 7.7.1 [6]; if the Serving cell is configured with multiple TRP PUSCH repetition, PH 1 is associated with the SRSResourceSet with a lower srs-ResourceSetld and PH 2 is associated with the SRS-ResourceSet with a higher srsResourceSetld. PH fields for a Serving Cell are included in ascending order based on k . The length of the field is 6 bits. The reported PH and the corresponding power headroom levels are shown in Table 6.1.3.8-1 (the corresponding measured values in dB for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dB for the E-UTRA Serving Cell are specified in TS 36.133 [12]);
- \( \mathrm{P}_{\mathrm{k}} \) : If mpe-Reporting-FR2 is configured and the Serving Cell operates on FR2, the MAC entity shall set this field to 0 if the applied P-MPR value associated with \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{F}, \mathrm{k}, \mathrm{k}} \) to meet MPE requirements, as specified in TS 38.101-2 [15], is less than P-MPR_ 00 as specified in TS 38.133 [11] and to 1 otherwise. If mpe-Reporting-FR2 is not configured or the Serving Cell operates on FR1, this field indicates whether power backoff is applied due to power management (as allowed by P-MPRc as specified in TS 38.101-1 [14], TS 38.101-2 [15], and TS 38.101-3 [16]). The MAC entity shall set the \( \mathrm{P}_{\mathrm{k}} \) field to 1 if the corresponding \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{F}, \mathrm{c}, \mathrm{k}} \) field would have had a different value if no power backoff due to power management had been applied;
- P \( _{\text {CMAX, } \sqrt{c},} \mathrm{P}_{\text {CMAX, } \sqrt{c}, \mathrm{k}} \) : If present, this field indicates the configured transmitted power \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{k}} \) (as specified in TS 38.213 [6]) for the NR Serving Cell and the \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{C}} \) or \( \tilde{\mathrm{P}}_{\mathrm{CMAX}, \mathrm{C}} \) (as specified in TS 36.213 [17]) for the E-UTRA Serving Cell used for calculation of the preceding PH k field. For the SpCell of the other MAC entity and a reported Serving Cell not configured with multipanelSchemeSDM or multipanelSchemeSFN, \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{Fe}} \) is presented (i.e., the index k is omitted). The reported \( \mathrm{P}_{\mathrm{CMAX}, \mathrm{J}, \mathrm{c}, \mathrm{k}} \) and the corresponding nominal UE transmit power levels are shown in Table 6.1.3.8-2 (the corresponding measured values in dBm for the NR Serving Cell are specified in TS 38.133 [11] while the corresponding measured values in dBm for the E-UTRA Serving Cell are specified in TS 36.133 [12]);
- MPE \( \mathrm{E}_{\mathrm{k}} \) : If mpe-Reporting-FR2 is configured, and the Serving Cell operates on FR2, and if the \( \mathrm{P}_{\mathrm{k}} \) field is set to 1, this field indicates the applied power backoff to meet MPE requirements, as specified in TS 38.101-2 [15]. This field indicates an index to Table 6.1.3.8-3 and the corresponding measured values of P-MPR levels in dB are

ETSI


--- Page 304  ---


3GPP TS 38.321 version 18.2.0 Release 18
303
ETSI TS 138321 V18.2.0 (2024-08)

specified in TS 38.133 [11]. The length of the field is 2 bits. If mpe-Reporting-FR2 is not configured, or if the Serving Cell operates on FR1, or if the \( \mathrm{P}_{\mathrm{k}} \) field is set to \( 0, \mathrm{R} \) bits are present instead.

\begin{tabular}{|l|l|l|l|l|l|l|}
\hline & & & & & & \\
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & R \\
\hline \( \mathrm{P}_{1} \) & \multicolumn{6}{|c|}{PH 1 (Type 2, SpCell of the other MAC entity)} \\
\hline \( \mathrm{MPE}_{1} \) or R & \multicolumn{6}{|c|}{\( P_{\text {CMAX,f,c }} 1 \)} \\
\hline \( \mathrm{P}_{1} \) & \multicolumn{6}{|c|}{PH 1 (Type 1, PCell)} \\
\hline \( \mathrm{P}_{2} \) & \multicolumn{6}{|c|}{PH 2 (Type 1, PCell)} \\
\hline \( \mathrm{MPE}_{1} \) or R & \multicolumn{6}{|c|}{Pamax,f,c,1 2} \\
\hline \( \mathrm{MPE}_{2} \) or R & \multicolumn{6}{|c|}{Pamax,f,c,2 2} \\
\hline \( \mathrm{P}_{1} \) & \multicolumn{6}{|c|}{PH 1 (Type X, Serving Cell 1)} \\
\hline \( \mathrm{P}_{2} \) & \multicolumn{6}{|c|}{PH 2 (Type 1, Serving Cell 1)} \\
\hline \( \mathrm{MPE}_{1} \) or R & \multicolumn{6}{|c|}{Pamax,f,c,1 3} \\
\hline \( \mathrm{MPE}_{2} \) or R & \multicolumn{6}{|c|}{Pomax,f,c,2 3} \\
\hline
\end{tabular}
(Optional)
(Optional)
(Optional)
(Optional)

\begin{tabular}{|c|c|c|}
\hline\( P_{1} \) & \( V_{1} \) & \( P H \) 1 (Type X, Serving Cell n) \\
\hline\( P_{2} \) & \( V_{2} \) & \( P H \) 2 (Type 1, Serving Cell n) \\
\hline\( M P E_{1} \) or R & \( P_{\text {CMAX, } f, c, 1} m \) \\
\hline\( M P E_{2} \) or R & \( P_{\text {QMAX, } f, c, 2} m \) \\
\hline
\end{tabular}

(Optional)
(Optional)

Figure 6.1.3.82-1: Enhanced Multiple Entry PHR for multiple TRP STx2P MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is less than 8

ETSI


--- Page 305  ---


3GPP TS 38.321 version 18.2.0 Release 18
304
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & & & & & & & \\
\hline \( \mathrm{C}_{7} \) & \( \mathrm{C}_{6} \) & \( \mathrm{C}_{5} \) & \( \mathrm{C}_{4} \) & \( \mathrm{C}_{3} \) & \( \mathrm{C}_{2} \) & \( \mathrm{C}_{1} \) & R \\
\hline \( \mathrm{C}_{15} \) & \( \mathrm{C}_{14} \) & \( \mathrm{C}_{13} \) & \( \mathrm{C}_{12} \) & \( \mathrm{C}_{11} \) & \( \mathrm{C}_{10} \) & \( \mathrm{C}_{9} \) & \( \mathrm{C}_{8} \) \\
\hline \( \mathrm{C}_{23} \) & \( \mathrm{C}_{22} \) & \( \mathrm{C}_{21} \) & \( \mathrm{C}_{20} \) & \( \mathrm{C}_{19} \) & \( \mathrm{C}_{18} \) & \( \mathrm{C}_{17} \) & \( \mathrm{C}_{16} \) \\
\hline \( \mathrm{C}_{31} \) & \( \mathrm{C}_{30} \) & \( \mathrm{C}_{29} \) & \( \mathrm{C}_{28} \) & \( \mathrm{C}_{27} \) & \( \mathrm{C}_{26} \) & \( \mathrm{C}_{25} \) & \( \mathrm{C}_{24} \) \\
\hline \( \mathrm{P}_{1} \) & \( \mathrm{V}_{1} \) & \multicolumn{6}{|c|}{PH 1 (Type 2, SpCell of the other MAC entity)} \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{1} \) or R} & \multicolumn{6}{|c|}{\( P_{\text {CMAX,f,c }} 1 \)} \\
\hline \( \mathrm{P}_{1} \) & \( \mathrm{V}_{1} \) & \multicolumn{6}{|c|}{PH 1 (Type 1, PCell)} \\
\hline \( \mathrm{P}_{2} \) & \( \mathrm{V}_{2} \) & \multicolumn{6}{|c|}{PH 2 (Type 1, PCell)} \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{1} \) or R} & \multicolumn{6}{|c|}{Pamax,f,c,1 2} \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{2} \) or R} & \multicolumn{6}{|c|}{Pamax,f,c,2 2} \\
\hline \( \mathrm{P}_{1} \) & \( \mathrm{V}_{1} \) & \multicolumn{6}{|c|}{PH 1 (Type X, Serving Cell 1)} \\
\hline \( \mathrm{P}_{2} \) & \( \mathrm{V}_{2} \) & \multicolumn{6}{|c|}{PH 2 (Type 1, Serving Cell 1)} \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{1} \) or R} & \multicolumn{6}{|c|}{\( P_{\text {CMAX,f,c, } 1} 3 \)} \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{2} \) or R} & \multicolumn{6}{|c|}{PaMAX,f,c,2 3} \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{(Optional)}
\end{table}

(Optional)

(Optional)

(Optional)

\begin{table}
\begin{tabular}{|l|l|l|}
\hline \( \mathrm{P}_{1} \) & \( \mathrm{V}_{1} \) & PH 1 (Type X, Serving Cell n) \\
\hline \( \mathrm{P}_{2} \) & \( \mathrm{V}_{2} \) & PH 2 (Type 1, Serving Cell n) \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{1} \) or R} & Pomax,f,c,1 m \\
\hline \multicolumn{2}{|c|}{\( \mathrm{MPE}_{2} \) or R} & \( P_{\text {CMAX, f, } \mathrm{c,} 2} \mathrm{~m} \) \\
\hline
\end{tabular}
\captionsetup{labelformat=empty}
\caption{(Optional)}
\end{table}

(Optional)

Figure 6.1.3.82-2: Enhanced Multiple Entry PHR for multiple TRP STx2P MAC CE with the highest ServCellIndex of Serving Cell with configured uplink is equal to or higher than 8
6.1.3.83 Aggregated SP Positioning SRS Activation/Deactivation MAC CE

The Aggregated SP Positioning SRS Activation/Deactivation MAC CE is identified by a MAC subheader with eLCID as specified in Table 6.2.1-1b. It has a variable size with following fields:
- Positioning SRS Aggregation ID: This field indicates one of the combinations of linked Positioning SRS Resource Sets corresponding to SRS-PosResourceSetAggBW-CombinationList or SRS-PosRRC-AggBW-

ETSI


--- Page 306  ---


3GPP TS 38.321 version 18.2.0 Release 18
305
ETSI TS 138321 V18.2.0 (2024-08)

InactiveConfigList specified in TS 38.331 [5]. Value 0 corresponds to the first entry within the list SRS-PosResourceSetAggBW-CombinationList or SRS-PosRRC-AggBW-InactiveConfigList, value 1 corresponds to the second entry within the list SRS-PosResourceSetAggBW-CombinationList or SRS-PosRRC-AggBWInactiveConfigList and so on;
- \( \mathrm{C}_{1}, \mathrm{C}_{2}, \mathrm{C}_{3} \) : These fields indicate the activation/deactivation status of each Positioning SRS Resource Set that is linked for SRS for positioning bandwidth aggregation configured in SRS-PosResourceSetAggBWCombinationList or SRS-PosRRC-AggBW-InactiveConfigList specified in TS 38.331 [5]. C1 corresponds to the first entry in SRS-PosResourceSetAggBW-CombinationList or SRS-PosRRC-AggBW-InactiveConfigList, \( \mathrm{C}_{2} \) corresponds to the second one and so on. The \( \mathrm{C}_{1} \) field is set to 1 to indicate that the Positioning SRS Resource Set corresponding to \( \mathrm{C}_{1} \) shall be activated. The \( \mathrm{C}_{1} \) field is set to 0 to indicate that the Positioning SRS Resource Set corresponding to \( \mathrm{C}_{1} \) shall be de-activated;
- S: This field indicates whether the fields Spatial Relation for Resource [ \( D_{1} \) are present. If the field is set to 1 , the fields Spatial Relation for Resource [D, are present; otherwise, they are absent;
- Spatial Relation for Resource [ \( D_{1} \) : The field Spatial Relation for Resource [ \( D_{1} \) is only present if MAC CE is used for activation, i.e. at least one of the \( \mathrm{C}_{1}, \mathrm{C}_{2} \), and \( \mathrm{C}_{3} \) is set to 1 . There can be as many as 16 entries of Spatial Relation for Resource \( \left[D_{1}\right. \) depending on the RRC configuration. There are 4 types of Spatial Relation for Resource \( \left[\mathrm{D}_{1}\right. \), which is indicated by the \( \mathrm{F}\left(\mathrm{F}_{0}\right. \) and \( \left.\mathrm{F}_{1}\right) \) field within, defined as in Figure 6.1.3.36-2 to 6.1.3.36-5 in clause 6.1.3.36. Spatial Relation for Resource [D1 corresponds to the spatial relation of the first set of aggregated SRS resources corresponding to the indicated Positioning SRS aggregation ID/ffs what is the first aggregated SRS resource];
- C: This field indicates whether the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) within the field Spatial Relation for Resource ID, are present, except for Spatial Relation Resource ID, with DL-PRS or SSB. If the combination of the linked SRS resource sets is configured by the field SRS-PosResourceSetAggBW-CombinationList and this field is set to 1 , the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) in the field Spatial Relation for Resource ID, are present, otherwise if this field is set to 0 , they are not present; if the combination of the linked SRS resource sets is configured by the field SRS-PosRRC-AggBW-InactiveConfigList, this field shall be set to 0 and the octets containing Resource Serving Cell ID field(s) and Resource BWP ID field(s) in the field Spatial Relation for Resource ID, are not present;
- R: Reserved bit, set to 0 .

Figure 6.1.3.83-1: Aggregated SP Positioning SRS Activation/Deactivation MAC CE

ETSI


--- Page 307  ---


3GPP TS 38.321 version 18.2.0 Release 18
306
ETSI TS 138321 V18.2.0 (2024-08)
6.1.4 MAC PDU (transparent MAC)

A MAC PDU consists solely of a MAC SDU whose size is aligned to a TB; as described in Figure 6.1.4-1. This MAC PDU is used for transmissions on PCH, BCH, DL-SCH including BCCH, and SL-BCH.

Figure 6.1.4-1: Example of MAC PDU (transparent MAC)
6.1.5 MAC PDU (Random Access Response)

A MAC PDU consists of one or more MAC subPDUs and optionally padding. Each MAC subPDU consists one of the following:
- a MAC subheader with Backoff Indicator only;
- a MAC subheader with RAPID only (i.e. acknowledgment for SI request);
- a MAC subheader with RAPID and MAC RAR.

A MAC subheader with Backoff Indicator consists of five header fields \( \mathrm{E} / \mathrm{T} / \mathrm{R} / \mathrm{R} / \mathrm{BI} \) as described in Figure 6.1.5-1. A MAC subPDU with Backoff Indicator only is placed at the beginning of the MAC PDU, if included. 'MAC subPDU(s) with RAPID only' and 'MAC subPDU(s) with RAPID and MAC RAR' can be placed anywhere between MAC subPDU with Backoff Indicator only (if any) and padding (if any).

A MAC subheader with RAPID consists of three header fields E/T/RAPID as described in Figure 6.1.5-2.
Padding is placed at the end of the MAC PDU if present. Presence and length of padding is implicit based on TB size, size of MAC subPDU(s).

Figure 6.1.5-1: E/T/R/R/BI MAC subheader

Figure 6.1.5-2: E/T/RAPID MAC subheader

Figure 6.1.5-3: Example of MAC PDU consisting of MAC RARs

ETSI


--- Page 308  ---


3GPP TS 38.321 version 18.2.0 Release 18
307
ETSI TS 138321 V18.2.0 (2024-08)
6.1.5a MAC PDU (MSGB)

A MAC PDU consists of one or more MAC subPDUs and optionally padding. Each MAC subPDU consists one of the following:
- a MAC subheader with Backoff Indicator only;
- a MAC subheader and fallbackRAR;
- a MAC subheader and successRAR;
- a MAC subheader and MAC SDU for CCCH, DCCH or DTCH;
- a MAC subheader and padding.

A MAC subheader with Backoff Indicator consists of five header fields \( \mathrm{E} / \mathrm{T} 1 / \mathrm{T} 2 / \mathrm{R} / \mathrm{BI} \) as described in Figure 6.1.5a-1. A MAC subPDU with Backoff Indicator only is placed at the beginning of the MAC PDU, if included.

A MAC subheader for fallbackRAR consists of three header fields E/T1/RAPID as described in Figure 6.1.5a-2. A MAC subheader for successRAR consists of eight header fields E/T1/T2/S/R/R/R/R as described in Figure 6.1.5a-3. A MAC subheader for MAC SDU consists of the four header fields R/F/LCID/L as described in Figure 6.1.2-1 and Figure 6.1.22.

At most one 'MAC subPDU for successRAR' indicating presence of 'MAC subPDU(s) for MAC SDU' is included in a MAC PDU_ MAC subPDU(s) for MAC SDU are placed immediately after the 'MAC subPDU for successRAR' indicating presence of 'MAC subPDU(s) for MAC SDU'.

If MAC PDU includes MAC subPDU(s) for MAC SDU, the last MAC subPDU for MAC SDU is placed before MAC subPDU with padding as depicted in Figure 6.1.5a-4. Otherwise, the last MAC subPDU in MAC PDU is placed before padding as depicted in Figure 6.1.5a-5. The MAC subPDU with padding includes R/R/LCID MAC subheader as described in Figure 6.1.2-3 and padding. The size of padding in the MAC subPDU with padding can be zero. The length of padding is implicit based on TB size, size of MAC subPDU(s).

Figure 6.1.5a-1: BI MAC subheader

Figure 6.1.5a-2: FallbackRAR MAC subheader

Figure 6.1.5a-3: SuccessRAR MAC subheader

ETSI


--- Page 309  ---


3GPP TS 38.321 version 18.2.0 Release 18
308
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.1.5a-4: Example of a MSGB MAC PDU with MAC SDU(s)

Figure 6.1.5a-5: Example of a MSGB MAC PDU without MAC SDU(s)
6.1.6 MAC PDU (SL-SCH)

A MAC PDU consists of one SL-SCH subheader and one or more MAC subPDUs. Each MAC subPDU consists of one of the following:
- A MAC subheader only (including padding);
- A MAC subheader and a MAC SDU;
- A MAC subheader and a MAC CE;
- AMAC subheader and padding.

The MAC SDUs are of variable sizes.
Each MAC subheader except SL-SCH subheader corresponds to either a MAC SDU, a MAC CE, or padding.
The SL-SCH subheader is of a fixed size and consists of the seven header fields V/R/R/R/R/SRC/DST.

Figure 6.1.6-1: SL-SCH MAC subheader

A MAC subheader except for fixed-sized MAC CE and padding consists of the four header fields R / F/LCID/L as depicted in Figure 6.1.2-1 (with 8-bit L field) and Figure 6.1.2-2 (with 16-bit L field). A MAC subheader for fixedsized MAC CE and padding consists of the two header fields R/LCID as depicted in Figure 6.1.2-3.

SL MAC subPDU(s) with MAC SDU(s) is placed after the SL-SCH subheader and before the MAC subPDU with a MAC CE and the MAC subPDU with padding in the MAC PDU as depicted in Figure 6.1.6-2. SL MAC subPDU with a

ETSI


--- Page 310  ---


3GPP TS 38.321 version 18.2.0 Release 18
309
ETSI TS 138321 V18.2.0 (2024-08)

MAC CE is placed after all the MAC subPDU(s) with MAC SDU and before the MAC subPDU with padding in the MAC PDU as depicted in Figure 6.1.6-2. The size of padding can be zero.

Figure 6.1.6-2: Example of an SL MAC PDU

A maximum of one MAC PDU can be transmitted per TB per MAC entity.
6.2 Formats and parameters
6.2.1 MAC subheader for DL-SCH and UL-SCH

The MAC subheader consists of the following fields:
- LCID: The Logical Channel ID field identifies the logical channel instance of the corresponding MAC SDU or the type of the corresponding MAC CE or padding as described in Tables 6.2.1-1 and 6.2.1-1c for the DL-SCH and Tables 6.2.1-2 and 6.2.1-2c for the UL-SCH. There is one LCID field per MAC subheader. The size of the LCID field is 6 bits. If the LCID field is set to 34 as in Table 6.2.1-1 or 6.2.1-2, one additional octet is present in the MAC subheader containing the eLCID field and follow the octet containing LCID field. If the LCID field is set to 33 as in Table 6.2.1-1 or 6.2.1-2, two additional octets are present in the MAC subheader containing the eLCID field and these two additional octets follow the octet containing LCID field;

NOTE 1: For MBS broadcast, a logical channel is identified based on G-RNTI and LCID if the same LCID is allocated for logical channels corresponding to different G-RNTIs.
- eLCID: The extended Logical Channel ID field identifies the logical channel instance of the corresponding MAC SDU or the type of the corresponding MAC CE as described in tables 6.2.1-1a, 6.2.1-1b, 6.2.1-2a and 6.2.1-2b for the DL-SCH and UL-SCH respectively. The size of the eLCID field is either 8 bits or 16 bits.

NOTE 2: The extended Logical Channel ID space using two-octet eLCID and the relevant MAC subheader format is used, only when configured, on the NR backhaul links between \( [\mathrm{AB} \) nodes or between \( [\mathrm{AB} \) node and IAB Donor, or for multicast MTCHs.
- L: The Length field indicates the length of the corresponding MAC SDU or variable-sized MAC CE in bytes. There is one \( L \) field per MAC subheader except for subheaders corresponding to fixed-sized MAC CEs, padding, and MAC SDUs containing UL CCCH. The size of the L field is indicated by the F field;
- F: The Format field indicates the size of the Length field. There is one F field per MAC subheader except for subheaders corresponding to fixed-sized MAC CEs, padding, and MAC SDUs containing UL CCCH. The size of the F field is 1 bit. The value 0 indicates 8 bits of the Length field. The value 1 indicates 16 bits of the Length field;
- LX: The LCID extension field indicates the use of extended LCID space. The size of the LX field is 1 bit. The LX field set to 1 indicates the use of Table 6.2.1-2c, otherwise R bit is present instead (i.e. set to 0);
- R: Reserved bit, set to 0 .

The MAC subheader is octet aligned.

ETSI


--- Page 311  ---


3GPP TS 38.321 version 18.2.0 Release 18
310
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.2.1-1: Values of LCID for DL-SCH}
\begin{tabular}{|l|l|}
\hline Codepoint/Index & LCID values \\
\hline 0 & CCCH \\
\hline 1-32 & Identity of the logical channel of DCCH, DTCH and multicast MTCH \\
\hline 33 & Extended logical channel ID field (two-octet eLCID field) \\
\hline 34 & Extended logical channel ID field (one-octet eLCID field) \\
\hline 35-46 & Reserved \\
\hline 47 & Recommended bit rate \\
\hline 48 & SP ZP CSI-RS Resource Set Activation/Deactivation \\
\hline 49 & PUCCH spatial relation Activation/Deactivation \\
\hline 50 & SP SRS Activation/Deactivation \\
\hline 51 & SP CSI reporting on PUCCH Activation/Deactivation \\
\hline 52 & TCI State Indication for UE-specific PDCCH \\
\hline 53 & TCI States Activation/Deactivation for UE-specific PDSCH \\
\hline 54 & Aperiodic CSI Trigger State Subselection \\
\hline 55 & SP CSI-RS/CSI-IM Resource Set Activation/Deactivation \\
\hline 56 & Duplication Activation/Deactivation \\
\hline 57 & SCell Activation/Deactivation (four octets) \\
\hline 58 & SCell Activation/Deactivation (one octet) \\
\hline 59 & Long DRX Command \\
\hline 60 & DRX Command \\
\hline 61 & Timing Advance Command \\
\hline 62 & UE Contention Resolution Identity \\
\hline 63 & Padding \\
\hline
\end{tabular}
\end{table}

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.2.1-1a: Values of two-octet eLCID for DL-SCH}
\begin{tabular}{|c|c|l|}
\hline Codepoint & Index & \multicolumn{1}{|c|}{ LCID values } \\
\hline 0 to \( \left(2^{16}-1\right) \) & 320 to \( \left(2^{16}+319\right) \) & Identity of the logical channel \\
\hline
\end{tabular}
\end{table}

ETSI


--- Page 312  ---


3GPP TS 38.321 version 18.2.0 Release 18
311
ETSI TS 138321 V18.2.0 (2024-08)

Table 6.2.1-1b: Values of one-octet eLCID for DL-SCH

ETSI


--- Page 313  ---


3GPP TS 38.321 version 18.2.0 Release 18
312
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|}
\hline Codepoint & Index & LCID values \\
\hline 0 to 215 & 64 to 279 & Reserved \\
\hline 216 & 280 & Aggregated SP Positioning SRS Activation/Deactivation MAC CE \\
\hline 217 & 281 & Enhanced SP CSI reporting on PUCCH Activation/Deactivation MAC CE \\
\hline 218 & 282 & Cross-RRH TCI State Indication for UEspecific PDCCH MAC CE \\
\hline 219 & 283 & LTM Cell Switch Command MAC CE \\
\hline 220 & 284 & Candidate Cell TCI States Activation/Deactivation MAC CE \\
\hline 221 & 285 & PSI-Based SDU Discard Activation/Deactivation MAC CE \\
\hline 222 & 286 & Enhanced Unified TCI state Activation/Deactivation MAC CE for Joint TCI States \\
\hline 223 & 287 & Enhanced Unified TCI state Activation/Deactivation MAC CE for Separate TCI States \\
\hline 224 & 288 & NCR Access Link Beam Indication MAC CE \\
\hline 225 & 289 & NCR Downlink Backhaul Link Beam Indication MAC CE \\
\hline 226 & 290 & NCR Uplink Backhaul Link Beam Indication MAC CE \\
\hline 227 & 291 & Serving Cell Set based SRS TCI State Indication MAC CE \\
\hline 228 & 292 & SP/AP SRS TCI State Indication MAC CE \\
\hline 229 & 293 & BFD-RS Indication MAC CE \\
\hline 230 & 294 & Differential Koffset \\
\hline 231 & 295 & Enhanced SCell Activation/Deactivation MAC CE with one octet \( \mathrm{C}_{\mathrm{i}} \) field \\
\hline 232 & 296 & Enhanced SCell Activation/Deactivation MAC CE with four octet \( \mathrm{C}_{\mathrm{i}} \) field \\
\hline 233 & 297 & Unified TCI States Activation/Deactivation MAC CE \\
\hline 234 & 298 & PUCCH Power Control Set Update for multiple TRP PUCCH repetition MAC CE \\
\hline 235 & 299 & PUCCH spatial relation Activation/Deactivation for multiple TRP PUCCH repetition MAC CE \\
\hline 236 & 300 & Enhanced TCI States Indication for UE-specific PDCCH \\
\hline 237 & 301 & Positioning Measurement Gap Activation/Deactivation Command \\
\hline 238 & 302 & PPW Activation/Deactivation Command \\
\hline 239 & 303 & DL Tx Power Adjustment \\
\hline 240 & 304 & Timing Case Indication \\
\hline 241 & 305 & Child IAB-DU Restricted Beam Indication \\
\hline 242 & 306 & Case-7 Timing advance offset \\
\hline 243 & 307 & Provided Guard Symbols for Case-6 timing \\
\hline 244 & 308 & Provided Guard Symbols for Case-7 timing \\
\hline 245 & 309 & Serving Cell Set based SRS Spatial Relation Indication \\
\hline 246 & 310 & PUSCH Pathloss Reference RS Update \\
\hline 247 & 311 & SRS Pathloss Reference RS Update \\
\hline 248 & 312 & Enhanced SP/AP SRS Spatial Relation Indication \\
\hline 249 & 313 & Enhanced PUCCH Spatial Relation Activation/Deactivation \\
\hline 250 & 314 & Enhanced TCI States Activation/Deactivation for UE-specific PDSCH \\
\hline 251 & 315 & Duplication RLC Activation/Deactivation \\
\hline 252 & 316 & Absolute Timing Advance Command \\
\hline 253 & 317 & SP Positioning SRS Activation/Deactivation \\
\hline 254 & 318 & Provided Guard Symbols \\
\hline 255 & 319 & Timing Delta \\
\hline
\end{tabular}

ETSI


--- Page 314  ---


3GPP TS 38.321 version 18.2.0 Release 18
313
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.2.1-1c: Values of LCID for MBS multicast MCCH and MBS broadcast on DL-SCH}
\begin{tabular}{|c|l|}
\hline Codepoint/Index & \multicolumn{1}{|c|}{ LCID values } \\
\hline 0 & Broadcast MCCH or multicast MCCH \\
\hline \( 1-32 \) & Identity of the logical channel of broadcast MTCH \\
\hline \( 33-63 \) & Reserved \\
\hline
\end{tabular}
\end{table}

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.2.1-2: Values of LCID for UL-SCH when the LX field is not present or is set to 0}
\begin{tabular}{|l|l|}
\hline Codepoint/Index & LCID values \\
\hline 0 & CCCH of size 64 bits, except for an (e)RedCap UE \\
\hline 1-32 & Identity of the logical channel of DCCH and DTCH \\
\hline 33 & Extended logical channel ID field (two-octet eLCID field) \\
\hline 34 & Extended logical channel ID field (one-octet eLCID field) \\
\hline 35 & CCCH of size 48 bits for a RedCap UE \\
\hline 36 & CCCH of size 64 bits for a RedCap UE \\
\hline 37-42 & Reserved \\
\hline 43 & Truncated Enhanced BFR (one octet \( \mathrm{C}_{\text {i }} \) ) \\
\hline 44 & Timing Advance Report \\
\hline 45 & Truncated Sidelink BSR \\
\hline 46 & Sidelink BSR \\
\hline 47 & Reserved \\
\hline 48 & LBT failure (four octets) \\
\hline 49 & LBT failure (one octet) \\
\hline 50 & BFR (one octet Ci) \\
\hline 51 & Truncated BFR (one octet \( \mathrm{C}_{\mathrm{i}} \) ) \\
\hline 52 & CCCH of size 48 bits, except for an (e)RedCap UE \\
\hline 53 & Recommended bit rate query \\
\hline 54 & Multiple Entry PHR (four octets Ci) \\
\hline 55 & Configured Grant Confirmation \\
\hline 56 & Multiple Entry PHR (one octet Ci) \\
\hline 57 & Single Entry PHR \\
\hline 58 & C-RNTI \\
\hline 59 & Short Truncated BSR \\
\hline 60 & Long Truncated BSR \\
\hline 61 & Short BSR \\
\hline 62 & Long BSR \\
\hline 63 & Padding \\
\hline \multicolumn{2}{|l|}{NOTE: \( \quad \mathrm{CCCH} \) of size 48 bits and CCCH of size 64 bits are referred to as CCCH and CCCH 1 , respectively, in TS 38.331 [5].} \\
\hline
\end{tabular}
\end{table}

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.2.1-2a: Values of two-octet eLCID for UL-SCH}
\begin{tabular}{|c|c|c|}
\hline Codepoint & Index & \multicolumn{1}{|c|}{ LCID values } \\
\hline 0 to \( \left(2^{16}-1\right) \) & 320 to \( \left(2^{16}+319\right) \) & Identity of the logical channel \\
\hline
\end{tabular}
\end{table}

ETSI


--- Page 315  ---


3GPP TS 38.321 version 18.2.0 Release 18
314
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.2.1-2b: Values of one-octet eLCID for UL-SCH}
\begin{tabular}{|l|l|l|}
\hline Codepoint & Index & LCID values \\
\hline 0 to 218 & 64 to 282 & Reserved \\
\hline 219 & 283 & Enhanced Multiple Entry PHR for multiple TRP STx2P (four octets Ci) \\
\hline 220 & 284 & Enhanced Multiple Entry PHR for multiple TRP STx2P (one octets Ci) \\
\hline 221 & 285 & Enhanced Single Entry PHR for multiple TRP STx2P \\
\hline 222 & 286 & SL LBT Failure \\
\hline 223 & 287 & Multiple Entry PHR with assumed PUSCH MAC CE (four octets Ci) \\
\hline 224 & 288 & Multiple Entry PHR with assumed PUSCH MAC CE (one octets Ci) \\
\hline 225 & 289 & Single Entry PHR with assumed PUSCH MAC CE \\
\hline 226 & 290 & SL-PRS Resource Request \\
\hline 227 & 291 & Refined Long BSR \\
\hline 228 & 292 & Delay Status Report \\
\hline 229 & 293 & Enhanced Multiple Entry PHR for multiple TRP (four octets Ci) \\
\hline 230 & 294 & Enhanced Multiple Entry PHR for multiple TRP (one octets Ci) \\
\hline 231 & 295 & Enhanced Single Entry PHR for multiple TRP \\
\hline 232 & 296 & Enhanced Multiple Entry PHR (four octets \( \mathrm{C}_{\mathrm{i}} \) ) \\
\hline 233 & 297 & Enhanced Multiple Entry PHR (one octets Ci) \\
\hline 234 & 298 & Enhanced Single Entry PHR \\
\hline 235 & 299 & Enhanced BFR (one octet \( \mathrm{C}_{\mathrm{i}} \) ) \\
\hline 236 & 300 & Enhanced BFR (four octet \( \mathrm{C}_{\mathrm{i}} \) ) \\
\hline 237 & 301 & Truncated Enhanced BFR (four octet Ci ) \\
\hline 238 & 302 & Positioning Measurement Gap Activation/Deactivation Request \\
\hline 239 & 303 & IAB-MT Recommended Beam Indication \\
\hline 240 & 304 & Desired IAB-MT PSD range \\
\hline 241 & 305 & Desired DL Tx Power Adjustment \\
\hline 242 & 306 & Case-6 Timing Request \\
\hline 243 & 307 & Desired Guard Symbols for Case 6 timing \\
\hline 244 & 308 & Desired Guard Symbols for Case 7 timing \\
\hline 245 & 309 & Extended Short Truncated BSR \\
\hline 246 & 310 & Extended Long Truncated BSR \\
\hline 247 & 311 & Extended Short BSR \\
\hline 248 & 312 & Extended Long BSR \\
\hline 249 & 313 & Extended Pre-emptive BSR \\
\hline 250 & 314 & BFR (four octets Ci) \\
\hline 251 & 315 & Truncated BFR (four octets Ci ) \\
\hline 252 & 316 & Multiple Entry Configured Grant Confirmation \\
\hline 253 & 317 & Sidelink Configured Grant Confirmation \\
\hline 254 & 318 & Desired Guard Symbols \\
\hline 255 & 319 & Pre-emptive BSR \\
\hline
\end{tabular}
\end{table}

ETSI


--- Page 316  ---


3GPP TS 38.321 version 18.2.0 Release 18
315
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.2.1-2c: Values of LCID for UL-SCH when the LX field is set to 1}
\begin{tabular}{|l|l|l|}
\hline Codepoint & Index & LCID values \\
\hline 0 & ( \( 2^{16}+320 \) ) & CCCH of size 48 bits for an eRedCap UE \\
\hline 1 & ( \( 2^{16}+321 \) ) & CCCH of size 64 bits for an eRedCap UE \\
\hline 2 & ( \( 2^{16}+322 \) ) & CCCH of size 48 bits for PUCCH repetition of Msg4 HARQ-ACK, except for an (e)RedCap UE \\
\hline 3 & ( \( 2^{16}+323 \) ) & CCCH of size 64 bits for PUCCH repetition of Msg4 HARQ-ACK, except for an (e)RedCap UE \\
\hline 4 & ( \( 2^{16}+324 \) ) & CCCH of size 48 bits for PUCCH repetition of Msg4 HARQ-ACK of a RedCap UE \\
\hline 5 & ( \( 2^{16}+325 \) ) & CCCH of size 64 bits for PUCCH repetition of Msg4 HARQ-ACK of a RedCap UE \\
\hline 6 & ( \( 2^{16}+326 \) ) & CCCH of size 48 bits for PUCCH repetition of Msg4 HARQ-ACK of an eRedCap UE \\
\hline 7 & ( \( 2^{16}+327 \) ) & CCCH of size 64 bits for PUCCH repetition of Msg4 HARQ-ACK of an eRedCap UE \\
\hline 8 to 63 & ( \( 2^{16}+328 \) ) to ( \( 2^{16}+383 \) ) & Reserved \\
\hline \multicolumn{3}{|c|}{\begin{tabular}{l}
NOTE 1: The MAC entity may use the code point corresponding to a given feature or feature combination in Table 6.2.1-2c only if network indicates support for the corresponding feature or feature combination. \\
NOTE 2: CCCH of size 48 bits and CCCH of size 64 bits are referred to as CCCH and CCCH1, respectively, in TS 38.331 [5]. \\
NOTE 3: For UE capable of PUCCH repetition of Msg4 HARQ-ACK, the MAC entity uses the code points corresponding to PUCCH repetition of Msg4 HARQ-ACK if numberOfMsg4HARQ-ACK-Repetitions is configured, and if rsrp-ThresholdMsg4HARQ-ACK is configured, the RSRP of the downlink pathloss reference is less than rsrp-ThresholdMsg4HARQ-ACK.
\end{tabular}} \\
\hline
\end{tabular}
\end{table}
6.2.2 MAC subheader for Random Access Response

The MAC subheader consists of the following fields:
- E: The Extension field is a flag indicating if the MAC subPDU including this MAC subheader is the last MAC subPDU or not in the MAC PDU. The E field is set to 1 to indicate at least another MAC subPDU follows. The E field is set to 0 to indicate that the MAC subPDU including this MAC subheader is the last MAC subPDU in the MAC PDU;
- T: The Type field is a flag indicating whether the MAC subheader contains a Random Access Preamble ID or a Backoff Indicator. The \( T \) field is set to 0 to indicate the presence of a Backoff Indicator field in the subheader (BI). The T field is set to 1 to indicate the presence of a Random Access Preamble ID field in the subheader (RAPID);
- R: Reserved bit, set to 0 ;
- BI: The Backoff Indicator field identifies the overload condition in the cell. The size of the BI field is 4 bits;
- RAPID: The Random Access Preamble IDentifier field identifies the transmitted Random Access Preamble (see clause 5.1.3). The size of the RAPID field is 6 bits. If the RAPID in the MAC subheader of a MAC subPDU corresponds to one of the Random Access Preambles configured for SI request, MAC RAR is not included in the MAC subPDU.

The MAC subheader is octet aligned.
6.2.2a MAC subheader for MSGB

The MAC subheader consists of the following fields:
- E: The Extension field is a flag indicating if the MAC subPDU including this MAC subheader is the last MAC subPDU (other than MAC subPDU for MAC SDU) or not in the MAC PDU. The E field is set to 1 to indicate at least another MAC subPDU (other than MAC subPDU for MAC SDU) follows. The E field is set to 0 to indicate that the MAC subPDU including this MAC subheader is the last MAC subPDU (other than MAC subPDU for MAC SDU) in the MAC PDU;

ETSI


--- Page 317  ---


3GPP TS 38.321 version 18.2.0 Release 18
316
ETSI TS 138321 V18.2.0 (2024-08)
- T1: The T1 field is a flag indicating whether the MAC subheader contains a Random Access Preamble ID or T2. The T1 field is set to 1 to indicate the presence of a Random Access Preamble ID field in the subheader (RAPID). The T1 field is set to 0 to indicate the presence of T2 field in the subheader;
- T2: The T2 field is a flag indicating whether the MAC subheader contains a Backoff Indicator (BI) or a MAC SDU indicator (S). The T2 field is set to 0 to indicate the presence of a Backoff Indicator field in the subheader. The T2 field is set to 1 to indicate the presence of the S field in the subheader;
- S: This field indicates whether 'MAC subPDU(s) for MAC SDU' follow the MAC subPDU including this MAC subheader or not; The S field is set to 1 to indicate presence of 'MAC subPDU(s) for MAC SDU'. The S field is set to 0 to indicate absence of 'MAC subPDU(s) for MAC SDU';
- R: Reserved bit, set to 0 ;
- BI: The Backoff Indicator field identifies the overload condition in the cell. The size of the BI field is 4 bits;
- RAPID: The Random Access Preamble IDentifier field identifies the transmitted Random Access Preamble (see clause 5.1.3). The size of the RAPID field is 6 bits.

The MAC subheader is octet aligned.
6.2.3 MAC payload for Random Access Response

The MAC RAR is of fixed size as depicted in Figure 6.2.3-1, and consists of the following fields:
- R: Reserved bit, set to 0 ;
- TI: If two TAGs are configured for the Serving Cell in which the Random Access procedure is being performed, this field indicates one of the two TAGs to which the Timing Advance Command is applied. If tag2-flag is set to true by upper layers, the field set to 0 indicates the tag2-Id and the field set to 1 indicates the tag-Id of the Serving Cell, otherwise the field set to 0 indicates the tag-Id and the field set to 1 indicates the tag2-Id of the Serving Cell. If the Serving Cell in which the Random Access procedure is being performed is not configured with two TAGs, the \( R \) bit is present instead;
- Timing Advance Command: The Timing Advance Command field indicates the index value \( T_{A} \) used to control the amount of timing adjustment that the MAC entity has to apply in TS 38.213 [6]. The size of the Timing Advance Command field is 12 bits;
- UL Grant: The Uplink Grant field indicates the resources to be used on the uplink in TS 38.213 [6]. The size of the UL Grant field is 27 bits;
- Temporary C-RNTI: The Temporary C-RNTI field indicates the temporary identity that is used by the MAC entity during Random Access. The size of the Temporary C-RNTI field is 16 bits.

The MAC RAR is octet aligned.

ETSI


--- Page 318  ---


3GPP TS 38.321 version 18.2.0 Release 18
317
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.2.3-1: MAC RAR
6.2.3a MAC payload for MSGB

The fallbackRAR is of fixed size as depicted in Figure 6.2.3a-1, and consists of the following fields:
- R: Reserved bit, set to 0 ;
- TI: If two TAGs are configured for the SpCell, this field indicates one of the two TAGs to which the Timing Advance Command is applied. If tag2-flag is set to true by upper layers, the field set to 0 indicates the tag2-Id and the field set to 1 indicates the tag-Id of the SpCell, otherwise the field set to 0 indicates the tag-Id and the field set to 1 indicates the tag2-Id of the SpCell. If the SpCell is not configured with two TAGs, the R bit is present instead;
- Timing Advance Command: The Timing Advance Command field indicates the index value \( T_{A} \) used to control the amount of timing adjustment that the MAC entity has to apply in TS 38.213 [6]. The size of the Timing Advance Command field is 12 bits;
- UL Grant: The Uplink Grant field indicates the resources to be used on the uplink in TS 38.213 [6]. The size of the UL Grant field is 27 bits;
- Temporary C-RNTI: The Temporary C-RNTI field indicates the temporary identity that is used by the MAC entity during Random Access. The size of the Temporary C-RNTI field is 16 bits.

The fallbackRAR is octet aligned.

ETSI


--- Page 319  ---


3GPP TS 38.321 version 18.2.0 Release 18
318
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.2.3a-1: fallbackRAR

The successRAR is of fixed size as depicted in Figure 6.2.3a-2, and consists of the following fields:
- UE Contention Resolution Identity: This field contains the UL CCCH SDU. If the UL CCCH SDU is longer than 48 bits, this field contains the first 48 bits of the UL CCCH SDU.
- R: Reserved bit, set to 0 ;
- ChannelAccess-CPext: The channel access type and CP extension for the PUCCH resource containing the HARQ feedback for MSGB in shared spectrum channel access as specified in TS 38.213 [6]. The field is only present when the MSGB HARQ feedback is to be transmitted with shared spectrum channel access as specified in TS 37.213 [18]. Otherwise, the field is not present and R bits are present instead. The size of the ChannelAccess-CPext field is 2 bits;
- TPC: The TPC command for the PUCCH resource containing HARQ feedback for MSGB, as specified in TS 38.213 [6]. The size of the TPC field is 2 bits;
- HARQ Feedback Timing Indicator: The PDSCH-to-HARQ feedback timing indicator field for MSGB HARQ feedback as specified in TS 38.213 [6]. The size of the HARQ Feedback Timing Indicator field is 3 bits;
- PUCCH Resource Indicator: The PUCCH resource indicator for HARQ feedback for MSGB, as specified in TS 38.213[6]. The size of the PUCCH resource Indicator field is 4 bits;
- Timing Advance Command: The Timing Advance Command field indicates the index value \( T_{A} \) used to control the amount of timing adjustment that the MAC entity has to apply in TS 38.213 [6]. The size of the Timing Advance Command field is 12 bits;
- C-RNTI: The C-RNTI field indicates the identity that is used by the MAC entity upon completion of Random Access. The size of the C-RNTI field is 16 bits.

The successRAR is octet aligned.

ETSI


--- Page 320  ---


3GPP TS 38.321 version 18.2.0 Release 18
319
ETSI TS 138321 V18.2.0 (2024-08)

Figure 6.2.3a-2: successRAR
6.2.4 MAC subheader for SL-SCH

The MAC subheader consists of the following fields:
- V: The MAC PDU format version number field indicates which version of the SL-SCH subheader is used. In this version of the specification, the V field is set to 0 . The size of the V field is 4 bits;
- SRC: The SRC field carries the 16 most significant bits of the Source Layer-2 ID set to the identifier provided by upper layers as defined in TS 23.287 [19] or TS 23.304 [26]. The length of the field is 16 bits;
- DST: The DST field carries the 8 most significant bits of the Destination Layer-2 [D set to the identifier provided by upper layers as defined in TS 23.287 [19] or TS 23.304 [26]. The length of the field is 8 bits;
- LCID: The Logical Channel ID field identifies the logical channel instance of the corresponding MAC SDU or the type of the corresponding MAC CE within the scope of one Source Layer-2 ID and Destination Layer-2 ID pair or padding as described in Tables 6.2.4-1 for SL-SCH. There is one LCID field per MAC subheader except for SL-SCH subheader. The values of LCID from 21 to 36 identify the logical channels used to send duplicated RLC SDUs from logical channels of which the values of LCID from 4 to 19 respectively in sequential order. The size of the LCID field is 6 bits;
- L: The Length field indicates the length of the corresponding MAC SDU or variable-sized MAC CE in bytes. There is one L field per MAC subheader except for SL-SCH subheader and subheaders corresponding to the fixed-sized MAC CE or padding. The size of the \( L \) field is indicated by the \( F \) field;
- F: The Format field indicates the size of the Length field. There is one F field per MAC subheader except for SL-SCH subheader and subheaders corresponding to the fixed-sized MAC CE or padding. The size of the F field is 1 bit. The value 0 indicates 8 bits of the Length field. The value 1 indicates 16 bits of the Length field;
- R: Reserved bit, set to 0 .

The MAC subheader is octet aligned.

ETSI


--- Page 321  ---


3GPP TS 38.321 version 18.2.0 Release 18
320
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 6.2.4-1: Values of LCID for SL-SCH}
\begin{tabular}{|l|l|}
\hline Index & LCID values \\
\hline 0 & SCCH carrying PC5-S messages that are not protected \\
\hline 1 & SCCH carrying PC5-S messages "Direct Security Mode Command" and "Direct Security Mode Complete","ProSe direct link security mode command" and "ProSe direct link security mode complete" \\
\hline 2 & SCCH carrying other PC5-S messages that are protected \\
\hline 3 & SCCH carrying PC5-RRC messages \\
\hline 4-19 & Identity of the logical channel \\
\hline 20 & SCCH carrying PC5-S messages ("Direct Security Mode Command" and "Direct Security Mode Complete") which is used for duplication \\
\hline 21 & SCCH carrying other PC5-S messages that are protected which is used for duplication \\
\hline 22 & SCCH carrying PC5-RRC messages which is used for duplication \\
\hline 23-38 & Identity of the logical channel which is used for duplication \\
\hline 39-52 & Reserved \\
\hline 53 & Enhanced Sidelink Inter-UE Coordination Request \\
\hline 54 & Enhanced Sidelink Inter-UE Coordination Information \\
\hline 55 & SCCH carrying end-to-end SL-SRB0/1/2/3 messages delivered via SL-U2U-RLC as specified in TS 38.331 [5] \\
\hline 56 & SCCH carrying RRC messages delivered via SL-RLC0 as specified in TS 38.331 [5] \\
\hline 57 & SCCH carrying RRC message delivered via SL-RLC1 as specified in TS 38.331 [5] \\
\hline 58 & SCCH for Sidelink Discovery Messages \\
\hline 59 & Sidelink Inter-UE Coordination Request \\
\hline 60 & Sidelink Inter-UE Coordination Information \\
\hline 61 & Sidelink DRX Command \\
\hline 62 & Sidelink CSI Reporting \\
\hline 63 & Padding \\
\hline
\end{tabular}
\end{table}

7 Variables and constants
7.1 RNTI values

RNTI values are presented in Table 7.1-1.

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 7.1-1: RNTI values.}
\begin{tabular}{|l|l|}
\hline Value (hexa-decimal) & RNTI \\
\hline 0000 & N/A \\
\hline 0001-FFF2 & RA-RNTI, MSGB-RNTI, Temporary C-RNTI, C-RNTI, CI-RNTI, MCS-C-RNTI, CS-RNTI, TPC-PUCCH-RNTI, TPC-PUSCH-RNTI, TPC-SRS-RNTI, INT-RNTI, SFI-RNTI, SP-CSI-RNTI, PS-RNTI, SL-RNTI, SL-CS-RNTI, SL-PRS-RNTI, SL-PRS-CS-RNTI, SL Semi-Persistent Scheduling V-RNTI, AI-RNTI, G-RNTI, G-CSRNTI, CG-SDT-CS-RNTI, NCR-RNTI, and cellDTRX-RNTI \\
\hline FFF3-FFFA & Reserved \\
\hline FFFB & Multicast MCCH-RNTI \\
\hline FFFC & PEI-RNTI \\
\hline FFFD & MCCH-RNTI \\
\hline FFFE & P-RNTI \\
\hline FFFF & SI-RNTI \\
\hline
\end{tabular}
\end{table}

ETSI


--- Page 322  ---


3GPP TS 38.321 version 18.2.0 Release 18
321
ETSI TS 138321 V18.2.0 (2024-08)

Table 7.1-2: RNTI usage.

ETSI


--- Page 323  ---


3GPP TS 38.321 version 18.2.0 Release 18
322
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|}
\hline RNTI & Usage & Transport Channel & Logical Channel \\
\hline P-RNTI & Paging and System Information change notification & PCH & PCCH \\
\hline SI-RNTI & Broadcast of System Information & DL-SCH & BCCH \\
\hline RA-RNTI & Random Access Response & DL-SCH & N/A \\
\hline MSGB-RNTI & Random Access Response for 2-step RA type & DL-SCH & CCCH, DCCH, DTCH \\
\hline Temporary C-RNTI & Contention Resolution (when no valid C-RNTI is available) & DL-SCH & CCCH, DCCH, DTCH \\
\hline Temporary C-RNTI & Msg3 transmission & UL-SCH & CCCH, DCCH, DTCH \\
\hline C-RNTI, MCS-CRNTI & Dynamically scheduled unicast transmission & UL-SCH & DCCH, DTCH \\
\hline C-RNTI & Dynamically scheduled unicast transmission & DL-SCH & CCCH, DCCH, DTCH \\
\hline NCR-RNTI & Transmission of Side Control Information for NCR operation & N/A & N/A \\
\hline MCS-C-RNTI & Dynamically scheduled unicast transmission & DL-SCH & DCCH, DTCH \\
\hline C-RNTI & Triggering of PDCCH ordered random access & N/A & N/A \\
\hline C-RNTI & Dynamically scheduled PTP retransmission for initial PTM transmission for multicast MBS. & DL-SCH & MTCH \\
\hline CG-SDT-CS-RNTI & Dynamically scheduled unicast transmission (retransmission) & UL-SCH & CCCH, DCCH, DTCH \\
\hline CS-RNTI & Configured scheduled unicast transmission (activation, reactivation and retransmission) & DL-SCH, UL-SCH & DCCH, DTCH \\
\hline CS-RNTI & Configured scheduled unicast transmission (deactivation) & N/A & N/A \\
\hline CS-RNTI & Configured scheduled unicast transmission (PTP retransmission for initial PTM transmission) & DL-SCH & MTCH \\
\hline CS-RNTI & Configured scheduled unicast transmission (MBS SPS deactivation) & N/A & N/A \\
\hline G-CS-RNTI & Configured scheduled multicast transmission (activation, reactivation and retransmission) & DL-SCH & MTCH \\
\hline G-CS-RNTI & Configured scheduled multicast transmission (deactivation) & N/A & N/A \\
\hline TPC-PUCCH-RNTI & PUCCH power control & N/A & N/A \\
\hline TPC-PUSCH-RNTI & PUSCH power control & N/A & N/A \\
\hline TPC-SRS-RNTI & SRS trigger and power control & N/A & N/A \\
\hline INT-RNTI & Indication pre-emption in DL & N/A & N/A \\
\hline SFI-RNTI & Slot Format Indication on the given cell & N/A & N/A \\
\hline SP-CSI-RNTI & Activation of Semi-persistent CSI reporting on PUSCH & N/A & N/A \\
\hline CI-RNTI & Cancellation indication in UL & N/A & N/A \\
\hline PS-RNTI & DCP to indicate whether to start drxonDurationTimer for associated DRX cycle & N/A & N/A \\
\hline SL-RNTI & Dynamically scheduled sidelink transmission & SL-SCH & SCCH, STCH \\
\hline SL-CS-RNTI & Configured scheduled sidelink transmission (activation, reactivation and retransmission) & SL-SCH & SCCH, STCH \\
\hline SL-CS-RNTI & Configured scheduled sidelink transmission (deactivation) & N/A & N/A \\
\hline SL-PRS-RNTI & Dynamically scheduled sidelink PRS transmission & N/A & N/A \\
\hline SL-PRS-CS-RNTI & Configured scheduled sidelink PRS transmission (activation and reactivation) & N/A & N/A \\
\hline SL-PRS-CS-RNTI & Configured scheduled sidelink PRS transmission (deactivation) & N/A & N/A \\
\hline SL Semi-Persistent Scheduling V-RNTI (NOTE 2) & Semi-Persistently scheduled sidelink transmission for V2X sidelink communication (activation, reactivation and retransmission) & SL-SCH & STCH \\
\hline SL Semi-Persistent Scheduling V-RNTI (NOTE 2) & Semi-Persistently scheduled sidelink transmission for V2X sidelink communication (deactivation) & N/A & N/A \\
\hline AI-RNTI & Availability indication on the given cell & N/A & N/A \\
\hline G-RNTI & Dynamically scheduled MBS PTM transmission & DL-SCH & MTCH \\
\hline MCCH-RNTI & Dynamically scheduled MCCH signalling and MCCH change notification for MBS broadcast & DL-SCH & MCCH \\
\hline
\end{tabular}

ETSI


--- Page 324  ---


3GPP TS 38.321 version 18.2.0 Release 18
323
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|}
\hline PEI-RNTI & Paging Early Indication & N/A & N/A \\
\hline Multicast MCCHRNTI & Dynamically scheduled MCCH signalling and MCCH change notification for MBS multicast in RRC_INACTIVE & DL-SCH & MCCH \\
\hline cellDTRX-RNTI & Network energy saving indication & N/A & N/A \\
\hline \multicolumn{4}{|l|}{\begin{tabular}{l}
NOTE 1: The usage of MCS-C-RNTI is equivalent to that of C-RNTI in MAC procedures (except for the C-RNTI MAC CE). \\
NOTE 2: The MAC entity uses SL Semi-Persistent Scheduling V-RNTI to control semi-persistently scheduled sidelink transmission on SL-SCH for V2X sidelink communication as specified in clause 5.14.1.1 of TS 36.321 [22]. \\
NOTE 3: The usage of CG-SDT-CS-RNTI is equivalent to that of CS-RNTI when there is an CG-SDT procedure ongoing.
\end{tabular}} \\
\hline
\end{tabular}
7.2 Backoff Parameter values

Backoff Parameter values are presented in Table 7.2-1.

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 7.2-1: Backoff Parameter values.}
\begin{tabular}{|l|l|}
\hline Index & Backoff Parameter value (ms) \\
\hline 0 & 5 \\
\hline 1 & 10 \\
\hline 2 & 20 \\
\hline 3 & 30 \\
\hline 4 & 40 \\
\hline 5 & 60 \\
\hline 6 & 80 \\
\hline 7 & 120 \\
\hline 8 & 160 \\
\hline 9 & 240 \\
\hline 10 & 320 \\
\hline 11 & 480 \\
\hline 12 & 960 \\
\hline 13 & 1920 \\
\hline 14 & Reserved \\
\hline 15 & Reserved \\
\hline
\end{tabular}
\end{table}
7.3 DELTA_PREAMBLE values

The DELTA_PREAMBLE preamble format based power offset values are presented in Tables 7.3-1 and 7.3-2.

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 7.3-1: DELTA_PREAMBLE values for long preamble formats.}
\begin{tabular}{|c|c|}
\hline \begin{tabular}{c} 
Preamble \\
Format
\end{tabular} & \begin{tabular}{c} 
DELTA_PREAMBLE \\
values
\end{tabular} \\
\hline 0 & 0 dB \\
\hline 1 & -3 dB \\
\hline 2 & -6 dB \\
\hline 3 & 0 dB \\
\hline
\end{tabular}
\end{table}

ETSI


--- Page 325  ---


3GPP TS 38.321 version 18.2.0 Release 18
324
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 7.3-2: DELTA_PREAMBLE values for short preamble formats.}
\begin{tabular}{|l|l|}
\hline Preamble Format & DELTA_PREAMBLE values (dB) \\
\hline A1 & \( 8+3 \times \mu \) \\
\hline A2 & \( 5+3 \times \mu \) \\
\hline A3 & \( 3+3 \times \mu \) \\
\hline B1 & \( 8+3 \times \mu \) \\
\hline B2 & \( 5+3 \times \mu \) \\
\hline B3 & \( 3+3 \times \mu \) \\
\hline B4 & \( 3 \times \mu \) \\
\hline C0 & \( 11+3 \times \mu \) \\
\hline C2 & \( 5+3 \times \mu \) \\
\hline
\end{tabular}
\end{table}
where \( \mu \) is the sub-carrier spacing configuration determined by msgl-SubcarrierSpacing or msgA-SubcarrierSpacing, as specified in TS 38.331 [5] and Table 4.2-1 in TS 38.211 [8], and the preamble formats are given by prach-
ConfigurationIndex or msgA-PRACH-ConfigurationIndex, as specified in TS 38.331 [5] and Tables 6.3.3.2-2 to 6.3.3.24 in TS 38.211 [8].
7.4 PRACH Mask Index values

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 7.4-1: PRACH Mask Index values}
\begin{tabular}{|l|l|}
\hline PRACH Mask Index/ msgA-SSB-SharedROMaskindex/ ssb-SharedROMaskindex & Allowed PRACH occasion(s) of SSB \\
\hline 0 & All \\
\hline 1 & PRACH occasion index 1 \\
\hline 2 & PRACH occasion index 2 \\
\hline 3 & PRACH occasion index 3 \\
\hline 4 & PRACH occasion index 4 \\
\hline 5 & PRACH occasion index 5 \\
\hline 6 & PRACH occasion index 6 \\
\hline 7 & PRACH occasion index 7 \\
\hline 8 & PRACH occasion index 8 \\
\hline 9 & Every even PRACH occasion \\
\hline 10 & Every odd PRACH occasion \\
\hline 11 & Reserved \\
\hline 12 & Reserved \\
\hline 13 & Reserved \\
\hline 14 & Reserved \\
\hline 15 & Reserved \\
\hline
\end{tabular}
\end{table}

ETSI


--- Page 326  ---


3GPP TS 38.321 version 18.2.0 Release 18
325
ETSI TS 138321 V18.2.0 (2024-08)

Annex A (informative):
Change history

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline \multicolumn{8}{|c|}{Change history} \\
\hline Date & Meetin g & TDoc & CR & Rev & Cat & Subject/Comment & New version \\
\hline 2017-04 & RAN2\# 97bis & R2-1703006 & - & - & - & Skeleton of NR MAC specification & 0.0.1 \\
\hline 2017-04 & RAN2\# 97bis & R2-1703915 & - & - & - & Editorial updates & 0.0.2 \\
\hline 2017-05 & RAN2\# 98 & R2-1704475 & - & - & - & To capture agreements from RAN2\#97bis & 0.0.3 \\
\hline 2017-06 & RAN2 NR AH\#2 & R2-1706608 & - & - & - & To capture agreements from RAN2\#98 & 0.0.4 \\
\hline 2017-06 & RAN2 NR AH\#2 & R2-1707471 & - & - & - & Endorsement of v0.0.4 (including minor updates) & 0.1.0 \\
\hline 2017-08 & RAN2\# 99 & R2-1707510 & - & - & - & To capture agreements from RAN2 NR AH\#2 & 0.2.0 \\
\hline 2017-08 & RAN2\# 99 & R2-1709946 & - & - & - & To capture agreements from RAN2\#99 & 0.3 .0 \\
\hline 2017-09 & RAN\#7 7 & RP-171733 & - & - & - & To be presented to RAN for information & 1.00 \\
\hline 2017-11 & RAN2\# 100 & R2-1712698 & - & - & - & To capture agreements from RAN2\#99bis & 1.1.0 \\
\hline 2017-12 & RAN2\# 100 & R2-1714253 & - & - & - & To capture agreements from RAN2\#100 & 1.2.0 \\
\hline 2017-12 & RP-78 & RP-172419 & - & - & - & To be presented to RAN for approval & 2.0.0 \\
\hline 2017-12 & RP-78 & & & & & Upgraded to Rel-15 & 15.0.0 \\
\hline 2018-03 & RP-79 & RP-180440 & 0039 & 1 & F & General corrections on TS 38.321 & 15.1.0 \\
\hline 2018-03 & RP-79 & RP-180440 & 0041 & - & B & Introduction of MAC CEs for NR MIMO & 15.1.0 \\
\hline 2018-06 & RP-80 & RP-181216 & 0057 & 5 & F & Miscellaneous corrections & 15.2.0 \\
\hline & RP-80 & RP-181216 & 0103 & 2 & F & Addition of the beamFailureRecoveryTimer & 15.2.0 \\
\hline & RP-80 & RP-181214 & 0115 & - & F & Correction to SR triggering to accommodate the configured grant & 15.2.0 \\
\hline & RP-80 & RP-181215 & 0145 & 1 & F & Corrections on the timers in MAC & 15.2.0 \\
\hline & RP-80 & RP-181215 & 0148 & 1 & F & Alternative 1 for Cross Carrier Indication for Semi-Persistent SRS MAC CE & 15.2.0 \\
\hline & RP-80 & RP-181215 & 0153 & 2 & F & Flush HARQ buffer upon skipping a UL transmission & 15.2.0 \\
\hline & RP-80 & RP-181215 & 0166 & 1 & F & Addition of Prioritized Random Access & 15.2.0 \\
\hline & RP-80 & RP-181216 & 0185 & - & F & Introduction of PDCP duplication & 15.2.0 \\
\hline & RP-80 & RP-181216 & 0186 & - & B & MAC CE adaptation for NR for TS 38.321 & 15.2.0 \\
\hline 2018-09 & RP-81 & RP-181941 & 0058 & 5 & F & Clarification on starting of dix-HARQ-RTT-TimerDL & 15.3 .0 \\
\hline & RP-81 & RP-181939 & 0094 & 3 & F & Correction of Configured Grant formula & 15.3 .0 \\
\hline & RP-81 & RP-181940 & 0100 & 4 & F & Introduction of DRX ambiguous period & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0139 & 2 & F & Clarification on timing requirement of SCell deactivation timer & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0141 & 2 & F & Correction on PUSCH resource handling for Semi-Persistent CSI reporting & 15.3 .0 \\
\hline & RP-81 & RP-181940 & 0184 & 3 & F & CR to 38.321 on the allocation of preambles for group B & 15.3 .0 \\
\hline & RP-81 & RP-181940 & 0189 & 3 & F & PRACH Preamble Selection for Msg1 based SI Request & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0190 & 1 & F & PRACH Resource Selection for RA Initiated by PDCCH Order & 15.3 .0 \\
\hline & RP-81 & RP-181942 & 0193 & 4 & F & Miscellaneous corrections & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0200 & 1 & F & Correction on BWP inactivity timer configuration & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0203 & 2 & F & Correction on Ci bitmap length determination in the Activation/Deactivation MAC CE & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0206 & 2 & F & Addition of NOTE to clarify meaning of available UL-SCH resource & 15.3 .0 \\
\hline & RP-81 & RP-181939 & 0214 & 2 & F & Correction to RO selection procedure & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0215 & 2 & F & CR on Semi-Persistent CSI Reporting and SRS for DRX & 15.3.0 \\
\hline & RP-81 & RP-181940 & 0234 & 2 & F & Correction to CCCH LCID & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0242 & 2 & F & Correction to SP CSI reporting on PUCCH Activation and Deactivation MAC CE & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0243 & 1 & F & Correction to TCI State Indication for UE-specific PDCCH MAC CE & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0245 & 1 & F & CR on MAC RAR & 15.3 .0 \\
\hline & RP-81 & RP-181939 & 0252 & 1 & F & Correction for LCP restriction for duplication and non-duplication & 15.3.0 \\
\hline & RP-81 & RP-181939 & 0254 & 2 & F & CR on BWP Inactivity timer & 15.3 .0 \\
\hline & RP-81 & RP-181939 & 0255 & 2 & F & Correction to BWP operations & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0259 & 2 & F & CR on BSR transmisison with insufficient grant & 15.3 .0 \\
\hline & RP-81 & RP-181940 & 0262 & 2 & F & Corrections on Configured Grants and SPS & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0272 & 2 & F & CR on RA parameter description in TS 38.321 & 15.3 .0 \\
\hline & RP-81 & RP-181940 & 0275 & 1 & F & Correction to acknowledgement for SPS deactivation & 15.3.0 \\
\hline
\end{tabular}

ETSI


--- Page 327  ---


3GPP TS 38.321 version 18.2.0 Release 18
326
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & RP-81 & RP-181940 & 0276 & 1 & F & Correction to handling of retransmission with a different TBS in DL HARQ & 15.3.0 \\
\hline & RP-81 & RP-181980 & 0279 & 2 & F & Correction to BWP handling upon SCell deactivation & 15.3.0 \\
\hline & RP-81 & RP-181940 & 0280 & 2 & F & Correction to MAC handling during different measurement gaps & 15.3 .0 \\
\hline & RP-81 & RP-181939 & 0283 & 1 & F & PDCCH for BFR termination & 15.3 .0 \\
\hline & RP-81 & RP-181939 & 0285 & 1 & F & CSI reporting in DRX & 15.3 .0 \\
\hline & RP-81 & RP-181940 & 0290 & 1 & F & Introduction of MCS-C-RNTI & 15.3 .0 \\
\hline & RP-81 & RP-181941 & 0297 & 1 & F & Clarification on the duration of timers in MAC & 15.3 .0 \\
\hline & RP-81 & RP-181941 & 0300 & 1 & F & Clarification on support of Type 2 PH & 15.3.0 \\
\hline & RP-81 & RP-181938 & 0302 & - & F & PRACH Occasion Selection for Msg1 based SI Request & 15.3.0 \\
\hline & RP-81 & RP-181938 & 0304 & - & F & Correction to RA Resource Selection Procedure & 15.3.0 \\
\hline & RP-81 & RP-181941 & 0306 & 2 & F & Correction on BWP operation procedure & 15.3 .0 \\
\hline & RP-81 & RP-181941 & 0326 & 2 & F & CR on padding BSR & 15.3.0 \\
\hline & RP-81 & RP-181941 & 0328 & 1 & F & CR on SR cancellation & 15.3 .0 \\
\hline & RP-81 & RP-181941 & 0329 & 2 & F & CR on BWP with ongoing RA procedure - Option 1 & 15.3.0 \\
\hline & RP-81 & RP-181940 & 0331 & 1 & F & CR on BWP inactivity timer stopping due to RA & 15.3 .0 \\
\hline & RP-81 & RP-181941 & 0342 & 1 & F & Correction for Random Access Back off & 15.3 .0 \\
\hline & RP-81 & RP-181941 & 0356 & 1 & F & RSRP measurements for Random Access & 15.3 .0 \\
\hline & RP-81 & RP-181938 & 0357 & 1 & F & Reset of BFD & 15.3 .0 \\
\hline & RP-81 & RP-181942 & 0368 & 2 & F & CR on first active BWP switching upon RRC (re)configuration & 15.3 .0 \\
\hline & RP-81 & RP-181941 & 0371 & 1 & F & Clarification on Long Truncated BSR & 15.3.0 \\
\hline & RP-81 & RP-181940 & 0376 & & F & Correction on SR with PUSCH resource handling of Semi-Persistent CSI reporting & 15.3.0 \\
\hline & RP-81 & RP-181940 & 0378 & 1 & F & BWP operation for BFR RA & 15.3.0 \\
\hline & RP-81 & RP-181942 & 0402 & 2 & F & Changes for MAC CEs to Support the Extended Maximum Number of TCI States & 15.3 .0 \\
\hline 2018-12 & RP-82 & RP-182658 & 0303 & 6 & F & Msg3 handling for switching from CBRA to CFRA & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0354 & 6 & F & Clarification on PHR timing for configured grant & 15.4.0 \\
\hline & RP-82 & RP-182652 & 0399 & 5 & F & Preamble power ramping & 15.4.0 \\
\hline & RP-82 & RP-182651 & 0406 & 2 & F & bwp-InactivityTimer when PDCCH indicating BWP switching is received & 15.4 .0 \\
\hline & RP-82 & RP-182666 & 0409 & 3 & F & RRC triggered BWP switching while RACH is ongoing & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0411 & 3 & F & Miscellaneous corrections & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0413 & 2 & F & RA Preamble Selection Procedure & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0421 & 3 & F & Correction for Msg3 grant overlapping with another UL grant & 15.4.0 \\
\hline & RP-82 & RP-182649 & 0423 & 1 & F & Correction on the scaling between CSI-RS and SSB for BFR & 15.4.0 \\
\hline & RP-82 & RP-182654 & 0432 & 2 & F & Corrections on CFRA BFR temmination & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0445 & 2 & F & Correction on PHR references & 15.4.0 \\
\hline & RP-82 & RP-182653 & 0452 & 3 & F & Correction of BWP switching when SUL is configured & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0459 & 2 & F & Correction on BSR triggered SR & 15.4.0 \\
\hline & RP-82 & RP-182656 & 0471 & 2 & F & Correction for Reconfiguration of CFRA during ongoing RA & 15.4.0 \\
\hline & RP-82 & RP-182656 & 0475 & 2 & F & Introduction of Data Inactivity timer in MAC & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0486 & 3 & F & Correction to RA prioritization & 15.4.0 \\
\hline & RP-82 & RP-182653 & 0488 & 2 & F & Correction to BFR procedure & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0505 & 2 & F & Handling of overlapped configured grant and UL grant received in RAR & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0523 & 1 & F & Allow padding when UL grant size is larger than 8 bytes & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0535 & 1 & F & Clarification on LCH-to-cell restriction & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0547 & 4 & F & Clarification on BWP ID in MAC CE & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0551 & 1 & F & Corrections for alignments in RACH resource selection & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0553 & 1 & F & Correction on the RO selection for PDCCH order triggered RA & 15.4 .0 \\
\hline & RP-82 & RP-182665 & 0564 & 2 & F & Correction to SR triggering & 15.4.0 \\
\hline & RP-82 & RP-182655 & 0575 & - & F & Handling of Msg3 size allocated by RAR mismatch during CBRA procedure & 15.4.0 \\
\hline & RP-82 & RP-182658 & 0582 & 1 & F & Clarification to value table for recommended bit rate MAC CE & 15.4.0 \\
\hline & RP-82 & RP-182656 & 0587 & - & F & Clarification for CCCH1 & 15.4.0 \\
\hline & RP-82 & RP-182666 & 0593 & 5 & F & Correction to PHR procedures in dual-connectivity & 15.4.0 \\
\hline & RP-82 & RP-182664 & 0594 & 1 & F & Correction on DL SPS configuration & 15.4.0 \\
\hline & RP-82 & RP-182664 & 0595 & - & F & Enabling to configure TCI-state for CORESET\#0 by MAC CE & 15.4.0 \\
\hline 2019-03 & RP-83 & RP-190540 & 0603 & 1 & F & Miscellaneous corrections & 15.5 .0 \\
\hline & RP-83 & RP-190540 & 0630 & 1 & F & Correction on PH omitting of dynamic power sharing incapable UE & 15.5 .0 \\
\hline & RP-83 & RP-190540 & 0634 & 1 & F & CR on RA-RNTI calculation & 15.5.0 \\
\hline & RP-83 & RP-190545 & 0638 & 1 & F & Clarification for random access on SUL & 15.5.0 \\
\hline 2019-06 & RP-84 & RP-191379 & 0639 & 1 & F & Correction to PUCCH spatial relation Activation/Deactivation MAC CE & 15.6.0 \\
\hline & RP-84 & RP-191375 & 0642 & 1 & F & Correction on NR PHR for late drop & 15.6.0 \\
\hline & RP-84 & RP-191376 & 0646 & 1 & F & Miscellaneous corrections & 15.6.0 \\
\hline & RP-84 & RP-191375 & 0648 & - & F & Clarification on PH value type determination & 15.6.0 \\
\hline 2019-09 & RP-85 & RP-192190 & 0650 & 1 & F & Miscellaneous corrections & 15.7 .0 \\
\hline & RP-85 & RP-192192 & 0661 & 1 & F & Correction to semi-persistant CSI report in DRX & 15.7 .0 \\
\hline 2019-12 & RP-86 & RP-192935 & 0672 & 3 & F & Clarification on CSI reporting in C-DRX & 15.8.0 \\
\hline & RP-86 & RP-192937 & 0680 & 1 & F & Correction on PRACH procedure with SRS switching & 15.8.0 \\
\hline 2020-03 & RP-87 & RP-200335 & 0675 & 1 & B & PRACH prioritization procedure for MPS and MCS & 16.0.0 \\
\hline & RP-87 & RP-200349 & 0677 & 6 & B & Introduction of Integrated Access and Backhaul for NR & 16.0.0 \\
\hline & RP-87 & RP-200348 & 0685 & 2 & B & Introduction of dommant BWP operation and Async CA & 16.00 \\
\hline
\end{tabular}

ETSI


--- Page 328  ---


3GPP TS 38.321 version 18.2.0 Release 18
327
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & RP-87 & RP-200347 & 0687 & 2 & B & Introduction NR mobility enhancement & 16.0.0 \\
\hline & RP-87 & RP-200359 & 0688 & 1 & B & Recommended Bit Rate/Query for FLUS and MTSI & 16.0.0 \\
\hline & RP-87 & RP-200339 & 0691 & 2 & B & Introduction of eMIMO for NR & 16.0.0 \\
\hline & RP-87 & RP-200342 & 0692 & 3 & B & Introduction of 2-step RACH in 38.321 & 16.0.0 \\
\hline & RP-87 & RP-200341 & 0694 & 1 & B & Introduction of NR-U in 38.321 & 16.0.0 \\
\hline & RP-87 & RP-200343 & 0695 & 1 & B & Introduction of NR eURLLC & 16.0 .0 \\
\hline & RP-87 & RP-200357 & 0696 & - & F & Correction on autonomous RACH retransmission for SRS switching & 16.0.0 \\
\hline & RP-87 & RP-200352 & 0698 & 1 & B & Introduction of NR IIOT & 16.0.0 \\
\hline & RP-87 & RP-200344 & 0699 & 2 & B & Introduction of Rel-16 NR UE power saving in 38.321 & 16.0.0 \\
\hline & RP-87 & RP-200346 & 0701 & 1 & B & Introduction of 5G V2X with NR Sidelink & 16.0.0 \\
\hline & RP-87 & RP-200358 & 0703 & - & B & Introduction of a new MAC subheader for MAC CEs & 16.0.0 \\
\hline & RP-87 & RP-200345 & 0704 & 1 & B & Introduction of NR positioning on MAC spec & 16.0.0 \\
\hline 2020-07 & RP-88 & RP-201191 & 0705 & 2 & F & Corrections to PRACH prioritization procedure for MPS and MCS & 16.1.0 \\
\hline & RP-88 & RP-201179 & 0708 & 4 & F & IAB MAC - rapporteur corrections and clarifications & 16.1.0 \\
\hline & RP-88 & RP-201170 & 0711 & 4 & F & Miscellaneous corrections on eMIMO & 16.1.0 \\
\hline & RP-88 & RP-201181 & 0712 & 3 & F & Correction for NR ||OT in 38.321 & 16.1.0 \\
\hline & RP-88 & RP-201172 & 0714 & 5 & F & Updates to MAC spec for 2-step RACH & 16.1.0 \\
\hline & RP-88 & RP-201190 & 0716 & 1 & F & P bit for Single Entry PHR & 16.1.0 \\
\hline & RP-88 & RP-201174 & 0719 & 4 & F & MAC CR for Rel-16 UE power saving & 16.1.0 \\
\hline & RP-88 & RP-201172 & 0726 & 4 & F & Corrections of NR operating with shared spectrum channel access in 38.321 & 16.1.0 \\
\hline & RP-88 & RP-201176 & 0730 & 2 & F & Corrections to 5G V2X with NR Sidelink & 16.1.0 \\
\hline & RP-88 & RP-201188 & 0734 & 2 & F & Correction to MAC spec for eURLLC & 16.1.0 \\
\hline & RP-88 & RP-201159 & 0739 & - & A & Clarification on obtaining of PH values & 16.1.0 \\
\hline & RP-88 & RP-201178 & 0743 & 1 & F & Corrections on dommant BWP operation & 16.1.0 \\
\hline & RP-88 & RP-201177 & 0744 & 1 & B & CR on 38.321 for NR mobility enhancement & 16.1.0 \\
\hline & RP-88 & RP-201198 & 0746 & 2 & C & Introduction of secondary DRX group CR 38.321 & 16.1.0 \\
\hline & RP-88 & RP-201191 & 0752 & 1 & F & 38321 CR Clarification on eLCID & 16.1.0 \\
\hline & RP-88 & RP-201166 & 0756 & 2 & F & CR to 38321 on RACH Prioritization for MPS and MCS & 16.1.0 \\
\hline & RP-88 & RP-201175 & 0758 & 1 & F & CR for MAC in R16 positioning & 16.1.0 \\
\hline 2020-09 & RP-89 & RP-201932 & 0769 & 2 & F & Miscellaneous corrections & 16.2.0 \\
\hline & RP-89 & RP-201927 & 0773 & 3 & F & Corrections to 5G V2X with NR Sidelink & 16.2.0 \\
\hline & RP-89 & RP-201963 & 0774 & 1 & F & Correction on the calculation of HARQ Process ID for SPS & 16.2.0 \\
\hline & RP-89 & RP-201963 & 0775 & 1 & F & Correction on the term of configuredGrantConfigList & 16.2.0 \\
\hline & RP-89 & RP-201920 & 0784 & 1 & F & Corrections to description of Candidate RS ID in BFR MAC CE & 16.2.0 \\
\hline & RP-89 & RP-201929 & 0794 & 3 & F & Correction on prioritization between DCP and RAR to C-RNTI for CFRA BFR - Option 2 & 16.2.0 \\
\hline & RP-89 & RP-201963 & 0802 & 1 & F & Modifications for LCH and PHY Prioritization Scenarios & 16.2.0 \\
\hline & RP-89 & RP-201938 & 0804 & 1 & A & Clarification on HARQ process ID determination for SPS & 16.2.0 \\
\hline & RP-89 & RP-201924 & 0809 & 3 & F & IAB MAC - miscellaneous corrections and clarifications & 16.2.0 \\
\hline & RP-89 & RP-201920 & 0824 & 1 & F & Correction on the BFR cancellation & 16.2.0 \\
\hline & RP-89 & RP-201920 & 0837 & - & F & BFR Cancellation regarding MAC reset & 16.2.0 \\
\hline & RP-89 & RP-201927 & 0854 & 2 & F & Corrections to SL-BSR truncation & 16.2.0 \\
\hline & RP-89 & RP-201927 & 0858 & 1 & F & Correction on resource (re)selection & 16.2.0 \\
\hline & RP-89 & RP-201963 & 0876 & 1 & F & Miscellaneous corrections for IIOT MAC & 16.2.0 \\
\hline & RP-89 & RP-201920 & 0878 & - & F & Correction on AP and SP SRS MAC-CE & 16.2.0 \\
\hline & RP-89 & RP-201927 & 0881 & - & F & Corrections for CSI reporting & 16.2.0 \\
\hline & RP-89 & RP-201921 & 0882 & 1 & F & Corrections for NR operating with shared spectrum channel access & 16.2.0 \\
\hline & RP-89 & RP-201925 & 0883 & 1 & B & Introduction of MPE reporting & 16.2.0 \\
\hline & RP-89 & RP-201922 & 0884 & - & F & Correction on domant SCell & 16.2.0 \\
\hline & RP-89 & RP-201932 & 0886 & - & F & Corrections to secondary DRX & 16.2.0 \\
\hline & RP-89 & RP-201927 & 0887 & - & F & Corrections to Prioritization for 5G V2X with NR Sidelink & 16.2.0 \\
\hline & RP-89 & RP-201963 & 0888 & - & F & Miscellaneous Conrections for intra-UE prioritization & 16.2.0 \\
\hline & RP-89 & RP-201927 & 0889 & - & F & Correction on the calculation of CG occasion & 16.2.0 \\
\hline & RP-89 & RP-201920 & 0890 & - & F & Corrections to SUL field in SRS Spatial Relation Indication MAC CE & 16.2.0 \\
\hline & RP-89 & & & & & Various editorial corrections by the rapporteur & 16.2.1 \\
\hline 2020-12 & RP-90 & RP-202767 & 0732 & 4 & F & Alignment of SR clause & 16.3 .0 \\
\hline & RP-90 & RP-202776 & 0902 & 2 & F & MAC CR for specification redundance between MAC and PHY & 16.3 .0 \\
\hline & RP-90 & RP-202771 & 0907 & 1 & F & Correction to parameter list for beam failure recovery procedure & 16.3 .0 \\
\hline & RP-90 & RP-202769 & 0920 & 1 & F & Corrections to 5G V2X with NR Sidelink & 16.3 .0 \\
\hline & RP-90 & RP-202773 & 0927 & 2 & F & Correction on resource overlapping with grants addressed to TC-RNTI & 16.3.0 \\
\hline & RP-90 & RP-202773 & 0928 & 1 & F & Clarification on the condition of a de-prioritized grant & 16.3 .0 \\
\hline & RP-90 & RP-202695 & 0936 & 2 & F & Miscellaneous correction on MPE reporting to 38.321 & 16.3 .0 \\
\hline & RP-90 & RP-202772 & 0938 & 1 & F & Correction on Tdelta & 16.3 .0 \\
\hline & RP-90 & RP-202789 & 0942 & 1 & A & Clarification on configured grant (re-)initialization & 16.3.0 \\
\hline & RP-90 & RP-202771 & 0947 & 2 & F & 38.321 correction on Enhanced PUCCH Spatial Relation Activation/Deactivation MAC CE & 16.3.0 \\
\hline & RP-90 & RP-202770 & 0956 & 1 & F & Timing of direct SCell activation upon RRC configuration & 16.3 .0 \\
\hline & RP-90 & RP-202773 & 0957 & 1 & F & Correction for SPS HARQ process ID calculation & 16.3.0 \\
\hline & RP-90 & RP-202772 & 0962 & - & F & Pre-emptive BSR handling at MAC Reset & 16.3 .0 \\
\hline & RP-90 & RP-202767 & 0966 & 1 & F & MAC conrections for NR operating in shared spectrum channel access & 16.3.0 \\
\hline
\end{tabular}

ETSI


--- Page 329  ---


3GPP TS 38.321 version 18.2.0 Release 18
328
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & RP-90 & RP-202789 & 0969 & - & A & Clarification of timer value zero interpretation in MAC & 16.3 .0 \\
\hline & RP-90 & RP-202775 & 0970 & 2 & F & Correction on SP posSRS (de-)activation MAC CE & 16.3 .0 \\
\hline & RP-90 & RP-202769 & 0974 & 1 & F & Correction on the SL process handling & 16.3 .0 \\
\hline & RP-90 & RP-202769 & 0977 & 1 & F & Correction on the MAC reset & 16.3 .0 \\
\hline & RP-90 & RP-202771 & 0982 & 1 & F & Correction on DELTA PREAMBLE and parameters for 2-step RA & 16.3 .0 \\
\hline & RP-90 & RP-202772 & 0984 & - & F & Correction on the condition check in Pre-emptive BSR procedure & 16.3 .0 \\
\hline & RP-90 & RP-202777 & 0987 & 1 & F & Correction on DRX with bundle transmission of configured uplink grant & 16.3 .0 \\
\hline & RP-90 & RP-202771 & 0994 & 4 & F & Correction for CC list operation for TCI state update MAC CE & 16.3 .0 \\
\hline & RP-90 & RP-202773 & 0997 & - & F & Configured Grant related MAC CR for IloT & 16.3 .0 \\
\hline & RP-90 & RP-202773 & 0998 & - & F & Correction for Priority of Uplink Grant & 16.3.0 \\
\hline & RP-90 & RP-202771 & 0999 & - & F & Correction on BFR MAC CE Generation and Build after Triggering of BFR & 16.3 .0 \\
\hline & RP-90 & RP-202769 & 1000 & - & F & Miscellaneous Corrections to 5G V2X with NR Sidelink & 16.3 .0 \\
\hline 2021-03 & RP-91 & RP-210689 & 1001 & 3 & F & Correction on mode2 operation & 16.4 .0 \\
\hline & RP-91 & RP-210702 & 1004 & 1 & A & Miscellaneous corrections & 16.4 .0 \\
\hline & RP-91 & RP-210691 & 1017 & 1 & F & Corrections on the description of Pre-emptive BSR MAC CE & 16.4.0 \\
\hline & RP-91 & RP-210691 & 1026 & 1 & F & Correction for Uplink Grant Received in RAR and Addressed to Temporary C-RNTI & 16.4 .0 \\
\hline & RP-91 & RP-210691 & 1030 & 1 & F & Introduction of the Configuration for SpCell BFR Enhancement & 16.4 .0 \\
\hline & RP-91 & RP-210691 & 1034 & 1 & F & Correction on PUCCH group for enhanced PUCCH Spatial Relation & 16.4.0 \\
\hline & RP-91 & RP-210689 & 1037 & 2 & F & Correction on available UL-SCH resource & 16.4.0 \\
\hline & RP-91 & RP-210691 & 1043 & 1 & F & Correction on configuredGrantTimer handling on the deprioritized configured grant & 16.4 .0 \\
\hline & RP-91 & RP-210703 & 1051 & 2 & F & Corrections to MAC reset & 16.4 .0 \\
\hline & RP-91 & RP-210703 & 1053 & 2 & F & Correction on CSI reporting when CSI masking is setup & 16.4 .0 \\
\hline & RP-91 & RP-210693 & 1057 & - & F & Correction to 38.321 on MPE P-MPR Report & 16.4 .0 \\
\hline & RP-91 & RP-210702 & 1058 & - & A & Activation of CG and DRX inactivity timer & 16.4 .0 \\
\hline & RP-91 & RP-210689 & 1061 & - & F & Miscellaneous MAC conrections & 16.4.0 \\
\hline & RP-91 & RP-210695 & 1062 & & F & Correction to PUSCH skipping with UCI without LCH-based prioritization & 16.4.0 \\
\hline 2021-06 & RP-92 & RP-211470 & 1065 & 1 & F & Correction on SL configured grant & 16.50 .0 \\
\hline & RP-92 & RP-211472 & 1066 & 1 & F & Clarification on which uplink grants participate to the intra-UE prioritization procedure & 16.5.0 \\
\hline & RP-92 & RP-211472 & 1070 & 2 & F & Correction on MAC handling of uplink grants within a bundle & 16.5 .0 \\
\hline & RP-92 & RP-211474 & 1072 & 4 & F & Corrections on SP Positioning SRS Activation and Deactivation MAC CE & 16.5 .0 \\
\hline & RP-92 & RP-211470 & 1074 & 2 & F & Correction on mode 2 UE performing re-evaluation check & 16.5 .0 \\
\hline & RP-92 & RP-211475 & 1075 & 1 & F & Corrections on BSR/PHR content handling & 16.5.0 \\
\hline & RP-92 & RP-211470 & 1095 & 2 & F & Corrections on MCS selection & 16.5 .0 \\
\hline & RP-92 & RP-211470 & 1096 & 2 & F & Miscellaneous MAC conrections & 16.5 .0 \\
\hline & RP-92 & RP-211470 & 1102 & - & F & Correction on SR procedur for sidelink BSR & 16.5 .0 \\
\hline & RP-92 & RP-211470 & 1106 & 2 & F & Handling of the retransmission TB without an associated SL process & 16.5 .0 \\
\hline & RP-92 & RP-211471 & 1112 & - & F & Correction to 38.321 on msga-TransMax selection for 2-step RACH & 16.5 .0 \\
\hline & RP-92 & RP-211475 & 1115 & - & F & Clarification on prioritization of retransmission over initial transmission for HARQ PID selection in NR-U & 16.5 . \\
\hline & RP-92 & RP-211473 & 1117 & - & F & CR on LCP of the source MAC entity & 16.50 \\
\hline & RP-92 & RP-211472 & 1118 & - & F & CR for not transmitting only padding and padding BSR with eLCID & 16.5 .0 \\
\hline 2021-09 & RP-93 & RP-212442 & 1098 & 1 & F & Correction on UL skipping with Ich-basedPrioritization & 16.6 .0 \\
\hline & RP-93 & RP-212444 & 1122 & 1 & F & Correction on R16 uplink skipping procedure & 16.6 .0 \\
\hline & RP-93 & RP-212441 & 1123 & 1 & F & Corrections on the dynamic sidelink grants & 16.6 .0 \\
\hline & RP-93 & RP-212441 & 1125 & - & F & Correct on priority of MAC PDU for SL-SCH & 16.6 .0 \\
\hline & RP-93 & RP-212441 & 1126 & 1 & F & Correct on random selection & 16.6.0 \\
\hline & RP-93 & RP-212441 & 1127 & 1 & F & Correction on condition of setting the resource reservation interval for mode 2 & 16.6.0 \\
\hline & RP-93 & RP-212443 & 1129 & - & F & Correction on starting of RetransmissionTimerDL & 16.6.0 \\
\hline & RP-93 & RP-212439 & 1134 & 1 & F & Clarification on E-UTRA MAC entity in PHR & 16.6.0 \\
\hline & RP-93 & RP-212441 & 1139 & - & F & Corrections on MCS selection when UE performing TX resource (re)selection check & 16.6.0 \\
\hline & RP-93 & RP-212441 & 1140 & 1 & F & Correction on SR procedure for SL-CSI reporting & 16.6 .0 \\
\hline & RP-93 & RP-212442 & 1141 & 1 & F & Clarification of PUCCH resource in LCH-based Prioritization & 16.6 .0 \\
\hline & RP-93 & RP-212442 & 1145 & 1 & F & Correction to 38.321 on priority handling of the UL grant addressed to TC-RNTI & 16.6 .0 \\
\hline & RP-93 & RP-212441 & 1154 & - & F & Corrections for SR configuration for SL & 16.6.0 \\
\hline 2021-12 & RP-94 & RP-213342 & 1158 & 1 & F & Correction on resource reselection behaviour & 16.7 .0 \\
\hline & RP-94 & RP-213343 & 1160 & 1 & F & Corrections to LCP for truncated SCell BFR MAC CE & 16.7 .0 \\
\hline & RP-94 & RP-213342 & 1168 & 1 & F & Miscelleneous CR on 38.321 (Rapporteur CR) & 16.7 .0 \\
\hline & RP-94 & RP-213342 & 1169 & - & F & Corrections to prioritization for NR sidelink communication & 16.7 .0 \\
\hline & RP-94 & RP-213344 & 1179 & - & F & Clarification on posSRS in MAC spec & 16.7 .0 \\
\hline & RP-94 & RP-213343 & 1180 & - & F & Clarification on Duplication MAC CE & 16.7 .0 \\
\hline 2022-03 & RP-95 & RP-220473 & 1187 & 1 & F & Correction on ULSL prioritization & 16.8 .0 \\
\hline & RP-95 & RP-220473 & 1189 & - & F & Corrections on the Unexpected SL-BSR Trigger for SL-CSI MAC CE & 16.8 .0 \\
\hline & RP-95 & RP-220473 & 1193 & - & F & Correction on the PDB derivation from LCH priority & 16.8.0 \\
\hline
\end{tabular}

ETSI


--- Page 330  ---


3GPP TS 38.321 version 18.2.0 Release 18
329
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & RP-95 & RP-220473 & 1202 & 1 & F & Correction on SL HARQ feedback indicator & 16.8.0 \\
\hline & RP-95 & RP-220473 & 1207 & - & F & Correction of RV indication & 16.8.0 \\
\hline & RP-95 & RP-220472 & 1209 & 1 & F & Clarification on the initial state of elements controlled by MAC CE and non-numerical K1 value & 16.8.0 \\
\hline & RP-95 & RP-220473 & 1218 & 1 & F & Correction on NACK reporting on PUCCH for NR SL & 16.8.0 \\
\hline 2022-03 & RP-95 & RP-220486 & 1171 & 7 & B & CR to 38.321 introducing Integrated Access and Backhaul for NR Rel17 & 17.0.0 \\
\hline & RP-95 & RP-220484 & 1184 & 1 & B & Introduction of NR MBS & 17.0.0 \\
\hline & RP-95 & RP-220480 & 1186 & 1 & B & Introduction of RedCap in TS 38.321 & 17.0.0 \\
\hline & RP-95 & RP-220490 & 1190 & 1 & B & Introduction of RAN Slicing & 17.00 \\
\hline & RP-95 & RP-220500 & 1191 & 1 & B & Introduction of FR2 UL gap for Rel-17 & 17.0 .0 \\
\hline & RP-95 & RP-220491 & 1194 & 1 & B & Introduction of Sidelink Relay & 17.0.0 \\
\hline & RP-95 & RP-220479 & 1197 & 2 & B & Introduction of R17 positioningEnh for MAC spec & 17.0.0 \\
\hline & RP-95 & RP-220487 & 1198 & 1 & B & Introduction of Small Data Transmission for MAC spec & 17.0 .0 \\
\hline & RP-95 & RP-220478 & 1199 & 1 & B & TS 38.321 CR for NR coverage enhancements & 17.0.0 \\
\hline & RP-95 & RP-220481 & 1200 & 1 & B & Introduction of enhanced lloT\&URLLC support for NR & 17.0.0 \\
\hline & RP-95 & RP-220474 & 1204 & 1 & B & Introduction of feMIMO & 17.0.0 \\
\hline & RP-95 & RP-220476 & 1206 & 1 & B & CR of TS 38.321 for Sidelink enhancement & 17.0.0 \\
\hline & RP-95 & RP-220485 & 1210 & 2 & B & Introduction of eDCCA & 17.00 \\
\hline & RP-95 & RP-220487 & 1214 & 1 & B & Introduction of common RACH partitioning aspects in MAC & 17.00 \\
\hline & RP-95 & RP-220482 & 1215 & 2 & B & Introduction of Release-17 support for Non-Terrestrial Networks (NTN) & 17.00 \\
\hline & RP-95 & RP-220475 & 1219 & - & B & Introduction of Extending NR operation to 71 GHz & 17.0 .0 \\
\hline 2022-06 & RP-96 & RP-221716 & 1238 & 1 & F & Miscellaneous CR on TS 38.321 for RedCap & 17.1.0 \\
\hline & RP-96 & RP-221729 & 1243 & 3 & F & Correction to MAC spec for Small Data Transmission & 17.1.0 \\
\hline & RP-96 & RP-221722 & 1261 & 1 & F & MAC Corrections on feMIMO & 17.1.0 \\
\hline & RP-96 & RP-221727 & 1262 & - & F & Introduction of PEI-RNT| & 17.1.0 \\
\hline & RP-96 & RP-221763 & 1264 & 4 & F & Corrections to MAC regarding deactivated SCG & 17.1.0 \\
\hline & RP-96 & RP-221718 & 1266 & 1 & B & CR to 38.321 on Integrated Access and Backhaul for NR Rel-17 & 17.1.0 \\
\hline & RP-96 & RP-221716 & 1273 & 1 & F & MAC Conrections for RACH partitioning & 17.1.0 \\
\hline & RP-96 & RP-221732 & 1277 & 1 & F & Correction for sidelink relay in MAC & 17.1.0 \\
\hline & RP-96 & RP-221721 & 1279 & 1 & F & Correction on FR2 UL gap & 17.1.0 \\
\hline & RP-96 & RP-221726 & 1281 & 1 & F & Correction for Enhanced NR IIoT and URLLC in 38.321 & 17.1.0 \\
\hline & RP-96 & RP-221713 & 1283 & 1 & A & Clarification on Duplication MAC CE & 17.1.0 \\
\hline & RP-96 & RP-221719 & 1292 & 1 & F & Correction on MAC specification for RAN slicing & 17.1.0 \\
\hline & RP-96 & RP-221712 & 1293 & - & A & Corrections on the MAC filtering for SL-SRBO/SL-SRB1 & 17.1.0 \\
\hline & RP-96 & RP-221736 & 1295 & - & F & Priority of MAC CEs & 17.1.0 \\
\hline & RP-96 & RP-221717 & 1296 & 1 & F & Corrections to Release-17 NR Non-Tenrestrial Networks (NTN) & 17.1.0 \\
\hline & RP-96 & RP-221724 & 1297 & 1 & F & Corrections for NR coverage enhancements & 17.1.0 \\
\hline & RP-96 & RP-221725 & 1298 & - & F & Correction on MAC spec for posEnh & 17.1.0 \\
\hline & RP-96 & RP-221712 & 1299 & - & A & Corrections on SL BSR & 17.1.0 \\
\hline & RP-96 & RP-221718 & 1300 & 1 & F & Miscellaneous corrections to 38.321 on Integrated Access and Backhaul for NR Rel-17 & 17.1.0 \\
\hline & RP-96 & RP-221754 & 1301 & 1 & F & Corrections on MBS & 17.1.0 \\
\hline & RP-96 & RP-221728 & 1302 & 1 & F & Corrections for TRS-based SCell activation & 17.1.0 \\
\hline & RP-96 & RP-221739 & 1303 & - & F & Correction on user plane aspects for SL enhancement & 17.1.0 \\
\hline 2022-09 & RP-97 & RP-222524 & 1318 & 2 & F & Miscellaneous corrections for NR Sidelink Relay (rapporteur CR) & 17.2.0 \\
\hline & RP-97 & RP-222522 & 1322 & 3 & F & Corrections to MAC regarding deactivated SCG & 17.2.0 \\
\hline & RP-97 & RP-222523 & 1327 & 1 & F & Miscellaneous corrections to 38.321 on Integrated Access and Backhaul for NR Rel-17 & 17.2.0 \\
\hline & RP-97 & RP-222518 & 1331 & 1 & A & Correction on the SL LCP restriction for sl-HARQ-FeedbackEnabled & 17.2.0 \\
\hline & RP-97 & RP-222518 & 1335 & 1 & A & Clarification on the Buffer Size field in the Sidelink BSR formats & 17.2.0 \\
\hline & RP-97 & RP-222525 & 1336 & 1 & F & Miscellaneous CR on TS 38.321 for RedCap & 17.2.0 \\
\hline & RP-97 & RP-222524 & 1344 & 2 & F & Change to the MAC spec for R17 Positioning enhancement & 17.2.0 \\
\hline & RP-97 & RP-222525 & 1357 & 1 & F & Change to MAC spec for Small Data Transmission & 17.2.0 \\
\hline & RP-97 & RP-222524 & 1378 & 2 & F & Corrections to Release-17 Non-Terrestrial Networks (NTN) for TS 38.321 & 17.2.0 \\
\hline & RP-97 & RP-222523 & 1389 & 2 & F & Miscellaneous MAC Corrections on feMIMO & 17.2.0 \\
\hline & RP-97 & RP-222602 & 1398 & 2 & F & Correction on RO Selection with RA Partitioning & 17.2.0 \\
\hline & RP-97 & RP-222524 & 1400 & 2 & F & 38.321 corrections for SL enhancement & 17.2.0 \\
\hline & RP-97 & RP-222522 & 1401 & - & F & MAC corrections on MUSIM & 17.2.0 \\
\hline & RP-97 & RP-222525 & 1402 & 1 & F & Corrections on TS 38.321 for RAN Slicing & 17.2.0 \\
\hline & RP-97 & RP-222523 & 1403 & 1 & F & 38.321 corrections for MBS & 17.2.0 \\
\hline & RP-97 & RP-222523 & 1404 & - & F & Correction for Simultaneous Transmission of SR and UL-SCH & 17.2.0 \\
\hline & RP-97 & RP-222524 & 1405 & - & F & Correction on active time & 17.2.0 \\
\hline & RP-97 & RP-222524 & 1406 & - & F & Correction on user plane aspects & 17.2.0 \\
\hline & RP-97 & RP-222526 & 1407 & - & B & Start drx-HARQ-RTT-TimerUL after last repetition [ulHARQ_RTT_Timer] & 17.2.0 \\
\hline 2022-12 & RP-98 & RP-223411 & 1399 & 3 & F & Correction on FR2 UL gap & 17.3.0 \\
\hline & RP-98 & RP-223411 & 1408 & 4 & F & Correction to MAC spec for positioning enhancement & 17.3.0 \\
\hline & RP-98 & RP-223410 & 1418 & 4 & F & Miscellaneous MAC Conrections on feMIMO & 17.3.0 \\
\hline & RP-98 & RP-223412 & 1428 & 1 & F & Correction on SL DRX Offset Calculation & 17.3.0 \\
\hline
\end{tabular}

ETSI


--- Page 331  ---


3GPP TS 38.321 version 18.2.0 Release 18
330
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & RP-98 & RP-223409 & 1439 & 2 & F & Correction on BWP handling for deactivated SCG and the timing requirement for SCG activation & 17.3.0 \\
\hline & RP-98 & RP-223412 & 1445 & 2 & F & 38.321 corrections for SL enhancement & 17.3.0 \\
\hline & RP-98 & RP-223411 & 1446 & 1 & F & Corrections to Release-17 Non-Terrestrial Networks (NTN) for TS 38.321 & 17.3.0 \\
\hline & RP-98 & RP-223413 & 1451 & 1 & F & Correction to MAC spec for Small Data Transmission & 17.3 .0 \\
\hline & RP-98 & RP-223406 & 1454 & 1 & F & Corrections for MBS & 17.3.0 \\
\hline & RP-98 & RP-223411 & 1461 & 1 & F & Miscellaneous CR on TS 38.321 for RedCap & 17.3.0 \\
\hline & RP-98 & RP-223410 & 1474 & 1 & F & Miscellaneous corrections to 38.321 on Integrated Access and Backhaul for NR Rel-17 & 17.3 .0 \\
\hline & RP-98 & RP-223413 & 1501 & - & F & Correction to RACH partitioning features & 17.3.0 \\
\hline & RP-98 & RP-223406 & 1505 & - & A & R16 MAC conrections & 17.3 .0 \\
\hline & RP-98 & RP-223412 & 1506 & 1 & F & R17 MAC conrections & 17.3.0 \\
\hline & RP-98 & RP-223412 & 1507 & - & F & Correction on cast type setting for discovery message & 17.3 .0 \\
\hline 2023-03 & RP-99 & RP-230688 & 1508 & 3 & F & Correction to INACTIVE posSRS transmission & 17.4.0 \\
\hline & RP-99 & RP-230688 & 1512 & 2 & F & Correction to PosMG Activation/Deactivation Request & 17.4.0 \\
\hline & RP-99 & RP-230688 & 1521 & - & F & MAC Corrections on SDT & 17.4.0 \\
\hline & RP-99 & RP-230688 & 1535 & 1 & F & Correction on uplink TA maintenance for positioning & 17.4.0 \\
\hline & RP-99 & RP-230689 & 1537 & 2 & F & Clarification on the Serving Cell configured with two BFD-RS sets & 17.4.0 \\
\hline & RP-99 & RP-230689 & 1538 & - & F & Clarification on desired IAB-MT PSD range & 17.4.0 \\
\hline & RP-99 & RP-230689 & 1539 & - & F & Correction to add the missing elAB MAC CEs & 17.4.0 \\
\hline & RP-99 & RP-230689 & 1540 & - & F & Correction to 38.321 on Integrated Access and Backhaul for NR Rel-17 concerning DL TX power adjustment range extension & 17.4.0 \\
\hline & RP-99 & RP-230688 & 1541 & 2 & F & Corrections for RA-SDT and CG-SDT & 17.4.0 \\
\hline & RP-99 & RP-230689 & 1544 & 1 & F & Correction on implicit BFD-RS change & 17.4.0 \\
\hline & RP-99 & RP-230692 & 1553 & 1 & F & Correction on discovery message filtering & 17.4.0 \\
\hline & RP-99 & RP-230690 & 1560 & 2 & F & Corrections to NR NTN for 38.321 & 17.4.0 \\
\hline & RP-99 & RP-230688 & 1569 & 1 & F & Correction to RA-SDT & 17.4.0 \\
\hline & RP-99 & RP-230692 & 1571 & 1 & F & R17 MAC corrections & 17.4.0 \\
\hline & RP-99 & RP-230694 & 1572 & 1 & D & Miscellaneous editorial changes for 38.321 & 17.4.0 \\
\hline & RP-99 & RP-230690 & 1573 & 1 & F & MBS MAC Corrections & 17.4.0 \\
\hline 2023-06 & RP-100 & RP-231415 & 1576 & 2 & F & Clarification on RA Resource Selection During CG-SDT & 17.5.0 \\
\hline & RP-100 & RP-231414 & 1579 & 3 & F & Corrections on cfr-ConfigMulticast and Multicast DRX & 17.50 \\
\hline & RP-100 & RP-231415 & 1580 & 2 & F & Correction to CG-SDT LCH restriction & 17.5.0 \\
\hline & RP-100 & RP-231414 & 1583 & 3 & F & Corrections on SPS Initialization and Handling of Unknown, Unforeseen and Erroneous Protocol Data for MBS & 17.50 \\
\hline & RP-100 & RP-231415 & 1584 & 2 & F & Corrections on SDT using NCD-SSB for RedCap & 17.5.0 \\
\hline & RP-100 & RP-231418 & 1588 & 2 & F & Clarification on UL operation upon validity timer expiry & 17.50 \\
\hline & RP-100 & RP-231413 & 1589 & 1 & F & Correction to MAC reset for elAB & 17.50 \\
\hline & RP-100 & RP-231418 & 1597 & 3 & F & Corrections to NR NTN for 38.321 & 17.50 \\
\hline & RP-100 & RP-231416 & 1605 & 3 & F & Corrections on MAC reset regarding configured sidelink grant & 17.50 \\
\hline & RP-100 & RP-231416 & 1611 & 1 & F & Correction on the usage of default CBR values for NR sidelink & 17.50 \\
\hline & RP-100 & RP-231412 & 1613 & 2 & F & RA partition selection for Msg1 based SI request & 17.5.0 \\
\hline & RP-100 & RP-231412 & 1614 & 1 & F & Correction to MAC spec for Positoning Enhancements & 17.5.0 \\
\hline & RP-100 & RP-231416 & 1615 & - & F & Correction on 38.321 for SL enhancements & 17.50 .0 \\
\hline & RP-100 & RP-231415 & 1616 & 1 & F & Correction on SDT with sparate initial BWP & 17.50 .0 \\
\hline & RP-100 & RP-231416 & 1618 & - & F & Miscellaneous corrections on TS 38.321 for NR sidelink & 17.5.0 \\
\hline & RP-100 & RP-231415 & 1621 & 1 & F & Clarification on unknown, unforeseen and erroneous protocol data during SDT & 17.5.0 \\
\hline & RP-100 & RP-231413 & 1622 & 1 & F & Clarification on respective roles of MAC and RRC in configuring various IAB parameters & 17.5.0 \\
\hline & RP-100 & RP-231413 & 1624 & 2 & F & Clarification on which CSI-RS resources in lAB restricted beam MAC CEs & 17.5.0 \\
\hline & RP-100 & RP-231416 & 1627 & 2 & F & MAC PDU filtering & 17.5.0 \\
\hline & RP-100 & RP-231413 & 1629 & 1 & F & Correction on Enhanced BFR MAC CE & 17.50 \\
\hline & RP-100 & RP-231414 & 1630 & - & F & Correction on the start condition of drx-HARQ-RTT-TimerDL & 17.50 .0 \\
\hline 2023-09 & RP-101 & RP-232568 & 1625 & 2 & F & Correction on number of restricted beams for elAB & 17.600 \\
\hline & RP-101 & RP-232667 & 1642 & 1 & F & Correction on NR Sidelink MAC & 17.600 \\
\hline & RP-101 & RP-232568 & 1643 & - & F & Correction on the use of the term ID in IAB MAC CEs & 17.6.0 \\
\hline & RP-101 & RP-232568 & 1644 & - & F & Clarification on use of SRI in |AB MAC CEs & 17.600 \\
\hline & RP-101 & RP-232667 & 1653 & 1 & F & DRX Command MAC CE for MBS & 17.600 \\
\hline & RP-101 & RP-232570 & 1656 & 1 & F & Correction on SDT Triggering Conditions & 17.60 \\
\hline & RP-101 & RP-232667 & 1659 & - & F & Miscellaneous corrections on TS 38.321 for NR sidelink & 17.600 \\
\hline & RP-101 & RP-232566 & 1660 & 1 & A & Correction on NR Sidelink MAC & 17.600 \\
\hline 2023-12 & RP-102 & RP-233885 & 1669 & 2 & A & Corrections to random access cancellation criteria for sidelink BSR and CSI reporting & 17.70 \\
\hline & RP-102 & RP-233886 & 1673 & 1 & A & Correction on CSI reporting for DCP function & 17.7 .0 \\
\hline & RP-102 & RP-233885 & 1676 & 3 & A & Correction on MAC layer for sidelink & 17.7 .0 \\
\hline & RP-102 & RP-233890 & 1686 & 2 & F & Correction on the condition of HARQ feedback generation and the condition of stopping drx-RetransmissionTimerDL & 17.70 \\
\hline & RP-102 & RP-233890 & 1688 & 2 & F & Correction on SRI in IAB MAC CEs & 17.7 .0 \\
\hline & RP-102 & RP-233888 & 1691 & 1 & F & Rel-17 MAC corrections & 17.7.0 \\
\hline
\end{tabular}

ETSI


--- Page 332  ---


3GPP TS 38.321 version 18.2.0 Release 18
331
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|l|l|l|l|l|}
\hline & RP-102 & RP-233965 & 1692 & 2 & F & Correction to 38.321 on Koffset handling during MAC reset & 17.7.0 \\
\hline & RP-102 & RP-233890 & 1714 & 1 & F & Correction on the list of MAC CEs for which there are requirements upon reception & 17.7 .0 \\
\hline & RP-102 & RP-233888 & 1718 & 1 & F & Correction on NR SL MAC & 17.7.0 \\
\hline & RP-102 & RP-233888 & 1720 & - & F & MAC correction for Sidelink CSI reporting & 17.7 .0 \\
\hline 2023-12 & RP-102 & RP-233898 & 1554 & 11 & B & Introduction of support for Network Controlled Repeaters & 18.0.0 \\
\hline & RP-102 & RP-233899 & 1694 & 2 & B & Introduction of eRedCap in TS 38.321 & 18.00 .0 \\
\hline & RP-102 & RP-233897 & 1695 & 2 & B & Introduction of Release-18 SL Evolution in TS 38.321 & 18.0.0 \\
\hline & RP-102 & RP-233896 & 1696 & 1 & B & Introduction of Rel-18 MIMOevo for TS 38.321 & 18.0.0 \\
\hline & RP-102 & RP-233914 & 1697 & 3 & B & Introduction of FR2 SCell enhancements & 18.0.0 \\
\hline & RP-102 & RP-233908 & 1698 & 2 & B & Introduction of XR enhancements & 18.0.0 \\
\hline & RP-102 & RP-233902 & 1699 & 2 & B & Introduction of MT-SDT and CG-SDT enhancement for MAC spec [CG-SDT-enh] & 18.0.0 \\
\hline & RP-102 & RP-233901 & 1700 & 2 & B & Introduction of R18 positioning to MAC spec & 18.00 .0 \\
\hline & RP-102 & RP-233907 & 1701 & 2 & B & Introduction of NR MBS enhancements & 18.00 .0 \\
\hline & RP-102 & RP-233904 & 1703 & 2 & B & Introduction of NR sidelink relay enhancements & 18.00 .0 \\
\hline & RP-102 & RP-233930 & 1705 & 2 & B & Introduction of NR further mobility enhancements in TS 38.321 & 18.0.0 \\
\hline & RP-102 & RP-233939 & 1706 & 2 & B & Introduction of Cross-RRH TCI state switch indication for high speed train & 18.0.0 \\
\hline & RP-102 & RP-233916 & 1710 & 2 & B & Introduction of NR ATG in TS 38.321 & 18.0.0 \\
\hline & RP-102 & RP-233895 & 1711 & 2 & B & Introduction of Further NR Coverage Enhancements in MAC spec & 18.0.0 \\
\hline & RP-102 & RP-233906 & 1716 & 2 & B & Introduction of RACH-less handover for NR NTN and mobile |AB to TS 38.321 & 18.0.0 \\
\hline & RP-102 & RP-233900 & 1717 & 1 & B & Introduction of Network energy savings to TS 38.321 & 18.00 .0 \\
\hline & RP-102 & RP-233906 & 1721 & 1 & B & LCID extension for CCCH/CCCH1 [LCID-extension] & 18.0.0 \\
\hline & RP-102 & RP-233890 & 1727 & 1 & B & PTM retransmission reception for multicast DRX with HARQ feedback disabled [PTM_ReTx_Mcast_HARQ_Disb] & 18.0.0 \\
\hline & RP-102 & RP-233931 & 1728 & - & B & Introduction of NR Support for Uncrewed Aerial Vehicles & 18.0.0 \\
\hline & RP-102 & RP-233906 & 1730 & - & B & Introduction of Rel-18 NTN enhancements to TS 38.321 & 18.0.0 \\
\hline 2024-03 & RP-103 & RP-240655 & 1657 & 2 & F & Correction on HARQ buffer flush at SCG deactivation & 18.1.0 \\
\hline & RP-103 & RP-240703 & 1712 & 2 & B & Introduction of beam failure recovery for SDT in Rel-18 [RASDT_BeamFailure] & 18.1.0 \\
\hline & RP-103 & RP-240655 & 1732 & 1 & A & Correction in TS 38.321 to support Simultaneous PUSCH and PUCCH transmissions of same priority on different inter-band cells [SimultaneousPUSCH-PUCCH] & 18.1.0 \\
\hline & RP-103 & RP-240692 & 1733 & 1 & F & Miscellaneous corrections for further mobility enhancements in MAC & 18.1.0 \\
\hline & RP-103 & RP-240702 & 1736 & 2 & F & Correction to TS 38.321 & 18.1.0 \\
\hline & RP-103 & RP-240693 & 1738 & 1 & B & Generalization of RACH-less handover for MAC spec [RACH-lessHO] & 18.1.0 \\
\hline & RP-103 & RP-240696 & 1739 & 1 & F & Corrections to the MAC spec for R18 positioning & 18.1.0 \\
\hline & RP-103 & RP-240698 & 1742 & 1 & F & Miscellaneous corrections on TS 38.321 for eRedCap & 18.1.0 \\
\hline & RP-103 & RP-240701 & 1743 & 1 & F & Correction for SL resource pool usage for BRID/DAA transmission & 18.1.0 \\
\hline & RP-103 & RP-240651 & 1748 & 1 & A & CR on termination of on-going RACH due to pending SR for SL-BSR & 18.1.0 \\
\hline & RP-103 & RP-240657 & 1751 & 2 & A & Correction on CG-SDT initial transmission & 18.1.0 \\
\hline & RP-103 & RP-240700 & 1756 & 1 & F & Miscellaneous MAC Conrections on SL Relay enhancements & 18.1.0 \\
\hline & RP-103 & RP-240665 & 1765 & 2 & F & Clarification on Timing Advance Report MAC CE for NR ATG & 18.1.0 \\
\hline & RP-103 & RP-240688 & 1772 & 2 & F & Miscellaneous corrections to eMBS in MAC & 18.1.0 \\
\hline & RP-103 & RP-240668 & 1779 & 1 & F & Miscellaneous MAC corrections for CE & 18.1.0 \\
\hline & RP-103 & RP-240662 & 1780 & 2 & F & Miscellaneous MAC conrections for network energy savings & 18.1.0 \\
\hline & RP-103 & RP-240694 & 1781 & - & F & Rapporteur CR to MT-SDT and CG-SDT enhanccement [CG-SDTenh] & 18.1.0 \\
\hline & RP-103 & RP-240651 & 1784 & 1 & A & Miscellaneous corrections on TS 38.321 & 18.1.0 \\
\hline & RP-103 & RP-240656 & 1785 & 1 & A & Miscellaneous corrections on TS 38.321 & 18.1.0 \\
\hline & RP-103 & RP-240689 & 1786 & 1 & B & Introduction of Multi-carrier enhancements & 18.1.0 \\
\hline & RP-103 & RP-240695 & 1787 & - & F & Corrections to Rel-18 NTN enhancements & 18.1.0 \\
\hline & RP-103 & RP-240699 & 1788 & 2 & F & MAC corrections on Rel-18 NR sidelink evolution & 18.1.0 \\
\hline & RP-103 & RP-240691 & 1789 & 1 & C & Corrections on Rel-18 MIMOevo for TS 38.321 & 18.1.0 \\
\hline 2024-06 & RP-104 & RP-241567 & 1774 & 2 & F & Correction on sdt-LogicalChannelSR-DelayTimer applicability & 18.2.0 \\
\hline & RP-104 & RP-241562 & 1807 & 2 & F & Correction to resource selection for LTE-NR cochannel scenario & 18.2.0 \\
\hline & RP-104 & RP-241581 & 1812 & 1 & F & Miscellaneous corrections & 18.2.0 \\
\hline & RP-104 & RP-241571 & 1813 & 3 & F & Correction on resource pool selection for A2X communication & 18.2.0 \\
\hline & RP-104 & RP-241543 & 1814 & 1 & F & SDT BFR timer being not configured [RA-SDT BeamFailure] & 18.2.0 \\
\hline & RP-104 & RP-241574 & 1817 & 3 & F & Miscellaneous corrections for further mobility enhancements & 18.2.0 \\
\hline & RP-104 & RP-241553 & 1821 & 4 & A & Correction on multicast DRX to support NTN & 18.2.0 \\
\hline & RP-104 & RP-241551 & 1828 & 3 & A & Correction on RACH resource set availability check & 18.2.0 \\
\hline & RP-104 & RP-241562 & 1830 & 3 & F & Correction on Release-18 Sidelink evolution & 18.2.0 \\
\hline & RP-104 & RP-241561 & 1832 & 1 & F & Miscellaneous Conrections on MIMOevo & 18.2.0 \\
\hline & RP-104 & RP-241573 & 1833 & 1 & F & Corrections for XR & 18.2.0 \\
\hline & RP-104 & RP-241564 & 1835 & 3 & F & Corrections on TS 38.321 for 2-step RACH for eRedCap & 18.2.0 \\
\hline & RP-104 & RP-241554 & 1838 & 1 & A & Correction to MAC on cast type & 18.2.0 \\
\hline & RP-104 & RP-241572 & 1842 & 1 & F & Clarification on MAC reset for multicast reception in RRC_INACTIVE & 18.2.0 \\
\hline & RP-104 & RP-241655 & 1843 & 3 & F & Clarification on HARQ RTT Timer operation & 18.2.0 \\
\hline & RP-104 & RP-241566 & 1844 & 1 & F & Rapporteur MAC CR for R18 positioning & 18.2.0 \\
\hline & RP-104 & RP-241544 & 1845 & 1 & F & Rapporteur correction for RACH-less HO [RACH-lessHO] & 18.2.0 \\
\hline
\end{tabular}

ETSI


--- Page 333  ---


3GPP TS 38.321 version 18.2.0 Release 18
332
ETSI TS 138321 V18.2.0 (2024-08)

\begin{tabular}{|l|l|l|c|c|c|l|l|}
\hline & RP-104 & RP-241560 & 1851 & 1 & F & Micellaneous MAC corrections for CE & 18.2 .0 \\
\hline & RP-104 & RP-241565 & 1855 & - & F & Miscellaneous MAC conections for network energy savings & 18.2 .0 \\
\hline & RP-104 & RP-241558 & 1858 & 2 & F & Corrections for Non-terrestrial Networks & 18.2 .0 \\
\hline
\end{tabular}

ETSI


--- Page 334  ---


3GPP TS 38.321 version 18.2.0 Release 18
333
ETSI TS 138321 V18.2.0 (2024-08)

\begin{table}
\captionsetup{labelformat=empty}
\caption{History}
\begin{tabular}{|l|l|l|}
\hline \multicolumn{3}{|r|}{Document history} \\
\hline V18.1.0 & May 2024 & Publication \\
\hline V18.2.0 & August 2024 & Publication \\
\hline & & \\
\hline & & \\
\hline & & \\
\hline
\end{tabular}
\end{table}

ETSI

