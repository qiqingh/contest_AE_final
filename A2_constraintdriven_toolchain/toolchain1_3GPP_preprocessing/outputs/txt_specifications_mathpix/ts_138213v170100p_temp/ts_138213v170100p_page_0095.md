<!-- Page 95 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
94
ETSI TS 138213 V17.1.0 (2022-05)

Set \( V_{D A I}^{(g+1) \bmod 2} \) to the value of a total DAI field for group \( (g+1) \bmod 2 \) in the last DCI format providing the value of \( g \)
- If \( g=1 \) and the UE detects a DCI format that does not include a PDSCH group index field in a PDCCH reception that is after the PDCCH reception for the last DCI format detection providing the value of \( g \) and indicating a same slot for a PUCCH transmission occasion, set \( V_{\mathrm{DAI}}^{(g+1) \bmod 2}=\emptyset \)

Set \( q \) to the value of a number of requested PDSCH group(s) field in the last DCI format providing the value of \( g \)
A UE does not expect to detect DCI formats with respective
- Number of requested PDSCH group(s) field values of 0 , and
- PDSCH-to-HARQ_feedback timing field values that indicate a same PUCCH transmission occasion, and
- PDSCH group index field values that are different

Generate first HARQ-ACK information for PUCCH transmission occasion \( i(g) \) in a slot, as described in clause 9.1.3.1, where
- the first HARQ-ACK information corresponds only to detections of DCI formats each providing a same value of \( g \), of \( h(g) \), and to detections of DCI formats that do not provide a value of \( g \) and \( h(g) \) and are associated with a same value of \( g \), of \( h(g) \), and at least one of the DCI formats providing a value of \( k \) indicating the slot
- at least one of the DCI formats provides a \( h(g) \) value
- \( m=0 \) corresponds to a PDCCH monitoring occasion, where the UE detects a DCI format that provides a value of \( g \) or is associated with a value of \( g \), that is the first PDCCH monitoring occasion after a PDCCH monitoring occasion where the UE detects another DCI format that provides a value different than \( h(g) \)

The generation of the first HARQ-ACK information for PUCCH transmission occasion \( i(g) \) in a slot, as described in clause 9.1.3.1, excludes the generation of HARQ-ACK information for SPS PDSCH receptions.

If \( h^{(g+1) \bmod 2}(g)=\emptyset \) or \( h^{(g+1) \bmod 2}(g)=h((g+1) \bmod 2) \), generate second HARQ-ACK information for PUCCH transmission occasion \( i((g+1) \bmod 2) \) in a slot, as described in clause 9.1.3.1, where
- the second HARQ-ACK information corresponds to detections of DCI formats each providing a same value of \( (g+1) \bmod 2 \), of \( h((g+1) \bmod 2) \) and to detections of DCI formats that do not provide a value of \( (g+1) \bmod 2 \), of \( h((g+1) \bmod 2) \), but are associated with a same value of \( (g+1) \bmod 2 \), of \( h((g+1) \bmod 2) \)
- at least one of the DCI formats provides a \( h((g+1) \bmod 2) \) value
- \( m=0 \) corresponds to a PDCCH monitoring occasion, where the UE detects a DCI format that provides a value of \( (g+1) \bmod 2 \) or that is associated with a value of \( (g+1) \bmod 2 \), that is the first PDCCH monitoring occasion after a PDCCH monitoring occasion where the UE detects another DCI format that provides a value different than \( h((g+1) \bmod 2) \)
- the PUCCH transmission occasion \( i((g+1) \bmod 2) \) is a last one for multiplexing second HARQ-ACK information and it is not after PUCCH transmission occasion \( i(g) \)
- if \( V_{\mathrm{DAI}}^{(g+1) \bmod 2} \neq \emptyset \), after the completion of the \( c \) and \( m \) loops for the pseudo-code for the second HARQ-ACK codebook generation in clause 9.1.3.1, set \( V_{\text {temp } 2}=V_{D A I}^{(g+1) m o d 2} \). If the UE is provided PDSCHCodeBlockGroupTransmission for \( N_{\text {cells }}^{\text {DLCBG }} \) serving cells, set \( V_{\text {temp } 2}=V_{D A I}^{(g+1) \bmod 2} \) for both sub-codebooks before appending the second sub-codebook to the first sub-codebook.

If \( h^{(g+1) \bmod 2}(g) \neq \emptyset \) and \( h^{(g+1) \bmod 2}(g) \neq h((g+1) \bmod 2) \), generate second HARQ-ACK information as described in clause 9.1.3.1 by setting \( M=0 \) and, after the completion of the \( c \) and \( m \) loops for the pseudo-code for the second HARQ-ACK codebook generation in clause 9.1.3.1, setting \( V_{\text {temp } 2}=V_{D A I}^{(g+1) \bmod 2} \).

The generation of the second HARQ-ACK information for PUCCH transmission occasion \( i((g+1) \bmod 2) \) in a slot, as described in clause 9.1.3.1, excludes the generation of HARQ-ACK information for SPS PDSCH receptions.

If \( q=0 \), the UE
includes only the first HARQ-ACK information for multiplexing in PUCCH transmission occasion \( i(g) \)

ETSI