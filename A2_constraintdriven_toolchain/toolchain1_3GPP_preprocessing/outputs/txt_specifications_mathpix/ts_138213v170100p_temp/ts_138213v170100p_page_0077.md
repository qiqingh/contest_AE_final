<!-- Page 77 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
76
ETSI TS 138213 V17.1.0 (2022-05)

cell \( c \) or the active UL BWP change on the PCell where \( n_{0, k} \) is a DL slot with a smallest index among DL slots overlapping with UL slot \( n_{U}-K_{1, k} \), or subslotLengthForPUCCH is provided for the HARQ-ACK codebook and slot \( n_{0, k}+n_{D} \) overlaps with UL slot \( n_{U}-K_{1, k-1}, k>0 \),
```
    \( n_{D}=n_{D}+1 ; \)
else
    while \( r<\mathscr{C}(R) \)
```

        if the UE is not provided enableTimeDomainHARQ-Bundling and is provided tdd-UL-DL-
        ConfigurationCommon, or tdd-UL-DL-ConfigurationDedicated and, for each slot from slot \( n_{0, k}+ \)
        \( n_{D}-N_{\text {PDSCH }}^{\text {repeat,max }}+1 \) to slot \( n_{0, k}+n_{D} \), at least one symbol of the PDSCH time resource derived by
        row \( r \) is configured as UL where \( K_{1, k} \) is the \( k \)-th slot timing value in set \( K_{1} \), where \( n_{0, k} \) is a DL slot
        with a smallest index among DL slots overlapping with UL slot \( n_{U}-K_{1, k} \), or
        subslotLengthForPUCCH is provided for the HARQ-ACK codebook and the end of the PDSCH time
        resource for row \( r \) is not within any UL slot \( n_{U}-K_{1, l}, 0 \leq l<\mathscr{C}\left(K_{1}\right) \) or if PDSCH-
        TimeDomainResourceAllocationListForMultiPDSCH is provided and HARQ-ACK information for
        PDSCH time resource derived by row \( r \) in slot \( \left\lfloor\left(n_{U}-K_{1, k}\right) \cdot 2^{\mu_{D L}-\mu_{U L}}\right\rfloor+\left\lfloor\left(\frac{N_{\text {slot,offset }}^{U L}}{2^{\mu_{\text {offset }, U L}}}-\right.\right. \)
        \( \left.\left.\frac{N_{\text {slot, offset, } c}^{\text {DL }}}{2^{\mu_{\text {offset, } D L, c}}}\right) \cdot 2^{\mu_{D L}}\right]+n_{D} \) cannot be provided in slot \( n_{U} \)
            \( R=R \backslash r ; \)
        elseif the UE is provided enableTimeDomainHARQ-Bundling and tdd-UL-DL-ConfigurationCommon,
        or tdd-UL-DL-ConfigurationDedicated and, for each slot \( \left[\left(n_{U}-K_{1, k}\right) \cdot 2^{\mu_{D L}-\mu_{U L}}\right]+ \)
        \( \left\lfloor\left(\frac{N_{\text {slot, offset }}^{U L}}{2^{\mu_{\text {offset, } U L}}}-\frac{N_{\text {slot, offset, } c}^{\text {DL }}}{2^{\mu_{\text {Offset, } D L, c}}}\right) \cdot 2^{\mu_{D L}}\right\rfloor+n_{D}-\Delta K_{0, r}(d) \), at least one symbol of each PDSCH time
        resource derived by row \( r \) of set \( R^{\prime} \) is configured as UL, where \( d=0,1, \ldots, C\left(\Delta K_{0, r}\right)-1 \).
            \( R=R \backslash r ; \)
            \( R^{\prime}=R^{\prime} \backslash r ; \)
        else
            \( r=r+1 ; \)
        end if
    end while
if the UE does not indicate a capability to receive more than one unicast PDSCH or multicast PDSCH per
slot and \( R \neq \emptyset \),
\( M_{A, c}=M_{A, c} \cup j ; \)
\( j=j+1 ; \)
else

Set \( C(R) \) to the cardinality of \( R \)
Set \( m \) to the smallest last OFDM symbol index, as determined by the SLIV, among all rows of \( R \)
while \( R \neq \emptyset \)
Set \( r=0 \)
while \( r<\mathscr{C}(R) \)
if \( S \leq m \) for start OFDM symbol index \( S \) for row \( r \)

ETSI