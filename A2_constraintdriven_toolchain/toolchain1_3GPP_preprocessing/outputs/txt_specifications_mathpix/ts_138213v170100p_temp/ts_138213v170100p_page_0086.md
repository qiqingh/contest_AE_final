<!-- Page 86 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
85
ETSI TS 138213 V17.1.0 (2022-05)
- if, for an active DL BWP of a serving cell, the UE is not provided coresetPoollndex or is provided coresetPoollndex with value 0 for one or more first CORESETs and is provided coresetPoollndex with value 1 for one or more second CORESETs, and is provided ackNackFeedbackMode = joint, the serving cell is counted two times where the first time corresponds to the first CORESETs and the second time corresponds to the second CORESETS
- if the UE indicates type2-HARQ-ACK-Codebook, a serving cell is counted \( N_{\text {PDSCH }}^{\mathrm{MO}} \) times where \( N_{\text {PDSCH }}^{\mathrm{MO}} \) is the number of PDSCH receptions that can be scheduled for the serving cell by DCI formats in PDCCH receptions at a same PDCCH monitoring occasion based on the reported value of type2-HARQ-ACK-Codebook

Set \( M \) to the number of PDCCH monitoring occasion(s)
while \( m<M \)
Set \( c=0 \)-serving cell index: lower indexes correspond to lower RRC indexes of corresponding cell while \( c<N_{\text {cells }}^{\mathrm{DL}} \)
if PDCCH monitoring occasion \( m \) is before an active DL BWP change on serving cell \( c \) or an active UL BWP change on the PCell and an active DL BWP change is not triggered in PDCCH monitoring occasion \( m \)
\[
c=c+1 ;
\]
else
if there is a PDSCH providing a transport block for a HARQ process with enabled HARQ-ACK information on serving cell \( c \) associated with PDCCH in PDCCH monitoring occasion \( m \), or there is a PDCCH providing a DCI format associated with HARQ-ACK information without scheduling PDSCH reception on serving cell \( c \)
```
if \( V_{C-\mathrm{DAJ}, c, m}^{\mathrm{DL}} \leq V_{\text {temp }} \)
    \( \mathrm{j}=\mathrm{j}+1 \)
end if
\( V_{\text {temp }}=V_{C-\mathrm{DAI}, c, m}^{\mathrm{DL}} \)
if \( V_{\mathrm{T}-\mathrm{DAJ}, m}^{\mathrm{DL}}=\emptyset \)
    \( V_{\text {temp }, 2}=V_{C-\mathrm{DAI}_{1}, m}^{\mathrm{DL}} \)
else
    \( V_{\text {temp }, 2}=V_{T-\mathrm{DA}, m}^{\mathrm{DL}} \)
end if
```

if harq-ACK-SpatialBundlingPUCCH is not provided and the UE is configured by maxNrofCode WordsScheduledByDCI with reception of two transport blocks for at least one configured DL BWP of at least one serving cell,
```
\( \tilde{o}_{2 \cdot T_{D} \cdot j+2\left(V_{C-D A I, c, m}^{D L-1}\right)}^{A C K} \) = HARQ-ACK information bit corresponding to the first transport block of
    this cell
\( \tilde{o}_{2 \cdot T_{D} \cdot j+2\left(V_{C-D A I, c, m}^{D L}-1\right)+1}^{A C K}= \) HARQ-ACK information bit corresponding to the second transport
block of this cell
\( V_{s}=V_{s} \cup\left\{2 \cdot T_{D} \cdot j+2\left(V_{C-D A I, c, m}^{\mathrm{DL}}-1\right), 2 \cdot T_{D} \cdot j+2\left(V_{C-D A I, c, m}^{\mathrm{DL}}-1\right)+1\right\} \)
```

elseif harq-ACK-SpatialBundlingPUCCH is provided to the UE and \( m \) is a monitoring occasion for PDCCH with a DCI format that supports PDSCH reception with two transport blocks and the UE is configured by maxNrofCodeWordsScheduledByDCI with reception of two transport blocks in at least one configured DL BWP of a serving cell,

ETSI