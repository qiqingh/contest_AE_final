<!-- Page 91 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
90
ETSI TS 138213 V17.1.0 (2022-05)
- the UE determines a first HARQ-ACK sub-codebook based on each detected DCI format scheduling one PDSCH reception or having associated HARQ-ACK information without scheduling a PDSCH reception, or SPS PDSCH receptions, if any, and
- the UE determines a second HARQ-ACK sub-codebook based on each detected DCI format scheduling more than one PDSCH reception, and
- instead of generating one HARQ-ACK information bit per transport block for serving cell \( c \), the UE generates \( N_{\text {HARQ-ACK }}^{\max } \) HARQ-ACK information bits where \( N_{\text {HARQ-ACK }}^{\max } \) is the maximum value of \( N_{\text {TB }, c}^{\mathrm{DL}} \). \( N_{\text {PDSCH }, c}^{\max } \) across all \( N_{\text {cells }}^{\text {DL }} \) serving cells, \( N_{\text {PDSCH }, c}^{\max } \) is a maximum number of PDSCH receptions that can be scheduled by a DCI format on serving cell \( c \) as described in [6, TS 38.214], and \( N_{\mathrm{TB}, c}^{\mathrm{DL}} \) is the value of maxNrofCode WordsScheduledByDCI for serving cell \( c \) if harq-ACK-SpatialBundlingPUCCH is not provided; else, \( N_{\mathrm{TB}, c}^{\mathrm{DL}}=1 \). The UE generates the \( N_{\mathrm{HARQ} \text {-ACK }}^{\max } \) HARQ-ACK information bits in ascending order of the \( N_{\text {PDSCH }, C} \) PDSCHs, including any PDSCH that overlaps with UL symbols indicated by \( t d d \)-UL-DL-ConfigurationCommon, or by tdd-UL-DL-ConfigurationDedicated if provided. If, for serving cell \( c \), the UE detects a DCI format that schedules \( N_{\text {PDSCH }, c} \) PDSCH receptions and \( N_{\text {TB }, c}^{\mathrm{DL}} \cdot N_{\text {PDSCH }, c}<N_{\text {HARQ-ACK }}^{\text {max }} \), the UE generates NACK for the last \( N_{\text {HARQ-ACK }}^{\max }-N_{\text {TB }, c}^{\text {DL }} \cdot N_{\text {PDSCH }, c} \) HARQ-ACK information bits
- The pseudo-code operation when PDSCH-CodeBlockGroupTransmission is provided is not applicable.
- The counter DAI value and the total DAI value apply separately for each HARQ-ACK sub-codebook.
- The UE generates the HARQ-ACK codebook by appending the second HARQ-ACK sub-codebook to the first HARQ-ACK sub-codebook.

If a UE is provided numberOfHARQ-BundlingGroups and is not provided harq-ACK-SpatialBundlingPUCCH for a serving cell \( c \), the UE generates HARQ-ACK information over transport block groups (TBGs) for PDSCH receptions where, for a maximum number of \( N_{\text {PDSCH }}^{\max } \) PDSCH receptions scheduled by a DCI format on the serving cell, a maximum number of TBGs \( N_{\mathrm{HARQ}-\mathrm{ACK}, c}^{\mathrm{TBG}, \mathrm{max}} \) is provided by numberOfHARQ-BundlingGroups. If the UE detects a DCI format scheduling \( N_{\text {PDSCH }, c} \) PDSCH receptions on the serving cell \( c \), the UE generates \( N_{\text {HARQ-ACK }, c}^{\text {TBG, }} \) HARQ-ACK information bits for first TBs and, if applicable, generates \( N_{\text {HARQ-ACK }, c}^{\text {TBG }} \) HARQ-ACK information bits for second TBs in the \( N_{\mathrm{PDSCH}, c} \mathrm{PDSCH} \) receptions as described in clause 9.1.1 by setting \( N_{\mathrm{HARQ}-\mathrm{ACK}}^{\mathrm{CBG} / \mathrm{TB}, \mathrm{max}}=N_{\mathrm{HARQ}-\mathrm{ACK}, c}^{\mathrm{TBG}, \mathrm{max}} \) and \( C=N_{\mathrm{PDSCH}, c} \) For a TBG associated with at least one PDSCH that does not overlap with an UL symbol indicated by tdd-UL-DLConfigurationCommon, or by tdd-UL-DL-ConfigurationDedicated if provided, the UE assumes that TB(s) provided by a PDSCH that overlaps with an UL symbol indicated by tdd-UL-DL-ConfigurationCommon, or by tdd-UL-DLConfigurationDedicated if provided, are correctly received. For a TBG associated only with PDSCHs that overlap with UL symbols indicated by tdd-UL-DL-ConfigurationCommon, or by tdd-UL-DL-ConfigurationDedicated if provided, the UE generates a NACK value for the TBG.

If a UE is provided numberOfHARQ-BundlingGroups and harq-ACK-SpatialBundlingPUCCH for a serving cell \( c \), the UE generates HARQ-ACK information over PDSCH reception groups for PDSCH receptions scheduled by a DCI format on the serving cell \( c \) where a maximum number of PDSCH reception groups, \( N_{\text {HARQ-ACK }, c}^{\text {TBG, }} \), is provided by numberOfHARQ-BundlingGroups. If the UE detects a DCI format scheduling \( N_{\mathrm{PDSCH}, c} \mathrm{PDSCH} \) receptions on the serving cell \( c \), the UE generates \( N_{\text {HARQ-ACK }, c}^{\text {TBG }} \) HARQ-ACK information bits for the \( N_{\text {PDSCH }, c} \) PDSCH receptions as described in clause 9.1.1 by setting \( N_{\mathrm{HARQ}-\mathrm{ACK}}^{\mathrm{CBG} / \mathrm{TB}, \max }=N_{\mathrm{HARQ}-\mathrm{ACK}, c}^{\mathrm{TBG}, \max } \) and \( C=N_{\mathrm{PDSCH}, c} \) - For a PDSCH reception group associated with at least one PDSCH that does not overlap with an UL symbol indicated by tdd-UL-DLConfigurationCommon, or by tdd-UL-DL-ConfigurationDedicated if provided, the UE assumes that TBs provided by a PDSCH that overlaps with an UL symbol indicated by tdd-UL-DL-ConfigurationCommon, or by tdd-UL-DLConfigurationDedicated if provided, are correctly received. For a PDSCH reception group associated only with PDSCHs that overlap with UL symbols indicated by tdd-UL-DL-ConfigurationCommon, or by tdd-UL-DLConfigurationDedicated if provided, the UE generates a NACK value for the PDSCH reception group.

If a UE
- is provided PDSCH-TimeDomainResourceAllocationListForMultiPDSCH and, if provided, numberOfHARQBundlingGroups with value \( N_{\text {HARQ-ACK }}^{\text {TBG }}>1 \) for \( N_{\text {cells }}^{\text {DLTBG }} \) serving cells; and
- is not provided PDSCH-TimeDomainResourceAllocationListForMultiPDSCH or is provided numberOfHARQBundlingGroups with value \( N_{\mathrm{HARQ}-\mathrm{ACK}}^{\mathrm{TBG}}=1 \), for \( N_{\text {cells }}^{\mathrm{DL}, \mathrm{TB}} \) serving cells where \( N_{\text {cells }}^{\mathrm{DLTB}}+N_{\text {cells }}^{\mathrm{DLTBG}}=N_{\text {cells }}^{\mathrm{DL}} \)

ETSI