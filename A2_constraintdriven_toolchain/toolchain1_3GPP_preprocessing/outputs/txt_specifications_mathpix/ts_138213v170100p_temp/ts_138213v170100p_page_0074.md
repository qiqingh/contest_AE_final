<!-- Page 74 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
73
ETSI TS 138213 V17.1.0 (2022-05)

\( K_{1}=K_{1, T} ; \)
For the set of slot timing values \( K_{1} \), the UE determines a set of \( M_{A, C} \) occasions for candidate PDSCH receptions or SPS PDSCH releases or TCI state update according to the following pseudo-code. A location in the Type-1 HARQ-ACK codebook for HARQ-ACK information corresponding to a single SPS PDSCH release is same as for a corresponding SPS PDSCH reception. A location in the Type-1 HARQ-ACK codebook for HARQ-ACK information corresponding to multiple SPS PDSCH releases by a single DCI format is same as for a corresponding SPS PDSCH reception with the lowest SPS configuration index among the multiple SPS PDSCH releases. If a UE provides HARQ-ACK information corresponding to detection of a DCI format that provides TCI state update without scheduling PDSCH reception, as described in [6, TS 38.214], a location in the Type-1 HARQ-ACK codebook for the HARQ-ACK information is same as when the DCI format schedules a PDSCH reception with CBGs or with transport blocks that are correctly decoded.

Set \( j=0 \) - index of occasion for candidate PDSCH reception or SPS PDSCH release or TCI state update
Set \( B=\emptyset \)
Set \( M_{A, c}=\emptyset \)
Set \( \mathcal{C}\left(K_{1}\right) \) to the cardinality of set \( K_{1} \)
Set \( k=0 \)-index of slot timing values \( K_{1, k} \), in descending order of the slot timing values, in set \( K_{1} \) for serving cell \( c \)
If a UE is not provided ca-SlotOffset for any serving cell of PDSCH receptions and for the serving cell of corresponding PUCCH transmission with HARQ-ACK information
while \( k<\mathscr{C}\left(K_{1}\right) \)
if \( \bmod \left(n_{\mathrm{U}}-K_{1, k}+1, \max \left(2^{\mu_{\mathrm{UL}}-\mu_{\mathrm{DL}}}, 1\right)\right)=0 \) or subslotLengthForPUCCH is provided for the HARQ-ACK
codebook
Set \( n_{\mathrm{D}}=0 \) - index of a DL slot overlapping with an UL slot
Set \( N_{k} \) to a number of DL slots overlapping with UL slot \( n_{U}-K_{1, k} \) if subslotLengthForPUCCH is provided for the HARQ-ACK codebook; otherwise, \( N_{k}=\max \left(2^{\mu_{D L}-\mu_{U L}}, 1\right) \)
while \( n_{D}<N_{k} \)
if PDSCH-TimeDomainResourceAllocationListForMultiPDSCH and enableTimeDomainHARQ-Bundling are provided for serving cell \( c \)
\( R=R_{\mathrm{T}} ; \)
\( R^{\prime}=R_{T}^{\prime} ; \)
elseif PDSCH-TimeDomainResourceAllocationListForMultiPDSCH is provided and enableTimeDomainHARQ-Bundling is not provided for serving cell \( c \)
\( R=R_{\mathrm{T}} ; \)
else
Set \( R \) to the set of rows
end if
Set \( \mathscr{C}(R) \) to the cardinality of \( R \)
Set \( r=0 \) - index of row in set \( R \)
if slot \( n_{\mathrm{U}} \) starts at a same time as or after a slot for an active DL BWP change on serving cell \( c \) or an active UL BWP change on the PCell and slot \( n_{0, k}+n_{D} \) is before the slot for the active DL BWP change on serving cell \( c \) or the active UL BWP change on the PCell, or subslotLengthForPUCCH is provided for the HARQACK codebook and slot \( n_{0, k}+n_{D} \) overlaps with UL slot \( n_{U}-K_{1, k-1}, k>0 \), where \( n_{0, k} \) is a DL slot with a smallest index among DL slots overlapping with UL slot \( n_{U}-K_{1, k} \),

ETSI