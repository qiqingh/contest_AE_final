<!-- Page 70 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
69
ETSI TS 138213 V17.1.0 (2022-05)
- the last UL slot for PUCCH transmission overlapping with DL slot \( n_{D} \) if the UE is not provided subslotLengthForPUCCH for the HARQ-ACK codebook
and \( k \) is a number of slots indicated by the PDSCH-to-HARQ_feedback timing indicator field in a corresponding DCI format, or provided by dl-DataToUL-ACK or dl-DataToUL-ACK-r16 or dl-DataToUL-ACK-ForDCI-Formatl-2 if the PDSCH-to-HARQ_feedback timing indicator field is not present in the DCI format. If the UE reports HARQ-ACK information for the PDSCH reception in a slot other than slot \( n+k \), the UE sets a value for each corresponding HARQACK information bit to NACK.

If a UE reports HARQ-ACK information in a PUCCH only for
- a SPS PDSCH release indicated by DCI format \( 1 \_0 \) or by DCI format \( 4 \_1 \), with counter DAI field value of 1 , or
- a PDSCH reception scheduled by DCI format \( 1 \_0 \) or by DCI format \( 4 \_1 \) having enabled associated HARQ-ACK information report as described in clause 18, with counter DAI field value of 1 on the PCell, or
- SPS PDSCH receptions associated with a CS-RNTI or with G-CS-RNTIs having enabled associated HARQACK information reports as described in clause 18
within the \( M_{A, c} \) occasions for candidate PDSCH receptions as determined in clause 9.1.2.1, the UE determines a HARQACK codebook only for the SPS PDSCH release, or only for the PDSCH reception, or only for SPS PDSCH receptions according to corresponding \( M_{A, c} \) occasions on respective serving cells, where the value of counter DAI in DCI format \( 1 \_0 \) or in DCI format 4_1 is according to Table 9.1.3-1 and HARQ-ACK information bits in response to more than one SPS PDSCH receptions that the UE is configured to receive are ordered according to the following pseudo-code; otherwise, the procedures in clause 9.1.2.1 and clause 9.1.2.2 for a HARQ-ACK codebook determination apply.

In the following pseudo-code, SPS PDSCH receptions associated with a SPS PDSCH configuration are activated by a DCI format with CRC scrambled by a CS-RNTI or by a DCI format with CRC scrambled by a G-CS-RNTI.

Set \( N_{\text {cells }}^{\mathrm{DL}} \) to the number of serving cells configured to the UE
Set \( N_{\mathrm{c}}^{\text {SPS }} \) to the number of SPS PDSCH configurations configured to the UE for serving cell \( c \)
Set \( N_{\mathrm{c}}^{\mathrm{DL}} \) to the number of DL slots for SPS PDSCH receptions on serving cell \( c \) with HARQ-ACK information multiplexed on the PUCCH

Set \( j=0- \) HARQ-ACK information bit index
Set \( c=0 \)-serving cell index: lower indexes correspond to lower RRC indexes of corresponding cell
while \( c<N_{\text {cells }}^{\mathrm{DL}} \)
Set \( s=0 \)-SPS PDSCH configuration index: lower indexes correspond to lower RRC indexes of corresponding
SPS configurations
while \( s<N_{\mathrm{c}}^{\text {SPS }} \)
Set \( n_{D}=0- \) slot index
while \( n_{D}<N_{\mathrm{c}}^{\text {DL }} \)
if \{
a UE is configured to receive SPS PDSCHs from slot \( n_{D}-N_{\text {PDSCH }}^{\text {repeat }}+1 \) to slot \( n_{D} \) for SPS PDSCH configuration \( s \) on serving cell \( c \), excluding SPS PDSCHs that are not required to be received in any slot among overlapping SPS PDSCHs, if any according to [6, TS 38.214], or based on a UE capability for a number of PDSCH receptions in a slot according to [6, TS 38.214], or due to overlapping with a set of symbols indicated as uplink by tdd-UL-DL-ConfigurationCommon or by tdd-UL-DL-ConfigurationDedicated where \( N_{\text {PDSCH }}^{\text {repeat }} \) is provided by pdsch-AggregationFactor\( r 16 \) in sps-Config or, if pdsch-AggregationFactor-r16 is not included in sps-Config, by pdschAggregationFactor in pdsch-config, and

HARQ-ACK information for the SPS PDSCH is associated with the PUCCH
\}

ETSI