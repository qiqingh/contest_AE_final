<!-- Page 73 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
72
ETSI TS 138213 V17.1.0 (2022-05)

the UE generates a Type-1 HARQ-ACK codebook for the set \( S_{\mathrm{U}} \) and the set \( S_{\mathrm{M}} \) of serving cells separately by setting \( N_{\text {cells }}^{\mathrm{DL}}=N_{\text {cells }}^{\mathrm{DL}, \mathrm{U}} \) and \( N_{\text {cells }}^{\mathrm{DL}}=N_{\text {cells }}^{\mathrm{DL}, \mathrm{M}} \) in the following pseudo-code. The UE concatenates the HARQ-ACK codebook generated for the set \( S_{\mathrm{U}} \) followed by the HARQ-ACK codebook generated for the set \( S_{\mathrm{M}} \) to obtain a total number of \( O_{\text {ACK }} \) HARQ-ACK information bits.

If the UE is configured to monitor PDCCH for DCI formats with CRC scrambled by G-RNTI or G-CS-RNTI and is provided typel-Codebook-Generation-Mode \( = \) 'model', the UE separately applies the following pseudo-code for each of the first \( K_{1, \mathrm{UM}} \) set, the second \( K_{1, \mathrm{U} \backslash \mathrm{M}} \) set, and third \( K_{1, \mathrm{M} \backslash \mathrm{U}} \) set as the set of slot timing values \( K_{1} \), and for the corresponding sets of row indexes as \( R \) to obtain first, second, and third Type-1 HARQ-ACK sub-codebooks, and concatenates the first, second, and third, Type-1 HARQ-ACK sub-codebooks to obtain the Type-1 HARQ-ACK codebook.

If enableTimeDomainHARQ-Bundling is provided
- \( \quad \operatorname{set} R_{T}^{\prime}=R \)
- set \( R_{T} \) to the set of row indexes that include the last SLIV of each row of set \( R_{T}^{\prime} \)

If the set of rows \( R \) includes a row with more than one SLIV entry as described in [6, TS 38.214] and enableTimeDomainHARQ-Bundling is not provided, the set of rows \( R \) and the set of slot timing values \( K_{1} \) are updated in this clause according to the following pseudo-code.
set \( R \) to the set of rows
set \( C(R) \) to the cardinality of \( R \)
set \( r=0 \) - index of row in set \( R \)
set \( R_{T}=\emptyset \)
set \( K_{1, T}=\emptyset \)
while \( r<\mathscr{C}(R) \)
set \( P_{r} \) to the set of entries for row \( r \)
set \( K_{0, r} \) to the set of \( K_{0} \) values of entries for row \( r \)
set \( \Delta K_{0, r}=\max _{K_{0}}\left(K_{0, r}\right)-K_{0, r} \)
set \( C\left(P_{r}\right) \) to the cardinality of \( P_{r} \)
set \( \mathcal{C}\left(\Delta K_{0, r}\right) \) to the cardinality of \( \Delta K_{0, r} \)
set \( p=0 \) - index of element in \( P_{r} \) set \( d=0 \) - index of element in \( \Delta K_{0, r} \)
while \( p<\mathscr{C}\left(P_{r}\right) \)
\[
\begin{array}{l}
R_{T}=R_{T} \cup P_{r}(p) \\
p=p+1
\end{array}
\]
end while
while \( d<\mathscr{C}\left(\Delta K_{0, r}\right) \)
\[
K_{1, T}=K_{1, T} \cup\left(K_{1}+\left[\Delta K_{0, \mathrm{r}}(d) \cdot 2^{\mu_{\mathrm{UL}}-\mu_{\mathrm{DL}}}\right]\right) \cup\left(K_{1}+\left\lfloor\Delta K_{0, \mathrm{r}}(d) \cdot 2^{\mu_{\mathrm{UL}}-\mu_{\mathrm{DL}}}\right\rfloor\right) ;
\]
\[
d=d+1 ;
\]
end while
\( r=r+1 ; \)
end while

ETSI