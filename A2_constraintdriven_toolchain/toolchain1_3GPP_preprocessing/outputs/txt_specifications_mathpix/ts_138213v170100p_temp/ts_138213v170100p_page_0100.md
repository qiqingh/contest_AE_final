<!-- Page 100 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
99
ETSI TS 138213 V17.1.0 (2022-05)

end while
\[
\begin{array}{l}
h=0 \\
c=c+1
\end{array}
\]
end while
If \( N_{\mathrm{TB}, c}^{\mathrm{DL}}>1 \), when a UE receives a PDSCH with one transport block, the HARQ-ACK information is associated with the first transport block.

If a UE receives a SPS PDSCH, or a PDSCH that is scheduled by a DCI format that does not support CBG-based PDSCH receptions for a serving cell \( c \), and if maxCodeBlockGroupsPerTransportBlock is provided for serving cell \( c \), and pdsch-HARQ-ACK-OneShotFeedbackCBG or pdsch-HARQ-ACK-enhType3CBG is provided, the UE repeats \( N_{\text {HARQ-ACK }, c}^{\text {CBG/TB } \text { max }} \) times the HARQ-ACK information for the transport block, if any, in the PDSCH.

If a UE detects a DCI format that includes a One-shot HARQ-ACK request field with value 1 , the UE determines a PUCCH or a PUSCH to multiplex a Type-3 HARQ-ACK codebook for transmission in a slot as described in clauses 9.2.3 and 9.2.5. If the UE is provided a periodic cell switching pattern for PUCCH transmissions by pucchsSCellPattern, the UE determines the slot and a corresponding cell based on the periodic cell switching pattern as described in clause 9. A. The UE multiplexes only the Type-3 HARQ-ACK codebook in the PUCCH or the PUSCH for transmission in the slot.

If
- a UE detects a DCI format that includes a One-shot HARQ-ACK request field with value 1 , and
- the CRC of the DCI is scrambled by a C-RNTI or an MCS-C-RNTI, and
- resourceAllocation \( = \) resourceAllocationType0 and all bits of the frequency domain resource assignment field in the DCI format are equal to 0 , or
- resourceAllocation \( = \) resourceAllocationTypel and all bits of the frequency domain resource assignment field in the DCI format are equal to 1 , or
- resourceAllocation = dynamicSwitch and all bits of the frequency domain resource assignment field in the DCI format are equal to 0 or 1
the DCI format provides a request for a Type-3 HARQ-ACK codebook report and does not schedule a PDSCH reception. If the UE is provided pdsch-HARQ-ACK-enhType3List and the DCI format includes a Type3-subcodebookindex field that provides a value for pdsch-HARQ-ACK-enhType3Index, the UE determines a number of indicated serving cells \( N_{\text {cells }}^{\text {DL ind }} \) and a number of indicated HARQ processes \( N_{\text {HARQ } c}^{\text {DL }} \) for each indicated serving cell \( c \) from the entry in pdsch-HARQ-ACK-enhType3List corresponding to the pdsch-HARQ-ACK-enhType3Index value. If the DCI format does not include the Type3-subcodebook-index field, the pdsch-HARQ-ACK-enhType3Index value is provided by the value of MCS field in the DCI format. The UE is expected to provide HARQ-ACK information in response to the request for the Type-3 HARQ-ACK codebook after \( N \) symbols from the last symbol of a PDCCH providing the DCI format, where the value of \( N \) for \( \mu=0,1,2 \) is provided in clause 10.2 by replacing "SPS PDSCH release" with "DCI format".

If a UE multiplexes HARQ-ACK information in a PUSCH transmission, the UE generates the HARQ-ACK codebook as described in this clause except that harq-ACK-SpatialBundlingPUCCH is replaced by harq-ACKSpatialBundlingPUSCH.
9.1.5 HARQ-ACK codebook retransmission

With reference to slots of PUCCH transmissions on the primary cell and for Type-1 or Type-2 HARQ-ACK codebooks, a UE that transmitted or would transmit a PUCCH or a PUSCH with a first HARQ-ACK codebook in slot \( m \) can be indicated by a DCI format with CRC scrambled by a C-RNTI or a MCS-C-RNTI that does not schedule a PDSCH reception [4, TS 38.212] and is received in a PDCCH ending in slot \( n \), to transmit a PUCCH with the first HARQ-ACK codebook in slot \( n+k \), where slot \( n+k \) is after slot \( m \). The UE determines \( k \) and a resource for the PUCCH transmission as described in clauses 9.23 and 9.2.5. If the UE is provided a periodic cell switching pattern for PUCCH transmissions by pucch-sSCellPattern, the UE further determines a corresponding cell based on the periodic cell switching pattern as described in clause 9.A.

ETSI