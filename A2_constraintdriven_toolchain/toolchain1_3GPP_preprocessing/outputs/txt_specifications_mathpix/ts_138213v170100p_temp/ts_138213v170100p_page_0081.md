<!-- Page 81 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
80
ETSI TS 138213 V17.1.0 (2022-05)
\[
j=j+1
\]
elseif PDSCH-CodeBlockGroupTransmission is provided, and \( N_{\mathrm{HARQ}-\mathrm{ACK}, c}^{\mathrm{CBG} / \mathrm{TB} \text { max }} \) CBGs are indicated by maxCodeBlockGroupsPerTransportBlock for serving cell \( c \),

Set \( n_{\text {CBG }}=0- \) CBG index
while \( n_{\mathrm{CBG}}<N_{\mathrm{HARQ}-\mathrm{ACK}_{1} \mathrm{c}}^{\mathrm{CBG} / \mathrm{TB}_{1} \text { max }} \)
\( \tilde{o}_{j+n_{\text {CBG }}}^{A C K}= \) HARQ-ACK information bit corresponding to CBG \( n_{\text {CBG }} \) of the first transport block;
if the UE is configured by maxNrofCodeWordsScheduledByDCI with reception of two transport blocks for the active DL BWP of serving cell \( c \)
\( \tilde{o}_{j+n_{\text {CBG }}+N_{\text {HARQ-ACK }, c}^{\text {CBG } / \text { TB, } \max }}^{\text {ACK }}= \) HARQ-ACK information bit corresponding to CBG \( n_{\text {CBG }} \) of the second transport block;
end if
\[
n_{\mathrm{CBG}}=n_{\mathrm{CBG}}+1
\]
end while
\( j=j+N_{\mathrm{TB}, c}^{\mathrm{DL}} \cdot N_{\mathrm{HARQ}-\mathrm{ACK}_{1} c}^{\mathrm{CBG} / \mathrm{TB}_{1} \max } \), where \( N_{\mathrm{TB}, c}^{\mathrm{DL}} \) is the value of maxNrofCodeWordsScheduledByDCI for the active DL BWP of serving cell \( c \);
else
\( \tilde{o}_{j}^{A C K}= \) HARQ-ACK information bit of serving cell \( c \);
\( j=j+1 ; \)
end if
end if
\( m=m+1 ; \)
end while
\( c=c+1 ; \)
end while
If \( O_{\mathrm{ACK}}+O_{\mathrm{SR}}+O_{\mathrm{CSI}} \leq 11 \), the UE determines a number of HARQ-ACK information bits \( n_{\mathrm{HARQ}-\mathrm{ACK}} \) for obtaining a transmission power for a PUCCH, as described in clause 7.2.1, as \( n_{\text {HARQ-ACK }}=\sum_{c=0}^{N_{\text {cells }}^{\text {DL }} \sum_{m=0}^{M_{c}-1} N_{m, c}^{\text {received }}}+ \sum_{c=0}^{N_{\text {cells }}^{\mathrm{DL}}{ }^{-1}} \sum_{m=0}^{M_{c}-1} N_{m, c}^{\text {received, CBG }} \) where
- \( \quad N_{\text {cells }}^{\text {DL }} \) are all DL cells where the UE is configured to receive unicast or multicast PDSCHs
- \( M_{c} \) is the cardinality for the union of all sets \( M_{A, C} \) of occasions for unicast or multicast PDSCH receptions or SPS PDSCH releases for serving cell \( c \)
- \( \quad N_{m, c}^{\text {received }} \) is the number of transport blocks the UE receives in PDSCH reception occasion \( m \) for serving cell \( c \) if harq-ACK-SpatialBundlingPUCCH and PDSCH-CodeBlockGroupTransmission are not provided, or the number of transport blocks the UE receives in PDSCH reception occasion \( m \) for serving cell \( c \) if PDSCHCodeBlockGroupTransmission is provided and the PDSCH reception is scheduled by a DCI format that does not support CBG-based PDSCH receptions, or the number of PDSCH receptions if harq-ACKSpatialBundlingPUCCH is provided or SPS PDSCH release or TCI state update in PDSCH reception occasion \( m \) for serving cell \( c \) and the UE reports corresponding HARQ-ACK information in the PUCCH.

ETSI