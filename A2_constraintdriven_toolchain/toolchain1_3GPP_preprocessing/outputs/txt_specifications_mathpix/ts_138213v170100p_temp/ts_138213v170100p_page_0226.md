<!-- Page 226 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
225
ETSI TS 138213 V17.1.0 (2022-05)
```
while \( n_{S}<\max \left(2^{\mu_{\mathrm{SL}}-\mu_{\mathrm{UL}}}, 1\right) \)
```

if slot \( n_{U} \) starts at a same time as or after a slot for an active UL BWP change on the PCell and slot \( \left\lfloor\left(n_{U}-K_{1, k}\right) \cdot 2^{\mu_{\mathrm{SL}}-\mu_{\mathrm{UL}}}\right\rfloor+n_{S} \) is before the slot for the active UL BWP change on the PCell
\[
n_{S}=n_{S}+1 ;
\]
else
if slot \( \left\lfloor\left(n_{U}-K_{1, k}\right) \cdot 2^{\mu_{\mathrm{SL}}-\mu_{\mathrm{UL}}}\right\rfloor+n_{S} \) belongs to the sidelink resource pool and includes PSFCH resources as indicated by a sidelink resource pool bitmap and sl-PSFCH-Period, where \( K_{1, k} \) is the \( k \)-th slot timing value in set \( K_{1} \)

Set \( n_{F}=0- \) index of a SL slot within an PSFCH period
while \( n_{F}<N_{\text {PSFCH }} \)
\[
M_{A}=M_{A} \cup j
\]
\[
n_{F}=n_{F}+1
\]
end while
end if
\[
n_{S}=n_{S}+1 ;
\]
end if
end while
end if
\( k=k+1 ; \)
end while
The cardinality of the set \( M_{A} \) defines a total number \( M \) of occasions for candidate PSSCH transmissions with corresponding PSFCH reception occasions corresponding to the HARQ-ACK information bits. A UE determines \( \tilde{o}_{0}^{A C K}, \tilde{o}_{1}^{A C K}, \ldots, \tilde{o}_{O_{\mathrm{ACK}}-1}^{A C K} \) HARQ-ACK information bits, for a total number of \( O_{\text {ACK }} \) HARQ-ACK information bits as \( \tilde{o}_{j}^{A C K}= \) HARQ-ACK information bit for candidate PSSCH transmission with index \( j \) with corresponding PSFCH reception, for \( 0 \leq j<M \), as described in clause 16.5. If the UE does not transmit a PSSCH in an occasion for candidate PSSCH transmission with corresponding PSFCH reception occasion, due to the UE not detecting a corresponding DCI format \( 3 \_0 \), the UE generates a NACK value for the occasion for candidate PSSCH transmission with corresponding PSFCH reception occasion.

If \( O_{\mathrm{ACK}} \leq 11 \), the UE determines a number of HARQ-ACK information bits \( n_{\mathrm{HARQ}-\mathrm{ACK}} \) for obtaining a transmission power for a PUCCH, as described in clause 7.2.1, as \( n_{\text {HARQ-ACK }}=\sum_{\mathrm{m}=0}^{\mathrm{M}-1} N_{\mathrm{m}}^{\text {received }} \) where \( N_{m}^{\text {received }} \) is a number of HARQ-ACK information bits determined for corresponding PSSCH transmissions with corresponding PSFCH reception occasions in PSFCH reception occasion \( m \).
16.5.1.2 Type-1 HARQ-ACK codebook in physical uplink shared channel

If a UE would multiplex HARQ-ACK information in a PUSCH transmission that is not scheduled by a DCI format or is scheduled by a DCI format without an SAI field, then
- if the UE
- has not received any PDCCH with a DCI format \( 3 \_0 \) scheduling PSSCH transmissions with corresponding PSFCH reception occasions that the UE transmits corresponding HARQ-ACK information in the PUSCH, based on a value of a respective PSFCH-to-HARQ_feedback timing indicator field in a DCI format

ETSI