<!-- Page 90 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
89
ETSI TS 138213 V17.1.0 (2022-05)
- a DCI format having associated HARQ-ACK information without scheduling PDSCH reception,
- TCI state update, and
- TB-based PDSCH receptions on the \( N_{\text {cells }}^{\text {DL,CBG }} \) serving cells and on the \( N_{\text {cells }}^{\text {DL,TB }} \) serving cells,
- \( \quad N_{\text {cells }}^{\text {DL }} \) is replaced by \( N_{\text {cells }}^{\text {DL,CBG }} \) for the determination of a second HARQ-ACK sub-codebook corresponding to the \( N_{\text {cells }}^{\text {DL, CBG }} \) serving cells for CBG-based PDSCH receptions, and
- if, for an active DL BWP of a serving cell, the UE is not provided coresetPoollndex or is provided coresetPoollndex with value 0 for one or more first CORESETs and is provided coresetPoollndex with value 1 for one or more second CORESETs, and is provided ackNackFeedbackMode = joint, the serving cell is counted as two times where the first time corresponds to the first CORESETs and the second time corresponds to the second CORESETs, and
- instead of generating one HARQ-ACK information bit per transport block for a serving cell from the \( N_{\text {cells }}^{\text {DL }} \) serving cells, the UE generates \( N_{\text {HARQ-ACK, max }}^{\mathrm{CBG} / \mathrm{TB} / \max } \) HARQ-ACK information bits, where \( N_{\text {HARQ-ACK, max }}^{\mathrm{CBG} / \mathrm{TB} / \max } \) is the maximum value of \( N_{\mathrm{TB}, c}^{\mathrm{DL}} \cdot N_{\mathrm{HARQ}-\mathrm{ACK}, c}^{\mathrm{CBG} / \mathrm{TB}, \max } \) across all \( N_{\text {cells }}^{\mathrm{DL}, \mathrm{CBG}} \) serving cells and \( N_{\mathrm{TB}, c}^{\mathrm{DL}} \) is the value of maxNrofCodeWordsScheduledByDCI for serving cell \( c \). If for a serving cell \( c \) it is \( N_{\mathrm{TB}, c}^{\mathrm{DL}} \cdot N_{\mathrm{HARQ}-\mathrm{ACK}, c}^{\mathrm{CBG} / \mathrm{TB} \text { max }}< N_{\text {HARQ-ACK, max, }}^{\mathrm{CBG} / \mathrm{TB}, \mathrm{max}_{2}} \), the UE generates NACK for the last \( N_{\text {HARQ-ACK, max }}^{\mathrm{CBG} / \mathrm{TB}, \max }-N_{\mathrm{TB}, c}^{\mathrm{DL}} \cdot N_{\text {HARQ-ACK }, c}^{\mathrm{CBG} / \mathrm{TB}, \max } \) HARQ-ACK information bits for serving cell \( c \)
- the pseudo-code operation when harq-ACK-SpatialBundlingPUCCH is provided is not applicable
- The counter DAI value and the total DAI value apply separately for each HARQ-ACK sub-codebook
- The UE generates the HARQ-ACK codebook by appending the second HARQ-ACK sub-codebook to the first HARQ-ACK sub-codebook

If \( O_{\mathrm{ACK}}+O_{\mathrm{SR}}+O_{\mathrm{CSI}} \leq 11 \), the UE also determines \( n_{\text {HARQ-ACK }}=n_{\text {HARQ-ACK,TB }}+n_{\text {HARQ-ACK,CBG }} \) for obtaining a PUCCH transmission power, as described in clause 7.2.1, with
\[
n_{\text {HARQ-ACK,CBG }, \mathrm{CBG}}=\left(\left(V_{\mathrm{DAI}, m_{\text {last }}}^{\mathrm{DL}}-\sum_{c=0}^{N_{\text {cells }}^{\mathrm{DL}, \mathrm{CBG}}}-1 U_{\mathrm{DAI}, c}^{\mathrm{CBG}}\right) \bmod \left(T_{D}\right)\right) N_{\mathrm{HARQ}-\mathrm{ACK}, \max }^{\mathrm{CBG} / \mathrm{TB}, \max }+\sum_{c=0}^{N_{\text {cells }}^{\mathrm{DL}}-1} \sum_{m=0}^{M-1} N_{m, c}^{\text {received,CBG }}
\]
where
- if \( N_{\text {cells }}^{\mathrm{DL}}=1, V_{\mathrm{DAI}, m_{\text {last }}}^{\mathrm{DL}} \) is the value of the counter DAI in the last DCI format scheduling CBG-based PDSCH reception that the UE detects within the \( M \mathrm{PDCCH} \) monitoring occasions
- if \( N_{\text {cells }}^{\mathrm{DL}}>1, V_{\mathrm{DAI}, m_{\text {last }}}^{\mathrm{DL}} \) is the value of the total DAI in the last DCI format scheduling CBG-based PDSCH reception for any serving cell \( c \) that the UE detects within the \( M \mathrm{PDCCH} \) monitoring occasions
- \( V_{\mathrm{DAL}, m_{\text {last }}}^{\mathrm{DL}}=0 \), if the UE does not detect any DCI format scheduling CBG-based PDSCH reception for any serving cell \( c \) in any of the \( M \) PDCCH monitoring occasions
- \( U_{\mathrm{DAL}, C}^{\mathrm{CBG}} \) is the total number of DCI formats scheduling CBG-based PDSCH receptions that the UE detects within the \( M \mathrm{PDCCH} \) monitoring occasions for serving cell \( c . U_{\mathrm{DAI}, c}^{\mathrm{CBG}}=0 \) if the UE does not detect any DCI format scheduling CBG-based PDSCH reception for serving cell \( c \) in any of the \( M \) PDCCH monitoring occasions
- \( N_{m, c}^{\text {received, }{ }^{\text {CBG }}} \) is the number of CBGs the UE receives in a PDSCH scheduled by a DCI format that supports CBG-based PDSCH reception that the UE detects in PDCCH monitoring occasion \( m \) for serving cell \( c \) and the UE reports corresponding HARQ-ACK information in the PUCCH

If a UE is not provided numberOfHARQ-BundlingGroups, detects a first DCI format scheduling one PDSCH reception or having associated HARQ-ACK information without scheduling a PDSCH reception, if any, and a second DCI format scheduling more than one PDSCH reception on a serving cell from the \( N_{\text {cells }}^{\text {DL }} \) serving cells, if any, and the UE would provide corresponding HARQ-ACK information in a same PUCCH, the UE determines the \( \tilde{o}_{0}^{\text {ACK }}, \tilde{o}_{1}^{\text {ACK }}, \cdots, \tilde{o}_{o_{\text {ACK }}-1}^{\text {ACK }} \) according to the previous pseudo-code with the following modifications

ETSI