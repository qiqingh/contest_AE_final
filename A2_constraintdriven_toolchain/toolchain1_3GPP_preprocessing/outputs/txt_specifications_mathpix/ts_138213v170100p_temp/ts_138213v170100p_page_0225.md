<!-- Page 225 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
224
ETSI TS 138213 V17.1.0 (2022-05)

If a UE is configured a SL configured grant Type 1, and the UE is configured a SL configured grant Type 2 or to monitor PDCCH for detection of DCI format \( 3 \_0 \) with CRC scrambled by SL-RNTI or SL-CS-RNTI, and the UE is provided a set of slot timing values \( K_{1} \) associated with a SL BWP by sl-PSFCH-ToPUCCH and sl-PSFCH-ToPUCCH-CG-Typel, the sl-PSFCH-ToPUCCH-CG-Typel is one of sl-PSFCH-ToPUCCH.
A UE reports HARQ-ACK information for PSSCH transmissions with corresponding PSFCH reception occasions in slot \( n \) only in a HARQ-ACK codebook that the UE includes in a PUCCH or PUSCH transmission in slot \( n+k \), where \( k \) is a number of slots indicated by the PSFCH-to-HARQ_feedback timing indicator field in a DCI format \( 3 \_0 \) scheduling the PSSCH transmissions, or by a value of PSFCH-to-HARQ feedback timing indicator field in a DCI format \( 3-0 \) activating a SL configured grant Type-2 transmission, or by a value of sl-PSFCH-ToPUCCH-CG-Typel for a SL configured grant Type-1. If the UE reports HARQ-ACK information for the PSSCH transmissions with corresponding PSFCH reception occasions in a slot other than slot \( n+k \), the UE sets a value for each corresponding HARQ-ACK information bit to NACK.

If a UE reports HARQ-ACK information in a PUCCH only for
- PSFCH reception occasions associated with PSSCH transmissions scheduled by a DCI format \( 3 \_0 \) with counter SAI field value of 1 , or
- PSFCH reception occasions associated with PSSCH transmissions corresponding to a SL configured grant
within a set \( M_{A} \) of occasions for candidate PSSCH transmissions with corresponding PSFCH reception occasions as determined in clause 16.5.1.1, the UE determines a HARQ-ACK codebook only for the PSFCH reception occasion associated with PSSCH transmissions scheduled by DCI format \( 3 \_0 \) or only for the PSFCH reception occasion associated with PSSCH transmissions corresponding to a SL configured grant according to corresponding set \( M_{A} \) of occasions, where a value of a counter SAI in DCI format \( 3-0 \) is according to Table 16.5.2.1-1. Otherwise, the procedures in clause 16.5.1.1 and in clause 16.5.1.2 for a HARQ-ACK codebook determination apply.
16.5.1.1 Type-1 HARQ-ACK codebook in physical uplink control channel

For a SL BWP on a carrier, and an active UL BWP on the primary cell, as described in clause 12, a UE determines a set \( M_{A} \) of occasions for candidate PSSCH transmissions with corresponding PSFCH reception occasions for which the UE can multiplex corresponding HARQ-ACK information in a PUCCH transmission in slot \( n_{U} \). The determination is based on:
a) a set of slot timing values \( K_{1} \) associated with the SLBWP where \( K_{1} \) is provided by sl-PSFCH-ToPUCCH for DCI format \( 3 \_0 \) or by sl-PSFCH-ToPUCCH-CG-Typel
b) the ratio \( 2^{\mu_{\mathrm{SL}}-\mu_{\mathrm{UL}}} \) between the sidelink SCS configuration \( \mu_{\mathrm{SL}} \) and the uplink SCS configuration \( \mu_{\mathrm{UL}} \) provided by subcarrierSpacing in sl-BWP-Config and BWP-Uplink for the SL BWP and the active UL BWP, respectively
c) a configured sidelink resource pool bitmap
d) a value of a period of PSFCH transmission occasion resources for a sidelink resource pool provided by a respective \( s l \)-PSFCH-Period

For the set of slot timing values \( K_{1} \), the UE determines a set \( M_{A} \) of occasions for candidate PSSCH transmissions with corresponding PSFCH reception occasions according to the following pseudo-code.

Set \( j=0 \) - index of occasion for candidate PSSCH transmissions with corresponding PSFCH reception occasions
Set \( M_{A}=\emptyset \)
Set \( c\left(K_{1}\right) \) to the cardinality of set \( K_{1} \)
Set \( k=0 \)-index of slot timing values \( K_{1, k} \), in descending order of the slot timing values, in set \( K_{1} \)
Set \( N_{\text {PSFCH }} \) to the value of the period of PSFCH transmission occasion resources for the sidelink resource pool
while \( k<\mathscr{C}\left(K_{1}\right) \)
if \( \bmod \left(n_{U}-K_{1, k}+1, \max \left(2^{\mu_{\text {UL }}-\mu_{\text {SL }}}, 1\right)\right)=0 \)
Set \( n_{S}=0 \) - index of a SL slot within an UL slot

ETSI