<!-- Page 76 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
75
ETSI TS 138213 V17.1.0 (2022-05)
```
                                \( r=r+1 ; \)
                            end if
                        end while
                        \( M_{A, c}=M_{A, c} \cup j \)
                        \( j=j+1 \);
                        Set \( m \) to the smallest last OFDM symbol index among all rows of \( R \);
                    end while
                end if
                \( n_{D}=n_{D}+1 ; \)
            end if
        end while
    end if
    \( k=k+1 ; \)
end while
else
while \( k<\mathcal{C}\left(K_{1}\right) \)
    if \( \bmod \left(n_{U}-K_{1, k}+\left\lfloor\left(\frac{N_{\text {slot }, \text { offset }}^{U L}}{2^{\mu_{\text {offset }, U L}}}-\frac{N_{\text {slot }, \text { offset }, c}^{\text {DL }}}{2^{\mu_{\text {offset }, D L, c}}}\right) \cdot 2^{\mu_{U L}}\right\rfloor+1, \max \left(2^{\mu_{U L}-\mu_{D L}}, 1\right)\right)=0 \) or subslotLengthForPUCCH
        is provided for the HARQ-ACK codebook
        Set \( n_{\mathrm{D}}=0 \) - index of a DL slot overlapping with an UL slot
        Set \( N_{k} \) to a number of DL slots overlapping with UL slot \( n_{U}-K_{1, k} \) if subslotLengthForPUCCH is provided for
        the HARQ-ACK codebook; otherwise, \( N_{k}=\max \left(2^{\mu_{D L}-\mu_{U L}}, 1\right) \)
        while \( n_{D}<N_{k} \)
            if PDSCH-TimeDomainResourceAllocationListForMultiPDSCH and enableTimeDomainHARQ-Bundling are
            provided for serving cell \( c \)
                \( R=R_{\mathrm{T}} ; \)
                \( R^{\prime}=R_{T}^{\prime} ; \)
            elseif PDSCH-TimeDomainResourceAllocationListForMultiPDSCH is provided and
            enableTimeDomainHARQ-Bundling is not provided for serving cell \( c \)
                \( R=R_{\mathrm{T}} ; \)
            else
                Set \( R \) to the set of rows
            end if
            Set \( \mathcal{C}(R) \) to the cardinality of \( R \)
            Set \( r=0 \) - index of row in set \( R \)
            if slot \( n_{U} \) starts at a same time as or after a slot for an active DL BWP change on serving cell \( c \) or an active
            UL BWP change on the PCell and slot \( n_{0, k}+n_{D} \) is before the slot for the active DL BWP change on serving
```


ETSI