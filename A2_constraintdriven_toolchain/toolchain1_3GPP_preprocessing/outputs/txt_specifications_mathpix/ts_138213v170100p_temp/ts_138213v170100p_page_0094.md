<!-- Page 94 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
93
ETSI TS 138213 V17.1.0 (2022-05)

PDSCH reception to multiplex in the PUSCH, as described in clause 9.1.3.1, the UE does not multiplex HARQACK information in the PUSCH transmission;
- else, the UE generates the HARQ-ACK codebook as described in clause 9.1.3.1, except that harq-ACKSpatialBundlingPUCCH is replaced by harq-ACK-SpatialBundlingPUSCH.

If a UE multiplexes HARQ-ACK information in a PUSCH transmission that is scheduled by a DCI format that includes a DAI field, the UE generates the HARQ-ACK codebook as described in clause 9.1.3.1, with the following modifications:
- For the pseudo-code for the HARQ-ACK codebook generation in clause 9.1.3.1, after the completion of the \( c \) and \( m \) loops, the UE sets \( V_{\text {temp } 2}=V_{\mathrm{T}-\mathrm{DA}}^{\mathrm{UL}} \) where \( V_{\mathrm{T}-\mathrm{DA}}^{\mathrm{UL}} \) is the value of the DAI field according to Table 9.1.3-2
- For the case of first and second HARQ-ACK sub-codebooks, the DCI format includes a first DAI field corresponding to the first HARQ-ACK sub-codebook and a second DAI field corresponding to the second HARQ-ACK sub-codebook
- harq-ACK-SpatialBundlingPUCCH is replaced by harq-ACK-SpatialBundlingPUSCH.

If a UE is not provided PDSCH-CodeBlockGroupTransmission and the UE is scheduled for a PUSCH transmission by DCI format that includes a DAI field with value \( V_{\text {T-DAI }}^{\text {UL }}=4 \) and the UE has not received any PDCCH within the monitoring occasions for PDCCH with DCI format scheduling PDSCH receptions or having associated HARQ-ACK information without scheduling PDSCH receptions on any serving cell \( c \) and the UE does not have HARQ-ACK information in response to a SPS PDSCH reception to multiplex in the PUSCH, as described in clause 9.1.3.1, the UE does not multiplex HARQ-ACK information in the PUSCH transmission.

If a UE is provided PDSCH-CodeBlockGroupTransmission and the UE is scheduled for a PUSCH transmission by DCI format that includes a DAI field with first value \( V_{\mathrm{T}-\mathrm{DAI}}^{\mathrm{UL}}=4 \) or with second value \( V_{\mathrm{T}-\mathrm{DA}}^{\mathrm{UL}}=4 \) and the UE has not received any PDCCH within the monitoring occasions for PDCCH with DCI format scheduling PDSCH reception or having associated HARQ-ACK information without scheduling PDSCH reception, on any serving cell \( c \) and the UE does not have HARQ-ACK information in response to a SPS PDSCH reception to multiplex in the PUSCH, as described in clause 9.1.3.1, the UE does not multiplex HARQ-ACK information for the first sub-codebook or for the second subcodebook, respectively, in the PUSCH transmission.

\begin{table}
\captionsetup{labelformat=empty}
\caption{Table 9.1.3-2: Value of DAI}
\begin{tabular}{|l|l|l|}
\hline DAI MSB, LSB & \( \boldsymbol{V}_{\text {T-DAI }}^{\mathrm{UL}} \) & Number of (serving cell, PDCCH monitoring occasion)-pair(s) in which PDSCH transmission(s) associated with PDCCH or PDCCH indicating SPS PDSCH release or providing TCI state update or DCI format 1_1 indicating SCell dormancy is present, denoted as \( X \) and \( X \geq 1 \) \\
\hline 0,0 & 1 & \( (X-1) \bmod 4+1=1 \) \\
\hline 0,1 & 2 & \( (X-1) \bmod 4+1=2 \) \\
\hline 1,0 & 3 & \( (X-1) \bmod 4+1=3 \) \\
\hline 1,1 & 4 & \( (X-1) \bmod 4+1=4 \) \\
\hline
\end{tabular}
\end{table}
9.1.3.3 Type-2 HARQ-ACK codebook grouping and HARQ-ACK retransmission

If a UE is provided pdsch-HARQ-ACK-Codebook-r16, the UE determines HARQ-ACK information for multiplexing in a PUCCH transmission occasion according to the following procedure.

Set \( g \) to the value of a PDSCH group index field in a last DCI format that provides a value of \( g \) and indicates a PUCCH transmission occasion.

Set \( i(g) \) to denote a PUCCH transmission occasion for multiplexing HARQ-ACK information
Set \( k \) to the value of a PDSCH-to-HARQ_feedback timing field, if any, in a DCI format providing a value of \( g \)
- If the DCI format does not include a PDSCH-to-HARQ_feedback timing field, set \( k \) to the value provided by \( d l \) -DataToUL-ACK or dl-DataToUL-ACK-r16

Set \( h(g) \) to the value of a first New feedback indicator field in the last DCI format providing the value of \( g \)
Set \( h^{(g+1) \bmod 2}(g) \) to a value of a second New feedback indicator field in the last DCI format providing the value of \( g \)

ETSI