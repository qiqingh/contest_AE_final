<!-- Page 79 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
78
ETSI TS 138213 V17.1.0 (2022-05)

A UE does not expect to detect a DCI format switching a DL BWP within \( N_{3} \) symbols prior to a first symbol of a PUCCH transmission where the UE multiplexes HARQ-ACK information, where \( N_{3} \) is defined in clause 9.2.3.

If a UE is provided dl-DataToUL-ACK or dl-DataToUL-ACK-r16 or dl-DataToUL-ACK-DCI-1-2, the UE does not expect to be indicated by DCI format \( 1 \_0 \) a slot timing value for transmission of HARQ-ACK information that does not belong to the intersection of the set of slot timing values \( \{1,2,3,4,5,6,7,8\} \) for SCS configuration of PUCCH transmission \( \mu \leq 3,\{7,8,12,16,20,24,28,32\} \) for \( \mu=5 \), and \( \{13,16,24,32,40,48,56,64\} \) for \( \mu=6 \), and the set of slot timing values provided by \( K_{1} \) for the active DL BWP of a corresponding serving cell.

If maxNrofCodeWordsScheduledByDCI indicates reception of two transport blocks, when the UE receives a PDSCH with one transport block or a SPS PDSCH release or a TCI state update, the HARQ-ACK information is associated with the first transport block and the UE generates a NACK for the second transport block if harq-ACKSpatialBundlingPUCCH is not provided and generates HARQ-ACK information with value of ACK for the second transport block if harq-ACK-SpatialBundlingPUCCH is provided.

A UE determines \( \tilde{o}_{0}^{A C K}, \tilde{o}_{1}^{A C K}, \ldots, \tilde{o}_{O_{A C K}-1}^{A C K} \) HARQ-ACK information bits, for a total number of \( O_{A C K} \) HARQ-ACK information bits, of a HARQ-ACK codebook for transmission in a PUCCH according to the following pseudo-code. In the following pseudo-code, if the UE does not receive a transport block or a CBG, due to the UE not detecting a corresponding DCI format, the UE generates a NACK value for the transport block or the CBG. The cardinality of the set \( M_{A, C} \) defines a total number \( M_{c} \) of occasions for PDSCH reception or SPS PDSCH release or TCI state update for serving cell \( c \) corresponding to the HARQ-ACK information bits.

Set \( c=0 \)-serving cell index: lower indexes correspond to lower RRC indexes of corresponding cells including, when applicable, cells in the set \( S_{0} \) and the set \( S_{1} \)

Set \( j=0 \) - HARQ-ACK information bit index
Set \( N_{\text {cells }}^{\mathrm{DL}} \) to the number of serving cells configured by higher layers for the UE
while \( c<N_{\text {cells }}^{\mathrm{DL}} \)
Set \( m=0 \) - index of occasion for candidate PDSCH reception, or SPS PDSCH release, or TCI state update
while \( m<M_{c} \)
if enableTimeDomainHARQ-Bundling is provided for serving cell \( c \) and a PDSCH associated with occasion \( m \) is scheduled by a DCI format indicating a TDRA row that includes more than one SLIV entry
if harq-ACK-SpatialBundlingPUCCH is not provided and the UE is configured by maxNrofCodeWordsScheduledByDCI with reception of two transport blocks for the active DL BWP of serving cell \( c \)
if the PDSCH is associated with the last SLIV in the TDRA row
\( \tilde{O}_{j}^{A C K}= \) binary AND operation of the HARQ-ACK information bits corresponding to first transport blocks in PDSCH receptions, that do not overlap with an uplink symbol indicated by \( t d d-U L-D L- \) ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated, scheduled by the DCI format on serving cell \( c \);
\( j=j+1 ; \)
\( \tilde{o}_{j}^{\text {ACK }}= \) binary AND operation of the HARQ-ACK information bits corresponding to second transport blocks in PDSCH receptions, that do not overlap with an uplink symbol indicated by tdd-UL-DL-ConfigurationCommon or tdd-UL-DL-ConfigurationDedicated, scheduled by the DCI format on serving cell \( c \);
else
\( \tilde{o}_{j}^{\text {ACK }}=\mathrm{NACK} ; \)
\( j=j+1 ; \)
\( \tilde{o}_{j}^{\text {ACK }}=\mathrm{NACK} ; \)

ETSI