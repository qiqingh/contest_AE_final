<!-- Page 97 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
96
ETSI TS 138213 V17.1.0 (2022-05)

PDSCH group 0 and a value of \( h(g) \) associated with the DCI format is set only if \( h(g) \) is provided by another DCI format that provides a value of \( h(g) \) for PDSCH group 0 and indicates the slot for the PUCCH transmission occasion.

For PUCCH transmission occasion \( i(g) \), the UE determines a PUCCH or a PUSCH transmission to multiplex the HARQ-ACK information according to the procedures in clauses 9.2.3 and 9.2.5.

If \( O_{\mathrm{ACK}}+O_{\mathrm{SR}}+O_{\mathrm{CSI}} \leq 11 \), the UE determines a number of HARQ-ACK information bits \( n_{\mathrm{HARQ}-\mathrm{ACK}, g} \) for group \( g \) and a number of HARQ-ACK information bits \( n_{\text {HARQ-ACK }(g+1) \bmod 2} \) for group \( (g+1) \bmod 2 \) as described in clause 9.1.3.1 where \( N_{\mathrm{SPS}, c} \) is included in \( n_{\mathrm{HARQ}-\mathrm{ACK}, g} \) and, if \( q=1 \) and \( V_{\mathrm{DAI}}^{(g+1) \bmod 2} \neq \emptyset \), the UE determines \( n_{\text {HARQ-ACK }(g+1) \bmod 2} \) by setting \( V_{\text {DAI } \mathrm{m}_{\text {last }}}^{\mathrm{DL}}=V_{D A I}^{(g+1) \bmod 2} \). For obtaining a PUCCH transmission power, if \( q=0 \), \( n_{\text {HARQ-ACK }}=n_{\text {HARQ-ACK }, g} \); else, \( n_{\text {HARQ-ACK }}=n_{\text {HARQ-ACK }, g}+n_{\left.\text {HARQ-ACK }_{( } g+1\right) \bmod 2} \) -
9.1.4 Type-3 HARQ-ACK codebook determination

If a UE is provided pdsch-HARQ-ACK-OneShotFeedback, the UE determines \( \tilde{o}_{0}^{A C K}, \tilde{o}_{1}^{A C K}, \ldots, \tilde{o}_{O_{A C K}-1}^{A C K} \) HARQ-ACK information bits, for a total number of \( O_{A C K} \) HARQ-ACK information bits, of a Type-3 HARQ-ACK codebook according to the following procedure. If the UE is provided pdsch-HARQ-ACK-enhType3List and a DCI format scheduling PDSCH reception and triggering the Type-3 HARQ-ACK codebook includes a Type3-subcodebook-index field that provides a value for \( p d s c h \)-HARQ-ACK-enhType3Index, the UE determines a number of indicated serving cells \( N_{\text {cells }}^{\text {DLind }} \) and a number of indicated HARQ processes \( N_{\text {HARQ, }}^{\text {DLind }} \) for each indicated serving cell \( c \) from the entry in pdsch-HARQ-ACK-enhType3List corresponding to the pdsch-HARQ-ACK-enhType3Index value. If the DCI format does not include the Type3-subcodebook-index field, the pdsch-HARQ-ACK-enhType3Index value is zero.

Set \( N_{\text {cells }}^{\text {DL }} \) to the number of configured serving cells or, when applicable, to \( N_{\text {cells }}^{\text {DL }} \)
Set \( N_{\mathrm{HARQ}, c}^{\mathrm{DL}} \) to the value of nrofHARQ-ProcessesForPDSCH for serving cell \( c \), if provided; else, set \( N_{\mathrm{HARQ}, c}^{\mathrm{DL}}=8 \).
When applicable, set \( N_{\mathrm{HARQ}, c}^{\mathrm{DL}} \) to \( N_{\mathrm{HARQ}, c}^{\mathrm{DL} \text { ind }} \)
Set \( N_{\mathrm{TB}, c}^{\mathrm{DL}} \) to the value of maxNrofCodeWordsScheduledByDCI for serving cell \( c \) if harq-ACK-SpatialBundlingPUCCH is provided and \( N D I_{\text {HARQ }}=0 \), or if harq-ACK-SpatialBundlingPUCCH is not provided, or if maxCodeBlockGroupsPerTransportBlock is provided for serving cell \( c \); else, set \( N_{\mathrm{TB}, c}^{\mathrm{DL}}=1 \)

Set \( N_{\text {HARQ-ACK }} \) CBG/TB, to the number of HARQ-ACK information bits per TB for PDSCH receptions on serving cell \( c \) as described in clause 9.1.1 if maxCodeBlockGroupsPerTransportBlock is provided for serving cell \( c \) and pdsch-HARQ-ACK-OneShotFeedbackCBG or pdsch-HARQ-ACK-enhType3CBG is provided; else, set \( N_{\text {HARQ-ACK }, c}^{\text {CBG/TB }}=0 \)

Set \( N D I_{\mathrm{HARQ}}=0 \) if pdsch-HARQ-ACK-OneShotFeedbackNDI or pdsch-HARQ-ACK-enhType3NDI is provided; else set \( N D I_{\text {HARQ }}=1 \)

Set \( c=0 \)-serving cell index
Set \( h=0- \) HARQ process number
Set \( t=0- \) TB index
Set \( g=0- \) CBG index
Set \( j=0 \)
while \( c<N_{\text {cells }}^{\mathrm{DL}} \)
while \( h<N_{\text {HARQ } c}^{\text {DL }} \)
if HARQ-feedbackEnabling-disablingperHARQprocess is not provided, or is provided and indicates enabled HARQ-ACK information for \( h \), or HARQ-feedbackEnablingforSPSactive is provided and \( h \) corresponds to a transport block in a first SPS PDSCH reception after an activation of SPS PDSCH receptions
if \( N D I_{\mathrm{HARQ}}=0 \)
if \( N_{\mathrm{HARQ}-\mathrm{ACK}_{1} c}^{\mathrm{CBG} / \mathrm{TB}, \max }>0 \)

ETSI