<!-- Page 53 of ts_138213v170100p -->

3GPP TS 38.213 version 17.1.0 Release 17
52
ETSI TS 138213 V17.1.0 (2022-05)

else, the UE is provided a SLIV by startSymbolAndLengthMsgA-PO, and a PUSCH mapping type by mappingTypeMsgA-PUSCH for a PUSCH transmission.

For mapping one or multiple preambles of a PRACH slot to a PUSCH occasion associated with a DMRS resource, a UE determines a first slot for a first PUSCH occasion in an active UL BWP from msgA-PUSCH-TimeDomainOffset that provides an offset, in number of slots in the active UL BWP, relative to the start of a PUSCH slot including the start of each PRACH slot. The UE does not expect to have a PRACH preamble transmission and a PUSCH transmission with a msgA in a PRACH slot or in a PUSCH slot, or to have overlapping msgA PUSCH occasions for a MsgA PUSCH configuration. The UE expects that a first PUSCH occasion in each slot has a same SLIV for a PUSCH transmission that is provided by startSymbolAndLengthMsgA-PO or msgA-PUSCH-timeDomainAllocation [6, TS 38.214].

Consecutive PUSCH occasions within each slot are separated by guardPeriodMsgA-PUSCH symbols and have same duration. A number \( N_{t} \) of time domain PUSCH occasions in each slot is provided by nrofMsgA-PO-perSlot and a number \( N_{s} \) of consecutive slots that include PUSCH occasions is provided by nrofSlotsMsgA-PUSCH.

A UE is provided a DMRS configuration for a PUSCH transmission in a PUSCH occasion in an active UL BWP by msgA-DMRS-Config.

A UE is provided an MCS for data information in a PUSCH transmission for a PUSCH occasion by msgA-MCS.
For a PUSCH transmission with frequency hopping in a slot, when indicated by msgA-intraSlotFrequencyHopping for the active UL BWP, the frequency offset for the second hop [6, TS 38.214] is determined as described in clause 8.3, Table 8.3-1 using msgA-HoppingBits instead of \( N_{\mathrm{UL}, \mathrm{h} \mathrm{p}} \) - If guardPeriodMsgA-PUSCH is provided, a first symbol of the second hop is separated by guardPeriodMsgA-PUSCH symbols from the end of a last symbol of the first hop; otherwise, there is no time separation of the PUSCH transmission before and after frequency hopping. If a UE is provided with uselnterlacePUCCH-PUSCH in BWP-UplinkCommon, the UE shall transmit PUSCH without frequency hopping. A PUSCH transmission uses a same spatial filter as an associated PRACH transmission.

A UE determines whether or not to apply transform precoding for a PUSCH transmission as described in [6, TS 38.214].

A PUSCH occasion for PUSCH transmission is defined by a frequency resource and a time resource, and is associated with a DMRS resource. The DMRS resources are provided by msgA-DMRS-Config-

Each consecutive number of \( N_{\text {preamble preamble indexes from valid PRACH occasions in a PRACH slot }} \)
- first, in increasing order of preamble indexes within a single PRACH occasion
- second, in increasing order of frequency resource indexes for frequency multiplexed PRACH occasions
- third, in increasing order of time resource indexes for time multiplexed PRACH occasions within a PRACH slot
are mapped to a valid PUSCH occasion and the associated DMRS resource
- first, in increasing order of frequency resource indexes \( f_{i d} \) for frequency multiplexed PUSCH occasions
- second, in increasing order of DMRS resource indexes within a PUSCH occasion, where a DMRS resource index \( D M R S_{i d} \) is determined first in an ascending order of a DMRS port index and second in an ascending order of a DMRS sequence index [4, TS 38.211]
- third, in increasing order of time resource indexes \( t_{i d} \) for time multiplexed PUSCH occasions within a PUSCH slot
- fourth, in increasing order of indexes for \( N_{s} \) PUSCH slots
where \( N_{\text {preamble }}=\operatorname{ceil}\left(T_{\text {preamble }} / T_{\text {PUSCH }}\right), T_{\text {preamble }} \) is a total number of valid PRACH occasions per association pattern period multiplied by the number of preambles per valid PRACH occasion provided by rachConfigCommonTwoStepRA, and \( T_{\text {PUSCH }} \) is a total number of valid PUSCH occasions per PUSCH configuration per association pattern period multiplied by the number of DMRS resource indexes per valid PUSCH occasion provided by msgA-DMRS-Config.

ETSI